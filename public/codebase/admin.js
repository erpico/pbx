!function(e){function t(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/codebase/",t(t.s=83)}([function(e,t,i){"use strict";var o=i(87);i.d(t,"a",function(){return o.a});var r=i(12);i.d(t,"b",function(){return r.a});var n=(i(64),i(93),i(94),i(95),i(96)),a=i(97),s=i(100),l=i(101),c=i(102),d=i(103),u=i(104);n.a,a.a,s.a,c.a,u.a,l.a,d.a;window.Promise||(window.Promise=webix.promise)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=(i(0),i(43)),n=i(44),a=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("outgoingcampaign",this)}return e.prototype.roleAllowed=function(){return["phc.oc","erpico.admin"]},e.prototype.getView=function(){return{id:"outgoingcampaign",hidden:!0,rows:[(new r.default).getView(),(new n.default).getView()]}},e.prototype.loadData=function(){var e=this;$$("outgoingcampaign-toolbar").show(),$$("outgoingcampaigns")&&(this.loaded||(webix.extend($$("outgoingcampaigns"),webix.ProgressBar),$$("outgoingcampaigns").load("/outgoingcampaign/list","json",function(){e.loaded=1})))},e}();t.default=a},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=(i(66),i(0)),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{view:"submenu",id:"profilePopup",css:"top-context-menu",width:150,padding:0,top:49,right:0,data:[{id:"settings",icon:"",value:"Настройки"},{id:"logout",icon:"sign-out",value:"Выйти"}],on:{onMenuItemClick:function(e){"logout"==e?webix.auth.logout():"settings"==e&&webix.auth.settings()}},type:{template:function(e){return e.type?"<div class='separator'></div>":"<span class='webix_icon alerts fa-"+e.icon+"'></span><span>"+e.value+"</span>"}}}},t.prototype.showPopup=function(){this.getRoot().show()},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(4),l=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";$$("outgoingcampaign-toolbar").hide(),$$("outgoingcampaigns").hide(),$$("outgoingcampaign-form").show(),e&&$$("co-form").setValues(e)}function t(e,t){webix.ajax().get("outgoingcampaign/"+t+"/state/"+e).then(function(e){var t=e.json();t.result?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),$$("outgoingcampaigns").load($$("outgoingcampaigns").config.url)):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}return{id:"outgoingcampaign-toolbar",hidden:!0,css:"top-menu-right-item",cols:[{view:"button",width:130,label:"Новая кампания",click:function(){e()}},{view:"button",width:130,label:"Правила по умолчанию",click:function(){this.$scope.ui(s.OCRulesWnd).showWindow(this.$scope.$view),$$("co-settings-result").load("/outgoingcampaign/0/settings").then(function(){$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")})}},{view:"button",width:"80",label:"СТАРТ",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(2,e.id):webix.message({type:"error",text:"Выберите кампанию для запуска"})}},{view:"button",width:"80",label:"ПАУЗА",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(3,e.id):webix.message({type:"error",text:"Выберите кампанию для приостановки"})}},{view:"button",width:"80",label:"СТОП",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(4,e.id):webix.message({type:"error",text:"Выберите кампанию для остановки"})}}]}},t.prototype.init=function(){},t}(a.b);t.default=l},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"OCRulesWnd",function(){return l});var a=i(0),s=function(){var e=[];return $$("co-settings-result").serialize().forEach(function(t){var i={};parseInt(t.pause)&&(i.pause=1,i.pause_time=t.pause_time),parseInt(t.stop)?i.stop=1:parseInt(t.postpone_for_radio)?i.postpone_for=t.postpone_for:parseInt(t.postpone_to)&&(i.postpone_to=t.postpone_to_date),i.result=t.id,e.push(i)}),e},l=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){function e(){var e=$$("co-form").getValues();$$("min_call_time")&&!$$("min_call_time").getValue()&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))}return{id:"co-setup-window",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:500,width:900,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Расширенные настройки",align:"left"},{view:"icon",icon:"wxi-close",click:function(){$$("co-setup-window").close()}}]},body:{view:"form",id:"co-setup-form",scroll:!0,elements:[{view:"fieldset",label:"Действия после звонка",body:{rows:[{view:"form",id:"settings-form",elements:[{cols:[{view:"fieldset",label:"Результат",body:{view:"list",width:250,height:200,select:"row",id:"co-settings-result",data:[],on:{onAfterSelect:function(){e(),$$("settings-form").save()},onAfterRender:function(){e()},onDataUpdate:function(){}},ready:function(){}}},{view:"fieldset",label:"Campaning",width:200,body:{height:200,rows:[{view:"checkbox",name:"pause",labelRight:"Пауза обработки после звонка",labelWidth:0},{view:"counter",name:"pause_time",value:0,label:"секунд",labelAlign:"right"},{view:"text",name:"result",label:"result"}]}},{view:"fieldset",label:"Контакт",body:{height:200,rows:[{view:"radio",name:"stop",id:"stop",value:0,options:[{id:1,value:"Прекратить"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_to_date").disable(),$$("postpone_for").disable(),$$("postpone_to").setValue(0),$$("postpone_for_radio").setValue(0))}}},{cols:[{view:"radio",value:0,id:"postpone_for_radio",name:"postpone_for_radio",options:[{id:1,value:"Отложить на"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_for").enable(),$$("postpone_to_date").disable(),$$("postpone_to").setValue(0),$$("stop").setValue(0))}}},{view:"counter",value:0,name:"postpone_for",id:"postpone_for",labelRight:"секунд",disabled:!0,on:{onChange:function(e,t){e?($$("postpone_for_radio").setValue(1),this.enable(),$$("stop").setValue(0),$$("postpone_to").setValue(0),$$("postpone_to_date").disable()):($$("postpone_for_radio").setValue(0),this.disable())}}}]},{cols:[{view:"radio",value:0,name:"postpone_to",id:"postpone_to",options:[{id:1,value:"Отложить до"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_for").disable(),$$("postpone_to_date").enable(),$$("postpone_for_radio").setValue(0),$$("stop").setValue(0))}}},{view:"datepicker",name:"postpone_to_date",id:"postpone_to_date",timepicker:!0,disabled:!0,placeholder:"Click to select"}]}]}}]}]},{rows:[{cols:[{view:"label",label:"Минимальное время соединения для фиксации успеха"},{view:"counter",id:"min_call_time",name:"min_call_time",labelRight:"секунд"}]},{cols:[{view:"label",label:"Количество одновременных звонков"},{view:"counter",id:"concurrent_calls_limit",name:"concurrent_calls_limit"}]},{cols:[{},{view:"button",label:"Ок",click:function(){if($$("co-form")&&$$("co-form").isVisible())window.concurrent_calls_limit=$$("concurrent_calls_limit").getValue(),window.min_call_time=$$("min_call_time").getValue(),window.settingsResult=$$("co-settings-result").serialize(),$$("settings-form").save(),$$("co-setup-window").close();else{$$("settings-form").save(),console.log(s());var e=s();webix.ajax().post("outgoingcampaign/0/settings/save",{settings:e}).then(function(e){var t=e.json();t.result?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),$$("co-setup-window").close()):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}}},{view:"button",label:"Отмена",click:function(){$$("co-setup-window").close()}}]}]}]}}]}}},t.prototype.showWindow=function(){this.getRoot().show(),$$("settings-form").bind($$("co-settings-result"));var e=$$("co-form").getValues();$$("min_call_time")&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))},t}(a.b)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(6),l=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{id:"users_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus-circle",width:240,label:"Добавить пользователя",click:function(){(new s.ClientsWindow).show({})}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var e=$$("users").getSelectedItem().id,t="/users/list?filter[id]="+e,i=null;webix.ajax(t).then(function(e){i=e.json().data[0]}).then(function(){if(i){i.id=0;(new s.ClientsWindow).show(i)}else webix.message({type:"error",text:"Выберите пользователя для копирования"})})}},{},{view:"button",type:"icon",icon:"fa fa-sync",width:56,css:"disable_margin_btn_tbar",click:function(){webix.guiutils.loadUserTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:206,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("users"),{filterHTML:!0,filename:"Пользователи"})}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"ClientsWindow",function(){return n});var r=(i(0),i(7)),n=function(){function e(){o(this,e)}return e.prototype.show=function(e){var t,i=[{id:"1",value:"Активный"},{id:"2",value:"Заблокирован"},{id:"3",value:"Удален"},{id:"4",value:"Скрытый"}],o=this.getThis(),n=(t={elementsConfig:{labelWidth:100},view:"form",id:"add-form",scroll:!0,minHeight:450,height:390,borderless:!0,elements:[{cols:[{view:"tabview",borderless:!0,tabbar:{optionWidth:180},cells:[{id:"settings",header:"Основные данные",body:{padding:17,minHeight:450,width:700,rows:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"fullname",label:"ФИО",inputAlign:"left",labelWidth:150,required:!0,width:650,placeholder:"Введите ФИО"},{cols:[{view:"text",name:"phone",label:"Номер",inputAlign:"left",labelWidth:150,width:325,placeholder:"Введите телефон"},{view:"text",name:"name",label:"Логин",inputAlign:"left",labelWidth:150,required:!0,width:325,placeholder:"Введите логин"}]},{cols:[{view:"select",name:"state",label:"Статус",inputAlign:"left",labelWidth:150,options:i,width:325,placeholder:"Выберите статус"},{view:"text",name:"password",id:"user-password",label:"Пароль",type:"password",inputAlign:"left",labelWidth:150,width:325,placeholder:"Введите пароль"}]},{view:"multicombo",name:"user_groups_ids",label:"Группы",inputAlign:"left",labelWidth:150,autoheight:!0,options:"/users/user_groups",width:650,placeholder:"Выберите группы"},{view:"multicombo",name:"rules",label:"Права доступа",inputAlign:"left",labelWidth:150,autoheight:!0,options:{body:{template:"#name#"},url:"/rules/list"},width:650,placeholder:"Назначьте права"},{view:"text",name:"description",label:"Описание",inputAlign:"left",labelWidth:150,width:650,placeholder:"Введите описание"},{height:10}]}},{header:"Переадресация",id:"forwarding",body:{width:700,minHeight:350,padding:17,rows:[{cols:[{view:"switch",labelRight:"Все звонки на номер",labelWidth:120,id:"cfwd.all.switch",labelPosition:"top",on:{onChange:function(e){webix.guiutils.updateControls()}}},{view:"text",id:"cfwd.all",name:"config.cfwd.all",label:"",placeholder:"Введите телефон"},{}]},{cols:[{view:"switch",labelRight:"После",labelWidth:120,id:"cfwd.noanswer.switch",labelPosition:"top",width:115,on:{onChange:function(e){webix.guiutils.updateControls()}}},{view:"text",id:"cfwd.noanswer.timeout",name:"config.cfwd.noanswer.timeout",placeholder:"000",labelWidth:120,suggest:[{id:5,value:"5"},{id:10,value:"10"},{id:20,value:"20"},{id:30,value:"30"}],width:75},{view:"text",id:"cfwd.noanswer",name:"config.cfwd.noanswer",label:"сек ожидания на номер",labelWidth:190,width:450,placeholder:"Введите телефон"},{}]},{view:"label",template:'<hr style="border: 0.5px solid #DDDDDD">',height:10},{cols:[{view:"switch",id:"cfwd.divert",name:"config.cfwd.divert",labelRight:"Переадресовывать",labelPosition:"top",on:{onChange:function(e){webix.guiutils.updateControls()}}},{css:"custom_margin_radio",view:"radio",id:"cfwd.duration.of.redirection",name:"config.cfwd.duration.of.redirection",options:[{id:"1",value:"весь день"},{id:"2",value:"c"}],width:190,on:{onChange:function(e){webix.guiutils.updateControls()}}},{id:"cfwd.limit.from",name:"config.cfwd.limit.from",view:"datepicker",type:"time",stringResult:!0,editable:!0,labelPosition:"left",format:"%H:%i",width:80},{css:"custom_padding_lbl",id:"cfwd.limit.to",name:"config.cfwd.limit.to",view:"datepicker",type:"time",stringResult:!0,editable:!0,label:"по",labelPosition:"left",format:"%H:%i",labelWidth:35,width:115}]},{cols:[{view:"multicombo",id:"cfwd.limit.days",name:"config.cfwd.limit.days",labelWidth:250,button:!0,options:[{id:"wd",value:"рабочие дни"},{id:"nwd",value:"выходные"},{id:"mo",value:"пн"},{id:"tu",value:"вт"},{id:"we",value:"ср"},{id:"th",value:"чт"},{id:"fr",value:"пт"},{id:"sa",value:"сб"},{id:"su",value:"вс"}]}]},{margin:10,cols:[{label:"Сообщение о переадресации",view:"select",id:"cfwd.notify",name:"config.cfwd.notify",labelPosition:"top",options:[{id:"0",value:"Отсутствует"},{id:"1",value:"Стандартное"},{id:"2",value:"Моя фраза"}],on:{onChange:function(e){webix.guiutils.updateControls()}}},{label:"Сообщение",view:"text",id:"cfwd.notify.message",name:"config.cfwd.notify.message",labelPosition:"top"}]}]}}],on:{onBeforeTabClick:function(e){console.log(13)}}},{rows:[{view:"icon",icon:"wxi-close",css:"window_close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("add-win").close()}})}}]}]}]},t.elementsConfig={labelPosition:"left",margin:0},t.rules={password:function(t){return!!e||t.length}},t),a={view:"window",id:"add-win",position:"center",maxWidth:700,css:"window-label-left",resize:!1,move:!0,modal:!0,borderless:!0,head:{height:450,minHeight:450,width:700,borderless:!0,rows:[n,{padding:17,margin:10,cols:[{css:"custom_trash_button",view:"button",label:"Удалить",type:"icon",align:"center",hidden:!e.id,width:110,icon:"wxi-trash",click:function(){webix.confirm({text:"Удалить пользователя <br> Продолжить?",callback:function(e){if(e){var t=$$("add-form"),i=t.getValues();i.state=3,i.id&&i.state&&webix.ajax().post("/users/"+i.id+"/save",i).then(function(e){t.enable(),e=e.json(),e.result?(webix.guiutils.loadUserTable(),webix.message({type:"success",text:e.message}),webix.$$("add-win").close()):webix.message({type:"error",text:e.message})}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),console.log(e)})}}})}},{},{css:"optional_btn",view:"button",label:"Настройки",align:"center",width:120,hidden:!e||!e.id,click:function(){this.$scope.ui(r.SettingsWindow).showWindow(o.getId(),"user")}},{css:"optional_btn",view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("add-win").close()}})}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("add-form");if(e.validate()){e.disable();var t=e.getValues(),i=Object.keys(t);t.config=[],i.forEach(function(e){-1!=e.toString().indexOf("config.")&&(0!=t["config.cfwd.notify.message"].length&&"config.cfwd.notify"==e?t.config.push({key:e.replace("config.",""),value:t["config.cfwd.notify.message"]}):"config.cfwd.notify.message"!=e&&t.config.push({key:e.replace("config.",""),value:t[e]}))}),t.id||(t.id=0),webix.ajax().post("/users/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(users.prototype.loaded=0,webix.guiutils.loadUserTable(),webix.message({type:"success",text:t.message}),webix.$$("add-win").close()):webix.message({type:"error",text:t.message})}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),console.log(e)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}}]}]},body:{height:1},on:{onShow:function(){var t=e;if(t)if(t.id){if(o.setId(t.id),$$("add-form").setValues(t),t&&t.id&&t.hasOwnProperty("config")){var i=t.config;i.forEach(function(e){"cfwd.duration.of.redirection"==e.key&&"2"==e.value&&$$("cfwd.divert").setValue(1),"cfwd.limit.days"==e.key&&e.value.length>0&&$$("cfwd.divert").setValue(1),"cfwd.all"==e.key&&e.value.length>0&&$$("cfwd.all.switch").setValue(1),"cfwd.noanswer"==e.key&&e.value.length>0&&$$("cfwd.noanswer.switch").setValue(1),$$(e.key)&&e.value&&$$(e.key).setValue(e.value),"cfwd.notify"==e.key&&e.value&&"0"!=e.value&&"1"!=e.value&&($$("cfwd.notify").setValue("2"),$$("cfwd.notify.message").setValue(e.value))})}}else o.setId(0);else $$("add-form").setValues({id:0}),o.setId(0);webix.guiutils.updateControls()}}};webix.ui(a).show(),$$("add-form").setValues(e)},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.clientId},e.prototype.setId=function(e){this.clientId=e},e.prototype.showWindow=function(){this.getRoot().show()},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"SettingsWindow",function(){return s});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){var e=this.getThis();return{view:"window",id:"settings-win",position:"center",move:!0,resize:!0,modal:!0,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Настройки",align:"left"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("settings-win").close()}})}}]},body:{width:800,view:"form",id:"settings-form",minHeight:500,scroll:!0,elements:[{view:"datatable",id:"settings-table",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,editable:!0,columns:[{id:"handle",header:"название столбца",fillspace:2,minWidth:50},{id:"val",header:"столбец",fillspace:2,minWidth:150,editor:"text"},{id:"changed",hidden:!0}],ready:function(){this.getChangedSettings=function(){var e=this.serialize(),t=[];return e.forEach(function(e){parseInt(e.changed)&&t.push(e)}),t},this.save=function(){var t=$$("settings-table");t.disable();var i=t.getChangedSettings();if(!i.length)return webix.message({type:"error",text:"Изменений не зафиксированно"}),void t.enable();i.forEach(function(e){"cti.ext"==e.handle&&webix.$$("add-form").elements.phone.setValue(e.val)}),webix.ajax().post("/settings/"+e.getType()+"/"+e.getTypeId()+"/save",{settings:i}).then(function(e){t.enable(),e=e.json(),e.result?(webix.message({type:"success",text:"Сохранение пришло успешно"}),t.enable(),webix.$$("settings-win").close()):(webix.message({type:"error",text:"Произошла ошибка сохранения"}),t.enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),t.enable(),console.log(e)})}},on:{onBeforeLoad:function(){this.clearAll()},onBeforeContextMenu:function(e){if(!this.getItem(e).main)return!1;this.select(e)},onEditorChange:function(e,t){this.getItem(e.row).changed=1,this.refresh(e.row)}},scheme:{$init:function(e){e.main||(e.$css="good-row")}}},{margin:10,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){webix.confirm({text:"Все измененные данные будут сохранены. <br> Продолжить?",callback:function(e){e&&$$("settings-table").save()}})}},{view:"button",label:"Закрыть",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("settings-win").close()}})}}]}]},on:{onShow:function(){if(!parseInt(e.typeId))return webix.message({type:"error",text:"Произошла ошибка получения настроек"}),webix.$$("settings-win").close(),!1;$$("settings-table").load("/settings/"+e.getType()+"/"+e.getTypeId())}}}},t.prototype.getThis=function(){return this},t.prototype.setType=function(e){this.type=e},t.prototype.setTypeId=function(e){this.typeId=e},t.prototype.getType=function(){return this.type},t.prototype.getTypeId=function(){return this.typeId},t.prototype.showWindow=function(e,t){this.setType(t),this.setTypeId(e),this.getRoot().show()},t.prototype.init=function(){var e=this.getThis();$$("settingsContext")||this.ui({view:"contextmenu",id:"settingsContext",width:450,data:[{id:"restore",value:"Восстановить значение по умолчанию"}],on:{onMenuItemClick:function(t){var i=this.getMenuItem(t),o=$$("settings-table").getSelectedItem();"restore"==i.id&&webix.confirm({text:"Внимание! Значение будет восстановлено по умолчанию. <br> Продолжить?",callback:function(t){t&&webix.ajax().get("/settings/user/"+e.getTypeId()+"/default/"+o.handle,function(t){var i=JSON.parse(t);i.result?$$("settings-table").load("/settings/"+e.getType()+"/"+e.getTypeId()):webix.message({type:"error",text:i.message?i.message:"Произошла ошибка"})})}})},onBeforeShow:function(){if(!$$("settings-table").getSelectedItem().main)return!1}}}),$$("settingsContext").attachTo($$("settings-table"))},t.prototype.destroy=function(){console.log("d"),$$("settingsContext").destructor()},t}(a.b)},function(e,t,i){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(){function e(){n(this,e)}return e.prototype.getFormValues=function(){var e=$$("form-queues");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.getQueueCode=function(e,t){if(!e)return!1;$$("queueName").disable(),$$("queueName").showProgress(),webix.ajax().get("/queues/code",{name:e}).then(function(e){$$("queueName").enable(),$$("queueName").hideProgress(),e=e.json(),e.result&&t&&t(e)})},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/queues/"+e.id+"/save",e).then(function(e){$$("form-queues").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-queues").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-queues").enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),$$("form-queues").enable(),console.log(e)})},e.prototype.loadTable=function(){webix.guiutils.loadTable("queues","/queues/list")},e.prototype.closeWindow=function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("window-queues").close()}})},e.prototype.hide=function(){$$("window-queues").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),i={view:"form",id:"form-queues",minHeight:500,minWidth:700,elements:[{cols:[{rows:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"fullname",required:!0},{padding:0,view:"text",id:"queueName",label:"Код",name:"name",required:!0,on:{onFocus:function(){var e=$$("form-queues").getValues();e.name||t.getQueueCode(e.fullname,function(t){e.name=t.message,$$("form-queues").setValues(e)})}}}]},{view:"combo",name:"pattern",label:"Шаблон",filter:function(e,t){return-1!==t.indexOf(t)},options:{body:{url:"/config/queues",template:"#value#"}}},{view:"textarea",name:"description",label:"Описание",labelWidth:120,height:100},{view:"text",label:"Адрес скрипта обработки",name:"url"},{cols:[{view:"counter",label:"Автопауза",name:"autopause",width:120},{view:"combo",label:"Автозакрытие",name:"close_on_hangup",width:120,options:[{id:1,value:"Да"},{id:2,value:"Нет"},{id:3,value:"10 сек"},{id:4,value:"60 сек"},{id:5,value:"5 мин"},{id:6,value:"10 мин"}]},{view:"text",label:"ID сервиса",name:"service_id",width:120}]},{cols:[{view:"counter",label:"Операторов < ",name:"alarms.operators",width:120},{view:"counter",label:"Звонков >",name:"alarms.calls",width:120},{view:"counter",label:"Ожидание >",name:"alarms.maxwait",width:120},{}]},{cols:[{view:"switch",label:"Скрыть",name:"hidden",labelPosition:"top",width:120},{view:"switch",label:"VIQ",name:"viq",width:120},{view:"switch",label:"Включено",labelPosition:"top",name:"active",id:"active",width:120}]}]},{id:"operators_tbl",view:"datatable",resizeColumn:!0,resizeRow:!1,select:!0,editable:!0,multiselect:!0,tooltip:!0,minWidth:400,onContext:{webix_view:function(e,t){(t=this.locate(e.target||e.srcElement))||($$("cmenu").setContext({obj:webix.$$(e)}),$$("cmenu").show(e),webix.html.preventEvent(e),$$("cmenu").clearAll(),$$("cmenu").parse([{id:"new",value:"Добавить"}]),$$("operators_tbl").unselectAll())}},data:[],columns:[{editor:"combo",header:"Сотрудник",id:"acl_user_id",sort:"string",options:"/groups/users/short",width:120},{header:"Телефон",width:100,id:"phone",editor:"text",template:function(e){return"string"!=typeof e.phone?"":e.phone}},{header:"Приоритет",id:"penalty",editor:"combo",sort:"string",width:110,options:[{id:1,value:"1"},{id:2,value:"2"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"},{id:7,value:"7"},{id:8,value:"8"},{id:9,value:"9"},{id:10,value:"10"}]},{header:"Статика",id:"static",name:"static",width:110,fillspace:1,template:"{common.checkbox()}"}],on:{onBeforeContextMenu:function(e){this.getItem(e)?(this.select(e),$$("cmenu").clearAll(),$$("cmenu").parse([{id:"new",value:"Добавить"},{id:"delete",value:"Удалить"}])):($$("cmenu").clearAll(),$$("cmenu").parse([{id:"new",value:"Добавить"}]))},onItemClick:function(e){var t=$$("operators_tbl").getItem(e),i=$$("operators_tbl").getItem(e).static;""==t.acl_user_id&&0==i&&$$("operators_tbl").updateItem(e,{static:!i})},onCheck:function(e,t,i){$$("operators_tbl").unselectAll(),$$("operators_tbl").select(e,!0);var o=$$("operators_tbl").getSelectedId(),r=$$("operators_tbl").getItem(e);r.acl_user_id||0!=i||(webix.message("Динамичными агентами могут быть только сотрудники","error"),o.column="static",r[o.column]=1,o.row&&$$("operators_tbl").updateItem(o.row,r))}},ready:function(){$$("cmenu")||webix.ui({view:"contextmenu",width:180,id:"cmenu",data:[{id:"new",value:"Добавить"}],on:{onMenuItemClick:function(e){switch(e){case"new":$$("operators_tbl").add({acl_user_id:"",phone:" ",penalty:"1",static:1});break;case"delete":var e=$$("operators_tbl").getSelectedId();e&&$$("operators_tbl").remove(e)}}}}),$$("cmenu").attachTo(this)}}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10}},o={id:"window-queues",view:"window",position:"center",move:!0,modal:!0,resize:!0,scroll:!0,height:700,maxHeight:1500,width:900,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  очередь",align:"left"},{view:"icon",icon:"wxi-close",click:function(){t.closeWindow()}}]},body:{padding:17,rows:[i,{margin:10,cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();$$("operators_tbl").editStop();var i=[];$$("operators_tbl").serialize().forEach(function(e){i.push({acl_user_id:e.acl_user_id,phone:e.phone,penalty:e.penalty,static:e.static})}),e.agents=i,e.alarms={"alarms.operators":e["alarms.operators"],"alarms.calls":e["alarms.calls"],"alarms.maxwait":e["alarms.maxwait"]},e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]},on:{onShow:function(){webix.extend($$("queueName"),webix.ProgressBar);var t=JSON.parse(e.alarms);e["alarms.operators"]=t["alarms.operators"],e["alarms.calls"]=t["alarms.calls"],e["alarms.maxwait"]=t["alarms.maxwait"],$$("form-queues").setValues(e),Array.isArray(e.agents)&&e.agents.forEach(function(e){$$("operators_tbl").add(e)})}}};webix.ui(o).show()},e}(),l=function(e){function t(){return n(this,t),o(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return window.queuesWindow=new s,{id:"queues_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){queuesWindow.show({})}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("queues").getSelectedId()?queuesWindow.show($$("queues").getSelectedItem()):webix.message({type:"error",text:"Выберите очередь для редактирования"})}},{view:"button",type:"icon",icon:"fa fa-trash",id:"removeQueue",width:150,label:"Удалить",click:function(){$$("queues").getSelectedId()?webix.guiutils.removeFromTable(parseInt($$("queues").getSelectedId()),"/queues/"+parseInt($$("queues").getSelectedId())+"/remove","queues","removeQueue"):webix.message({type:"error",text:"Выберите очередь для удаления"})}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var e=$$("queues").getSelectedItem().id,t="/queues/list?filter[id]="+e,i=null;webix.ajax(t).then(function(e){i=e.json().data[0]}).then(function(){i?(i.id=0,queuesWindow.show(i)):webix.message({type:"error",text:"Выберите очередь для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){queuesWindow.loadTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("queues"),{filterHTML:!0,filename:"Очереди"})}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){function e(e){var t=$$("scripts_lst").getValue();if(!t)return void webix.message({type:"error",text:"Выберите\\добавьте скрипт перед добавление этапа"});var i=e.parent_id?e.parent_id:$$("script_stages").getSelectedId(!1),o=e.id?e.id:0;webix.ui({id:"add_script_stage_win",view:"window",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:o?"Редактирование этапа скрипта":"Добавление этапа скрипта"},{view:"icon",icon:"wxi-close",click:"$$('add_script_stage_win').close();"}]},resize:!0,width:700,height:500,center:!0,position:"center",modal:!0,move:!0,body:{view:"form",id:"script_stage_form",elements:[{view:"text",label:"Название",name:"name"},{view:"checkbox",labelRight:"Отображать название как заголовок",name:"show_name"},{view:"checkbox",labelRight:"Автоматическая генерация кнопок для перехода на подэтапы",name:"autobuttons"},{view:"checkbox",labelRight:'Отображать кнопки "Назад"/"Вперед"',name:"show_back_next"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=$$("script_stage_form");if(e.validate()){e.disable();var r=e.getValues();r.script_id=t,r.parent_id=i,o&&(r.id=o),webix.ajax().post("/legacy/ext/scripts/save/stage",r,function(i,o,r){e.enable();var o=o.json();1==o.result?($$("add_script_stage_win").close(),$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+t),$$("script_stages").select(o.id)):webix.message({type:"error",text:o.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!o,click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить этап "'+e.name+'"?',type:"confirm-error",callback:function(e){if(e){var i={id:o,delete:1};webix.ajax().post("/legacy/ext/scripts/save/stage",i,function(e,i,o){var i=i.json();1==i.result?($$("add_script_stage_win").close(),$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+t)):webix.message({type:"error",text:i.message})})}}})}}]}],rules:{name:webix.rules.isNotEmpty}},on:{onShow:function(){$$("script_stage_form").setValues(e)}}}).show()}function t(e){var t,i=e.id?e.id:0;webix.ui((t={id:"add_script_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('add_script_win').close();"}},t.head={view:"toolbar",margin:-4,cols:[{view:"label",label:i?e.copy?"Копирование скрипта":"Редактирование скрипта":"Добавление скрипта"},{view:"icon",icon:"wxi-close",click:"$$('add_script_win').close();"}]},t.resize=!0,t.width=700,t.height=300,t.center=!0,t.position="center",t.modal=!0,t.move=!0,t.body={view:"form",id:"script_form",elements:[{view:"text",label:"Название",name:"name"},{cols:[{view:"button",label:i&&e.copy?"Копировать":"Сохранить",click:function(){var t=$$("script_form");if(t.validate()){t.disable();var o=t.getValues();i&&(o.id=i),e.copy&&(o.copy=e.copy),webix.ajax().post("/legacy/ext/scripts/save",o,function(e,i,o){t.enable();var i=i.json();1==i.result?($$("add_script_win").close(),$$("scripts_lst").getList().clearAll(),$$("scripts_lst").getList().load("/legacy/ext/scripts/list"),$$("scripts_lst").setValue(i.id)):webix.message({type:"error",text:i.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!(i&&!e.copy),click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить скрипт "'+e.name+'"?',type:"confirm-error",callback:function(e){if(e){var t={id:i,delete:1};webix.ajax().post("/legacy/ext/scripts/save",t,function(e,t,i){var t=t.json();1==t.result?($$("add_script_win").close(),$$("scripts_lst").getList().clearAll(),$$("scripts_lst").getList().load("/legacy/ext/scripts/list")):webix.message({type:"error",text:t.message})})}}})}}]}],rules:{name:webix.rules.isNotEmpty}},t.on={onShow:function(){$$("script_form").setValues(e)}},t)).show()}return{id:"scripts_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{view:"button",label:"Добавить этап",width:130,click:function(){e([])}},{css:"last-button-on-left-position",view:"button",label:"Изменить этап",width:130,click:function(){var t=$$("script_stages").getSelectedId(!1);if(!t)return void webix.message({type:"error",text:"Выберите этап"});e($$("script_stages").getItem(t))}},{view:"combo",label:"Скрипт",width:400,css:"margin-left-30 font_family_top_menu",options:"/legacy/ext/scripts/list",id:"scripts_lst",on:{onChange:function(e){$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+e),$$("script_elements").clearAll()}}},{view:"button",label:"Добавить",width:130,click:function(){t([])}},{view:"button",label:"Изменить",width:130,click:function(){var e=$$("scripts_lst").getValue();if(e){var i=$$("scripts_lst").getList().getItem(e);i&&t(i)}else webix.message({type:"error",text:"Выберите скрипт для редактирования"})}},{view:"button",label:"Копировать",width:130,click:function(){var e=$$("scripts_lst").getValue();if(e){var i=$$("scripts_lst").getList().getItem(e);i&&(i.copy=1,t(i))}else webix.message({type:"error",text:"Выберите скрипт для копирования"})}},{css:"last-button-on-left-position",view:"button",label:"Тест",width:130,click:function(){$$("scripts_lst").getValue()||webix.message({type:"error",text:"Выберите скрипт для тестирования"})}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(){function e(){n(this,e),this.formName="form-phonesGroups",this.tableName="phones_groups",this.windowName="window-phone"}return e.prototype.getCode=function(e,t){if(!e)return!1;$$("phoneGroupCode").disable(),$$("phoneGroupCode").showProgress(),webix.ajax().get("/phones/groups/code",{name:e}).then(function(e){$$("phoneGroupCode").enable(),$$("phoneGroupCode").hideProgress(),e=e.json(),e.result&&t&&t(e)})},e.prototype.getFormValues=function(){var e=$$(this.formName);return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.saveFormValues=function(e,t){var i=this.getThis();parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/groups/"+e.id+"/save",e).then(function(e){return $$(i.formName).enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$(i.formName).enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$(i.formName).enable()),!0},function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу. Скорее всего, один из телефонов уже принадлежит другой группе"}),$$(i.formName).enable(),console.log(e)})},e.prototype.loadTable=function(){webix.guiutils.loadTable(this.tableName,"/phones/groups/list")},e.prototype.closeWindow=function(){var e=this.getThis();webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(t){t&&webix.$$(e.windowName).close()}})},e.prototype.hide=function(){$$(this.windowName).close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis();console.log(e);var i={view:"form",id:t.formName,scroll:!0,autoheight:!0,elements:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"name",keyPressTimeout:500,required:!0},{view:"text",label:"Код",name:"code",id:"phoneGroupCode",required:!0,on:{onFocus:function(){var e=$$(t.formName).getValues();e.code||t.getCode(e.name,function(i){e.code=i.message,$$(t.formName).setValues(e)})}}}]},{view:"text",label:"Исходящий номер",name:"outgoing_phone"},{cols:[{view:"combo",name:"pattern",label:"Шаблон",required:!0,filter:function(e,t){return-1!==t.indexOf(t)},options:{body:{url:"/config/sip",template:"#value#"}}},{view:"combo",label:"Правила набора",name:"rules",suggest:"/config/extensions",filter:function(e,t){return-1!==e.value.indexOf(t)}}]},{view:"multicombo",name:"phones",label:"Телефоны в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#phone#"},url:"/phones/list/short"},tagMode:!1,tagTemplate:function(e){return e.length?"Телефонов выбрано: "+e.length:""}},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10}},o={id:this.windowName,view:"window",position:"center",move:!0,modal:!0,resize:!0,scroll:!0,height:400,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close",click:function(){t.closeWindow()}}]},body:{padding:17,rows:[i,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]},on:{onShow:function(){webix.extend($$("phoneGroupCode"),webix.ProgressBar)}}};webix.ui(o).show(),$$(this.formName).setValues(e)},e}(),l=function(e){function t(){return n(this,t),o(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){window.phonesGroupsWindow=new s;var e="phones_groups";return{id:"phones_groups_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){phonesGroupsWindow.show({})}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$(e).getSelectedId()?phonesGroupsWindow.show($$(e).getSelectedItem()):webix.message({type:"error",text:"Выберите группу телефонов для редактирования"})}},{view:"button",type:"icon",icon:"fa fa-trash",id:"removePhoneGroup",width:150,label:"Удалить",click:function(){$$(e).getSelectedId()?webix.guiutils.removeFromTable(parseInt($$(e).getSelectedId()),"/phones/groups/"+parseInt($$(e).getSelectedId())+"/remove",e,"removePhoneGroup"):webix.message({type:"error",text:"Выберите группу для удаления"})},on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var t=$$(e).getSelectedItem().id,i="/phones/groups/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?(o.id=0,phonesGroupsWindow.show(o)):webix.message({type:"error",text:"Выберите группу телефонов для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){phonesGroupsWindow.loadTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$(e),{filterHTML:!0,filename:"Группы телефонов"})}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(6),n=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("users",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getView=function(){var e=0,t=[{id:"1",value:"Активный"},{id:"2",value:"Заблокирован"},{id:"3",value:"Удален"},{id:"4",value:"Скрытый"}];return{id:"users",view:"datatable",hidden:!0,resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,tooltip:!0,fixedRowHeight:!1,onContext:{webix_view:function(e,t){}},css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50,template:function(e){return e.id}},{id:"fullname",header:[{text:"ФИО"},{content:"serverFilter"}],fillspace:1},{id:"state",header:[{text:"статус"},{content:"serverSelectFilter",options:t}],fillspace:1,template:function(e){var t="<span class="+webix.guiutils.getColorCicle(e.state)+"></span>";return t+='<span class = "state'+e.state+'">',t+=webix.guiutils.сallStateToTxt(e.state),t+="</span>"}},{id:"name",header:[{text:"логин"},{content:"serverFilter"}],fillspace:1},{id:"phone",header:[{text:"номер"},{content:"serverFilter"}],fillspace:1},{id:"user_groups",header:["группы",""],fillspace:1},{id:"description",header:[{text:"описание"},{content:"serverFilter"}],fillspace:1}],yCount:0,autoConfig:!0,on:{onItemDblClick:function(){var e=this.getSelectedItem();(new r.ClientsWindow).show(e)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e),this.adjustRowHeight("user_groups")},onAfterSelect:function(){e=this.getSelectedId()},onAfterContextMenu:function(e){e.row&&$$("users").select(e.row)},onDataRequest:function(e,t){}},ready:function(){webix.extend(this,webix.ProgressBar),this.adjustRowHeight("user_groups"),this.getFilter("state")&&(this.getFilter("state").value=1),$$("cmenu")||webix.ui({view:"contextmenu",width:180,id:"cmenu",data:[{id:"edit",value:"Изменить",icon:"wxi-pencil"},{id:"delete",value:"Удалить",icon:"wxi-trash"}],on:{onMenuItemClick:function(e){switch(e){case"edit":var t=$$("users").getSelectedItem().id,i="/users/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){if(o){(new r.ClientsWindow).show(o)}else webix.message({type:"error",text:"Выберите пользователя для копирования"})});break;case"delete":$$("users").getSelectedId()?webix.guiutils.removeFromTable(parseInt($$("users").getSelectedId()),"/users/"+parseInt($$("users").getSelectedId())+"/remove","users","removeUser",function(){var e=$$("users").getSelectedItem();e.state="3",$$("users").updateItem(e.id,e)}):webix.message({type:"error",text:"Выберите группу для удаления"})}}}}),$$("cmenu").attachTo(this)}}},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),$$("users_toolbar").show(),$$("users")&&(this.loaded||(webix.extend($$("users"),webix.ProgressBar),$$("users").load("/users/list","json",function(){$$("users").filterByAll(),e.loaded=1})))},e.prototype.init=function(){this.win2=this.ui(WindowsView)},e}();t.default=n},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var o=i(62),r=i(63),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),s=function(e){function t(t,i){var o=e.call(this)||this;return o.app=t,o._name=i,o._children=[],o}return a(t,e),t.prototype.ui=function(e,t){t=t||{};var i=t.container||e.container,r=this.app.createView(e);return this._children.push(r),r.render(i,null,this),"object"!==(void 0===e?"undefined":n(e))||e instanceof o.a?r:r.getRoot()},t.prototype.show=function(e,t){var i=this;if(t=t||{},"string"==typeof e){if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("../")){var o=this.getParentView();return void(o?o.show("./"+e.substr(3),t):this.app.show("/"+e.substr(3)))}0===e.indexOf("./")&&(e=e.substr(2));var a=this.getSubViewInfo(t.target);if(!a)return this.app.show("/"+e);if(a.parent!==this)return a.parent.show(e,t)}var s=Object(r.a)(this.app.getRouter().get());if("object"===(void 0===e?"undefined":n(e)))if(webix.isArray(e)){var l=this._index+e[0];s[l]||(s[l]={}),s[l].page=e[1],e=""}else{var c=[];for(var d in e)c.push(encodeURIComponent(d)+"="+encodeURIComponent(e[d]));e="?"+c.join("&")}if("string"==typeof e){if("?"===e.substr(0,1)){var u=e.indexOf("/"),h=e;u>-1&&(h=e.substr(0,u));var p=Object(r.a)(h);webix.extend(s[this._index-1].params,p[0].params,!0),e=u>-1?e.substr(u+1):""}var f=""===e?s.slice(this._index):Object(r.a)(e),w=null;if(this._index){w=s.slice(0,this._index).concat(f);for(var g=0;g<w.length;g++)w[g].index=g+1;var b=Object(r.b)(w);return this.app.canNavigate(b,this).then(function(e){return null!==e?b!==e?i.app.show(e):i._finishShow(w,e):null})}return this._finishShow(f,"")}},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this.app=this._parentFrame=null,this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){var e=this;this._destroyKids();var t=[];this._index>1&&(t=Object(r.a)(this.app.getRouter().get()).slice(this._index-1)),this._render(t).then(function(){e._parentFrame.id=e.getRoot().config.id})},t.prototype._render=function(e){var t=this,i=this.config();return i.then?i.then(function(i){return t._render_final(i,e)}):this._render_final(i,e)},t.prototype._render_final=function(e,t){var i=this,o=this._container;if(o&&o.$destructed)return Promise.reject("Container destroyed");var r,n={ui:{}};this.app.copyConfig(e,n.ui,this._subs),this.app.callEvent("app:render",[this,t,n]),n.ui.$scope=this;try{if(o&&o.getParentView){var a=o.getParentView();a&&"multiview"===a.name&&!n.ui.id&&(n.ui.id=o.config.id)}this._root=this.app.webix.ui(n.ui,this._container),this._root.getParentView()&&(this._container=this._root),this._init(this._root,t),r=this._urlChange(t).then(function(){return i.ready(i._root,t)})}catch(e){r=Promise.reject(e)}return r.catch(function(e){return i._initError(i,e)})},t.prototype._init=function(e,t){return this.init(e,t)},t.prototype._urlChange=function(e){var t=this;this.app.callEvent("app:urlchange",[this,e,this._index]);var i=[];for(var o in this._subs){var r=this._renderFrame(o,this._subs[o],e);r&&i.push(r)}return Promise.all(i).then(function(){t.urlChange(t._root,e)})},t.prototype._renderFrame=function(e,t,i){if(t.url){if("string"==typeof t.url){var o=Object(r.a)(t.url);return o.map(function(e){e.index=0}),this._createSubView(t,o)}var n=t.view;return"function"!=typeof t.url||n instanceof t.url||(n=new t.url(this.app,"")),n||(n=t.url),this._renderSubView(t,n,i)}if("default"===e&&i&&i.length>1){var a=i.slice(1);return this._createSubView(t,a)}},t.prototype._initError=function(e,t){return this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var i=this;return this.app.createFromURL(t,e.view).then(function(o){return i._renderSubView(e,o,t)})},t.prototype._renderSubView=function(e,i,o){var r=this.app.webix.$$(e.id);return i.render(r,o,this).then(function(o){return e.view&&e.view!==i&&e.view.destructor(),e.view=i,e.id=o.config.id,i instanceof t&&(i._parentFrame=e),o})},t.prototype._finishShow=function(e,t){var i;return this._index?(i=this._renderPartial(e.slice(this._index-1)),this.app.getRouter().set(t,{silent:!0}),this.app.callEvent("app:route",[e])):(e.map(function(e){return e.index=0}),i=this._renderPartial([null].concat(e))),i},t.prototype._renderPartial=function(e){return this._init_url_data(e),this._urlChange(e)},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(o.a)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(){o(this,e),this.phonesLoaded=0,this.intervalReportsLoaded=0,this.groupedAgentsReportsLoaded=0,this.extOutgoingReportsLoaded=0,this.extIncomingReportsLoaded=0,this.dailyReportsLoaded=0,this.hourlyReportsLoaded=0,this.compareCallsLoaded=0,this.channelsLoaded=0,this.queuesLoaded=0,this.contactGroupsLoaded=0,this.groupsLoaded=0,this.usersLoaded=0,this.aliasesLoaded=0,this.setupLoaded=0,this.clientsLoaded=0,this.outgoingcampaignsLoaded=0,this.extIncomingExternalReportsLoaded=0,webix.filterSuggest={fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,i){t.firstChild.innerHTML="Итого:  "+e.count()||"0"}},webix.ui.datafilter.summColumn),webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,i){t.firstChild.innerHTML="Итого: "+e.count()||"0"}},webix.ui.datafilter.summColumn),webix.protoUI({name:"my_suggest1",$init:function(e){var t=e.body.rows.length;t>1&&(e.body.rows[t]={view:"counter",step:10,value:0,label:"От",id:e.id+"_from"},e.body.rows[t+1]={view:"counter",step:10,value:0,label:"До",id:e.id+"_to"},e.body.rows[t+2]={view:"button",label:"Применить",click:function(){if(e.id&&$$(e.id+"_from").getValue()>$$(e.id+"_to").getValue())return webix.message({type:"error",text:"Время ДО не может быть меньше времени ОТ"}),!1;e&&e.table?$$(e.table).filterByAll():$$("cdr_reports").filterByAll()}})}},webix.ui.checksuggest),webix.ui.datafilter.sum_duration=webix.extend({refresh:function(e,t,i){e.config.serverFooter&&e.config.serverFooter.sum_duration&&(t.firstChild.innerHTML=e.config.serverFooter.sum_duration)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.sum_billsec=webix.extend({refresh:function(e,t,i){e.config.serverFooter&&e.config.serverFooter.sum_duration&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML=webix.guiutils.roundNumber(e.config.serverFooter.sum_duration/60,2))}},webix.ui.datafilter.summColumn),webix.ui.datafilter.count_answered=webix.extend({refresh:function(e,t,i){e.config.serverFooter&&e.config.serverFooter.total&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML="ASR "+webix.guiutils.roundNumber(e.config.serverFooter.count_answered/e.config.serverFooter.total*100,2)+" %")}},webix.ui.datafilter.summColumn),webix.ui.datafilter.pdd=webix.extend({refresh:function(e,t,i){e.config.serverFooter&&e.config.serverFooter.sum_billsec&&e.config.serverFooter.sum_duration&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML="ср. время ожидания"+webix.guiutils.roundNumber((e.config.serverFooter.sum_duration-e.config.serverFooter.sum_billsec)/e.config.serverFooter.count_answered,2))}},webix.ui.datafilter.summColumn),webix.ui.datafilter.summTotal=webix.extend({refresh:function(e,t,i){var o=e.count();o&&0!=o&&1e5!=o?(t.firstChild.innerHTML="<span class='color_footer_totals'>"+o+"</span> звонков",$$("cdr_excel_button").show(),this.loaded||$$("cdr_reports")&&($$("cdr_reports").load("/cdr/list"),this.loaded=1)):($$("cdr_excel_button").hide(),t.firstChild.innerHTML="")}},webix.ui.datafilter.summColumn),webix.ui.datafilter.playback=webix.extend({refresh:function(e,t,i){}},webix.ui.datafilter.summColumn),webix.ui.datafilter.customPlayback={getValue:function(){},setValue:function(){},refresh:function(e,t,i){t.onchange=function(){console.log("On change...")},t.onclick=function(){console.log("On click...")}},render:function(e,t){return console.log("Render..."),"..."}},webix.proxy.calldatePartialLoad={$proxy:!0,load:function(e,t){if(t&&(t.filter||t.sort)){var i=this.source+(-1==this.source.indexOf("?")?"?":"&"),o=[];for(var n in t)"filter"!=n&&"sort"!=n&&o.push(n+"="+t[n]),"start"==n&&0==t[n]&&$$("cdr_reports").clearAll();t.sort&&o.push("sort["+t.sort.id+"]="+encodeURIComponent(t.sort.dir)),t.filter&&(t.filter.hold=JSON.stringify({from:$$(e.getFilter("hold").config.suggest+"_from").getValue(),to:$$(e.getFilter("hold").config.suggest+"_from").getValue()})),t.filter.talk=JSON.stringify({from:$$("$my_suggest12_from").getValue(),to:$$("$my_suggest12_to").getValue()});for(var a in t.filter){var s=t.filter[a];"object"===(void 0===s?"undefined":r(s))?o.push("filter["+a+"]="+encodeURIComponent(JSON.stringify(s))):""!==s&&o.push("filter["+a+"]="+encodeURIComponent(s))}var l=0,c=0;return $$("cdr_reports").data.each(function(e){e&&e.time&&(l=e.time,c++)}),o.push("lcd="+encodeURIComponent(l)),o.push("lli="+encodeURIComponent(c)),i+=o.join("&"),webix.ajax().get(i)}return webix.ajax().get(this.source,t)}}}return e.prototype.hideAllView=function(){$$("sidebar").serialize().forEach(function(e){$$(e.id)&&$$(e.id)&&($$(e.id).hide(),webix.guiutils.hideAllToolbars()),e.data&&e.data.forEach(function(e){$$(e.id)&&$$(e.id).hide()})})},e.prototype.loadPhoneReport=function(){$$("phoneExcelButton").show()},e.prototype.showHideView=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if($$(e)){this.hideAllView();var i=webix.Manager.getComponent(e);"object"==(void 0===i?"undefined":r(i))&&i.loadData(),parseInt(t)?$$(e).hide():$$(e).show()}else console.error("viewId "+e+"is not defined")},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(){o(this,e),this.id="appFilterBody",this.additonalsBodyId="appFilterAdditionalBody",this.body={},this.result=[],this.defaultHeader="Панель поиска",this.reset}return e.prototype.setReset=function(e){this.reset=e},e.prototype.setBody=function(e,t){if($$("defaultsForReports").hide(),"object"===(void 0===t?"undefined":r(t))&&t.hasOwnProperty("id")){for(var i in this.body)this.body[i].id&&$$(this.body[i].id)&&$$(this.body[i].id).hide();this.body[e]&&this.body[e].id&&$$(this.body[e].id)?$$(this.body[e].id).show():($$(this.additonalsBodyId).addView(t),this.body[e]=t)}t.rows?($$("appFilterAdditionalBody").show(),$$("line_label_first").show()):($$("appFilterAdditionalBody").hide(),$$("line_label_first").hide())},e.prototype.hide=function(){$$("filterCol")&&$$("filterCol").hide()},e.prototype.show=function(){$$("filterCol")&&($$("filterCol").show(),$$("dstFilters").show(),$$("srcFilters").show(),$$("filterReports").show(),$$("queueReports").show(),$$("defaultsForTraffic").hide())},e.prototype.setSubmit=function(e){$$(this.id).detachEvent("onSubmit"),$$(this.id).attachEvent("onSubmit",e)},e.prototype.getTextValues=function(e){if(e)for(var t in e)"function"==typeof e[t].getText&&e[t].getText()?this.result.push(e[t].getText()):e[t].getChildViews()&&this.getTextValues(e[t].getChildViews())},e.prototype.updateHeader=function(){var e=$$(this.id).getValues();this.result=[];for(var t in e)e[t]&&$$(t)&&$$(t).getText()&&this.result.push($$(t).getText());this.getTextValues($$(this.id).getChildViews())},e.prototype.setHeader=function(e){$$("appFilterContent").define("header",e),$$("appFilterContent").refresh()},e.prototype.submit=function(){$$("appFilterBody").callEvent("onSubmit"),this.updateHeader()},e.prototype.resetDefaultReport=function(){$$("queueReports").setValue(""),$$("filterReports").setValue("")},e.prototype.resetDefaultTraffic=function(){$$("srcFilters").setValue(""),$$("dstFilters").setValue("")},e.prototype.getView=function(){var e=this;return{id:"appFilter",multi:!0,view:"accordion",css:"webix_dark",cols:[{width:380,header:"Панель поиска",id:"appFilterContent",body:{rows:[{view:"form",complexData:!0,id:"appFilterBody",elements:[{rows:[{view:"daterangepicker",id:"reportDateRange",labelWidth:100,hidden:!0,label:"Период",timepicker:!0,labelPosition:"top",format:"%d.%m.%Y %H:%i",value:{start:webix.Date.add(webix.startDayDateTime,-1,"month"),end:webix.endDayDateTime},suggest:{view:"daterangesuggest",body:{timepicker:!0,calendar:{weekNumber:!0,on:{onAfterZoom:function(e){-1===e&&(this.$timeSelectionActive=!0)},onBeforeDateSelect:function(e){if(this.$timeSelectionActive)this.$timeSelectionActive=!1;else{var t=$$("reportDateRange").getValue();t.start&&t.end?e.setHours(0,0,0):e.setHours(23,59,59)}}}},icons:[{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_today webix_cal_icon'>"+webix.i18n.calendar.today+"</span>"},on_click:{webix_cal_icon_today:function(){var e=new Date,t=new Date;e.setHours(23,59,59),t.setHours(0,0,0),this.addToRange(t),this.addToRange(e),this.callEvent("onTodaySet",[this.getValue()])}}},{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_clear webix_cal_icon'>"+webix.i18n.calendar.clear+"</span>"},on_click:{webix_cal_icon_clear:function(){this.setValue(""),this.callEvent("onDateClear",[])}}}]}},on:{onChange:function(e){e.start&&($$("startDate_hourly_load")&&$$("startDate_hourly_load").setValue(e.start),$$("startDate_compare_calls")&&$$("startDate_compare_calls").setValue(e.start),$$("date_ext_dash")&&$$("date_ext_dash").setValue({start:e.start,end:e.end}),$$("cdr_reports")&&$$("cdr_reports").getFilter("time")&&($$("cdr_reports").getFilter("time").config.value=e))}}},{id:"defaultsForReports",hidden:!0,rows:[{id:"queueReports",view:"richselect",labelPosition:"top",label:"Очередь",labelWidth:100,options:"/legacy/grouped_queues_name/short"},{id:"filterReports",view:"richselect",labelPosition:"top",label:"Тип звонков",labelWidth:100,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]}]},{id:"defaultsForTraffic",hidden:!0,rows:[{id:"srcFilters",view:"text",type:"search",labelPosition:"top",labelWidth:100,label:"Источник"},{id:"dstFilters",view:"text",type:"search",labelPosition:"top",labelWidth:100,label:"Номер"}]},{view:"label",id:"line_label_first",template:'<hr style="background-color: transparent">',height:20}]},{id:"appFilterAdditionalBody",rows:[]},{rows:[{view:"label",id:"line_label_last",template:'<hr style="background-color: transparent">',height:20},{cols:[{view:"button",type:"icon",icon:"fa fa-trash",label:"Сбросить все",width:155,click:function(){"function"==typeof e.reset&&(e.reset(),e.submit())}},{},{view:"button",type:"icon",icon:"fa fa-search",width:155,label:"Применить",click:function(){e.submit()}}]}]}],inputConfig:{labelAlign:"left"},on:{onSubmit:function(){}}},{height:0}]}}],on:{onAfterCollapse:function(t){e.updateHeader(),e.result.length&&e.setHeader(e.result.join(","))},onAfterExpand:function(t){e.setHeader(e.defaultHeader)}}}},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"OptionWindow",function(){return r});var r=function(){function e(){o(this,e),this.id="option-add-win",this.setView()}return e.prototype.setView=function(){webix.ui(this.getView())},e.prototype.getView=function(){var e,t=[{id:"1",value:"Активный"},{id:"2",value:"Заблокирован"},{id:"3",value:"Удален"},{id:"4",value:"Скрытый"}];this.getThis();return{view:"window",id:"option-add-win",position:"center",maxWidth:700,resize:!1,move:!0,modal:!0,borderless:!0,head:{height:450,width:700,borderless:!0,rows:[(e={elementsConfig:{labelWidth:100},view:"form",id:"option-form",scroll:!0,height:390,borderless:!0,elements:[{cols:[{view:"tabview",borderless:!0,tabbar:{optionWidth:180},cells:[{id:"settings",header:"Основные данные",body:{padding:17,minHeight:380,width:700,rows:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"fullname",label:"ФИО",inputAlign:"left",labelWidth:150,required:!0,width:650,placeholder:"Введите ФИО"},{cols:[{view:"text",name:"phone",label:"Номер",inputAlign:"left",labelWidth:150,width:325,placeholder:"Введите телефон"},{view:"text",name:"name",label:"Логин",inputAlign:"left",labelPosition:"left",labelWidth:150,required:!0,width:325,placeholder:"Введите логин"}]},{cols:[{view:"select",name:"state",label:"Статус",disable:!0,inputAlign:"left",labelWidth:150,options:t,width:325,placeholder:"Выберите статус",disabled:!0},{view:"text",name:"password",id:"user-password",label:"Пароль",labelPosition:"left",type:"password",inputAlign:"left",labelWidth:150,width:325,placeholder:"Введите пароль"}]},{view:"multicombo",name:"user_groups_ids",label:"Группы",inputAlign:"left",labelWidth:150,autoheight:!0,options:"/users/user_groups",width:650,placeholder:"Выберите группы",disabled:!0},{view:"multicombo",name:"rules",label:"Права доступа",inputAlign:"left",labelWidth:150,autoheight:!0,disabled:!0,options:{body:{template:"#name#"},url:"/rules/list"},width:650,placeholder:"Назначьте права"},{view:"text",name:"description",label:"Описание",inputAlign:"left",labelWidth:150,width:650,placeholder:"Введите описание"},{height:10}]}},{header:"Переадресация",id:"forwarding",body:{width:700,minHeight:350,padding:17,rows:[{cols:[{view:"switch",labelRight:"Все звонки на номер",labelWidth:120,id:"cfwd.all.switch",labelPosition:"top",on:{onChange:function(e){webix.guiutils.updateControls()}}},{view:"text",id:"cfwd.all",name:"config.cfwd.all",label:"",placeholder:"Введите телефон"},{}]},{cols:[{view:"switch",labelRight:"После",labelWidth:120,id:"cfwd.noanswer.switch",labelPosition:"top",width:115,on:{onChange:function(e){webix.guiutils.updateControls()}}},{view:"text",id:"cfwd.noanswer.timeout",name:"config.cfwd.noanswer.timeout",labelWidth:120,placeholder:"000",suggest:[{id:5,value:"5"},{id:10,value:"10"},{id:20,value:"20"},{id:30,value:"30"}],width:75},{view:"text",id:"cfwd.noanswer",name:"config.cfwd.noanswer",label:"сек ожидания на номер",labelWidth:190,width:450,placeholder:"Введите телефон"},{}]},{view:"label",template:'<hr style="border: 0.5px solid #DDDDDD">',height:10},{cols:[{view:"switch",id:"cfwd.divert",labelRight:"Переадресовывать",labelPosition:"top",on:{onChange:function(e){webix.guiutils.updateControls()}}},{css:"custom_margin_radio",view:"radio",id:"cfwd.duration.of.redirection",value:1,options:[{id:"1",value:"весь день"},{id:"2",value:"c"}],width:190,on:{onChange:function(e){webix.guiutils.updateControls()}}},{id:"cfwd.limit.from",name:"config.cfwd.limit.from",view:"datepicker",type:"time",stringResult:!0,editable:!0,labelPosition:"left",format:"%H:%i",width:80},{css:"custom_padding_lbl",id:"cfwd.limit.to",name:"config.cfwd.limit.to",view:"datepicker",type:"time",stringResult:!0,editable:!0,label:"по",labelPosition:"left",format:"%H:%i",labelWidth:35,width:115}]},{cols:[{view:"multicombo",id:"cfwd.limit.days",name:"config.cfwd.limit.days",labelWidth:250,options:[{id:"wd",value:"рабочие дни"},{id:"nwd",value:"выходные"},{id:"mo",value:"пн"},{id:"tu",value:"вт"},{id:"we",value:"ср"},{id:"th",value:"чт"},{id:"fr",value:"пт"},{id:"sa",value:"сб"},{id:"su",value:"вс"}]}]},{cols:[{label:"Сообщение о переадресации",view:"select",id:"cfwd.notify",name:"config.cfwd.notify",labelPosition:"top",options:[{id:"0",value:"Отсутствует"},{id:"1",value:"Стандартное"},{id:"2",value:"Моя фраза"}],on:{onChange:function(e){webix.guiutils.updateControls()}}},{label:"Сообщение",view:"text",id:"cfwd.notify.message",name:"config.cfwd.notify.message",labelPosition:"top"}]}]}}],on:{onBeforeTabClick:function(e){}}},{rows:[{view:"icon",icon:"wxi-close",css:"window_close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("option-add-win").close()}})}}]}]}]},e.elementsConfig={inputAlign:"left",labelPosition:"left"},e),{padding:17,cols:[{},{css:"optional_btn",view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("option-add-win").close()}})}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("option-form");if(e.validate()){e.disable();var t=e.getValues();t.config=[];Object.keys(t).forEach(function(e){-1!=e.toString().indexOf("config.")&&t.config.push({key:e.replace("config.",""),value:t[e]})}),webix.ajax().post("/users/"+t.id+"/save/disable_rules",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.guiutils.loadUserTable(),webix.message({type:"success",text:t.message}),e.enable(),webix.$$("option-add-win").close()):(webix.message({type:"error",text:t.message}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable(),console.log(t)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}}]}]},body:{height:1},on:{onShow:function(){webix.ajax().get("/auth/settings",{error:function(e,t,i){webix.message({type:"error",text:e})},success:function(e,t,i){if(t){var o=t.json();if($$("option-form").setValues(o.data),o.data.hasOwnProperty("config")){o.data.config.forEach(function(e){"cfwd.duration.of.redirection"==e.key&&"2"==e.value&&$$("cfwd.divert").setValue(1),"cfwd.limit.days"==e.key&&e.value.length>0&&$$("cfwd.divert").setValue(1),"cfwd.all"==e.key&&e.value.length>0&&$$("cfwd.all.switch").setValue(1),"cfwd.noanswer"==e.key&&e.value.length>0&&$$("cfwd.noanswer.switch").setValue(1),$$(e.key)&&e.value&&$$(e.key).setValue(e.value),"cfwd.notify"==e.key&&e.value&&"0"!=e.value&&"1"!=e.value&&($$("cfwd.notify").setValue("2"),$$("cfwd.notify.message").setValue(e.value))})}}}}),webix.guiutils.updateControls()}}}},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.groupId},e.prototype.setId=function(e){this.groupId=e},e.prototype.showWindow=function(){if($$(this.id)&&!$$(this.id).isVisible()&&$$(this.id).show(),!$$(this.id))return this.setView(),this.showWindow()},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.init=function(){},t.prototype.getRows=function(){var e=[];try{for(var t in webix.Manager.getComponents())webix.Manager.getComponents()[t].roleAllowed()&&webix.Manager.getComponents()[t].roleAllowed().length?webix.auth.isAllowedRoles(webix.Manager.getComponents()[t].roleAllowed())&&e.push(webix.Manager.getComponents()[t].getView()):e.push(webix.Manager.getComponents()[t].getView())}catch(e){console.log(e)}return e},t.prototype.config=function(){return{rows:this.getRows()}},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(18),l=webix.guiutils.getMenuData(s.data),c=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{width:200,collapsed:!1,collapsedWidth:48,view:"sidebar",id:"sidebar",css:"sidebar",layout:"y",scroll:"y",select:!0,data:l,on:{onBeforeOpen:function(e,t,i){var o=this.getItem(e);if(o&&o.disabled)return!1},onBeforeSelect:function(e){var t=this.getItem(e);if(t&&t.disabled)return webix.message({type:"error",text:"У вас нет доступа к этому разделу. Обратитесь к администратору."}),this.select("cti"),!1},onAfterRender:function(e){},onAfterSelect:function(e){document.location.hash="!/main/"+e;var t=this.getItem(e);webix.$$("app:title").parse({title:t.value}),webix.AppConfig.showHideView(e)}}}},t.prototype.init=function(e){e.parse(l)},t}(a.b);t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"data",function(){return o});var o=[{id:"phone",value:"Телефоны",icon:"fa fa-phone-square",rules:["erpico.admin"]},{id:"cti",value:"Инструкция",icon:"fa fa-cubes",$css:""},{id:"cdr_reports",value:"Звонки",icon:"fa fa-phone-volume",$css:""},{id:"forms",value:"Отчеты",icon:"fa fa-chart-bar",rules:["phc.reports","erpico.admin"],data:[{id:"ext_dashboard",value:"Dashboard"},{id:"grouped_reports",value:"Входящие"},{id:"grouped_reports_by_agents",value:"По агентам"},{id:"grouped_reports_by_queues",value:"По очередям"},{id:"lost_calls",value:"Потерянные"},{id:"analysis_outgoing_calls",value:"Исходящие"},{id:"operators_work_report",value:"Сотрудники"},{id:"checklist",value:"Чеклисты"}]},{id:"calendar",value:"Анализ трафика",icon:"fa fa-sliders-h",rules:["phc.reports","erpico.admin"],data:[{id:"interval_reports",value:"Входящие"},{id:"daily_report",value:"По дням"},{id:"month_traffic",value:"По месяцам"},{id:"hourly_load",value:"По часам"},{id:"compare_calls",value:"Сравнить"}]},{id:"statistics",value:"Статистика",icon:"fa fa-chart-bar",rules:["phc.reports","erpico.admin"],data:[{id:"ext_incoming_external",value:"Внешние"},{id:"ext_incoming_internal",value:"Внутренние"},{id:"ext_outgoing",value:"Исходящие"}]},{id:"extended",value:"Расширенные",icon:"fa fa-th-large",rules:["phc.reports","erpico.admin"],data:[{id:"extended_calls",value:"Звонки"},{id:"extended_contact_calls",value:"Входящие"}]},{id:"outgoingcampaign",value:"Кампании",icon:"fa fa-phone-square",$css:"",rules:["phc.oc","erpico.admin"]},{id:"control",value:"Управление",icon:"fa fa-tools",rules:["erpico.admin"],subrules:!0,data:[{id:"users",value:"Пользователи",rules:["erpico.admin"]},{id:"aliases",value:"Алиасы",rules:["erpico.admin"]},{id:"groups",value:"Группы",rules:["erpico.admin"]},{id:"contact_groups",value:"Контактные группы",rules:["phc.admin","erpico.admin"]},{id:"phones",value:"Телефоны",rules:["erpico.admin"]},{id:"phones_groups",value:"Группы телефонов",rules:["erpico.admin"]},{id:"queues",value:"Очереди",rules:["phc.admin","erpico.admin"]},{id:"channels",value:"Каналы",rules:["erpico.admin","phc.reports"]},{id:"scripts",value:"Скрипты",rules:["phc.admin","erpico.admin"]},{id:"setup",value:"Настройки",rules:["erpico.admin"]},{id:"blacklist",value:"Blacklist",rules:["erpico.admin"]}]}]},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(20),n=i(21),a=i(22),s=i(24),l=i(25),c=i(26),d=i(27),u=i(28),h=i(29),p=i(30),f=i(31),w=i(32),g=i(33),b=i(34),m=i(35),_=i(36),v=i(37),x=i(38),$=i(39),y=i(40),k=i(41),C=i(42),F=i(1),T=i(11),S=i(45),B=i(46),I=i(47),A=i(49),V=i(51),P=i(53),D=i(54),j=i(56),R=i(57),E=i(58),q=i(59),W=i(60),O=function(){function e(t,i){o(this,e),this.components=[]}return e.prototype.setComponent=function(e,t){this.components[e]=t},e.prototype.getComponents=function(){return this.components},e.prototype.getComponent=function(e){return this.components[e]},e.prototype.initViews=function(){(new r.default).getView(),(new n.default).getView(),(new a.default).getView(),(new s.default).getView(),(new l.default).getView(),(new c.default).getView(),(new d.default).getView(),(new u.default).getView(),(new h.default).getView(),(new p.default).getView(),(new f.default).getView(),(new w.default).getView(),(new g.default).getView(),(new b.default).getView(),(new m.default).getView(),(new _.default).getView(),(new v.default).getView(),(new x.default).getView(),(new $.default).getView(),(new y.default).getView(),(new F.default).getView(),(new k.default).getView(),(new C.default).getView(),(new T.default).getView(),(new S.default).getView(),(new B.default).getView(),(new I.default).getView(),(new A.default).getView(),(new V.default).getView(),(new P.default).getView(),(new D.default).getView(),(new j.default).getView(),(new R.default).getView(),(new E.default).getView(),(new q.default).getView(),(new W.default).getView()},e}();t.default=O},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),webix.Manager.setComponent("cti",this)}return e.prototype.roleAllowed=function(){return null},e.prototype.getView=function(){return webix.AppFilter.hide(),{id:"cti",view:"htmlform",scroll:"y",template:'<div style="padding: 0px 20px 20px 20px"><h1>Памятка по использованию IP-АТС ErpicoPBX</h1><p>Для совершения исходящих вызовов наберите номер телефона и нажмите клавишу «#» или «Набор». При звонке на городские номера нет необходимости набирать префикс, на сотовые и междугородние номера вызов осуществляется через «8» без дополнительных префиксов.</p><h2>Переадресация</h2><p>Для переадресации звонка нажмите два раза клавишу «#» во время разговора, система Вам сообщит об инициализации перевода, наберите внутренний номер сотрудника и нажмите еще раз «#». После ответа сотрудника или когда услышите сигнал вызова положите трубку – вызов уйдет сотруднику. Для возвращения к звонку до завершения переадресации нажмите клавишу «*».<br/>Краткая формула: ## номер #<br/>Возврат: *</p><h2>Перехват</h2><p>Для перехвата звонка наберите «*» и вызов.<br/>Краткая формула: *#</p><h2>Телефонный клиент</h2><p>Телефонный клиент предоставляет расширенные функции телефонии и доступ к онлайн-контролю, статистики и записи разговоров.<br/><br/>Для установки скачайте телефонный клиент по ссылке <a href="https://dl.erpico.ru/ErpicoPBX.msi">ErpicoPBX.msi</a></p><p>Для запуска телефонного клиента щелкните по иконке на рабочем столе. Если программа запускается первый раз нужно верно указать имя сервера, логин и пароль. Уточните эти реквизиты у Вашего системного администратора. Адрес совпадает с адресом АТС, логин, как правило, совпадает с номером телефона.</p><p>Если программа запущена щелкните по иконке на панели задач.</p><p>Когда телефонный клиент запущен Вы можете набирать номера используя функцию Copy2Call. Для осуществления звонка Вам достаточно выделить на любом сайте или в любой программе номер телефона, по которому Вы хотите позвонить и два раза скопировать его в буфер обмена при помощи клавиатуры: Ctrl+C</p><p>На Ваш телефон придет служебный вызов, ответьте на него и система начнет автоматически набор номера.</p><p>Так же в телефонном клиенте Вам доступен справочник сотрудников и история Ваших звонков.</p><h2>Техподдержка</h2><p>По всем вопросам использования АТС и телефонного клиента обращайтесь в нашу службу техподдержки: 8 (4852) 593-100, добавочный код: 2</p></div>'}},e.prototype.loadData=function(){webix.AppFilter.hide()},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="phoneExcelButton",webix.Manager.setComponent("phone",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getView=function(){return{id:"phone",hidden:!0,view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"group",header:[{text:"Группа",height:30},{content:"textFilter",height:35}],sort:"int",width:160,template:"{common.icon()} #group#"},{id:"number",header:[{text:"Номер",height:30},{content:"textFilter",height:35}],sort:"int",width:160},{id:"fio",header:[{text:"ФИО"},{content:"textFilter"}],sort:"int",width:200}]}},e.prototype.getToolBar=function(){return{css:"top-menu-right-item excel_btn_on_phone",view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",id:"phoneExcelButton",hidden:!1,click:function(){webix.toExcel($$("phone"),{filterHTML:!0,filename:"Телефоны"})}}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.loadData=function(){this.setToolBar(),webix.AppFilter.hide(),this.loaded||$$("phone")&&($$("phone").load("/legacy/phones"),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(23),n=function(){function e(){o(this,e),this.loaded=0,this.id="cdr_reports",this.toolBarId="cdr_toolbar",this.isRenderOnce=0,this.ReportsWindow=new r.default,webix.Manager.setComponent("cdr_reports",this)}return e.prototype.roleAllowed=function(){return[]},e.prototype.getThis=function(){return this},e.prototype.getGreed=function(){var e=this,t=this.getThis();return{id:t.id,view:"datatable",resizeColumn:!0,resizeRow:!1,select:!0,footer:!0,disabled:!1,multiselect:!1,hidden:!0,tooltip:!0,columns:[{id:"status",header:"",width:30,template:function(e){return e.answered?"<span class='greencircle'></span>":"<span class='redcircle'></span>"},footer:{content:"summTotal",colspan:2}},{id:"time",header:["Дата/время",{content:"serverDateRangeFilter",inputConfig:{timepicker:!0,start:webix.startDayDateTime,finish:webix.endDayDateTime,suggest:{view:"daterangesuggest",body:{timepicker:!0,calendar:{weekNumber:!0,on:{onAfterZoom:function(e){-1===e&&(this.$timeSelectionActive=!0)},onBeforeDateSelect:function(e){if(this.$timeSelectionActive)this.$timeSelectionActive=!1;else{var t=$$("cdr_reports").getFilter("time").data.value;t.start&&t.end?e.setHours(0,0,0):e.setHours(23,59,59)}}}},icons:[{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_today webix_cal_icon'>"+webix.i18n.calendar.today+"</span>"},on_click:{webix_cal_icon_today:function(){var e=new Date,t=new Date;e.setHours(23,59,59),t.setHours(0,0,0),this.addToRange(t),this.addToRange(e),this.callEvent("onTodaySet",[this.getValue()])}}},{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_clear webix_cal_icon'>"+webix.i18n.calendar.clear+"</span>"},on_click:{webix_cal_icon_clear:function(){this.setValue(""),this.callEvent("onDateClear",[])}}}]}}}}],width:250,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"id",header:["ID",{content:"textFilter"}],width:200,hidden:!0},{id:"agent",header:["Сотрудник",{inputConfig:{disabled:!1},content:"customFilterSelect",options:"/groups/users/short?nameasvalue=1",suggest:{body:{template:"#value#"},filter:function(e,t){return-1!==e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}}],width:200,footer:{text:"Выберите звонок для прослушивания",colspan:3}},{id:"queue",header:["Очередь",{content:"customFilterSelect",options:"/queues/list/short?nameasvalue=1",suggest:{body:{template:"#value#"},filter:function(e,t){return-1!==e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}}],width:200},{id:"src",header:["От кого",{content:"textFilter",placeholder:"Введите номер для поиска...",colspan:2}],width:130,template:function(e){return e.src&&e.src.length>4?e.src+" <span class='webix_icon fa fa-phone' style='cursor: pointer'></span>":e.src}},{id:"dst",header:["Кому"],width:130,template:function(e){return e.dst&&e.dst.length>4?e.dst+" <span class='webix_icon fa fa-phone' style='cursor: pointer'></span>":e.dst},footer:{content:"pdd",colspan:2}},{id:"hold",header:["Ожидание",{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],width:100,template:function(e){return webix.guiutils.formatTime(e.hold)}},{id:"talk",header:["Разговор",{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],width:80,template:function(e){return webix.guiutils.formatTime(e.talk)},footer:{content:"sum_billsec",colspan:2}},{id:"reason",header:["Результат",{content:"richSelectFilter",suggest:{fitMaster:!1,width:220},options:[{id:"EXITWITHTIMEOUT",value:"Не дождался ответа"},{id:"RINGNOANSWER",value:"Оператор не ответил"},{id:"NO ANSWER",value:"Нет ответа"},{id:"ABANDON",value:"Брошенный"},{id:"FAILED",value:"Ошибка набора"},{id:"BUSY",value:"Занято"},{id:"ANSWERED",value:"Разговор состоялся"},{id:"COMPLETEAGENT",value:"Завершен оператором"},{id:"COMPLETECALLER",value:"Завершен клиентом"},{id:"TRANSFER",value:"Переведен"}]}],width:190,template:function(e){var t='<span class = "state '+e.reason+'">';return t+=webix.guiutils.сallReasonToTxt(e.reason),t+="</span>"}},{id:"userfield",header:["Входящий номер",{content:"textFilter"}],fillspace:1,template:function(e){return e.userfield},footer:{content:"count_answered"}}],on:{onBeforeFilter:function(){},onBeforeLoad:function(){webix.extend(this,webix.ProgressBar)},"data->onParse":function(e,t){if(0===t.data.length){var i=0;$$("cdr_reports").data.each(function(e){e&&e.time&&i++}),t.total_count=i}t.server_footer&&(this.config.$serverFooter=t.server_footer,this.config.serverFooter=t.server_footer)},onItemDblClick:function(){t.ReportsWindow.showWindow()},onAfterSelect:function(){var e=$$("cdr_reports"),t=e.getSelectedItem(),i="Выберите звонок для прослушивания";t&&(i="<audio style='height:32px;width:400px;' controls='true' src='/recording/"+t.uid+".mp3' type='audio/mpeg' preload='none'/>"),e.getColumnConfig("agent").footer[0].text=i,e.refreshColumns()},onAfterRender:function(){if($$("reportDateRange")&&$$("cdr_reports").getFilter("time")){var e=$$("reportDateRange").getValue();e&&(t.isRenderOnce||(t.isRenderOnce=1,$$("cdr_reports").getFilter("time").config.value=e))}}},ready:function(){webix.extend(e,webix.ProgressBar)}}},e.prototype.getView=function(){return{rows:[this.getGreed()]}},e.prototype.getToolBar=function(){return{css:"top-menu-right-item",id:this.toolBarId,hidden:!0,cols:[{css:"disable_margin_btn_tbar",id:"cdr_refresh_button",view:"button",type:"icon",icon:"wxi-sync",width:56,click:function(){$$("cdr_reports").filterByAll()}},{id:"cdr_excel_button",view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",hidden:!1,click:function(){$$("cdr_reports").loadNext(1e6,0,function(){webix.toExcel($$("cdr_reports"),{filterHTML:!0,filename:"Звонки",footer:!1}).fail(function(e){return console.error(e)})})}}]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").hide(),this.showToolBar()},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),$$("cdr_reports")&&(this.setToolBar(),webix.extend($$("cdr_reports"),webix.ProgressBar),this.loaded||$$("cdr_reports").load("calldatePartialLoad->/cdr/list","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.id="reports_info"}return e.prototype.setView=function(){webix.ui(this.getView())},e.prototype.getView=function(){var e=this.getThis();return{view:"window",id:"reports_info",position:"center",move:!0,modal:!1,resize:!0,minHeigth:1200,minWidth:1e3,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Звонки",inputWidth:100,align:"left"},{view:"icon",icon:"wxi-close",click:function(){$$("reports_info").close()}}]},body:{view:"form",id:"report_form",elements:[{rows:[{paddingX:17,cols:[{view:"text",name:"id",label:"ID",readonly:!0,hidden:!0},{view:"text",name:"time",label:"Дата/время",readonly:!0},{view:"text",name:"agent",label:"Сотрудник",readonly:!0},{view:"text",name:"src",label:"От кого",readonly:!0},{view:"text",name:"queue",label:"Очередь",readonly:!0}]},{paddingX:17,cols:[{view:"text",name:"dst",label:"Кому",readonly:!0},{view:"text",name:"hold",label:"Ожидание",readonly:!0},{view:"text",name:"talk",label:"Разговор",readonly:!0},{view:"text",name:"reason",label:"Результат",readonly:!0}]},{paddingX:17,cols:[{view:"text",name:"userfield",label:"Входящий номер",readonly:!0},{view:"text",name:"channel",label:"Канал звонящего",readonly:!0},{view:"text",name:"dstchannel",label:"Канал ответившего",readonly:!0},{view:"text",name:"uniqid",label:"ID",readonly:!0}]}]},{id:"reports_tbl",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,height:300,tooltip:!0,columns:[{id:"status",header:"",width:30,template:function(e){return"ANSWERED"==e.reason||"COMPLETEAGENT"==e.reason?"<span class='greencircle'>&nbsp;</span>":"<span class='redcircle'>&nbsp;</span>"},footer:{content:"summTotal",colspan:2}},{id:"time",header:["Дата/время"],width:250,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"id",header:["ID"],sort:"string",width:200,hidden:!0},{id:"agent",header:["Сотрудник"],sort:"string",width:200,footer:{text:"Выберите звонок для прослушивания",colspan:3}},{id:"queue",header:["Очередь"],sort:"string",width:200},{id:"src",header:["От кого"],sort:"string",width:130},{id:"dst",header:["Кому"],sort:"string",width:130},{id:"hold",header:["Ожидание"],sort:"int",width:100,template:function(e){return webix.guiutils.formatTime(e.hold)}},{id:"talk",header:["Разговор"],width:80,sort:"int",template:function(e){return webix.guiutils.formatTime(e.talk)}},{id:"reason",header:["Результат"],width:190,template:function(e){var t='<span class = "state '+e.reason+'">';return t+=webix.guiutils.сallReasonToTxt(e.reason),t+="</span>"}},{id:"userfield",header:["Входящий номер"],sort:"string",widht:160},{id:"channel",header:["Канал звонящего"],sort:"string",width:160},{id:"dstchannel",header:["Канал ответившего"],sort:"string",width:200},{id:"uniqid",header:["ID"],sort:"string",width:160}]}],elementsConfig:{labelPosition:"top",margin:10}},on:{onShow:function(){var t=$$("reports_tbl"),i=$$("cdr_reports").getSelectedItem();e.setId(i.id),$$("reports_tbl").load("/cdr/list/"+i.uid,"json",function(){}),$$("report_form").load("/cdr/list/"+i.uid,"json",function(){var e=$$("report_form").getValues();e.hold=webix.guiutils.formatTime(e.hold),e.talk=webix.guiutils.formatTime(e.talk),e.reason=webix.guiutils.сallReasonToTxt(e.reason),$$("report_form").setValues(e)}),text="<audio style='height:32px;width:400px;' controls='true' src='/recording/"+i.uid+".mp3' type='audio/mpeg' preload='none'/>",t.getColumnConfig("agent").footer[0].text=text,t.refreshColumns()}}}},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.reportId},e.prototype.setId=function(e){this.reportId=e},e.prototype.showWindow=function(){if($$(this.id)&&!$$(this.id).isVisible()&&$$(this.id).show(),!$$(this.id))return this.setView(),this.showWindow()},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i,o=[],n=0;n<e.length;n++){var a=e[n],s=t+"."+n,l={id:s,open:!1,checked:!0};void 0!==a.value&&(l.value=a.value),void 0!==a.elem&&(l.elem=a.elem),void 0!==a.col&&(l.col=a.col),void 0!==a.data&&(i=r(a.data,s),l.data=i),console.log(l),o.push(l)}return o}function n(){var e=[{elem:"gages_row",value:"Показатели",data:[{elem:"gage_sl",value:"SL"},{elem:"gage_lcr",value:"LCR"},{elem:"gage_ans",value:"Ср. ответа"},{elem:"gage_avg",value:"Ср. разговора"},{elem:"gage_fcr",value:"FCR"},{elem:"box3",value:"Стоимость звонка"}]},{elem:"ext_dashboard_managers",value:"Менеджеры",data:[{elem:"ext_dashboard_managers",col:"agent_name",value:"Менеджер"},{elem:"ext_dashboard_managers",col:"total",value:"Звонков"},{elem:"ext_dashboard_managers",col:"served",value:"Принятых"},{elem:"ext_dashboard_managers",col:"served_more20s",value:"После SL"},{elem:"ext_dashboard_managers",col:"unserved",value:"Не принятых"},{elem:"ext_dashboard_managers",col:"served_call_per",value:"Отвеченные(%)"},{elem:"ext_dashboard_managers",col:"sl",value:"SL"},{elem:"ext_dashboard_managers",col:"lcr",value:"LCR"},{elem:"ext_dashboard_managers",col:"avg_answer",value:"Ср. ответа"},{elem:"ext_dashboard_managers",col:"avg_duration",value:"Ср. разговора ВХ"},{elem:"ext_dashboard_managers",col:"out_count",value:"Исходящих"},{elem:"ext_dashboard_managers",col:"out_avg",value:"Ср. разговора ИСХ"},{elem:"ext_dashboard_managers",col:"int_count",value:"Внутренних"},{elem:"ext_dashboard_managers",col:"int_avg",value:"Ср. разговора ВН"}]},{elem:"ext_dashboard_charts",value:"Графики по звонкам",data:[{elem:"callschart",value:"По дням"},{elem:"hourschart",value:"По часам"}]},{elem:"ext_dashboard_charts2",value:"Графики по операторам",data:[{elem:"operatorsworktime",value:"Рабочее время"},{elem:"operatorschart",value:"Среднее время разговоров"}]},{elem:"dashboard_tree",value:"Данные по периодам",data:[{elem:"dashboard_tree",col:"period",value:"Период"},{elem:"dashboard_tree",col:"total",value:"Всего"},{elem:"dashboard_tree",col:"served",value:"Принято"},{elem:"dashboard_tree",col:"served20",value:"Принято > SL"},{elem:"dashboard_tree",col:"unserved",value:"Потеряно"},{elem:"dashboard_tree",col:"lost20",value:"Потеряно > SL"},{elem:"dashboard_tree",col:"served_call_per",value:"Отв (%)"},{elem:"dashboard_tree",col:"sl",value:"SL(%)"},{elem:"dashboard_tree",col:"agents",value:"Операторов"},{elem:"dashboard_tree",col:"avg_lost",value:"ВХ Ср. пот."},{elem:"dashboard_tree",col:"avg_ans",value:"ВХ Ср. отв."},{elem:"dashboard_tree",col:"avg_talk",value:"ВХ Ср. разг."},{elem:"dashboard_tree",col:"max_wait",value:"ВХ Макс. отв."},{elem:"dashboard_tree",col:"max_talk",value:"ВХ Макс. разг."},{elem:"dashboard_tree",col:"out_count",value:"Исходящих"},{elem:"dashboard_tree",col:"out_avg",value:"Ср. разговора ИСХ"},{elem:"dashboard_tree",col:"int_count",value:"Внутренних"},{elem:"dashboard_tree",col:"int_avg",value:"Ср. разговора ВН"}]}];return window.response=r(e,"ft"),console.log(response),response}Object.defineProperty(t,"__esModule",{value:!0});for(var a=[],s=0;s<24;s++)a.push({id:s,value:s+":00-"+s+"-59"});var l=function(){function e(){o(this,e),this.loaded=0,this.dashboard_req_pars="",this.toolBarId="ext_dashboard_toolbar",this.filterId="ext_dashboard_filter",this.id="ext_dashboard",webix.Manager.setComponent("ext_dashboard",this),this.ext_dashboard_charts2_tooltip="<table border=0><tr><td colspan=2><b>#agent_name#</td></tr><tr><td>Готов:</td><td>#ready# ч.</td></tr><tr><td>Не готов:</td><td>#notready# ч.</td></tr><tr><td>Обед:</td><td>#lunch# ч.</td></tr><tr><td>Отдых:</td><td>#rest# ч.</td></tr><tr><td>Постобработка:</td><td>#afterwork# ч.</td></tr><tr><td>Собрание:</td><td>#meeting# ч.</td></tr><tr><td>Доп. задачи:</td><td>#tasks# ч.</td></tr><tr><td>Разговоров:</td><td>#talktime# ч.</td></tr><tr><td>Утилизация:</td><td>#utilization# %</td></tr></table>",this.ext_dashboard_charts3_tooltip="<table border=0><tr><td colspan=2><b>#agent_name#</td></tr><tr><td>Ср. разговора:</td><td>#avg_duration#</td></tr><tr><td>Ср. исходящие:</td><td>#out_avg#</td></tr><tr><td>Ср. внутренние:</td><td>#int_avg#</td></tr></table>"}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.loadDashboard=function(){var e=this;return function(){var t=webix.guiutils.getExtDashboardFilterData();$$("ext_dashboard_managers").clearAll(),$$("dashboard_tree").clearAll(),$$("callschart").clearAll(),$$("hourschart").clearAll(),$$("operatorsworktime").clearAll(),$$("operatorschart").clearAll(),e.dashboard_req_pars=t,$$("search_ext_dashboard")&&webix.extend($$("search_ext_dashboard"),webix.ProgressBar),webix.ajax("/legacy/ext_dashboard_getgages",t,function(e,i,o){i=i.json(),$$("gage_sl").setValue(i.sl),$$("gage_lcr").setValue(i.lcr),$$("gage_fcr").setValue(i.fcr);var r=$$("box3").getValues();r.items[0].value=i.cost+" р.",$$("box3").setValues(r),$$("gage_ans").setValue(parseFloat(i.aat.replace(/,/,"."))),$$("gage_avg").setValue(i.att),webix.extend($$("ext_dashboard_managers"),webix.ProgressBar),webix.extend($$("operatorschart"),webix.ProgressBar),webix.extend($$("callschart"),webix.ProgressBar),webix.extend($$("hourschart"),webix.ProgressBar),webix.extend($$("dashboard_tree"),webix.ProgressBar),webix.extend($$("operatorsworktime"),webix.ProgressBar),$$("operatorschart").showProgress(),$$("callschart").showProgress(),$$("hourschart").showProgress(),$$("dashboard_tree").showProgress(),$$("operatorsworktime").showProgress(),webix.ajax("/legacy/ext_dashboard_agents_stat",t,function(e,i,o){var r=i.json();$$("ext_dashboard_managers").clearAll(),$$("ext_dashboard_managers").parse(r.data),$$("operatorschart").clearAll(),$$("operatorschart").parse(r.data),$$("ext_dashboard_managers").hideProgress(),$$("operatorschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_callschart",t,function(e,i,o){$$("callschart").clearAll(),$$("callschart").parse(e),$$("callschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_hourschart",t,function(e,i,o){$$("hourschart").clearAll(),$$("hourschart").parse(e),$$("hourschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_treetable",t,function(e,t,i){$$("dashboard_tree").clearAll(),$$("dashboard_tree").parse(e),$$("dashboard_tree").hideProgress()})})})})}),webix.ajax("/legacy/ext_dashboard_worktimechart",t,function(e,t,i){$$("operatorsworktime").clearAll(),$$("operatorsworktime").parse(e),$$("operatorsworktime").hideProgress()})}},e.prototype.getColor=function(e){return e<20?"green":e<50?"orange":"red"},e.prototype.getColorFcr=function(e){return e<50?"red":e<80?"orange":"greed"},e.prototype.getToolBar=function(){return{id:this.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{css:"disable_margin_btn_tbar",id:"search_ext_dashboard",view:"button",type:"icon",icon:"wxi-sync",width:56,on:{onItemClick:function(){webix.AppFilter.submit()},onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getToolTestBar=function(){return{type:"space",id:this.filterId,name:this.filterId,margin:0,padding:0,rows:[{view:"multiselect",id:"hours",name:"hours",label:"Часы",labelWidth:100,labelPosition:"top",options:a},{view:"multiselect",id:"queues-select",name:"queues-select",label:"Очереди",labelWidth:100,labelPosition:"top",options:"/legacy/grouped_queues_name/short"},{view:"multiselect",id:"agents",name:"agents",label:"Операторы",labelWidth:100,labelPosition:"top",options:"/legacy/ext_dashboard_agentslist/0/short"},{view:"label",template:'<hr style="background-color: transparent">',height:20},{cols:[{id:"ext_dashboard_fields",view:"button",type:"icon",icon:"fa fa-list",width:155,label:"Поля",click:function(){if($$("fields_setup_win"))return void $$("fields_setup_win").show();webix.ui({id:"fields_setup_win",view:"window",title:"",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Настройка полей"},{view:"icon",icon:"wxi-close",click:"$$('fields_setup_win').close();"}]},resize:!0,width:600,height:500,center:!0,position:"center",modal:!1,move:!0,body:{rows:[{id:"fields_tree",view:"tree",template:"{common.icon()} {common.checkbox()} {common.folder()} <span>#value#</span>",select:!0,data:n(),on:{onItemCheck:function(e){var t=$$("fields_tree").getItem(e);t.checked?void 0!==t.col?$$(t.elem).showColumn(t.col):$$(t.elem).show():void 0!==t.col?$$(t.elem).hideColumn(t.col):$$(t.elem).hide()}}}]}}).show()}},{},{id:"ext_dashboard_salary",view:"button",type:"icon",icon:"fa fa-dollar-sign",width:155,label:"Оклады",click:function(){webix.ui({id:"salary_setup_win",view:"window",title:"",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Настройка окладов"},{view:"icon",icon:"wxi-close",click:"$$('salary_setup_win').close();"}]},resize:!0,width:600,height:500,center:!0,position:"center",modal:!0,move:!0,body:{rows:[{view:"datatable",id:"salary_agents",autowidth:!0,editable:!0,columns:[{id:"value",header:"Сотрудник",width:400},{id:"salary",header:"Оклад",width:100,editor:"text"}],url:"/legacy/ext_dashboard_agentslist/",on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{view:"button",label:"Сохранить",click:function(){}}]}]}}).show()}}]}]}},e.prototype.resetFilters=function(){$$("hours").setValue(""),$$("agents").setValue(""),$$("queues-select").setValue("")},e.prototype.getGages=function(){return{type:"clean",rows:[{id:"gages_row",rows:[{id:"gages",cols:[{id:"gage_sl",view:"gage",minRange:0,maxRange:100,color:this.getColorFcr(),value:0,label:"SL",placeholder:"%"},{id:"gage_lcr",view:"gage",minRange:0,maxRange:100,color:this.getColor(),value:0,label:"LCR",placeholder:"%"},{id:"gage_ans",view:"gage",minRange:0,maxRange:20,color:this.getColor(),value:0,label:"Ср.ответа",placeholder:"сек"},{id:"gage_avg",view:"gage",minRange:0,maxRange:120,color:this.getColor(),value:0,label:"Ср.разговора",placeholder:"сек"},{id:"gage_fcr",view:"gage",minRange:0,maxRange:100,color:this.getColorFcr(),value:0,label:"FCR",placeholder:"%"},{id:"box3",view:"template",height:136,css:"tiles",width:250,template:function(e){for(var t=null,i=e.items,o="<div class='flex_tmp'>",r=0;r<i.length;r++)t=i[r],o+="<div class='item "+t.css+"'>",o+="<div class='webix_icon icon fa-"+t.icon+"'></div>",o+="<div class='details'><div class='text'>"+t.text+"</div><div class='value'>"+t.value+"</div></div>",o+="</div>";return o+="</div>"},data:{items:[{id:"evidences",text:"Стоимость звонка",icon:"wxi-usd",css:"feedbacks",value:""}]}}]}]}]}},e.prototype.getManagers=function(){return{type:"clean",rows:[{id:"ext_dashboard_managers",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,height:300,columns:[{id:"agent_name",header:[{text:"Менеджеров"}],sort:"string",width:160},{id:"total",header:[{text:"Звонков"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"served_more20s",header:[{text:"После SL"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"served_call_per",header:[{text:"Отвеченные(%)"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. разговора ВХ"}],width:160},{id:"out_count",header:[{text:"Исходящих"}],width:160},{id:"out_avg",header:[{text:"Ср. разговора ИСХ"}],width:160},{id:"int_count",header:[{text:"Внутренних"}],width:160},{id:"int_avg",header:[{text:"Ср. разговора ВН"}],width:160}],onBeforeLoad:function(){this.showProgress()},onAfterLoad:function(){this.hideProgress()},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getCharts=function(){return{type:"clean",rows:[{id:"ext_dashboard_charts",rows:[{height:300,cols:[{id:"callschart",view:"chart",type:"bar",barWidth:20,radius:2,alpha:.7,gradient:"rising",xAxis:{template:"'#period#"},yAxis:{property:"value"},legend:{values:[{text:"Звонки",color:"#4aa397"},{text:"SL",color:"#de619c",markerType:"item"}],valign:"middle",align:"right",width:90,layout:"y"},series:[{value:"#calls#",color:"#4aa397",tooltip:{template:"Звонков: #calls#, SL: #sl#%"}},{type:"line",value:"#slg#",color:"#36abee",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:"Звонков: #calls#, SL: #sl#%"}}]},{id:"hourschart",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#time#"},yAxis:{},legend:{values:[{text:"Принятые > SL",color:"#36abee"},{text:"Принято < SL",color:"#f7ae70"},{text:"Потеряно > SL",color:"#a7ee70"},{text:"Потеряно < SL",color:"#07eef0"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#unserved20#",color:"#07eef0",label:"#unserved20#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#unserved#",color:"#a7ee70",label:"#unserved#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#served20#",color:"#f7ae70",label:"#served20#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#served#",label:"#served#",color:"#36abee",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}}]}]},{id:"ext_dashboard_charts2",rows:[{height:300,id:"operatorsworktime",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#agent_name_short#"},yAxis:{},legend:{values:[{text:"Готов",color:"#36abee"},{text:"Не готов",color:"#f7ae70"},{text:"Обед",color:"#a7fe70"},{text:"Отдых",color:"#f7aeff"},{text:"Постобработка",color:"#a7ae70"},{text:"Собрание",color:"#36cbfe"},{text:"Доп.задачи",color:"#36fffe"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#notready#",color:"#f7ae70",label:"#notready# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#lunch#",color:"#a7fe70",label:"#lunch# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#rest#",color:"#f7aeff",label:"#rest# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#afterwork#",color:"#a7ae70",label:"#afterwork# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#meeting#",color:"#36cbfe",label:"#meeting# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#tasks#",color:"#36fffe",label:"#tasks# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{value:"#ready#",color:"#36abee",label:"#ready# ч.",tooltip:{template:this.ext_dashboard_charts2_tooltip}},{type:"line",value:"#utg#",color:"#36abee",label:"#utilization#%",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:this.ext_dashboard_charts2_tooltip}}]},{height:300,id:"operatorschart",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#agent_name_short#"},yAxis:{},legend:{values:[{text:"Ср. разговора",color:"#36abee"},{text:"Ср. исходящие",color:"#f6abee"},{text:"Ср. внутренние",color:"#36fbee"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#avg_duration_sec#",color:"#36abee",label:"#avg_duration#",tooltip:{template:this.ext_dashboard_charts3_tooltip}},{value:"#out_avg_sec#",color:"#f6abee",label:"#out_avg#",tooltip:{template:this.ext_dashboard_charts3_tooltip}},{value:"#int_avg_sec#",color:"#36fbee",label:"#int_avg#",tooltip:{template:this.ext_dashboard_charts3_tooltip}}]}]}]}]}},e.prototype.getCalls=function(){return{id:"dashboard_tree",type:{folder:""},view:"treetable",columns:[{id:"period",header:[{text:"Период"}],width:250,template:"{common.treetable()} #period#"},{id:"total",header:[{text:"Всего"}]},{id:"served",header:[{text:"Принято"}]},{id:"served20",header:[{text:"Принято > SL"}],width:150},{id:"unserved",header:[{text:"Потеряно"}]},{id:"lost20",header:[{text:"Потеряно > SL"}],width:150},{id:"served_call_per",header:[{text:"Отв (%)"}]},{id:"sl",header:[{text:"SL(%)"}]},{id:"agents",header:[{text:"Операторов"}]},{id:"avg_lost",header:[{text:"ВХ Ср. потер."}],width:130},{id:"avg_ans",header:[{text:"ВХ Ср. отв."}]},{id:"avg_talk",header:[{text:"ВХ Ср. разг."}]},{id:"max_wait",header:[{text:"ВХ Макс. отв."}],width:130},{id:"max_talk",header:[{text:"ВХ Макс. разг."}],width:130},{id:"out_count",header:[{text:translate("Исходящих")}],width:160},{id:"out_avg",header:[{text:translate("Ср. разговора ИСХ")}],width:160},{id:"int_count",header:[{text:translate("Внутренних")}],width:160},{id:"int_avg",header:[{text:translate("Ср. разговора ВН")}],width:160}],resizeColumn:!0,height:500,select:!0,on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)},onDataRequest:function(e){var t=webix.guiutils.getExtDashboardFilterData(1);return this.load("/legacy/ext_dashboard_treetable?filter[parent]="+e+"&"+t),!1}}}},e.prototype.getView=function(){return{id:"ext_dashboard",hidden:!0,rows:[{view:"scrollview",id:"verses",scroll:!0,body:{rows:[this.getGages(),this.getManagers(),this.getCharts(),this.getCalls()]}}]}},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(this.loadDashboard()),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=l},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.id="grouped_reports",this.toolBarId="grouped_reports_toolbar",this.filterId="grouped_reports_filter",this.additionOptionsWindowId="win_option_grouped_reports",webix.Manager.setComponent("grouped_reports",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getFirstReport=function(){return{id:"grouped_reports1_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонки</center>"}],height:30},{id:"grouped_reports1",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getSecondReport=function(){return{id:"grouped_reports2_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Суммарное время разговора, ожидания (мин.)</center>"}],height:30},{id:"grouped_reports2",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getThirdReport=function(){return{id:"grouped_reports3_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Причина завершения обслуженных звонков</center>"}],height:30},{id:"grouped_reports3",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getFourthReport=function(){return{id:"grouped_reports4_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Причина завершения необслуженных звонков</center>"}],height:30},{id:"grouped_reports4",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getFifthReport=function(){return{id:"grouped_reports5_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"grouped_reports5",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getSixthReport=function(){return{id:"grouped_reports6_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"grouped_reports6",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getSeventhReport=function(){return{id:"grouped_reports7_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонки по уровню обслуживания (обслуженные в интервале ожидания)</center>"}],height:30},{id:"grouped_reports7",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.getGreed=function(){return[{visibleBatch:"1",rows:[{id:"analysis_outgoing_calls_layout_1",view:"scrollview",batch:1,scroll:"y",body:{height:1120,rows:[{cols:[this.getFirstReport(),{view:"resizer"},this.getSeventhReport()]},{view:"resizer"},{cols:[this.getSixthReport(),{view:"resizer"},this.getSecondReport()]},{view:"resizer"},{cols:[this.getFifthReport(),{view:"resizer"},this.getThirdReport()]},{view:"resizer"},{cols:[this.getFourthReport()]}]}}]}]},e.prototype.getView=function(){return{id:"grouped_reports",hidden:!0,type:"clean",rows:this.getGreed()}},e.prototype.refreshReport=function(){var e=this.getThis(),t=$$("reportDateRange").getValue(),i="";if(t.end){var o=webix.guiutils.sqlDateTime(t.start);i=webix.guiutils.sqlDateTime(t.end)}else var o=webix.guiutils.sqlDate(t.start);webix.extend($$(e.id),webix.ProgressBar),$$(e.id).showProgress();var r={t1:o,t2:i},n="?filter[t1]="+r.t1+"&filter[t2]="+r.t2;$$("queueReports").getValue()&&(n+="&filter[queue]="+$$("queueReports").getValue()),$$("filterReports").getValue()&&(n+="&filter[filter]="+$$("filterReports").getValue());var a="/legacy/grouped_reports_total_chart";$$("grouped_reports1").load(a+"1"+n),$$("grouped_reports2").load(a+"2"+n),$$("grouped_reports3").load(a+"3"+n),$$("grouped_reports4").load(a+"4"+n),$$("grouped_reports5").load(a+"5"+n),$$("grouped_reports6").load(a+"6"+n),$$("grouped_reports7").load(a+"7"+n,function(){$$(e.id).hideProgress()})},e.prototype.getThis=function(){return this},e.prototype.getToolBar=function(){var e=this.getThis();return{css:"top-menu-right-item",id:this.toolBarId,hidden:!0,cols:[{css:"disable_margin_btn_tbar",id:"search_grouped_reports",view:"button",type:"icon",icon:"wxi-sync",width:55,click:function(){e.refreshReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",disabled:!0,id:"grouped_reports_export"}]}},e.prototype.getToolTestBar=function(){return{id:this.filterId,rows:[]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),$$("defaultsForReports").show(),webix.AppFilter.setSubmit(function(){e.refreshReport()}),webix.AppFilter.setReset(function(){webix.AppFilter.resetDefaultReport()}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="agents_grouped_reports_toolbar",this.filterId="grouped_reports_by_agents_filter",this.id="grouped_reports_by_agents",webix.Manager.setComponent("grouped_reports_by_agents",this)}return e.prototype.getThis=function(){return this},e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getGreed=function(){return{id:"agents_reports",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"agent",header:[{text:"<b>Агент</b>",rowspan:3,height:25},{text:"",height:25},{text:"",height:25},{content:"selectFilter"}],sort:"string",template:"#agent#",width:115,footer:{text:"Total:",height:30}},{id:"agent_name",header:[{text:"<b>Имя агента</b>",rowspan:3},{text:""},{text:""},{content:"selectFilter"}],sort:"string",width:120,footer:{content:"avgColumn"}},{id:"total_call",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",footer:{content:"summColumn"}},{id:"unserved_call",header:[{text:""},{text:"Необслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:140,template:"#unserved_call_chart#",footer:{content:"summColumn"}},{id:"served_call",header:[{text:""},{text:"Обслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:140,template:"#served_call_chart#",footer:{content:"summColumn"}},{id:"investment_unserved",header:[{text:"<b>Вклад, %</b>",colspan:2},{text:"Необслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:135},{id:"investment_served",header:[{text:""},{text:"Обслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:130},{id:"time_sum_hold",header:[{text:"<b>Время, мин.</b>",colspan:4},{text:"Всего",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"int",width:140,template:"#time_sum_hold_chart#",footer:{content:"summTimeColumn"}},{id:"time_sum_talk",header:[{text:""},{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"int",width:140,template:"#time_sum_talk_chart#",footer:{content:"summTimeColumn"}},{id:"time_avg_hold",header:[{text:""},{text:"Среднее",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"int",width:100,footer:{content:"avaregeTimeColumn"}},{id:"time_avg_talk",header:[{text:""},{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"int",width:100,footer:{content:"avaregeTimeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getView=function(){return{id:"grouped_reports_by_agents",hidden:!0,type:"clean",rows:[this.getGreed()]}},e.prototype.loadReport=function(e){var t=$$("reportDateRange").getValue(),i=t.start,o=i.getMonth()+1,r=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),n=t.end;if(n)var a=n.getMonth()+1,s=n.getFullYear()+"-"+a+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();else var s="";var l="/legacy/grouped_agents_reports?filter[t1]="+r+"&filter[t2]="+s;$$("filterReports").getValue()&&(l+="&filter[filter]="+$$("filterReports").getValue()),$$("queueReports").getValue()&&(l+="&filter[queue]="+$$("queueReports").getValue()),$$("agents_reports").clearAll(),webix.extend($$("agents_reports"),webix.ProgressBar),$$("agents_reports").showProgress(),$$("agents_reports").load(l,function(){e&&e()})},e.prototype.getToolBar=function(){var e=this.getThis();return{id:e.toolBarId,css:"top-menu-right-item",cols:[{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel"}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),$$("agents_reports")&&(webix.extend($$("agents_reports"),webix.ProgressBar),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),$$("defaultsForReports").show(),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){webix.AppFilter.resetDefaultReport()}),this.loaded||(webix.AppFilter.submit(),this.loaded=1))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="queues_grouped_reports_toolbar",this.id="queues_grouped_reports_filter",this.filterId="queues_grouped_reports_filter",webix.Manager.setComponent("grouped_reports_by_queues",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.loadQueuesGroupedReports=function(){var e=$$("filterReports").getValue(),t=$$("queueReports").getValue(),i=$$("reportDateRange").getValue(),o=i.start,r=o.getMonth()+1,n=o.getFullYear()+"-"+r+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),a=i.end;if(a)var s=a.getMonth()+1,l=a.getFullYear()+"-"+s+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();else var l="";var c="?filter[t1]="+n+"&filter[t2]="+l;1==e?($$("report_queues_chart1_l").show(),$$("report_queues_chart2_l").show(),$$("report_queues_chart3_l").show(),$$("report_queues_chart4_l").show(),$$("report_queues_chart5_l").show()):2==e?($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").show(),$$("report_queues_chart3_l").hide(),$$("report_queues_chart4_l").show(),$$("report_queues_chart5_l").show()):3==e?($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").hide(),$$("report_queues_chart3_l").show(),$$("report_queues_chart4_l").hide(),$$("report_queues_chart5_l").show()):4==e&&($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").hide(),$$("report_queues_chart3_l").hide(),$$("report_queues_chart4_l").hide(),$$("report_queues_chart5_l").hide()),""!=e&&(c+="&filter[filter]="+e),""!=t&&(c+="&filter[queue]="+t),$$("report_queues_table").clearAll(),webix.extend($$("report_queues_table"),webix.ProgressBar),$$("report_queues_table").showProgress(),$$("report_queues_table").load("/legacy/grouped_queues_table_total"+c),$$("report_queues_chart1").clearAll(),webix.extend($$("report_queues_chart1"),webix.ProgressBar),$$("report_queues_chart1").showProgress(),$$("report_queues_chart1").load("/legacy/grouped_queues_table_chart1"+c),$$("report_queues_chart2").clearAll(),webix.extend($$("report_queues_chart2"),webix.ProgressBar),$$("report_queues_chart2").showProgress(),$$("report_queues_chart2").load("/legacy/grouped_queues_table_chart2"+c),$$("report_queues_chart3").clearAll(),webix.extend($$("report_queues_chart3"),webix.ProgressBar),$$("report_queues_chart3").showProgress(),$$("report_queues_chart3").load("/legacy/grouped_queues_table_chart3"+c),$$("report_queues_chart4").clearAll(),webix.extend($$("report_queues_chart4"),webix.ProgressBar),$$("report_queues_chart4").showProgress(),$$("report_queues_chart4").load("/legacy/grouped_queues_table_chart4"+c),$$("report_queues_chart5").clearAll(),webix.extend($$("report_queues_chart5"),webix.ProgressBar),$$("report_queues_chart5").showProgress(),$$("report_queues_chart5").load("/legacy/grouped_queues_table_chart5"+c)},e.prototype.getGreed=function(){return{id:"report_queues_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"name_queue",header:[{text:"<b>Очередь</b>",rowspan:2,height:25},{text:"",height:25}],width:150,footer:{text:"Всего:",height:30}},{id:"calls_total",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего"}],width:120,footer:{content:"summColumn"}},{id:"unserved_call",header:[{text:""},{text:"Необслуженные"}],width:140,template:"#unserved_call_chart#",footer:{content:"summColumn"}},{id:"served_call",header:[{text:""},{text:"Обслуженные"}],width:140,template:"#served_call_chart#",footer:{content:"summColumn"}},{id:"sum_holdtime",header:[{text:"<b>Суммарное время, мин.</b>",colspan:2},{text:"Ожидание"}],width:140,template:"#sum_holdtime_chart#",footer:{content:"summTimeColumn"}},{id:"sum_talktime",header:[{text:""},{text:"Разговор"}],width:140,template:"#sum_talktime_chart#",footer:{content:"summTimeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getFirstChartRow=function(){return{cols:[{id:"report_queues_chart1_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Всего звонков</center>"}],height:30},{id:"report_queues_chart1",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:function(e){if(!e)return"";if(!e.month)return"";if(e.month.toString().length>10){var t=e.month.substring(0,7);return t+="..",t+=e.month.substring(e.month.length-2)}return e.month},width:200,tooltip:{template:"#month#"}},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"report_queues_chart2_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Обслуженные звонки</center>"}],height:30},{id:"report_queues_chart2",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:function(e){if(!e)return"";if(!e.month)return"";if(e.month.toString().length>10){var t=e.month.substring(0,7);return t+="..",t+=e.month.substring(e.month.length-2)}return e.month},width:200,tooltip:{template:"#month#"}},yAxis:{start:0,step:10},legend:{values:[{text:"Перевод",color:"#66CCFF"},{text:"Завершен оператором",color:"#FFCC33"},{text:"Завершен клиентом",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FFCC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.getSecondChartRow=function(){return{cols:[{id:"report_queues_chart4_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"report_queues_chart4",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:function(e){if(!e)return"";if(!e.month)return"";if(e.month.toString().length>10){var t=e.month.substring(0,7);return t+="..",t+=e.month.substring(e.month.length-2)}return e.month},width:200,tooltip:{template:"#month#"}},yAxis:{start:0,step:10},legend:{values:[{text:"Минимум",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимум",color:"#66CC33"}],valign:"middle",align:"right",width:130,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"report_queues_chart5_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"report_queues_chart5",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:function(e){if(!e)return"";if(!e.month)return"";if(e.month.toString().length>10){var t=e.month.substring(0,7);return t+="..",t+=e.month.substring(e.month.length-2)}return e.month},width:200,tooltip:{template:"#month#"}},yAxis:{start:0,step:10},legend:{values:[{text:"Минимум",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимум",color:"#66CC33"}],valign:"middle",align:"right",width:130,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.getLastChartRow=function(){return{rows:[{id:"report_queues_chart3_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Необслуженные звонки</center>"}],height:30},{id:"report_queues_chart3",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:function(e){if(!e)return"";if(!e.month)return"";if(e.month.toString().length>10){var t=e.month.substring(0,7);return t+="..",t+=e.month.substring(e.month.length-2)}return e.month},width:200,tooltip:{template:"#month#"}},yAxis:{start:0,step:10},legend:{values:[{text:"Прерванные клиентом",color:"#66CCFF"},{text:"Таймаут вызова клиента",color:"#FF3333"},{text:"По нажатию кнопки клиентом",color:"#66CC33"},{text:"По причине пустой очереди",color:"#CC6633"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}},{value:"#sales4#",color:"#CC6633",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales4#</div>",tooltip:{template:"#sales4#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.getView=function(){var e=this;return{id:"grouped_reports_by_queues",hidden:!0,type:"clean",rows:[{id:"report_queues",batch:3,view:"scrollview",scroll:"y",body:{height:1010,rows:[e.getGreed(),{view:"resizer"},e.getFirstChartRow(),{view:"resizer"},e.getSecondChartRow(),{view:"resizer"},e.getLastChartRow()]}}]}},e.prototype.getToolBar=function(){var e=this;return{id:this.toolBarId,css:"top-menu-right-item",cols:[{view:"button",id:"queues_grouped_reports_load_button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Показать отчет",click:function(){e.loadQueuesGroupedReports()},on:{itemClick:function(){e.loadQueuesGroupedReports()}}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel"}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),$$("defaultsForReports").show(),webix.AppFilter.setSubmit(function(){e.loadQueuesGroupedReports()}),webix.AppFilter.setReset(function(){webix.AppFilter.resetDefaultReport()}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="lost_calls_toolbar",this.filterId="lost_calls_filter",this.id="lost_calls",webix.Manager.setComponent("lost_calls",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getGreed=function(){return{id:"lost_calls_table",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!1,navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"title_unserved_calls",header:[{text:"<b> <center>"+translate("Report for period")+"</center> </b>",colspan:5,height:25},{text:"",rowspan:2,height:25},{text:"",height:25}],fillspace:!0},{id:"client_callback",fillspace:!0,header:[{text:""},{text:translate("Client called back himself"),rowspan:2},{text:""}]},{id:"manager_callback",fillspace:!0,header:[{text:""},{text:translate("Manager called back to client"),colspan:2},{text:translate("Total")}]},{id:"speed_callback",fillspace:!0,header:[{text:""},{text:""},{text:translate("Average speed of callback, h.")}]},{id:"call_was_lost",fillspace:!0,header:[{text:""},{text:translate("Lost call"),rowspan:2},{text:""}]}],on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getList=function(){return{id:"lost_calls_list",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",columns:[{header:[{text:"<b>"+translate("List of lost calls during period")+"</b>",height:25},{content:"textFilter",height:30}],sort:"string",fillspace:!0,id:"number",footer:{text:"<center><b>"+translate("Total:")+"</b></center>",height:30},template:function(e){return'<a href="tel:'+e.number+'">'+e.number+"</a>"}},{id:"date",header:["<b>"+translate("Date and time of last call during period")+"</b>",{content:"textFilter"}],sort:"string",fillspace:!0,footer:{content:"avgColumn"},format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"queue",header:["<b>Очередь</b>",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"agent",header:["<b>Оператор</b>",{content:"textFilter"}],sort:"string",fillspace:!0}],on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getView=function(){var e=this;return{id:"lost_calls",hidden:!0,type:"clean",rows:[e.getGreed(),{view:"resizer"},e.getList()]}},e.prototype.loadReport=function(e){webix.extend($$("lost_calls_list"),webix.ProgressBar),webix.extend($$("lost_calls_table"),webix.ProgressBar),$$("lost_calls_table").enable(),$$("lost_calls_list").enable();var t=webix.guiutils.getDateRange("reportDateRange"),i={t1:t.start,t2:t.end},o="filter[t1]="+i.t1+"&filter[t2]="+i.t2;$$("lost_calls_list").showProgress(),$$("lost_calls_table").showProgress(),webix.ajax().get("legacy/lost_calls_total",o,{error:function(e,t,i){$$("lost_calls_list").hideProgress(),$$("lost_calls_table").hideProgress(),webix.message({type:"error",text:"Произошла ошибка при получении данных."})},success:function(t,i,o){var r=i.json();$$("lost_calls_list").clearAll(),r.data.lost_cals&&$$("lost_calls_list").parse(r.data.lost_cals),$$("lost_calls_table").clearAll(),r.data&&$$("lost_calls_table").parse(r.data),$$("lost_calls_list").hideProgress(),$$("lost_calls_table").hideProgress(),e&&e()}})},e.prototype.getToolBar=function(){var e=this;return{id:"lost_calls_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{id:"search_lost_calls",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("lost_calls_list"),{filterHTML:!0,filename:"Lost"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.id="analysis_outgoing_calls",this.toolBarId="analysis_outgoing_calls_toolbar",this.filterId="analysis_outgoing_calls_filter",webix.Manager.setComponent("analysis_outgoing_calls",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getTrafficForPeriod=function(){return[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>Трафик за период</center>"}]},{id:"traffic_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"name",header:[{text:"Направление",height:30}],fillspace:2},{id:"count",header:[{text:"Звонки"}],fillspace:2},{id:"duration",header:[{text:"Длительность"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},e.prototype.getPopularCityForPeriod=function(){return[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>Популярные городские звонки за период</center>"}]},{id:"popular_city_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},e.prototype.getPopularLongDistanceOverPeriod=function(){return[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>Популярные междугородние звонки за период</center>"}]},{id:"popular_longdistance_over_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},e.prototype.getPopularCellForPeriod=function(){return[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>Популярные сотовые звонки за период</center>"}]},{id:"popular_cell_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},e.prototype.getMostCallingEmployersForPeriod=function(){return[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>Самые звонящие сотрудники за период</center>"}]},{id:"most_calling_employees_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"src",header:[{text:"Сотрудник",height:30}],fillspace:2},{id:"count_src",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_dst",header:[{text:"Номера"}],fillspace:4,tooltip:"<div style:'color:#000000;'>#group_dst#</div>"}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},e.prototype.getGreed=function(){var e=this.getThis();return{id:"analysis_outgoing_calls_layout",view:"scrollview",scroll:"y",body:{rows:[{height:250,rows:e.getTrafficForPeriod()},{view:"resizer"},{height:280,rows:e.getPopularCityForPeriod()},{view:"resizer"},{height:280,rows:e.getPopularLongDistanceOverPeriod()},{view:"resizer"},{height:280,rows:e.getPopularCellForPeriod()},{view:"resizer"},{height:280,rows:e.getMostCallingEmployersForPeriod()}]}}},e.prototype.getView=function(){var e=this.getThis();return{id:e.id,hidden:!0,type:"clean",rows:[{rows:[e.getGreed()]}]}},e.prototype.getToolBar=function(){return{css:"top-menu-right-item",id:this.toolBarId,hidden:!0,cols:[{id:"search_analysis_outgoing_calls",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){webix.guiutils.billing_analysis_outgoing_calls_refresh()}}]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.loadData=function(){this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){webix.guiutils.billing_analysis_outgoing_calls_refresh()}),webix.AppFilter.setReset(function(){}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.operators_work_report_toolbar="",this.toolBarId="operators_work_report_toolbar",this.filterId="operators_work_report_filter",this.id="operators_work_report",webix.Manager.setComponent("operators_work_report",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getView=function(){return{id:"operators_work_report",hidden:!0,type:"clean",rows:[{id:"operators_work_table",view:"datatable",resizeColumn:!0,resizeRow:!0,footer:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"operator_name",header:[{text:"Имя оператора",height:25},{content:"textFilter"}],sort:"string",width:210,footer:{text:"Всего:",height:30}},{id:"time_ready",header:[{text:"Время, сколько был готов"},{content:"textFilter"}],sort:"string",width:200,footer:{content:"avgColumn"}},{id:"time_unready",header:[{text:"Суммарное время"},{content:"textFilter"}],sort:"string",width:160},{id:"time_post",header:[{text:"Суммарное время постобработки"},{content:"textFilter"}],sort:"string",width:260},{id:"time_first",header:[{text:"Время первого входа"},{content:"textFilter"}],sort:"string",width:260,template:function(e){if(!e)return"";if(e.time_first){var t=e.time_first.split(" ");return t[0]&&t[1]?t[0]+" в "+t[1]:e.time_first}return""}},{id:"time_last",header:[{text:"Последнего выхода"},{content:"textFilter"}],sort:"string",width:260,template:function(e){if(!e)return"";if(e.time_last){var t=e.time_last.split(" ");return t[0]&&t[1]?t[0]+" в "+t[1]:e.time_last}return""}},{id:"include",header:[{text:"Включений в очереди"},{content:"textFilter"}],sort:"string",width:260},{id:"take_part",header:[{text:"Очереди, в которых принимал участие"},{content:"textFilter"}],sort:"string",width:450}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{id:"operators_work_report_list",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",tooltip:!0,scheme:{$change:function(e){"Начало смены"==e.type&&(e.$css="highlightB"),"Не готов"==e.type&&(e.$css="highlightY"),"Завершение смены"==e.type&&(e.$css="highlightR")}},columns:[{id:"type",header:[{text:"<b>Тип</b>",height:25},{content:"textFilter"}],sort:"string",width:250,template:"{common.treetable()} #type#"},{id:"calldate",header:["<b>Время</b>",{content:"textFilter"}],sort:"string",width:180,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"duration",header:["<b>Длительность</b>",{content:"textFilter"}],sort:"string",width:150},{id:"queue",header:["<b>Очередь</b>",{content:"textFilter"}],sort:"string",width:0}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.loadReport=function(e){var t=webix.guiutils.getDateRange("reportDateRange"),i="?filter[t1]="+t.start+"&filter[t2]="+t.end;$$("operators_work_table").load("/legacy/operators_work_report"+i),$$("operators_work_report_list").load("legacy/operators_work_report_list"+i,function(){e&&e()})},e.prototype.getToolBar=function(){var e=this;return{id:e.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{id:"search_operators_work_report",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("operators_work_report"),{filterHTML:!0,filename:"Operators"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="interval_reports_toolbar",this.id="interval_reports",this.filterId="interval_reports_filter",this.additionOptionsWindowId="win_option_interval_reports",webix.Manager.setComponent("interval_reports",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getGreed=function(){return{id:"interval_reports_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"<b>Интервал</b>",rowspan:2,height:25},{text:"",height:25},{content:"textFilter"}],sort:"string",width:130,footer:{text:"Всего:",height:30},format:webix.Date.dateToStr("%d.%m.%Y")},{id:"calls_total",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего"},{content:"textFilter"}],sort:"string",width:85,footer:{content:"summColumn"}},{id:"calls_unserved",header:[{text:""},{text:"Необслуженные"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summColumn"},template:"#calls_unserved_chart#"},{id:"calls_served",header:[{text:""},{text:"Обслуженные"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summColumn"},template:"#calls_served_chart#"},{id:"sum_holdtime",header:[{text:"<b>Суммарное время, мин.</b>",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summTimeColumn"},template:"#sum_holdtime_chart#"},{id:"sum_talktime",header:[{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summTimeColumn"},template:"#sum_talktime_chart#"}],ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getView=function(){return{type:"clean",id:"interval_reports",hidden:!0,rows:[{view:"scrollview",scroll:"y",body:{height:1120,rows:[this.getGreed(),{view:"resizer"},{cols:[{id:"chart_total_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Всего звонков</center>"}],height:30},{id:"chart_total_calls",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",legend:{values:[{text:"Всего звонков",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},tooltip:{template:"<b>Date: </b>#month#<br><b>Всего звонков: </b>#sales#"},xAxis:{template:""},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"chart_served_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Обслуженные звонки</center>"}],height:30},{id:"chart_served_calls",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Трансфер звонков",color:"#66CCFF"},{text:"Завершенные агентом",color:"#FFCC33"},{text:"Завершенные клиентом",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Трансфер звонков: </b>#sales#"}},{value:"#sales2#",color:"#FFCC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Завершенные агентом: </b>#sales2#"}},{value:"#sales3#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Завершенные клиентом: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{cols:[{id:"chart_unserved_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Необслуженные звонки</center>"}],height:30},{id:"chart_unserved_calls",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Прерванные клиентом",color:"#66CCFF"},{text:"Таймаут вызова агента",color:"#FF3333"},{text:"По нажатию кнопки клиентом",color:"#66CC33"},{text:"По причине пустой очереди",color:"#CC6633"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Прерванные клиентом: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Таймаут вызова агента: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>По нажатию кнопки клиентом: </b>#sales3#"}},{value:"#sales4#",color:"#CC6633",tooltip:{template:"<b>Date: </b>#year#<br><b>По причине пустой очереди: </b>#sales4#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"chart_talktime_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"chart_talktime",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Минимальное",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимальное",color:"#66CC33"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Минимальное: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Среднее: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Максимальное: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{cols:[{id:"chart_holdtime_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"chart_holdtime",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Минимальное",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимальное",color:"#66CC33"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Минимальное: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Среднее: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Максимальное: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}}]}},e.prototype.loadReport=function(e){$$("interval_reports_table").enable(),$$("chart_total_calls").enable(),$$("chart_served_calls").enable(),$$("chart_unserved_calls").enable(),$$("chart_talktime").enable(),$$("chart_holdtime").enable(),$$("interval_reports_table").getFilter("calldate")&&($$("interval_reports_table").getFilter("calldate").value="",$$("interval_reports_table").getFilter("calls_total").value="",$$("interval_reports_table").getFilter("calls_served").value="",$$("interval_reports_table").getFilter("calls_unserved").value="",$$("interval_reports_table").getFilter("sum_talktime").value="",$$("interval_reports_table").getFilter("sum_holdtime").value="");var t=webix.guiutils.getDateRange("reportDateRange"),i="?filter[t1]="+t.start+"&filter[t2]="+t.end;$$("srcFilters").getValue()&&(i+="&filter[src]="+$$("srcFilters").getValue()),$$("filter_interval_reports").getValue()&&(i+="&filter[filter]="+$$("filter_interval_reports").getValue()),$$("interval_interval_reports").getValue()&&(i+="&filter[type]="+$$("interval_interval_reports").getValue()),$$("interval_reports_table").clearAll(),$$("interval_reports_table").load("/legacy/interval_reports_day"+i),1==$$("filter_interval_reports").getValue()?($$("chart_total_calls_l").show(),$$("chart_served_calls_l").show(),$$("chart_unserved_calls_l").show(),$$("chart_talktime_l").show(),$$("chart_holdtime_l").show()):2==$$("filter_interval_reports").getValue()?($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").show(),$$("chart_unserved_calls_l").hide(),$$("chart_talktime_l").show(),$$("chart_holdtime_l").show()):3==$$("filter_interval_reports").getValue()?($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").hide(),$$("chart_unserved_calls_l").show(),$$("chart_talktime_l").hide(),$$("chart_holdtime_l").show()):4==$$("filter_interval_reports").getValue()&&($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").hide(),$$("chart_unserved_calls_l").hide(),$$("chart_talktime_l").hide(),$$("chart_holdtime_l").hide()),$$("chart_total_calls").clearAll(),$$("chart_total_calls").load("/legacy/interval_reports_day_chart1"+i),$$("chart_served_calls").clearAll(),$$("chart_served_calls").load("/legacy/interval_reports_day_chart2"+i),$$("chart_unserved_calls").clearAll(),$$("chart_unserved_calls").load("/legacy/interval_reports_day_chart3"+i),$$("chart_talktime").clearAll(),$$("chart_talktime").load("/legacy/interval_reports_day_chart4"+i),$$("chart_holdtime").clearAll(),$$("chart_holdtime").load("/legacy/interval_reports_day_chart5"+i,function(){e&&e()})},e.prototype.getToolBar=function(){var e=this;return{id:e.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{id:"search_interval_reports",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){switch($$("filter_interval_reports").getValue()){case 1:e.filter_interval_reports_text="Входящие - все";break;case 2:e.filter_interval_reports_text="Входящие - обслуженные";break;case 3:e.filter_interval_reports_text="Входящие - необслуженные";break;case 4:e.filter_interval_reports_text="Исходящие";break;default:e.filter_interval_reports_text="Входящие - все"}switch($$("interval_interval_reports")){case 1:e.interval_interval_reports_text="По дням";break;case 2:e.interval_interval_reports_text="По дням недели";break;case 3:e.interval_interval_reports_text="По часам";break;case 4:e.interval_interval_reports_text="По месяцам"}webix.toExcel($$("interval_reports_table"),{filterHTML:!0,filename:"Входящие - "+e.interval_interval_reports_text+" - "+e.filter_interval_reports_text})}}]}},e.prototype.getToolTestBar=function(){return{type:"space",id:this.filterId,name:this.filterId,margin:0,padding:0,rows:[{id:"filter_interval_reports",view:"richselect",labelPosition:"top",label:"Тип звонков",labelWidth:100,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{id:"interval_interval_reports",view:"richselect",labelPosition:"top",label:"Тип звонков",labelWidth:100,options:[{id:1,value:"По дням"},{id:2,value:"По дням недели"},{id:3,value:"По часам"},{id:4,value:"По месяцам"}]}]}},e.prototype.resetFilters=function(){$$("interval_interval_reports").setValue(""),$$("filter_interval_reports").setValue(""),$$("srcFilters").setValue("")},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),$$("dstFilters").hide(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.extend($$("chart_total_calls"),webix.ProgressBar),webix.extend($$("interval_reports_table"),webix.ProgressBar),webix.extend($$("chart_served_calls"),webix.ProgressBar),webix.extend($$("chart_unserved_calls"),webix.ProgressBar),webix.extend($$("chart_talktime"),webix.ProgressBar),webix.extend($$("chart_holdtime"),webix.ProgressBar),webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="daily_report_toolbar",this.id="daily_report",this.filterId="daily_report_filter",this.additionOptionsWindowId="win_option_daily_report",webix.Manager.setComponent("daily_report",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getToolBar=function(){var e=this.getThis();return{id:e.toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{id:"search_daily_report",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadGreedData()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("daily_report_table"),{filterHTML:!0,filename:"По дням"})}}]}},e.prototype.loadGreedData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;$$("daily_report_table").enable();var t=webix.guiutils.getDateRange("reportDateRange"),i="/legacy/daily_report?filter[t1]="+t.start+"&filter[t2]="+t.end;""!=$$("srcFilters").getValue()&&(i+="&filter[src]="+$$("srcFilters").getValue()),""!=$$("dstFilters").getValue()&&(i+="&filter[dst]="+$$("srcFilters").getValue()),$$("daily_report_table").clearAll(),$$("daily_report_table").showProgress({type:"icon",hide:!0}),$$("daily_report_table").load(i,function(){e&&e()})},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getView=function(){return{id:"daily_report",hidden:!0,type:"clean",rows:[{id:"daily_report_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:25},{content:"textFilter"}],sort:"string",width:180,template:"#calldate2#",footer:{text:"Всего:",height:30}},{id:"1",header:["Длительность",{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:["Звонки",{content:"textFilter"}],sort:"int",width:155,template:"#share#",footer:{content:"summColumn"}},{id:"3",header:["ACD, мин",{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %",{content:"textFilter"}],sort:"string",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:["PDD, сек",{content:"textFilter"}],sort:"string",width:140,footer:{content:"avaregeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),$$("dstFilters").show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadGreedData()}),webix.AppFilter.setReset(function(){e.resetFilters()}),$$("daily_report_table")&&(webix.extend($$("daily_report_table"),webix.ProgressBar),this.loaded||this.loadGreedData(function(){e.loaded=1}))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="month_traffic_toolbar",this.filterId="month_traffic_filter",this.id="month_traffic",this.additionOptionsWindowId="win_option_month_traffic",webix.Manager.setComponent("month_traffic",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getView=function(){return{id:"month_traffic",hidden:!0,type:"clean",rows:[{id:"month_traffic_layout",rows:[{id:"month_traffic_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",columns:[{id:"10",header:[{text:"Месяц",height:25},{content:"selectFilter"}],sort:"string",width:180,template:"#month#",footer:{text:"Всего:",height:30}},{id:"1",header:["Длительность",{content:"textFilter"}],sort:"int",template:"#time#",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:["Звонки",{content:"textFilter"}],sort:"int",width:155,template:function(e){return e&&e.share?e.share:e[1]},footer:{content:"summColumn"}},{id:"3",header:["ACD, мин",{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %",{content:"textFilter"}],sort:"int",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:["PDD, сек",{content:"textFilter"}],sort:"int",width:140,footer:{content:"avaregeColumn"}}],disabled:!0,ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{id:"month_traffic_chart",view:"chart",type:"pie3D",value:"#sales#",color:"#color#",tooltip:{template:"#month#"},pieInnerText:"",shadow:0,disabled:!0,legend:{layout:"y",width:250,align:"right",valign:"middle",template:"<div style='color:#111;font-weight:bold;'>#month#</div>"},ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadReport=function(e){$$("month_traffic_table").enable(),$$("month_traffic_chart").enable();var t="";""!=$$("startDate_month_traffic").getValue()&&(t&&(t+="&"),t+="&filter[t1]="+$$("startDate_month_traffic").getValue()),""!=$$("finishDate_month_traffic").getValue()&&(t&&(t+="&"),t+="filter[t2]="+$$("finishDate_month_traffic").getValue()),""!=$$("srcFilters").getValue()&&(t&&(t+="&"),t+="filter[src]="+$$("srcFilters").getValue()),""!=$$("dstFilters").getValue()&&(t&&(t+="&"),t+="filter[dst]="+$$("dstFilters").getValue()),$$("month_traffic_table").clearAll(),webix.extend($$("month_traffic_table"),webix.ProgressBar),$$("month_traffic_table").showProgress(),$$("month_traffic_table").load("/legacy/month_traffic?"+t),$$("month_traffic_chart").clearAll(),$$("month_traffic_chart").load("/legacy/month_traffic_chart?"+t,function(){e&&e()}),$$("month_traffic_chart").refresh()},e.prototype.resetFilters=function(){$$("startDate_month_traffic").setValue(""),$$("finishDate_month_traffic").setValue(""),webix.AppFilter.resetDefaultTraffic()},e.prototype.getToolTestBar=function(){return{id:this.filterId,rows:[{id:"startDate_month_traffic",view:"richselect",label:"Период от",labelPosition:"top",labelWidth:100,options:"/legacy/month_traffic_period"},{id:"finishDate_month_traffic",view:"richselect",label:"Месяцев",labelPosition:"top",labelWidth:100,options:[{id:1,value:"-1 месяц"},{id:2,value:"-2 месяца"},{id:3,value:"-3 месяца"},{id:4,value:"-4 месяца"},{id:5,value:"-5 месяцев"},{id:6,value:"-6 месяцев"}]}]}},e.prototype.getToolBar=function(){var e=this;return{id:e.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{id:"search_month_traffic",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("month_traffic_table"),{filterHTML:!0,filename:"По месяцам"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="hourly_traffic_toolbar",this.id="hourly_load",this.filterId="hourly_traffic_filter",this.additionOptionsWindowId="win_option_hourly_load",webix.Manager.setComponent("hourly_load",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getView=function(){return{id:"hourly_load",hidden:!0,type:"clean",rows:[{id:"hourly_load_layout",rows:[{id:"hourly_load_table",view:"datatable",resizeColumn:!0,resizeRow:!0,height:85,navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:30}],width:180,format:webix.Date.dateToStr("%d.%m.%Y")},{id:"1",header:[{text:"Длительность"}],width:130},{id:"2",header:[{text:"Звонки"}],template:"#share#",width:155},{id:"3",header:[{text:"ACD, мин"}],width:155},{id:"4",header:["ASR, %"],width:120},{id:"5",header:[{text:"PDD, сек"}],width:140}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{borderless:!0,cols:[{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонков в час</center>"}],height:30},{id:"hourly_load_chart",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>ASR% по часам</center>"}],height:30},{id:"hourly_load_chart_asr",view:"chart",type:"line",value:"#sales#",item:{borderColor:"#ffffff",color:"#000000"},line:{color:"#ff9900",width:3},label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,end:100,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}]}},e.prototype.getToolTestBar=function(){return{id:this.filterId,rows:[{id:"startDate_hourly_load",view:"datepicker",label:"Период от",labelPosition:"top",labelWidth:100,timepicker:!1,format:"%Y-%m-%d",value:new Date}]}},e.prototype.resetFilters=function(){$$("startDate_hourly_load").setValue(new Date),webix.AppFilter.resetDefaultTraffic()},e.prototype.getToolBar=function(){var e=this;return{id:"hourly_traffic_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{id:"search_hourly_load",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("hourly_load_table"),{filterHTML:!0,filename:"По часам"})}}]}},e.prototype.loadReport=function(e){$$("hourly_load_table").enable(),$$("hourly_load_chart").enable(),$$("hourly_load_chart_asr").enable();var t="/legacy/hourly_load",i="";if(""!=$$("startDate_hourly_load").getValue()){var o=new Date($$("startDate_hourly_load").getValue()),r=o.getDate(),n=o.getMonth()+1;i+="?filter[t1]="+o.getFullYear()+"-"+n+"-"+r}""!=$$("srcFilters").getValue()&&(i.length?i+="&":i+="?",i+="filter[src]="+$$("srcFilters").getValue()),""!=$$("dstFilters").getValue()&&(i.length?i+="&":i+="?",i+="filter[dst]="+$$("dstFilters").getValue());var a=webix.ajax(t+i,function(e){return e});$$("hourly_load_table").clearAll(),$$("hourly_load_table").showProgress({type:"icon",hide:!0}),$$("hourly_load_table").parse(a),$$("hourly_load_chart").clearAll(),$$("hourly_load_chart").load(t+"_chart1"+i),$$("hourly_load_chart").refresh(),$$("hourly_load_chart_asr").clearAll(),$$("hourly_load_chart_asr").load(t+"_chart2"+i,function(){e&&e()}),$$("hourly_load_chart_asr").refresh()},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.extend($$("hourly_load_table"),webix.ProgressBar),webix.extend($$("hourly_load_chart"),webix.ProgressBar),webix.extend($$("hourly_load_chart_asr"),webix.ProgressBar),this.loadReport(function(){e.loaded=1}))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.toolBarId="compare_calls_toolbar",this.id="compare_calls",this.filterId="compare_calls_filter",this.loaded=0,this.oneDays=1,this.twoDays=2,this.threDays=3,this.forDays=4,this.fiveDays=5,webix.Manager.setComponent("compare_calls",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.loadGreedData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=this.getThis();$$("compare_calls_table").enable();var i="";""!=$$("startDate_compare_calls").getValue()&&(i+="?filter[t1]="+t.getDateForCompare()),""!=$$("finishDate_compare_calls").getValue()&&(i+="&filter[t2]="+$$("finishDate_compare_calls").getValue()),""!=$$("srcFilters").getValue()&&(i+="&filter[src]="+$$("srcFilters").getValue()),""!=$$("dstFilters").getValue()&&(i+="&filter[dst]="+$$("dstFilters").getValue()),webix.extend($$("compare_calls_table"),webix.ProgressBar),$$("compare_calls_table").showProgress();var o=webix.ajax("/legacy/compare_calls"+i,function(e){return $$("compare_calls_table").hideProgress(),e});$$("compare_calls_table").clearAll(),$$("compare_calls_table").parse(o),$$("compare_calls_chart").clearAll(),$$("compare_calls_chart").load("/legacy/compare_calls_chart"+i,function(){e&&e()}),$$("compare_calls_chart").define({legend:{values:t.getLegendValues($$("finishDate_compare_calls").getValue()),align:"right",valign:"middle",layout:"y",width:100,margin:8}}),$$("compare_calls_chart").refresh()},e.prototype.getToolTestBar=function(){return{id:this.filterId,rows:[{id:"startDate_compare_calls",view:"datepicker",label:"Период от",labelPosition:"top",labelWidth:100,timepicker:!1,format:"%Y-%m-%d",value:new Date},{id:"finishDate_compare_calls",view:"richselect",label:"Диапазон",labelPosition:"top",labelWidth:100,value:1,options:[{id:this.oneDay,value:"-1 день"},{id:this.twoDays,value:"-2 дня"},{id:this.threDays,value:"-3 дня"},{id:this.forDays,value:"-4 дня"},{id:this.fiveDays,value:"-5 дней"}]}]}},e.prototype.resetFilters=function(){$$("startDate_compare_calls").setValue(new Date),$$("finishDate_compare_calls").setValue(""),webix.AppFilter.resetDefaultTraffic()},e.prototype.getToolBar=function(){var e=this.getThis();return{id:this.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{id:"search_compare_calls",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadGreedData()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("compare_calls_table"),{filterHTML:!0,filename:"Сравнить"})}}]}},e.prototype.getLegendValues=function(e){var t=[];switch(e){case this.oneDays:t=[{text:webix.guiutils.sqlDate(this.getDateForCompare()),color:"#1293f8"}];break;case this.twoDays:t=[{text:webix.guiutils.sqlDate(this.getDateForCompare(this.twoDays)),color:"#1293f8"},{text:webix.guiutils.sqlDate(this.getDateForCompare()),color:"#66cc00"}];break;case this.threDays:t=[{text:webix.guiutils.sqlDate(this.getDateForCompare(this.threDays)),color:"#1293f8"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.twoDays)),color:"#66cc00"},{text:webix.guiutils.sqlDate(this.getDateForCompare()),color:"#FF6633"}];break;case this.forDays:t=[{text:webix.guiutils.sqlDate(this.getDateForCompare(this.forDays)),color:"#1293f8"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.threDays)),color:"#66cc00"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.twoDays)),color:"#FF6633"},{text:webix.guiutils.sqlDate(this.getDateForCompare()),color:"#CC0033"}];break;case this.fiveDays:t=[{text:webix.guiutils.sqlDate(this.getDateForCompare(this.fiveDays)),color:"#1293f8"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.forDays)),color:"#66cc00"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.threDays)),color:"#FF6633"},{text:webix.guiutils.sqlDate(this.getDateForCompare(this.twoDays)),color:"#CC0033"},{text:webix.guiutils.sqlDate(this.getDateForCompare()),color:"#009933"}]}return t},e.prototype.getDateForCompare=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Date($$("startDate_compare_calls").getValue()-86400*e)},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").hide(),this.showToolBar()},e.prototype.getView=function(){return{id:"compare_calls",hidden:!0,type:"clean",rows:[{id:"compare_calls_layout",rows:[{id:"compare_calls_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,height:250,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:30}],sort:"string",width:180,footer:{text:"Всего:",height:30},format:webix.Date.dateToStr("%d.%m.%Y")},{id:"1",header:[{text:"Длительность"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:[{text:"Звонки"}],sort:"string",width:155,template:"#share#",footer:{content:"summColumn"}},{id:"3",header:[{text:"ACD, мин"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %"],sort:"int",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:[{text:"PDD, сек"}],sort:"int",fillspace:1,footer:{content:"avaregeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонков в час</center>"}],height:30},{id:"compare_calls_chart",view:"chart",type:"line",xAxis:{template:"#hour#"},yAxis:{start:0,step:10},legend:{values:[{text:webix.guiutils.sqlDate(new Date),color:"#1293f8"}],align:"right",valign:"middle",layout:"y",width:100,margin:8},series:[{value:"#sales1#",item:{borderColor:"#1293f8",color:"#ffffff"},line:{color:"#1293f8",width:3},tooltip:{template:"Звонки: #sales1# <br>Дата: #day1#"}},{value:"#sales2#",item:{borderColor:"#66cc00",color:"#ffffff"},line:{color:"#66cc00",width:3},tooltip:{template:"Звонки: #sales2# <br>Дата: #day2#"}},{value:"#sales3#",item:{borderColor:"#996600",color:"#ffffff"},line:{color:"#996600",width:3},tooltip:{template:"Звонки: #sales3# <br>Дата: #day3#"}},{value:"#sales4#",item:{borderColor:"#CC0033",color:"#ffffff"},line:{color:"#CC0033",width:3},tooltip:{template:"Звонки: #sales4# <br>Дата: #day4#"}},{value:"#sales5#",item:{borderColor:"#009933",color:"#ffffff"},line:{color:"#009933",width:3},tooltip:{template:"Звонки: #sales5# <br>Дата: #day5#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(function(){e.loadGreedData()}),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.extend($$("compare_calls_table"),webix.ProgressBar),webix.extend($$("compare_calls_chart"),webix.ProgressBar),webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("ext_incoming_external",this),this.toolBarId="ext_incoming_external_toolbar",this.filterId="ext_incoming_external_filter",this.id="ext_incoming_external"}return e.prototype.getThis=function(){return this},e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.loadReport=function(){var e=webix.guiutils.getDateRange("reportDateRange"),t="legacy/ext_incoming_external_total?filter[t1]="+e.start+"&filter[t2]="+e.end;$$("ext_incoming_external_table").clearAll(),$$("ext_incoming_external_table").load(t)},e.prototype.getToolBar=function(){var e=this;return{id:this.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{id:"search_ext_incoming_external",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){e.loadReport()}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getGrid=function(){return{id:"ext_incoming_external",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_incoming_external_table",view:"datatable",subview:{view:"datatable",columns:[{id:"agent_name",header:[{text:"Оператор"}],sort:"string",width:309},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"rcr",header:[{text:"% повторных"}],width:160},{id:"fcr",header:[{text:"FCR"}],width:160},{id:"transfer",header:[{text:"Переводов"}],width:160},{id:"cost",header:[{text:"Себестоимость"}],width:160},{id:"ready",header:[{text:"Готов"}],width:160},{id:"notready",header:[{text:"Не готов"}],width:160}],data:[],height:300,resizeColumn:!0,resizeRow:!0,select:!0},resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"queue_name",header:[{text:"Линия"}],template:"{common.subrow()} #queue_name#",sort:"string",width:160},{id:"agents",header:[{text:"Операторов"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"rcr",header:[{text:"% повторных"}],width:160},{id:"fcr",header:[{text:"FCR"}],width:160},{id:"transfer",header:[{text:"Переводов"}],width:160},{id:"nwh",header:[{text:"Не рабочее время"}],width:160},{id:"cost",header:[{text:"Себестоимость"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)},on:{onSubViewCreate:function(e,t){var i=webix.guiutils.getDateRange("reportDateRange");e.load("legacy/ext_incoming_external_personal?filter[t1]="+i.start+"&filter[t2]="+i.end+"&filter[queue]="+t.queue)}}}]}]}},e.prototype.getView=function(){return this.getGrid()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),this.loaded||$$("ext_incoming_external_table")&&(webix.extend($$("ext_incoming_external_table"),webix.ProgressBar),webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("ext_incoming_internal",this),this.toolBarId="ext_incoming_internal_toolbar",this.filterId="ext_incoming_internal_filter",this.id="ext_incoming_internal"}return e.prototype.getThis=function(){return this},e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getUrl=function(){var e=webix.guiutils.getDateRange("reportDateRange");if($$("ext_incoming_internal_talbe").isVisible())var t=$$("ext_incoming_internal_talbe").getFilter("number").value,i=$$("ext_incoming_internal_talbe").getFilter("user_name").value;else var t="",i="";var o="/legacy/ext_incoming_internal?filter[t1]="+e.start+"&filter[t2]="+e.end;return i.length&&(o+="&filter[user_name]="+i),t.length&&(o+="&filter[number]="+t),o},e.prototype.loadReport=function(){$$("ext_incoming_internal_talbe").clearAll(),$$("ext_incoming_internal_talbe").load(this.getUrl())},e.prototype.getToolBar=function(){var e=this;return{css:"top-menu-right-item",id:"ext_incoming_internal_toolbar",hidden:!0,cols:[{id:"search_ext_incoming_internal",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",on:{onItemClick:function(){e.loadReport()}}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getGrid=function(){return{id:"ext_incoming_internal",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_incoming_internal_talbe",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"number",header:[{text:"Вн. номер"},{content:"serverFilter"}],width:160},{id:"user_name",header:[{text:"Сотрудник"},{content:"serverFilter"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.getView=function(){return this.getGrid()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),$$("ext_incoming_internal_talbe")&&(webix.extend($$("ext_incoming_internal_talbe"),webix.ProgressBar),webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("ext_outgoing",this),this.toolBarId="ext_outgoing_toolbar",this.id="ext_outgoing",this.filterId="ext_outgoing_filter"}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.loadReport=function(){var e=webix.guiutils.getDateRange("reportDateRange");if($$("ext_outgoing_table").isVisible())var t=$$("ext_outgoing_table").getFilter("number").value,i=$$("ext_outgoing_table").getFilter("user_name").value;else var t="",i="";var o="/legacy/ext_outgoing?filter[t1]="+e.start+"&filter[t2]="+e.end;i.length&&(o+="&filter[user_name]="+i),t.length&&(o+="&filter[number]="+t),$$("ext_outgoing_table").clearAll(),$$("ext_outgoing_table").load(o)},e.prototype.getToolBar=function(){var e=this;return{id:this.toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{id:"search_ext_outgoing",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",on:{onItemClick:function(){e.loadReport()}}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getGrid=function(){return{id:"ext_outgoing",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_outgoing_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"number",header:[{text:"Вн. номер"},{content:"serverFilter"}],width:160},{id:"user_name",header:[{text:"Сотрудник"},{content:"serverFilter"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Отвеченных"}],width:160},{id:"unserved",header:[{text:"Не отвеченных"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.getView=function(){return this.getGrid()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),$$("ext_outgoing_table")&&(webix.extend($$("ext_outgoing_table"),webix.ProgressBar),this.loaded||(webix.AppFilter.submit(),this.loaded=1))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="checklist_toolbar",this.filterId="checklist_filter",this.id="checklist",this.greeId="ext_checklist_table",webix.Manager.setComponent("checklist",this)}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.folderStyling=function(e){if(e.block){if(1==e.$level)return"<span class='webix_icon fa-angle-double-right'></span>";if(2==e.$level)return"<span class='webix_icon fa-question'></span>"}else{if(1==e.$level)return"<span class='webix_icon fa fa-calendar'></span>";if(2==e.$level)return"<span class='webix_icon fa fa-star'></span>";if(3==e.$level)return"<span class='webix_icon fa fa-adjust'></span>";if(4==e.$level)return"<span class='webix_icon fa fa-stopwatch'></span>";if(5==e.$level)return""}},e.prototype.getGreed=function(){return{id:"ext_checklist_table",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,type:{folder:this.folderStyling},columns:[{id:"value",header:[{text:""}],template:"{common.treetable()} #value#",width:300},{id:"total",header:[{text:"Итоговый балл"}],width:200},{id:"percent",header:[{text:"Процент"}],width:300}],on:{onItemDblClick:function(e,t,i){var o=$$("ext_checklist_table").getItem(e);4==o.$level&&webix.guiutils.checklistFillWindow(o.user_id,o.date,o.checklist_id)},onAfterLoad:function(e){}}}},e.prototype.getView=function(){return{id:"checklist",hidden:!0,type:"clean",rows:[{rows:[this.getGreed()]}]}},e.prototype.addGroup=function(e){webix.ui({view:"window",height:200,width:300,modal:!0,position:"center",head:e?"Добавление блока":"Добавление группы",body:{view:"form",elements:[{view:"text",name:"name",label:"Название",value:""},{cols:[{view:"button",label:"Добавить",click:function(){var t=this.getFormView().elements.name.getValue(),i={addgroup:t,parent_id:e};this.getFormView().getParentView().close(),webix.ajax().post("/legacy/ext/checklist/addgroup",i,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при добавлении."})},success:function(t,i,o){if(webix.message({type:"success",text:"Операция добавления успешно завершена."}),e){$$("questions_list").clearAll();var r=$$("questions_checklist_block");r.getList().clearAll(),r.getList().load("/legacy/ext/checklists/groups/"+e),r.setValue(i.json().id)}else{$$("questions_list").clearAll();var r=$$("questions_checklist_block");r.getList().clearAll(),r.setValue(0),r=$$("questions_checklist"),r.getList().clearAll(),r.getList().load("/legacy/ext/checklists/groups/"),r.setValue(i.json().id)}}})}},{view:"button",label:"Отмена",click:function(){this.getFormView().getParentView().close()}}]}]}}).show()},e.prototype.removeGroup=function(e){webix.ui({view:"window",height:200,width:300,modal:!0,position:"center",head:"Удалить выбранную группу вопросов?",body:{view:"form",elements:[{cols:[{view:"button",label:"Удалить",click:function(){var t={deletegroup:e};this.getFormView().getParentView().close(),webix.ajax().post("/legacy/ext/checklist/deletegroup",t,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при удалении."})},success:function(e,t,i){webix.message({type:"success",text:"Операция удаления успешно завершена."});var o=$$("questions_checklist_block");o.getList().clearAll(),o.setValue(0),o=$$("questions_checklist"),o.getList().clearAll(),o.getList().load("/legacy/ext/checklists/groups/"),o.setValue(0),$$("questions_checklist_save").disable(),$$("row_questions_checklist_block").hide()}})}},{view:"button",label:"Отмена",click:function(){this.getFormView().getParentView().close()}}]}]}}).show()},e.prototype.checklistEditWindow=function(){var e=this.getThis();webix.ui({id:"checklist_setup_win",view:"window",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Список вопросов чеклиста"},{view:"icon",icon:"wxi-close",click:"$$('checklist_setup_win').close();"}]},resize:!0,width:600,height:500,center:!0,position:"center",modal:!0,move:!0,body:{rows:[{cols:[{view:"richselect",id:"questions_checklist",label:"Группа",labelWidth:100,labelAlign:"right",options:"/legacy/ext/checklists/groups/",on:{onChange:function(e,t){$$("questions_list").clearAll();var i=$$("questions_checklist_block");i.getList().clearAll(),i.setValue(0),e&&(i.getList().load("/legacy/ext/checklists/groups/"+e),$$("row_questions_checklist_block").show())}}},{id:"questions_checklist_add",view:"button",type:"icon",icon:"wxi-plus",width:36,click:function(){e.addGroup(0)}},{id:"questions_checklist_delete",view:"button",type:"icon",icon:"wxi-minus",width:36,click:function(){e.removeGroup($$("questions_checklist").getValue())}}]},{id:"row_questions_checklist_block",hidden:!0,cols:[{view:"richselect",id:"questions_checklist_block",label:"Блок",labelWidth:100,labelAlign:"right",options:[],value:1,on:{onChange:function(e,t){$$("questions_list").clearAll(),e&&($$("questions_list").load("/legacy/ext/checklist/list/"+e),$$("questions_checklist_save").enable())}}},{id:"questions_checklist_block_add",view:"button",type:"icon",icon:"wxi-plus",width:36,click:function(){e.addGroup($$("questions_checklist").getValue())}},{id:"questions_checklist_block_delete",view:"button",type:"icon",icon:"wxi-minus",width:36,click:function(){e.removeGroup($$("questions_checklist_block").getValue())}}]},{view:"treetable",id:"questions_list",autowidth:!0,editable:!0,columns:[{id:"question",header:"Вопрос",width:450,editor:"text"}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{view:"button",id:"questions_checklist_save",disabled:!1,label:"Сохранить",click:function(){var e=$$("questions_checklist_block").getValue();if(e){var t=[];$$("questions_list").editStop(),$$("questions_list").data.each&&$$("questions_list").data.each(function(e){t.push(e)});var i=JSON.stringify(t);webix.ajax().post("/legacy/ext/checklist/questions/save/"+e,i,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при сохранении."})},success:function(e,t,i){webix.message({type:"success",text:"Операция сохранения успешно завершена."})}})}}},{view:"button",label:"Закрыть окно",click:"$$('checklist_setup_win').close();"}]}]}}).show()},e.prototype.reloadData=function(){$$("ext_checklist_table").clearAll();var e=webix.guiutils.getDateRange("reportDateRange");webix.extend($$("ext_checklist_table"),webix.ProgressBar),$$("ext_checklist_table").showProgress(),$$("ext_checklist_table").load("/legacy/ext/checklist/tree?start="+e.start+"&finish="+e.end)},e.prototype.getToolBar=function(){var e=this,t=this.getThis();return{id:"checklist_toolbar",hidden:!0,css:"top-menu-right-item",cols:[{id:"checklist_questions_fill",view:"button",type:"icon",icon:"fa fa-comments",width:155,label:"Заполнить",click:function(){webix.guiutils.checklistFillWindow(0,0,0)}},{id:"checklist_reload",view:"button",type:"icon",icon:"wxi-search",width:155,label:"Поиск",click:function(){e.reloadData()}},{view:"button",type:"icon",icon:"wxi-file",width:185,label:"Поиск и развернуть",click:function(){$$("ext_checklist_table").clearAll();var e=webix.guiutils.getDateRange("reportDateRange");webix.extend($$("ext_checklist_table"),webix.ProgressBar),$$("ext_checklist_table").showProgress(),$$("ext_checklist_table").load("/legacy/ext/checklist/tree?start="+e.start+"&finish="+e.end+"&open=1")}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("ext_checklist_table"))}},{id:"checklist_questions_list",view:"button",type:"icon",icon:"fa fa-question",width:50,click:function(){t.checklistEditWindow()}}]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.reloadData()}),webix.AppFilter.setReset(function(){}),$$("ext_checklist_table")&&(this.loaded||(webix.AppFilter.submit(),this.loaded=1))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("dashboard",this),this.npsTooltip="<strong>#name#:</strong><table><tr><td>Промоутеры: &nbsp;</td><td>#promouters#%</td></tr><tr><td>Нейтралы:</td><td>#neutrals#%</td></tr><tr><td>Детракторы:</td><td>#detractors#%</td></tr><tr><td>NPS:</td><td>#nps#%</td></tr><tr><td>Клиентов:</td><td>#allClients#</td></tr></table>",this.toolBarId="dashboard_toolbar",this.filterId="dashboard_filter",this.id="dashboard"}return e.prototype.roleAllowed=function(){return["phc.nps","erpico.admin"]},e.prototype.getByCity=function(){return{id:"nps/dashboard",view:"panel",x:0,y:0,dx:1,dy:1,header:"NPS по городам",body:{view:"chart",id:"countListByCities",minWidth:500,minHeight:500,type:"stackedBar",barWidth:30,radius:2,padding:{bottom:110},css:"nps_chart nps_chart_cities",legend:{values:[{text:"Детракторы",color:"#d81b1b"},{text:"Нейтралы",color:"#d4dbd3"},{text:"Промоутеры",color:"#27ae60"},{text:"NPS",color:"#ff9900"}],valign:"middle",align:"center",width:400,height:30,layout:"x"},xAxis:{template:"#name#",width:100},yAxis:{start:0,step:25,end:100,lines:!0},series:[{value:"#detractors#",color:"#d81b1b",tooltip:{template:this.npsTooltip}},{value:"#neutrals#",color:"#d4dbd3",tooltip:{template:this.npsTooltip}},{value:"#promouters#",color:"#27ae60",tooltip:{template:this.npsTooltip}},{type:"line",value:"#nps#",color:"#ff9900",label:"#nps#%(#numberNps#)",item:{borderColor:"#ff9900",color:"#ff9900",type:"s",radius:6,borderWidth:1,shadow:!0},line:{color:"#ff9900",width:3},tooltip:{template:this.npsTooltip}}],ready:function(){webix.extend(this,webix.ProgressBar),webix.guiutils.getNpsFilter()}}}},e.prototype.getByFilials=function(){return{id:"dashboardNps",view:"panel",x:0,y:0,dx:1,dy:1,header:"NPS по филиалам",body:{view:"chart",id:"countList",minWidth:500,minHeight:500,type:"stackedBar",barWidth:30,radius:2,padding:{bottom:110},css:"nps_chart nps_chart_filials",legend:{values:[{text:"Детракторы",color:"#d81b1b"},{text:"Нейтралы",color:"#d4dbd3"},{text:"Промоутеры",color:"#27ae60"},{text:"NPS",color:"orange"}],valign:"middle",align:"center",width:400,height:30,layout:"x"},xAxis:{template:function(e){if(!e)return"";if(!e.name)return"";if(e.name.toString().length>10){var t=e.name.substring(0,7);return t+="..",t+=e.name.substring(e.name.length-2)}return e.name},width:200},yAxis:{start:0,step:25,end:100,lines:!0},series:[{value:"#detractors#",color:"#d81b1b",tooltip:{template:this.npsTooltip}},{value:"#neutrals#",color:"#d4dbd3",tooltip:{template:this.npsTooltip}},{value:"#promouters#",color:"#27ae60",tooltip:{template:this.npsTooltip}},{type:"line",value:"#nps#",color:"#ff9900",label:"#nps#%(#numberNps#)",item:{borderColor:"#ff9900",color:"#ff9900",type:"s",radius:6,borderWidth:1,shadow:!0},line:{color:"#ff9900",width:3},tooltip:{template:this.npsTooltip}}]}}},e.prototype.getDetractors=function(){return{view:"chart",id:"detractorsList",type:"barH",height:450,css:"flip-horizontal-chart chart-detractor",value:"#sales#",tooltip:{template:"#comments#"},label:"<strong>#label#</strong> <span class='chart-number'>#sales#%</span>",barWidth:35,padding:{top:30,left:0,right:10,bottom:20},color:"#d81b1b",legend:{values:[{text:"Детракторы",color:"#d81b1b"}],valign:"middle",align:"center",height:22,layout:"x"},xAxis:{start:0,step:25,end:100,lines:!1}}},e.prototype.getPromoters=function(){return{view:"chart",id:"promotersList",type:"barH",css:"no-flip-horizontal-chart chart-promouter",value:"#sales#",tooltip:{template:"#comments#"},InnerText:"#sales#",label:" <span class='chart-number'>#sales#%</span> <strong>#label#</strong>",barWidth:35,padding:{top:30,left:0,right:10,bottom:20},color:"#27ae60",legend:{values:[{text:"Промоутеры",color:"#27ae60"}],valign:"middle",align:"center",height:22,layout:"x"},xAxis:{start:0,step:25,end:100,lines:!1}}},e.prototype.getDash=function(){return{rows:[this.getByCity(),this.getByFilials()]}},e.prototype.getDetractorsAndPromotersData=function(){return{cols:[this.getDetractors(),this.getPromoters()]}},e.prototype.getView=function(){return{view:"scrollview",id:"dashboard",hidden:!0,body:{rows:[this.getDash(),this.getDetractorsAndPromotersData()]}}},e.prototype.resetFilters=function(){$$("cityFilter").setValue(""),$$("filialFilter").setValue(""),$$("channel").setValue("")},e.prototype.getToolTestBar=function(){return{id:this.filterId,rows:[{view:"multiselect",label:"Город",id:"cityFilter",labelWidth:100,on:{onChange:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/city"},{view:"multiselect",label:"Филиал",id:"filialFilter",labelWidth:100,on:{onChange:function(){webix.guiutils.getNpsFilter()},onAfterRender:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/filial"},{labelWidth:100,view:"multiselect",label:"Канал",id:"channel",on:{onChange:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/channel"}]}},e.prototype.getToolBar=function(){return{id:this.toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{css:"disable_margin_btn_tbar",width:56,view:"button",type:"icon",icon:"wxi-sync",click:function(){webix.guiutils.getNpsFilter()}},{view:"button",type:"icon",icon:"fa fa-file-excel",label:"Export to PDF",width:200,click:function(){webix.guiutils.getPdfChart("charts")}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),$$("reportDateRange").show(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,this.getToolTestBar()),webix.AppFilter.setSubmit(function(){webix.guiutils.getNpsFilter()}),webix.AppFilter.setReset(function(){e.resetFilters()}),this.loaded||(webix.guiutils.getNpsFilter(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("reports",this),this.id="reports",this.filterId="reports_filter",this.toolBarId="reports_toolbar"}return e.prototype.roleAllowed=function(){return["phc.nps","erpico.admin"]},e.prototype.getView=function(){return webix.protoUI({name:"my_suggest",$init:function(e){var t=e.body.rows.length;t>1&&(e.body.rows[t]={view:"select",label:"От",id:"markFrom",options:["","0","1","2","3","4","5","6","7","8","9","10"]},e.body.rows[t+1]={view:"select",label:"До",id:"markTo",options:["","0","1","2","3","4","5","6","7","8","9","10"]},e.body.rows[t+2]={view:"button",label:"Применить",click:function(){$$("reports");$$("reports").filterByAll()}})}},webix.ui.checksuggest),webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,i){t.firstChild.innerHTML="Итого:  "+e.count()||"0"}},webix.ui.datafilter.summColumn),{id:"reports",hidden:!0,view:"datatable",select:!0,css:"my_style",tooltip:!0,footer:!0,resizeColumn:!0,columns:[{id:"id",header:[{text:translate("ID")},{content:"serverFilter"}],sort:"int",width:40,footer:{content:"rowCount",colspan:2}},{id:"city",header:[{text:translate("Город")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/city"}],sort:"int",width:150,footer:{content:"rowCount",colspan:1}},{id:"filial",header:[{text:translate("Филиал")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/filial"}],sort:"int",width:150},{id:"channel",header:[{text:translate("Канал")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/channel"}],sort:"int",width:150},{id:"name",header:[{text:translate("ФИО клиента")},{content:"serverFilter"}],sort:"int",width:150},{id:"lastbuy_date",header:[{text:translate("Дата последней покупки ")},""],width:220},{id:"buyer_status",header:[{text:translate("Статус покупателя")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"}},options:[{id:"Первичный"},{id:"Повторный"}]}],width:180},{id:"motivational_p",header:[{text:translate("Мотивационная программа")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/motivational_p"}],sort:"int",width:180},{id:"recomendations_mark",header:[{text:translate("Шкала рекомендаций")},{content:"multiSelectFilter",suggest:{view:"my_suggest",fitMaster:!1,width:200}}],sort:"int",width:180},{id:"reason_plus",header:[{text:translate("Причина положительной оценки")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/reasonPlus"}],sort:"int",width:250},{id:"reason_minus",header:[{text:translate("Причина отрицательной оценки")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:"legacy/nps/options/reasonPlus"}],sort:"int",width:250},{id:"recomendations",header:[{text:translate("Рекомендации по улучшению")},{content:"multiSelectFilter",suggest:{fitMaster:!1,body:{tooltip:function(e){return e.id},template:"#id#"},tooltip:!0},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}},options:"legacy/nps/options/recomendations"}],width:250,sort:"int"}],on:{onBeforeContextMenu:function(e){this.select(e)}},ready:function(){$$("reports").registerFilter($$("reportDateRange"),{columnId:"date"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),$$("reports").registerFilter($$("markFrom"),{columnId:"markFrom"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),$$("reports").registerFilter($$("markTo"),{columnId:"markTo"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),webix.extend(this,webix.ProgressBar),webix.ui({view:"contextmenu",submenu:"data",width:300,data:[{value:"Анкета",id:"open"}],on:{onMenuItemClick:function(e){if("open"===this.getMenuItem(e).id){var t=$$("reports")?$$("reports").getSelectedItem():0;t?window.open(window.location.origin+"/#!/main/script?id=10&nps="+t.id,"_blank"):webix.message({type:"error",text:"Произошла ошибка"})}}}}).attachTo(this)}}},e.prototype.loadReport=function(){$$("reports").clearAll(),webix.extend($$("reports"),webix.ProgressBar),$$("reports").showProgress(),$$("reports").load("legacy/nps/report"),$$("reports").filterByAll()},e.prototype.getToolBar=function(){var e=this;return{id:"reports_toolbar",hidden:!0,css:"top-menu-right-item",cols:[{css:"disable_margin_btn_tbar",width:56,view:"button",type:"icon",icon:"wxi-sync",click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",label:"Export to PDF",width:200,click:function(){var e=$$("reportDateRange").getValue();if(e.start)var t=webix.Date.dateToStr("%d.%m.%Y")(new Date(e.start));else if(e.end)var t=webix.Date.dateToStr("%d.%m%Y")(new Date(e.end));if(e.end)var i=webix.Date.dateToStr("%d.%m%Y")(new Date(e.end));else var i=t;webix.toExcel($$("reports"),{filename:"NPS_Report_"+t+"-"+i,name:"NPS_Report_"+t+"-"+i})}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.show(),webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){}),this.loaded||(webix.AppFilter.submit(),this.loaded=1)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,this.id="clients",this.contextMenuId="clientsContext",this.toolBarId="clients_toolbar",webix.Manager.setComponent("clients",this)}return e.prototype.roleAllowed=function(){return["phc.nps","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getGreed=function(){var e=this.getThis();return{id:this.id,hidden:!0,view:"datatable",select:!0,css:"my_style",tooltip:!0,scrollY:!0,scrollX:!0,scrollAlignY:!0,footer:!0,resizeColumn:!0,columns:[{id:"id",header:[{text:translate("ID")},{content:"serverFilter"}],width:40,footer:{content:"rowCount",colspan:2}},{id:"created",header:[{text:translate("Дата добавления")},{content:"serverDateRangeFilter"}],width:180,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"phone",header:[{text:translate("Номер телефон")},{content:"serverFilter"}],width:150,template:function(e){return window.MakeCall?"<a href=\"javascript:window.MakeCall('"+e.phone+"');\">"+e.phone+"</a>":'<a href="tel:'+e.phone+'">'+e.phone+"</a>"}},{id:"name",header:[{text:translate("Имя клиента")},{content:"serverFilter"}],width:220},{id:"called",header:[{text:translate("Последний звонок")},{content:"serverDateRangeFilter"}],width:220},{id:"buyer_status",header:[{text:translate("Статус покупателя")},{content:"multiSelectFilter",suggest:webix.filterSuggest,options:[{id:"Первичный"},{id:"Повторный"}]}],width:180},{id:"lastbuy_date",header:[{text:translate("Дата последней покупки")},""],width:220},{id:"city",header:[{text:translate("Город")},{content:"multiSelectFilter",suggest:webix.filterSuggest,options:"legacy/nps/options/city"}],width:180},{id:"filial",header:[{text:translate("Филиал")},{content:"multiSelectFilter",suggest:webix.filterSuggest,options:"legacy/nps/options/filial"}],width:180},{id:"channel",header:[{text:translate("Канал")},{content:"multiSelectFilter",suggest:webix.filterSuggest,options:"legacy/nps/options/channel"}],width:180},{id:"state",header:[{text:translate("Результат звонка")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#value#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var i=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",i),this.resize()}}},options:[{id:0,value:"Не звонили"},{id:1,value:"Не отвечает"},{id:2,value:"Занят"},{id:3,value:"Перезвонить"},{id:4,value:"Состоялся"}]}],template:function(e){var t=["Не звонили","Не отвечает","Занят","Перезвонить","Состоялся"],i="";return e.state&&(i=3==e.state&&e.called?t[e.state]+" в "+e.called:t[e.state]),i},width:180},{id:"anketa",width:120,header:[{text:translate("Анкета")},{text:""}],template:function(e){var t="";return e.id&&(t='<div class="webix_view webix_control webix_el_button" style="display: inline-block; vertical-align: top; border-width: 0px; width: 100px; height: 38px;"><div class="webix_el_box" style="width:100px; height:30px"><button type="button" class="webix_img_btn_abs webixtype_base accountDone" style="width:100%; "><center>Анкета</center></button></div></div></div>'),t}}],datafetch:20,loadahead:10,on:{onBeforeContextMenu:function(e){this.select(e)},onItemClick:function(e){if("anketa"==e.column){var t=$$("clients").getSelectedItem();window.open(window.location.origin+"/#!/main/script?id=10&nps="+t.id,"_blank")}},onAfterFilter:function(){},onBeforeFilter:function(e,t,i){}},ready:function(){webix.extend(this,webix.ProgressBar),e.bindContextMenuToGreed()}}},e.prototype.bindContextMenuToGreed=function(){var e=this.getThis();$$(e.contextMenuId)||webix.ui({view:"contextmenu",submenu:"data",id:e.contextMenuId,width:300,data:[{value:"Изменить статус",id:"editStatus",submenu:[{id:"0",value:"Не звонили"},{id:1,value:"Не отвечает"},{id:2,value:"Занят"},{id:3,value:"Перезвонить"},{id:4,value:"Совершен"}]},{value:"Анкета",id:"open"}],on:{onMenuItemClick:function(e){var t=this.getMenuItem(e);if("open"==t.id){var i=$$("clients")?$$("clients").getSelectedItem():0;i?window.open(window.location.origin+"/#!/main/script?id=10&nps="+i.id,"_blank"):webix.message({type:"error",text:"Произошла ошибка"})}else if("editStatus"!=t.id){var o=$$("clients").getSelectedItem();webix.ajax().get("legacy/nps/clients/setstate",{npsId:o.id,state:t.id},function(e){e=JSON.parse(e),e.result?(webix.message({text:"Статус звонка изменен"}),$$("clients").clearAll(),$$("clients").load($$("clients").config.url)):(webix.message({type:"error",text:e.msg}),console.log("err",e.data))})}}}}).attachTo($$(e.id))},e.prototype.getView=function(){return this.getGreed()},e.prototype.removeClient=function(){var e=$$("clients");if(e){var t=e.getSelectedItem();t&&t.id?webix.confirm({text:"Клиент и результаты его анкетирования будут удалены. <br> Продолжить?",callback:function(e){if(!e)return!1;webix.ajax().get("legacy/nps/clients/remove",{id:t.id},function(e){e=JSON.parse(e),e.result?(webix.message({text:"Клиент удален"}),$$("clients").remove(t.id)):(webix.message({type:"error",text:e.msg}),console.log("err",e.data))})}}):webix.message({type:"error",text:"Выберите клиента!"})}else webix.message({type:"error",text:"Произошла ошибка!"})},e.prototype.showModalWindow=function(){var e=this.getThis();webix.ui({view:"window",id:"importWindow",position:"center",move:!0,resizw:!0,modal:!0,width:700,height:500,scroll:!0,head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Импорт клиентов"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Внесенные изменения не будут сохранены. <br/> Продолжить?",ok:"Ок",cancel:"Отмена",callback:function(e){e&&$$("importWindow").close()}})}}]},body:{id:"importForm",view:"form",elements:[{cols:[{},{view:"uploader",value:translate("Выберите Excel или CSV файл"),on:{onBeforeFileAdd:function(e){var t=[{id:"phone",value:translate("Телефон")},{id:"name",value:translate("Имя клиента")},{id:"buyer_status",value:translate("Статус покупателя")},{id:"lastbuy_date",value:translate("Дата последней покупки")},{id:"city",value:translate("Город")},{id:"filial",value:translate("Филиал")},{id:"channel",value:translate("Канал")},{id:"motivational_p",value:translate("Мотивационная программа")}];if(t.unshift({id:"empty",value:"Выберите зачение"}),"xlsx"==e.type||"xls"==e.type)webix.DataDriver.excel.toObject(e.file).then(function(e){for(var i=e.data,o=webix.toArray($$("importData").config.columns),r=0;r<i[0].length;r++)o.insertAt({id:"field"+r,header:[{content:"selectFilter",options:t}]},r);$$("importData").refreshColumns();for(var r=0;r<i.length;r++){for(var n={},a=0;a<i[r].length;a++)n["field"+a]=i[r][a];i[r]=n}$$("importData").clearAll(),$$("importData").parse(i)});else{if("csv"==e.type){var i=new FileReader;return i.onload=function(e){for(var i=e.target.result.split("\n"),o=0;o<i.length;o++){var r={};i[o]=i[o].split("\t");for(var n=0;n<i[o].length;n++)r["field"+(n+1)]=i[o][n];i[o]=r}for(var a=[],o=0;o<i.length;o++)a.push(i[o].field1.split(";",-1));for(var s=webix.toArray($$("importData").config.columns),o=0;o<a[0].length;o++)s.insertAt({id:"field"+o,header:[{content:"selectFilter",options:t}]},o);$$("importData").refreshColumns(),$$("importData").clearAll();for(var o=0;o<a.length;o++){for(var r={},n=0;n<a[o].length;n++)r["field"+n]=a[o][n];a[o]=r,$$("importData").parse(a[o])}},i.readAsText(e.file),!1}webix.message({type:"erro",text:"Неизвестный тип файла!"})}}}},{}]},{view:"datatable",id:"importData",select:!0,resize:!0,resizeColumn:!0,columns:[],ready:function(){this.filterByAll=function(){}}},{margin:20,cols:[{view:"label",id:"import_process"},{view:"button",value:"Отмена",width:200,click:function(){$$("importWindow").close()},hidden:!0},{view:"button",id:"importButton",type:"form",value:"Импортировать",width:200,align:"right",click:function(){var t=getImportMap();e.sendImport(0,$$("importData").serialize(),t)}}]}]},ready:function(){webix.extend($$("importWindow"),webix.ProgressBar)}}).show()},e.prototype.getImportMap=function(){var e=$$("importData").serialize(),t=[];if(e&&e.length)for(var i in e[0])"id"!=i&&t.push($$("importData").getFilter(i).value);var o=!1;for(var r in t){if("phone"==t[r]){o=!0;break}o=!1}if(!o)return void webix.message({type:"error",text:"Выберите телефон"});var n=[];for(var a in t)-1!=t[a].indexOf("phone")&&(n.phone=a),-1!=t[a].indexOf("name")&&(n.name=a),-1!=t[a].indexOf("buyer_status")&&(n.buyer_status=a),-1!=t[a].indexOf("lastbuy_date")&&(n.lastbuy_date=a),-1!=t[a].indexOf("city")&&(n.city=a),-1!=t[a].indexOf("filial")&&(n.filial=a),-1!=t[a].indexOf("channel")&&(n.channel=a),-1!=t[a].indexOf("motivational_p")&&(n.motivational_p=a);return $$("importForm").disable(),webix.extend($$("importWindow"),webix.ProgressBar),webix.extend($$("importButton"),webix.ProgressBar),$$("importWindow").showProgress({type:"bottom",hide:!1,position:.1}),$$("importButton").showProgress({type:"icon",hide:!1}),n},e.prototype.sendImport=function(e,t,i){var o=this.getThis();if(webix.extend($$("importWindow"),webix.ProgressBar),$$("importWindow").showProgress({type:"bottom",hide:!1,position:e/t.length==0?.01:e/t.length}),!(e>t.length)){for(var r=[],n=e;n<e+10&&n<t.length;n++)if(t[n]){var a={phone:String(t[n]["field"+i.phone]),name:"undefined"!=String(t[n]["field"+i.name])?String(t[n]["field"+i.name]):null,buyer_status:"undefined"!=String(t[n]["field"+i.buyer_status])?String(t[n]["field"+i.buyer_status]):null,lastbuy_date:"undefined"!=String(t[n]["field"+i.lastbuy_date])?String(t[n]["field"+i.lastbuy_date]):null,city:"undefined"!=String(t[n]["field"+i.city])?String(t[n]["field"+i.city]):null,filial:"undefined"!=String(t[n]["field"+i.filial])?String(t[n]["field"+i.filial]):null,channel:"undefined"!=String(t[n]["field"+i.channel])?String(t[n]["field"+i.channel]):null,motivational_p:"undefined"!=String(t[n]["field"+i.motivational_p])?String(t[n]["field"+i.motivational_p]):null};a.phone.length&&r.push(a)}console.log(r),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/clients/import",{data:JSON.stringify(r)},{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e}),$$("importForm").enable(),$$("importWindow").hideProgress(),$$("importButton").hideProgress()},success:function(e,r,a){var s=r.json();if(!s||!s.result)return webix.message({type:"error",text:"Произошла ошибка при обработке данных.<br/>"+e}),$$("importForm").enable(),$$("importWindow").hideProgress(),void $$("importButton").hideProgress();$$("import_process").setHTML("Импортировано "+n+" из "+t.length),$$("import_process").show(),n<t.length-1?o.sendImport(n,t,i):($$("importButton").hideProgress(),$$("importButton").hide(),$$("importWindow").showProgress({type:"bottom",hide:!1,position:1}),webix.alert("Импорт успешно завершен",function(e){e&&($$("importWindow").close(),$$("clients").loadNext(20,0,null,"controllers/clients.php"))}))}})}},e.prototype.loadGreedData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;webix.guiutils.loadTable(this.id,"/legacy/nps/clients",e)},e.prototype.getToolBar=function(){var e=this.getThis();return{id:"clients_toolbar",hidden:!0,css:"top-menu-right-item",cols:[{view:"button",type:"icon",id:"reloadClients",width:56,icon:"wxi-sync",css:"disable_margin_btn_tbar",click:function(){e.loadGreedData()}},{view:"button",type:"icon",icon:"wxi-file",width:260,label:translate("Import from Excel or CSV"),click:function(){e.showModalWindow()}},{view:"button",type:"icon",icon:"wxi-trash",width:125,label:translate("Удалить"),click:function(){e.removeClient()}}]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").hide(),this.showToolBar()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.hide(),$$("clients")&&(this.loaded||(webix.extend($$("clients"),webix.ProgressBar),this.loadGreedData(function(){e.loaded=1})))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e)}return e.prototype.getView=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if($$("outgoingcampaign-toolbar").hide(),$$("outgoingcampaigns").hide(),$$("outgoingcampaign-form").show(),e){if($$("co-form").setValues(e),!e.id)return;webix.ajax().get("outgoingcampaign/"+e.id+"/queues").then(function(e){var t=e.json();t.length&&$$("oc-queues").parse(t)}),webix.ajax().get("outgoingcampaign/"+e.id+"/results").then(function(e){var t=e.json();t.length&&$$("oc-results").parse(t)})}}return{view:"datatable",id:"outgoingcampaigns",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,columns:[{id:"tm_created",header:"Создан(а)",width:150,minWidth:50,template:function(e){var t="";switch(e.state){case"1":t+="<img src='./assets/imgs/oc-states/2.png'>";break;case"2":t+="<img src='./assets/imgs/oc-states/3.png'>";break;case"3":t+="<img src='./assets/imgs/oc-states/4.png'>";break;case"4":t+="<img src='./assets/imgs/oc-states/5.png'>";break;case"5":t+="<img src='./assets/imgs/oc-states/6.png'>";break;default:t+="<img src='./assets/imgs/oc-states/1.png'>"}return t+=webix.Date.dateToStr("%d.%m.%y в %H:%i")(e.tm_created)}},{id:"name",header:"Название",fillspace:2,minWidth:90},{id:"method",header:"Расписание",fillspace:2,minWidth:90,template:function(e){var t=webix.Date.dateToStr("%d.%m")(e.date_start);return t+="-"+webix.Date.dateToStr("%d.%m")(e.date_finish),t+=" "+Object.values(e.days).join(","),t+=" c "+e.time_start,t+=" до "+e.time_finish}},{id:"state",header:"Статус",width:200,minWidth:90,sort:"text",template:function(e){if(!e)return"1";if(!e.state)return"2";switch(e.state){case"1":return"Создан(а)";case"2":return"Выполняется";case"3":return"Приостановлен(а)";case"4":return"Остановлен(а)";case"5":return"Завершен(а)";default:return""}}}],ready:function(){},on:{onItemDblClick:function(t,i,o){var r=this.getSelectedItem();if(r.time_start){var n=r.time_start.split(":",2);2==n.length&&(r.minutes_start=n[1],r.hours_start=n[0]);var a=r.time_finish.split(":",2);2==a.length&&(r.minutes_finish=a[1],r.hours_finish=a[0])}var s={};for(var l in r.days)s[l]=1;$$("weekDays-form").setValues(s),r.settings.length?r.result=r.settings[0].result:r.result=0,console.log(r),e(r)}}}},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(4),l=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){var e,t=[{id:1,value:"В очереди"},{id:2,value:"Вызывается"},{id:3,value:"Занят"},{id:4,value:"Ошибка"},{id:5,value:"Переход"},{id:6,value:"Завершен"},{id:7,value:"Остановлен"},{id:8,value:"Запланирован"}];return{id:"co-calls-window",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:500,width:900,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Звонки контакту",align:"left"},{view:"icon",icon:"wxi-close",click:function(){$$("co-calls-window").hide()}}]},body:(e={view:"datatable",id:"co-calls-table",scroll:!0,tooltip:!0,resizeColumn:!0},e.scroll=!0,e.columns=[{id:"time",header:"Дата и время",fillspace:2,format:webix.Date.dateToStr("%d.%m.%y в %H:%i"),minWidth:100},{id:"rbt_duration",header:"Вызов(сек)",fillspace:2,minWidth:100},{id:"duration",header:"Разговор(сек)",fillspace:2,minWidth:100},{id:"hangup_code",header:"Код завершения",fillspace:4,minWidth:100,template:function(e){return e?e.status_text?e.status_text:e.hangup_code?e.hangup_code:"":""}},{id:"state",header:"Результат",width:100,template:function(e){if(console.log(e.state),6==e.state||3==e.state)var i=t[e.state].value+"(a)";else var i=t[e.state].value;return i}}],e)}},t.prototype.showWindow=function(e){e&&e.id&&this.$$("co-calls-table").load("/outgoingcampaign/result/"+e.id+"/calls"),this.getRoot().show()},t}(a.b),c=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.getView=function(){for(var e=this,t=[],i=["1","3","5","10","15","20"],o=[{id:1,value:"В очереди"},{id:2,value:"Вызывается"},{id:3,value:"Занят"},{id:4,value:"Ошибка"},{id:5,value:"Переход"},{id:6,value:"Завершен"},{id:7,value:"Остановлен"},{id:8,value:"Запланирован"}],r=["OCA_MANAGER","OCS_PHONE","OCS_QUEUE","OCS_PLAYFILE"],n=function(e,t){r.forEach(function(t){if(t==e)return!1;$$(t)&&$$(t).setValue(0)})},a=function(e){var t={};return r.forEach(function(i){if(0!=e[i])return t.action=e[i],void(t.value=e[i+"value"])}),t},l=function(){$$("oc-queues").clearAll(),$$("oc-results").clearAll(),$$("co-form").setValues({}),$$("outgoingcampaign-toolbar").show(),$$("outgoingcampaigns").show(),$$("outgoingcampaign-form").hide(),$$("outgoingcampaigns").load("/outgoingcampaign/list")},c=function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")},d=function(e){var t=[],i=window.settingsResult?window.settingsResult:e.settings;return!!i&&(i.forEach(function(e){var i={};parseInt(e.pause)&&(i.pause=1,i.pause_time=e.pause_time),parseInt(e.stop)?i.stop=1:parseInt(e.postpone_for_radio)?i.postpone_for=e.postpone_for:parseInt(e.postpone_to)&&(i.postpone_to=e.postpone_to_date),i.result=e.id,t.push(i)}),t)},u=function(){var e=$$("co-form").getValues(),t={};t.id=parseInt(e.id)?e.id:0,0==t.id&&(t.state=1),t.name=e.name,t.description=e.description,t.date_finish=webix.Date.dateToStr("%Y-%m-%d")(e.date_finish),t.date_start=webix.Date.dateToStr("%Y-%m-%d")(e.date_start),t.time_start=e.time_start.toString(),t.time_finish=e.time_finish.toString(),t.days=c($$("weekDays-form").getValues()),t.call_tries=e.call_tries;var i=a(e);t.action=i.action,t.action_value=i.value,t.min_call_time=window.min_call_time,t.concurrent_calls_limit=window.concurrent_calls_limit;var o=d(e);return o&&(t.settings=o),t.phones=$$("oc-queues").serialize(),t.dial_context=e.dial_context,t},h=0,p=function(){webix.ui({view:"window",id:"importPhoneWindow",position:"center",move:!0,resizw:!0,modal:!0,width:700,height:500,scroll:!0,head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Импорт телефонов"},{view:"icon",icon:"times-circle",click:function(){webix.confirm({text:"Внесенные изменения не будут сохранены. <br/> Продолжить?",ok:"Ок",cancel:"Отмена",callback:function(e){e&&$$("importPhoneWindow").close()}})}}]},body:{id:"importForm",view:"form",elements:[{view:"uploader",value:translate("Выберите CSV файл"),on:{onBeforeFileAdd:function(e){var t=[{id:"phone",value:translate("Номер телефона")},{id:"name",value:translate("Имя контакта")},{id:"description",value:translate("Примечание")},{id:"state",value:translate("Состояние")}];if("csv"==e.type){var i=new FileReader;return i.onload=function(e){for(var i=e.target.result.split("\n"),o=0;o<i.length;o++){var r={};i[o]=i[o].split("\t");for(var n=0;n<i[o].length;n++)r["field"+(n+1)]=i[o][n];i[o]=r}for(var a=[],o=0;o<i.length;o++)a.push(i[o].field1.split(";",-1));for(var s=webix.toArray($$("importData").config.columns),o=0;o<a[0].length;o++)s.insertAt({id:"field"+o,header:[{content:"selectFilter",options:t}]},o);$$("importData").refreshColumns(),$$("importData").clearAll();for(var o=0;o<a.length;o++){for(var r={},n=0;n<a[o].length;n++)r["field"+n]=a[o][n];a[o]=r,$$("importData").parse(a[o])}},i.readAsText(e.file),!1}webix.message({type:"error",text:"Неизвестный тип файла!"})}}},{view:"datatable",id:"importData",select:!0,resize:!0,resizeColumn:!0,columns:[],ready:function(){this.filterByAll=function(){}}},{margin:20,cols:[{view:"button",id:"importButton",type:"form",value:"Импортировать",align:"right",click:function(){var e=f(),t=[],i=$$("importData").serialize();if(!e||!e.phone)return webix.message({type:"error",text:"Выберите телефон"}),!1;for(var o in i)if(i[o]){var r={phone:String(i[o]["field"+e.phone]),name:"undefined"!=String(i[o]["field"+e.name])?String(i[o]["field"+e.name]):null,description:"undefined"!=String(i[o]["field"+e.description])?String(i[o]["field"+e.description]):null,state:"undefined"!=String(i[o]["field"+e.state])?String(i[o]["field"+e.state]):null,id:webix.uid()};r.phone.length&&t.push(r)}t?($$("oc-queues").parse(t),w(),webix.message({type:"success",text:"Телефоны импортированы в таблицу!"}),$$("importPhoneWindow").close()):webix.message({type:"error",text:"Нет данных!"})}}]}]},ready:function(){webix.extend($$("importPhoneWindow"),webix.ProgressBar)}}).show()},f=function(){var e=$$("importData").serialize(),t=[];if(e&&e.length)for(var i in e[0])"id"!=i&&t.push($$("importData").getFilter(i).value);var o=!1;for(var r in t){if("phone"==t[r]){o=!0;break}o=!1}if(o){var n=[];for(var a in t)-1!=t[a].indexOf("phone")&&(n.phone=a),-1!=t[a].indexOf("name")&&(n.name=a),-1!=t[a].indexOf("description")&&(n.description=a),-1!=t[a].indexOf("state")&&(n.state=a);return n}},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$$("oc-queues").serialize(),t=$$("oc-results").serialize().length,i=0,o=0,r=0;for(var n in e){var a=e[n];switch(parseInt(a.state)){case 1:++r;break;case 6:++t;break;case 3:++i;break;case 4:++o}}$$("phones-total-info").setValue("Контактов в списке: "+e.length+" Завершено: "+t+", Занят/не отвечает: "+i+", Ошибка дозвона: "+o+", В очереди: "+r)};h<=23;)h<=9&&(h="0"+h.toString()),t.push(h.toString()),h++;return{hidden:!0,id:"outgoingcampaign-form",rows:[{template:"Редактирование кампании",type:"header"},{view:"form",id:"co-form",padding:24,scroll:!0,rows:[{rows:[{margin:10,cols:[{view:"fieldset",label:"Название",body:{view:"text",name:"name",required:!0,tooltip:"Название кампании: #value#"}},{view:"fieldset",label:"Период проведения",body:{cols:[{required:!0,view:"datepicker",name:"date_start",label:"Начало",labelPosition:"left",placeholder:"Click to select",labelWidth:90},{required:!0,view:"datepicker",name:"date_finish",label:"Конец",labelPosition:"left",placeholder:"Click to select"}]}},{view:"fieldset",label:"Время звонка",body:{cols:[{view:"label",label:"С:",width:40,align:"center"},{view:"datepicker",name:"time_start",required:!0,type:"time"},{view:"label",label:"По:",width:50,align:"center"},{view:"datepicker",name:"time_finish",required:!0,type:"time"}]}}]},{margin:10,cols:[{view:"fieldset",label:"Описание кампании",body:{view:"textarea",name:"description",tooltip:"Описание кампании: #value#"}},{view:"fieldset",label:"Дни недели",body:{view:"multiselect",id:"weekDays-form",name:"weekDays",options:[{id:1,value:"Пн"},{id:2,value:"Вт"},{id:3,value:"Ср"},{id:4,value:"Чт"},{id:5,value:"Пт"},{id:6,value:"Сб"},{id:7,value:"Вс"},{id:8,value:"Рабочие дни"},{id:9,value:"Выходные"},{id:10,value:"Праздники"}]}},{rows:[{view:"fieldset",label:"Настройка",body:{cols:[{view:"richselect",label:"Попыток",options:i,name:"call_tries",tooltip:"Попыток: #value#",required:!0,labelWidth:90,width:150},{width:10},{view:"button",label:"Расширенные",click:function(){this.$scope.ui(s.OCRulesWnd).showWindow(this.$scope.$view);var e=$$("co-form").getValues();parseInt(e.id)?($$("co-settings-result").parse(e.settings),$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")):$$("co-settings-result").load("/outgoingcampaign/0/settings").then(function(){$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")})}}]}},{},{cols:[{view:"button",label:"Обновить статусы",click:function(){var e=$$("co-form").getValues();parseInt(e.id)||(e.id=0),$$("oc-queues").clearAll(),$$("oc-results").clearAll(),$$("oc-queues").load("outgoingcampaign/"+e.id+"/queues","json",function(){w()}),$$("oc-results").load("outgoingcampaign/"+e.id+"/results","json",function(){w()})}}]}]}]},{margin:10,cols:[{view:"tabview",id:"co-tabview",cells:[{header:"Очередь",width:150,body:{id:"oc-queues-tab",rows:[{view:"datatable",id:"oc-queues",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,minHeight:200,editable:!0,columns:[{id:"phone",header:"Номер телефона",width:150,minWidth:50,editor:"text"},{id:"name",header:"Имя контакта",fillspace:2,minWidth:90,editor:"text"},{id:"description",header:"Примечание",fillspace:2,minWidth:90,editor:"text"},{id:"state",header:"Состояние",fillspace:2,minWidth:90,options:o,editor:"select"}],on:{"data->onParse":function(e,t){w(t)}},scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",type:"icon",icon:"wxi-file",width:260,label:"Импорт из CSV...",click:function(){p()}},{view:"button",type:"icon",icon:"fa fa-plus",width:60,click:function(){var t=e.$$("oc-queues").add({});e.$$("oc-queues").select(t),$$("oc-queues").showCell(),$$("oc-queues").editCell(t,"phone",!0,!0),w()}},{},{}]}]}},{header:"Результаты",width:170,body:{id:"oc-results-tab",rows:[{view:"datatable",id:"oc-results",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,minHeight:200,columns:[{id:"phone",header:"Номер телефона",width:150,minWidth:50},{id:"name",header:"Имя контакта",fillspace:2,minWidth:90},{id:"description",header:"Примечание",fillspace:1,minWidth:90},{id:"state",header:"Состояние",fillspace:2,minWidth:90,template:function(e){var t="",i=parseInt(e.state)-1;return 6==e.state||3==e.state?t+=o[i].value+"(a)":t+=o[i].value,3!=e.state&&4!=e.state||(t+=" "+e.dial_result),t+=", звонков: "+e.tries+", последний: "+webix.Date.dateToStr("%d.%m в %H:%i")(e.last_call)}}],on:{onItemDblClick:function(){this.$scope.callsWindow.showWindow(this.getSelectedItem())}},scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",label:"Импорт из CSV...",width:150,disabled:!0},{},{view:"button",label:"Звонки контакту",width:150,click:function(){$$("oc-results").getSelectedItem()?this.$scope.callsWindow.showWindow($$("oc-results").getSelectedItem()):webix.alert({type:"error",text:"Выберите контакт для просмотра звонков"})}}]}]}},{header:"Журнал",width:120,body:{id:"oc-journal-tab",rows:[{view:"datatable",id:"oc-journal",minHeight:200,select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,columns:[{id:"datatime",header:"Дата и время",width:150,minWidth:50},{id:"value",header:"Сообщение",fillspace:2,minWidth:90}],scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",label:"Импорт из CSV...",width:150,disabled:!0},{},{}]}]}}]}]},{margin:10,cols:[{view:"button",label:"Создать отчет",width:150,click:function(){switch($$("co-tabview").getValue()){case"oc-journal-tab":var e="oc-journal";break;case"oc-queues-tab":var e="oc-queues";break;case"oc-results-tab":var e="oc-results"}webix.csv.delimiter.cols=";",webix.toCSV($$(e),{filename:e})}},{view:"label",id:"phones-total-info",align:"right",label:"Контактов в списке: 0, Завершено: 0, Занят/не отвечает: 0, Ошибка дозвона: 0, В очереди: 1"}]},{margin:10,cols:[{view:"fieldset",label:"Действие при дозвоне",body:{rows:[{cols:[{view:"radio",value:0,name:r[0],id:r[0],options:[{id:1,value:"Соединение с менеджером"}],disabled:!0,on:{onChange:function(e,t){n(this.config.id)}}},{view:"radio",value:0,name:r[1],id:r[1],options:[{id:2,value:"Вызов номера или группы:"}],on:{onChange:function(e,t){e&&(n(this.config.id),$$(r[1]+"value").enable(),$$(r[2]+"value").disable())}}},{view:"text",name:r[1]+"value",id:r[1]+"value",disabled:!0,on:{onChange:function(e,t){""!=e&&$$(r[2]+"value").setValue("")}}},{view:"radio",value:0,name:r[2],id:r[2],options:[{id:3,value:"Вызов звонковой очереди"}],on:{onChange:function(e,t){e&&(n(this.config.id),$$(r[2]+"value").enable(),$$(r[1]+"value").disable())}}},{view:"combo",name:r[2]+"value",id:r[2]+"value",disabled:!0,on:{onChange:function(e,t){""!=e&&$$(r[1]+"value").setValue("")}},options:"/legacy/grouped_queues_name/short"}]},{cols:[{view:"radio",value:0,name:r[3],id:r[3],options:[{id:3,value:"Проигрывать записанный файл"}],disabled:!0,on:{onChange:function(e,t){n(this.config.id)}}},{view:"richselect",value:"Recorded file",options:["Recorded file"],disabled:!0},{view:"button",label:"Прослушать",disabled:!0},{view:"button",label:"Записать",disabled:!0},{view:"combo",label:"Правила набора",name:"dial_context",suggest:"/config/extensions",filter:function(e,t){return-1!==e.value.indexOf(t)},labelWidth:150}]}]}},{width:140,rows:[{view:"button",label:"Сохранить",click:function(){if(!$$("co-form").validate())return webix.message({type:"error",text:"Заполните обязательные параметры"}),!1;$$("oc-queues").editStop();var e=u();webix.ajax().post("outgoingcampaign/"+e.id+"/save",e).then(function(e){var t=e.json();t.result&&!t.errors.length?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),l()):t.errors.length?(webix.message({type:"error",text:"При сохранении номеров произошла ошибка"}),t.errors.forEach(function(e){var t="";t=e.errorInfo[2]?e.errorInfo[2]:e.errorInfo?e.errorInfo.toString():e.toString(),webix.message({type:"error",text:t})})):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}},{},{view:"button",label:"Отмена",click:function(){webix.confirm({text:"Не сохраненные изменения будут утеряны. Продолжить?",callback:function(e){if(e)return void l()}})}}]}]}]}],rules:{name:webix.rules.isNotEmpty},on:{onValues:function(){var e=$$("co-form").getValues();if(e[r[e.action-1]]==e.action)return!1;e[r[e.action-1]]=e.action,e[r[e.action-1]+"value"]=e.action_value,console.log(e),$$("co-form").setValues(e),$$("min_call_time")&&!$$("min_call_time").getValue()&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))}}}]}},t.prototype.setFormValues=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(e),this.$$("co-form").setValues(e)},t.prototype.init=function(){this.callsWindow=this.ui(l)},t}(a.b);t.default=c},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("aliases",this),this.dst_change="",this.src_change="",this.optionsWindowId="aliases_wnd",this.toolBarId="aliases_toolbar"}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.aliasesId},e.prototype.setId=function(e){this.aliasesId=e},e.prototype.getView=function(){var e=this.getThis(),t=0;return{id:"aliases",view:"datatable",hidden:!0,resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,tooltip:!0,fixedRowHeight:!1,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50,template:function(e){return e.id}},{id:"number",header:[{text:"Номер телефона"},{content:"serverFilter"}],fillspace:1},{id:"type",header:[{text:"Назначение"},{content:"serverSelectFilter"}],options:"/aliases/type/short",fillspace:1}],yCount:0,autoConfig:!0,on:{onItemDblClick:function(){$$(e.optionsWindowId)||e.getEditWindow(),e.showEditWindow()},onAfterLoad:function(){t&&this.getItem(t)&&this.select(t)},onAfterSelect:function(){t=this.getSelectedId()},onDataRequest:function(e,t){}},ready:function(){}}},e.prototype.getEditWindow=function(e){var t,i=this.getThis(),o={padding:17,rows:[(t={elementsConfig:{labelWidth:100,margin:10},width:600,view:"form",id:"aliases-add-form",autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"ID",hidden:!0},{view:"text",name:"number",label:"Номер телефона",inputAlign:"left",labelWidth:120,required:!0},{view:"combo",name:"type",label:"Назначение",inputAlign:"left",labelWidth:120,required:!0,options:"/aliases/type/short",on:{onChange:function(){var e=$$(this).getValue();e=e.split(","),$$("users_id").hide(),$$("phone").hide(),$$("queues_id").hide(),e.forEach(function(e){"user"==e?$$("users_id").show():"queue"==e?$$("queues_id").show():"phone"==e&&$$("phone").show()})}}},{view:"text",name:"phone",id:"phone",label:"Номер",inputAlign:"left",labelWidth:120,hidden:!0},{view:"combo",name:"queues_id",id:"queues_id",label:"Очередь",inputAlign:"left",labelWidth:200,hidden:!0,options:{body:{template:"#fullname#"},url:"/queues/list/short"}},{view:"combo",name:"users_id",id:"users_id",label:"Пользователи",inputAlign:"left",labelWidth:120,options:"/groups/users/short",hidden:!0},{height:10}]},t.elementsConfig={inputAlign:"left",labelPosition:"top",margin:10},t),{margin:10,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("aliases-add-form");if(e.validate()){e.disable();var t=e.getValues();webix.ajax().post("/aliases/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.guiutils.loadAliasesTable(),webix.message({type:"success",text:t.message}),e.enable(),webix.$$(i.optionsWindowId).close()):(webix.message({type:"error",text:t.message}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable(),console.log(t)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$(i.optionsWindowId).close()}})}}]}]},r={view:"window",id:i.optionsWindowId,position:"center",modal:!0,width:600,minHeight:450,resize:!0,move:!0,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:($$("aliases").getSelectedItem()?"Изменить ":"Добавить")+"  алиас",align:"left"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$(i.optionsWindowId).close()}})}}]},body:webix.copy(o),on:{onShow:function(){var t=e;t?t.id?(i.setId(t.id),$$("aliases-add-form").setValues(t)):i.setId(0):($$("aliases-add-form").setValues({id:0}),i.setId(0))}}};webix.ui(r).show(),$$("aliases-add-form").setValues(e)},e.prototype.getToolBar=function(){var e=this.getThis();return{css:"top-menu-right-item",id:e.toolBarId,hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){$$("aliases").unselectAll(),$$(e.optionsWindowId)||e.getEditWindow(),e.showEditWindow()}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){var t=$$("aliases").getSelectedItem().id,i="/aliases/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?($$(e.optionsWindowId)||e.getEditWindow(o),e.showEditWindow()):webix.message({type:"error",text:"Выберите пользователя для копирования"})})}},{css:"last-button-on-left-position",view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Копировать",click:function(){var t=$$("aliases").getSelectedItem().id,i="/aliases/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?(o.id=0,$$(e.optionsWindowId)||e.getEditWindow(o),e.showEditWindow()):webix.message({type:"error",text:"Выберите пользователя для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){webix.guiutils.loadAliasesTable()}}]}},e.prototype.showEditWindow=function(){$$(this.optionsWindowId).show()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").hide(),this.showToolBar()},e.prototype.loadData=function(){var e=this;$$("aliases")&&(this.setToolBar(),this.loaded||(webix.extend($$("aliases"),webix.ProgressBar),$$("aliases").load("/aliases/list","json",function(){$$("aliases").filterByAll(),e.loaded=1})))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("setup",this),this.dst_change="",this.src_change="",this.optionsWindowId="setup_wnd",this.toolBarId="setup_toolbar",this.edited=0}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.setupsId},e.prototype.setId=function(e){this.setupId=e},e.prototype.getView=function(){var e=this.getThis();return{id:"setup",view:"form",hidden:!0,minHeight:1200,css:"my_style",scrollY:!0,scrollX:!0,tooltip:!0,borderless:!0,elements:[{cols:[{rows:[{name:"sip.url",id:"sip.url",view:"text",label:"SIP адрес станции",value:"",inputWidth:400,required:!0},{name:"acdclient.homepages",id:"acdclient.homepages",view:"text",label:"Страница, отображаемая в ACD клиент по умолчанию",value:"",inputWidth:400,required:!0}]}]},{cols:[{},{},{},{view:"button",label:"Доп. настройки",click:function(){$$(e.optionsWindowId)||e.getEditWindow(),e.showEditWindow()}},{view:"button",label:"Сохранить",disabled:!1,click:function(){var e=$$("setup").getValues(),t=[];if(Object.entries(e).forEach(function(e){var i=e[0],o=e[1];t.push({handle:i,val:o})}),!$$("setup").validate())return webix.message({type:"error",text:"Заполните обязательные поля"}),!1;$$("setup").disable(),webix.ajax().post("/settings/default/save",{settings:t}).then(function(e){var t=e.json();1==t.result?(webix.message("Информация сохранена."),$$("setup").enable()):webix.message({type:"error",text:t.message}),$$("setup").enable()})}}]}],elementsConfig:{labelPosition:"top",margin:10}}},e.prototype.getEditWindow=function(){var e=this.getThis(),t={width:800,view:"form",id:"settings-form",minHeight:500,padding:17,scroll:!0,elements:[{elementsConfig:{labelWidth:100},width:600,view:"datatable",id:"setup-cfg-settings",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,editable:!0,columns:[{id:"handle",header:"",fillspace:2,minWidth:50},{id:"val",header:"",fillspace:2,minWidth:150,editor:"text"},{id:"changed",hidden:!0}],ready:function(){this.getChangedSettings=function(){var e=this.serialize(),t=[];return e.forEach(function(e){parseInt(e.changed)&&t.push(e)}),t},this.save=function(){var t=$$("setup-cfg-settings");t.disable();var i=t.getChangedSettings();if(!i.length)return webix.message({type:"error",text:"Изменений не зафиксированно"}),void t.enable();webix.ajax().post("/settings/default/save",{settings:i}).then(function(i){t.enable(),i=i.json(),i.result?(webix.message({type:"success",text:"Сохранение прoшло успешно"}),t.enable(),webix.$$(e.optionsWindowId).close()):(webix.message({type:"error",text:"Произошла ошибка сохранения"}),t.enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),t.enable(),console.log(e)})}},on:{onBeforeEditStop:function(e,t){return this.edited=0,e.value!=e.old&&(this.edited=1),!0},onEditorChange:function(e,t){(this.getItem(e.row)[e.column]!=t||this.edited)&&(this.getItem(e.row).changed=1,this.refresh(e.row))}}},{margin:10,padding:17,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){webix.confirm({text:"Все измененные данные будут сохранены. <br> Продолжить?",callback:function(e){e&&$$("setup-cfg-settings").save()}})}},{view:"button",label:"Закрыть",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(t){t&&webix.$$(e.optionsWindowId).close()}})}}]}]};webix.ui({view:"window",id:e.optionsWindowId,position:"center",modal:!0,width:600,maxHeight:800,resize:!0,move:!0,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Дополнительные настройки",align:"left"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(t){t&&webix.$$(e.optionsWindowId).close()}})}}]},body:webix.copy(t),on:{onShow:function(){$$("setup-cfg-settings").load("/settings/default")}}})},e.prototype.getToolBar=function(){return{id:this.getThis().toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{}]}},e.prototype.showEditWindow=function(){$$(this.optionsWindowId).show()},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.loadData=function(){webix.AppFilter.hide(),$$("setup")&&($$(this.toolBarId)?this.showToolBar():this.setToolBar(),this.loaded||(webix.extend($$("setup"),webix.ProgressBar),webix.ajax().get("/settings/default",function(e,t){t=t.json(),t.forEach(function(e){"sip.url"==e.handle&&$$("setup").elements["sip.url"].setValue(e.val),"acdclient.homepages"==e.handle&&$$("setup").elements["acdclient.homepages"].setValue(e.val)}),this.loaded=1})))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(48),n=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="groups_toolbar",this.GroupsWindow=new r.GroupsWindow,webix.Manager.setComponent("groups",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getView=function(){var e=0,t=this;return{id:"groups",hidden:!0,view:"datatable",resizeColumn:!0,resizeRow:!0,scroll:!0,scrollX:!0,navigation:!0,select:!0,css:"my_style",fixedRowHeight:!1,tooltip:!0,columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"description",header:[{text:"Описание"},{content:"serverFilter"}],fillspace:1},{id:"list_users_str",header:["Список пользователей",""],fillspace:3}],on:{onItemDblClick:function(){t.GroupsWindow.showWindow()},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e),this.adjustRowHeight("list_users_str")}},ready:function(){webix.extend(this,webix.ProgressBar),this.adjustRowHeight("list_users_str")}}},e.prototype.getToolBar=function(){var e=this;return{id:e.toolBarId,hidden:!0,css:"top-menu-right-item",cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){$$("groups").unselectAll(),e.GroupsWindow.showWindow()}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("groups").getSelectedItem()?e.GroupsWindow.showWindow():webix.message({type:"error",text:"Выберите группу для редактирования"})}},{css:"last-button-on-left-position",view:"button",type:"icon",icon:"fa fa-trash",id:"removeGroup",width:150,label:"Удалить",click:function(){$$("groups").getSelectedId()?webix.guiutils.removeFromTable(parseInt($$("groups").getSelectedId()),"/groups/"+parseInt($$("groups").getSelectedId())+"/remove","groups","removeGroup"):webix.message({type:"error",text:"Выберите группу для удаления"})},on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){webix.guiutils.loadTable("groups","/groups/list")}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("groups"),{filterHTML:!0,filename:"Группы"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.hide(),this.loaded||(webix.extend($$("groups"),webix.ProgressBar),webix.guiutils.loadTable("groups","/groups/list",function(){e.loaded=1}))},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"GroupsWindow",function(){return n});var r=i(7),n=function(){function e(){o(this,e),this.id="group-add-win",this.setView()}return e.prototype.setView=function(){webix.ui(this.getView())},e.prototype.getView=function(){var e=this.getThis();return{view:"window",id:"group-add-win",position:"center",move:!0,modal:!0,resize:!0,height:400,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Группа",inputWidth:100,align:"left"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&$$("group-add-win").close()}})}}]},body:{padding:17,rows:[{view:"form",id:"group-add-form",autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"name",label:"Название",inputAlign:"left",labelWidth:190,placeholder:"Введите название",required:!0},{view:"text",name:"description",label:"Описание",inputAlign:"left",labelWidth:190,placeholder:"Введите описание"},{cols:[{view:"multicombo",name:"list_users_ids",label:"Пользователи",inputAlign:"left",labelWidth:190,labelPosition:"left",options:"/groups/users/short",placeholder:"Выберите пользователей"}]},{view:"multicombo",name:"rules",label:"Права доступа",inputAlign:"left",labelWidth:190,options:{body:{template:"#name#"},url:"/rules/list"},placeholder:"Назначьте права"}],elementsConfig:{inputAlign:"left",labelPosition:"left"}},{margin:10,cols:[{},{view:"button",label:"Настройки",align:"center",width:120,click:function(){this.$scope.ui(r.SettingsWindow).showWindow(e.getId(),"group")}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("group-add-form");if(e.validate()){e.disable();var t=e.getValues();webix.ajax().post("/groups/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.message({type:"success",text:t.message}),e.enable(),webix.$$("group-add-win").close(),webix.guiutils.loadTable("groups","/groups/list")):(webix.message({type:"error",text:t&&t.message?t.message:t.text}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable(),console.log(t)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&$$("group-add-win").close()}})}}]}]},on:{onShow:function(){var t=$$("groups").getSelectedItem();t?t.id?(e.setId(t.id),$$("group-add-form").setValues(t)):e.setId(0):($$("group-add-form").setValues({id:0}),e.setId(0))}}}},e.prototype.getThis=function(){return this},e.prototype.getId=function(){return this.groupId},e.prototype.setId=function(e){this.groupId=e},e.prototype.showWindow=function(){if($$(this.id)&&!$$(this.id).isVisible()&&$$(this.id).show(),!$$(this.id))return this.setView(),this.showWindow()},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(50),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(){o(this,e),this.loaded=0,this.id="contact_groups",this.toolBarId="contact_groups_toolbar",this.ContactsGroupsWindow=new r.ContactsGroupsWindow,webix.Manager.setComponent(this.id,this)}return e.prototype.roleAllowed=function(){return["phc.admin","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getToolBar=function(){var e=this.getThis();return{css:"top-menu-right-item",id:this.toolBarId,hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){$$(e.id).unselectAll(),e.ContactsGroupsWindow.showWindow()}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$(e.id).getSelectedItem()?e.ContactsGroupsWindow.showWindow():webix.message({type:"error",text:"Выберите группу для редактирования"})}},{view:"button",type:"icon",icon:"fa fa-trash",id:"removeContactGroup",width:150,label:"Удалить",click:function(){if($$(e.id).getSelectedId()){var t="/contact_groups/"+parseInt($$(e.id).getSelectedId())+"/remove";webix.guiutils.removeFromTable(parseInt($$(e.id).getSelectedId()),t,e.id,"removeContactGroup")}else webix.message({type:"error",text:"Выберите группу для удаления"})},on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var t=$$(tableName).getSelectedItem().id,i="/contact_groups/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?(o.id=0,e.ContactsGroupsWindow.show(o)):webix.message({type:"error",text:"Выберите контактную группу для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){e.loadGreedData()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$(e.id),{filterHTML:!0,filename:"Контактные группы"})}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.loadGreedData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;webix.guiutils.loadTable(this.id,"/contact_groups/list",e)},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getView=function(){var e=0;return{hidden:!0,id:this.getThis().id,view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,css:"my_style",fixedRowHeight:!1,tooltip:!0,columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"queue",header:[{text:"Входяшая очередь"},{content:"serverFilter"}],fillspace:1},{id:"queues",header:[{text:"Входяшии очереди"},{text:""}],fillspace:1,template:function(e){var t="";return e&&Array.isArray(e.queues)&&e.queues.forEach(function(e){t.length&&(t+=","),t+=e.fullname}),t}},{id:"items",header:[{text:"Члены группы"},{text:""}],fillspace:3,template:function(e){var t="";return e&&"object"==n(e.items)&&(Array.isArray(e.items.queues)&&e.items.queues.forEach(function(e){t.length&&(t+=","),t+=e.fullname}),Array.isArray(e.items.users)&&e.items.users.forEach(function(e){t.length&&(t+=","),t+=e.fullname})),t}}],on:{onAfterSelect:function(){e=this.getSelectedId()},onItemDblClick:function(){this.$scope.ui(r.ContactsGroupsWindow).showWindow(this.$scope.$view)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.hide(),$$(this.id)&&(this.loaded||(webix.extend($$(this.id),webix.ProgressBar),this.loadGreedData(function(){e.loaded=1})))},e}();t.default=a},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"ContactsGroupsWindow",function(){return r});var r=function(){function e(){o(this,e),this.id="contact-groups-add-win",this.setView()}return e.prototype.setView=function(){webix.ui(this.getView())},e.prototype.getView=function(){return{view:"window",id:this.id,position:"center",move:!0,modal:!0,resize:!0,height:350,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Контактная группа",inputWidth:450,align:"left"},{view:"icon",icon:"wxi-close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&$$("contact-groups-add-win").close()}})}}]},body:{padding:17,rows:[{view:"form",id:"group-add-form",width:600,autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"name",label:"Название",inputAlign:"left",labelWidth:200,required:!0},{margin:10,cols:[{view:"text",name:"queue",label:"Входящая очередь",inputAlign:"left",readonly:!0,placeholder:"Deprecated"},{view:"multicombo",name:"queues",label:"Входящие очереди",inputAlign:"left",options:{body:{template:"#fullname#"},url:"/queues/list/short"},tagMode:!1,tagTemplate:function(e){return e.length?"Очередей выбрано: "+e.length:""}}]},{margin:10,cols:[{view:"multicombo",name:"items_users",label:"Пользователи в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#value#"},url:"/groups/users/short"},tagMode:!1,tagTemplate:function(e){return e.length?"Пользователей выбрано: "+e.length:""}},{view:"multicombo",name:"items_queues",label:"Очереди в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#fullname#"},url:"/queues/list/short"},tagMode:!1,tagTemplate:function(e){return e.length?"Очередей выбрано: "+e.length:""}}]}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10}},{margin:10,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("group-add-form");if(e.validate()){e.disable();var t=e.getValues();webix.ajax().post("/contact_groups/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.message({type:"success",text:t.message}),e.enable(),webix.$$("contact-groups-add-win").close(),webix.guiutils.loadTable("contact_groups","/contact_groups/list")):(webix.message({type:"error",text:t&&t.message?t.message:text}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable()})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&$$("contact-groups-add-win").close()}})}}]}]},on:{onShow:function(){var e=$$("contact_groups").getSelectedItem();e&&e.id?(e.items_users=e.items.users,e.items_queues=e.items.queues,$$("group-add-form").setValues(e)):$$("group-add-form").setValues({id:0})}}}},e.prototype.showWindow=function(){if($$(this.id)&&!$$(this.id).isVisible()&&$$(this.id).show(),!$$(this.id))return this.setView(),this.showWindow()},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(52),n=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="phones_toolbar",this.PhonesWindow=new r.PhonesWindow,webix.Manager.setComponent("phones",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getView=function(){var e=0;return{hidden:!0,id:"phones",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollX:!0,scrollY:!0,navigation:!0,select:!0,css:"my_style",columns:[{id:"active",header:"",width:30,template:function(e){return 1==e.active?"<span class='greencircle'></span>":"<span class='graycircle'></span>"},footer:{content:"summTotal",colspan:2}},{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"phone",header:[{text:"Номер"},{content:"serverFilter"}],fillspace:1},{id:"model",header:[{text:"Модель"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/models.json"},{id:"mac",header:[{text:"MAC-адрес "},{content:"serverFilter"}],fillspace:1},{id:"user_id",header:[{text:"Пользователь "},{content:"serverFilter"}],fillspace:1,options:"/groups/users/short"},{id:"login",header:[{text:"Логин"},{content:"serverFilter"}],fillspace:1},{id:"rules",header:[{text:"Правила набора номера "},{content:"serverFilter"}],fillspace:1,options:"/config/extensions"},{id:"default_phone",header:[{text:"Внешний номер по умолчанию"},{content:"serverFilter"}],fillspace:1}],on:{onItemDblClick:function(){var e=this.getSelectedItem();(new r.PhonesWindow).show(e)},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}}}},e.prototype.getToolBar=function(){var e=this;return{id:e.toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){e.PhonesWindow.show({})}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("phones").getSelectedId()?e.PhonesWindow.show($$("phones").getSelectedItem()):webix.message({type:"error",text:"Выберите телефон для редактирования"})}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Provisioning",click:function(){if($$("phones").getSelectedId()){var e=$$("phones").getSelectedItem(),t={id:"window-phone-provisioning",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,minHeight:500,maxHeight:500,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Provisioning телефона",align:"left"},{view:"icon",icon:"wxi-close",click:function(){$$("window-phone-provisioning").close()}}]},body:{view:"form",id:"provisioning-form",elements:[{view:"text",label:"IP Адрес",name:"ip",required:!0},{view:"button",label:"Перезагрузить и настроить",click:function(){var t=$$("provisioning-form").getValues();webix.ajax().post("/phones/provisioning/start",{ip:t.ip,mac:e.mac}).then(function(e){})}}]}};webix.ui(t).show()}else webix.message({type:"error",text:"Выберите телефон для настройки"})}},{view:"button",type:"icon",icon:"fa fa-trash",id:"removePhone",width:150,label:"Удалить",click:function(){$$("phones").getSelectedId()?webix.guiutils.removeFromTable(parseInt($$("phones").getSelectedId()),"/phones/"+parseInt($$("phones").getSelectedId())+"/remove","phones","removePhone"):webix.message({type:"error",text:"Выберите телефон для удаления"})},on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var t=$$("phones").getSelectedItem().id,i="/phones/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?(o.id=0,console.log(o),e.PhonesWindow.show(o)):webix.message({type:"error",text:"Выберите телефон для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){e.PhonesWindow.loadTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("phones"),{filterHTML:!0,filename:"Телефоны"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.loadData=function(){var e=this;this.setToolBar(),webix.AppFilter.hide(),webix.extend($$("phones"),webix.ProgressBar),this.loaded||$$("phones").load("/phones/list","json",function(){e.loaded=1})},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"PhonesWindow",function(){return r});var r=function(){function e(){o(this,e),this.id="window-phone"}return e.prototype.getFormValues=function(){var e=$$("form-phone");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/"+e.id+"/save",e).then(function(e){$$("form-phone").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-phone").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-phone").enable())})},e.prototype.loadTable=function(){webix.guiutils.loadTable("phones","/phones/list")},e.prototype.closeWindow=function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("window-phone").close()}})},e.prototype.hide=function(){$$("window-phone").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),i={view:"form",id:"form-phone",scroll:!0,autoheight:!0,elements:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{cols:[{paddingX:17,view:"text",label:"Номер телефона",name:"phone",required:!0},{view:"text",label:"Внешний номер по умолчанию",name:"default_phone"}]},{view:"combo",label:"Модель",id:"phone_model",name:"model",options:"./assets/options/models.json"},{view:"text",label:"MAC-адрес",name:"mac"},{view:"combo",label:"Пользователь",name:"user_id",options:"/groups/users/short"},{cols:[{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"}]},{cols:[{view:"combo",label:"Правила набора",name:"rules",suggest:"/config/extensions",filter:function(e,t){return-1!==e.value.indexOf(t)}},{view:"combo",label:"Группа",name:"group_id",options:{body:{url:"/phones/groups/list/short",template:"#name#"}}}]},{cols:[{},{view:"switch",labelRight:"Включено",labelWidth:120,labelPosition:"top",name:"active",id:"active",width:150}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10},rules:{password:function(t){return!!e.id||t.length>0},user_id:function(e){return"erpico"!=$$("phone_model").getValue()||e.length}}},o={id:"window-phone",view:"window",position:"center",move:!0,modal:!0,resize:!0,scroll:!0,height:530,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close",click:function(){t.closeWindow()}}]},body:{padding:17,rows:[i,{margin:10,cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]}};webix.ui(o).show(),$$("form-phone").setValues(e)},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("queues",this)}return e.prototype.roleAllowed=function(){return["phc.admin","erpico.admin"]},e.prototype.getView=function(){var e=0;return{hidden:!0,id:"queues",view:"datatable",resizeColumn:!0,resizeRow:!0,scroll:!0,navigation:!0,select:!0,css:"my_style",columns:[{id:"active",header:"",width:30,template:function(e){return 1==e.active?"<span class='greencircle'></span>":"<span class='graycircle'></span>"},footer:{content:"summTotal",colspan:2}},{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Код"},{content:"serverFilter"}],fillspace:1},{id:"fullname",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"url",header:[{text:"URI"},{content:"serverFilter"}],fillspace:1},{id:"close_on_hangup",header:[{text:"Закрытие страницы после обработки "},{content:"serverFilter"}],fillspace:1,template:function(e){var t="";switch(e.close_on_hangup){case"1":t+="Да";break;case"2":t+="Нет";break;case"3":t+="10 сек";break;case"4":t+="60 сек";break;case"5":t+="5 мин";break;case"6":t+="10 мин"}return t}},{id:"sl",header:[{text:"SL"},{content:"serverFilter"}],fillspace:1},{id:"viq",header:[{text:"Приоритетная очередь"},{content:"serverRichSelectFilter"}],fillspace:1,options:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]},{id:"service_id",header:[{text:"Сервис"},{content:"serverFilter"}],fillspace:1},{id:"pattern",header:[{text:"Шаблон"},{content:"serverFilter"}],fillspace:1,options:"/config/queues"},{id:"agents",header:["Операторы",""],fillspace:3,template:function(e){var t="";return Array.isArray(e.agents)&&e.agents.forEach(function(e){t.length>0&&(t+=", "),null!=e.name?t+=e.name:null!=e.phone?t+=e.phone:null!=e.acl_user_id&&(t+="id"+e.acl_user_id)}),t}},{id:"hidden",header:[{text:"Скрытая"},{content:"serverRichSelectFilter"}],fillspace:1,options:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]}],on:{onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)},onAfterSelect:function(){e=this.getSelectedId()},onItemDblClick:function(){var e=this.getSelectedItem();queuesWindow.show(e)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),$$("queues_toolbar").show(),$$("queues")&&(this.loaded||$$("queues").load("/queues/list","json",function(){e.loaded=1}))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(55),n=function(){function e(){o(this,e),this.loaded=0,this.PBXChannelsWindow=new r.default,this.toolBarId="channels_toolbar",webix.Manager.setComponent("channels",this)}return e.prototype.roleAllowed=function(){return["phc.admin","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getGreed=function(){var e=0;return{hidden:!0,id:"channels",view:"datatable",resizeColumn:!0,resizeRow:!0,scroll:!0,navigation:!0,select:!0,css:"my_style",columns:[{id:"active",header:"",width:30,template:function(e){return 1==e.active?"<span class='greencircle'></span>":"<span class='graycircle'></span>"},footer:{content:"summTotal",colspan:2}},{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Код"},{content:"serverFilter"}],fillspace:1},{id:"fullname",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"provider",header:[{text:"Провайдер"},{content:"serverFilter"}],fillspace:1,options:"/config/sip"},{id:"login",header:[{text:"Логин"},{content:"serverFilter"}],fillspace:1},{id:"phone",header:[{text:"Номер телефона"},{content:"serverFilter"}],fillspace:1},{id:"host",header:[{text:"Адрес сервера"},{content:"serverFilter"}],fillspace:1},{id:"port",header:[{text:"Порт"},{content:"serverFilter"}],fillspace:1},{id:"rules",header:[{text:"Правила обработки"},{content:"serverFilter"}],fillspace:1,options:"/config/extensions"}],on:{onItemDblClick:function(){var e=this.getSelectedItem();this.PBXChannelsWindow.show(e)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)},onAfterSelect:function(){e=this.getSelectedId()}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getView=function(){return this.getGreed()},e.prototype.getToolBar=function(){var e=this.getThis();return{id:"channels_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-plus",width:150,label:"Добавить",click:function(){e.PBXChannelsWindow.show({})}},{view:"button",type:"icon",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("channels").getSelectedId()?e.PBXChannelsWindow.show($$("channels").getSelectedItem()):webix.message({type:"error",text:"Выберите телефон для редактирования"})}},{css:"last-button-on-left-position",view:"button",type:"icon",icon:"fa fa-trash",id:"removeChannel",width:150,label:"Удалить",click:function(){$$("channels").getSelectedId()?webix.guiutils.removeFromTable(parseInt($$("channels").getSelectedId()),"/channels/"+parseInt($$("channels").getSelectedId())+"/remove","channels","removeChannel"):webix.message({type:"error",text:"Выберите канал для удаления"})},on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}}},{view:"button",css:"last-button-on-left-position",type:"icon",icon:"fa fa-copy",width:150,label:"Копировать",click:function(){var t=$$("channels").getSelectedItem().id,i="/channels/list?filter[id]="+t,o=null;webix.ajax(i).then(function(e){o=e.json().data[0]}).then(function(){o?(o.id=0,e.PBXChannelsWindow.show(o)):webix.message({type:"error",text:"Выберите rfyfk для копирования"})})}},{},{css:"disable_margin_btn_tbar",view:"button",type:"icon",icon:"fa fa-sync",width:56,click:function(){e.PBXChannelsWindow.loadTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("channels"),{filterHTML:!0,filename:"Каналы"})}}]}},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),this.setToolBar(),$$("channels")&&(webix.extend($$("channels"),webix.ProgressBar),this.loaded||this.PBXChannelsWindow.loadTable(function(){e.loaded=1}))},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e)}return e.prototype.getFormValues=function(){var e=$$("form-channels");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.getCode=function(e,t){if(!e)return!1;$$("channelName").disable(),$$("channelName").showProgress(),webix.ajax().get("/channels/code",{name:e}).then(function(e){e=e.json(),$$("channelName").hideProgress(),$$("channelName").enable(),e.result&&t&&t(e)})},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/channels/"+e.id+"/save",e).then(function(e){$$("form-channels").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-channels").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-channels").enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),$$("form-channels").enable(),console.log(e)})},e.prototype.loadTable=function(e){webix.guiutils.loadTable("channels","/channels/list",e)},e.prototype.closeWindow=function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("window-channels").close()}})},e.prototype.hide=function(){$$("window-channels").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),i={view:"form",id:"form-channels",scroll:!0,autoheight:!0,elements:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"fullname",keyPressTimeout:500,required:!0},{view:"text",label:"Код",name:"name",id:"channelName",required:!0,on:{onFocus:function(){var e=$$("form-channels").getValues();e.name||t.getCode(e.fullname,function(t){e.name=t.message,$$("form-channels").setValues(e)})}}}]},{view:"text",label:"Номер телефона",name:"phone",marginX:0},{cols:[{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"}]},{view:"combo",label:"Провайдер",name:"provider",options:"/config/sip"},{view:"combo",label:"Правила обработки",name:"rules",suggest:"/config/extensions",filter:function(e,t){return-1!==e.value.indexOf(t)}},{cols:[{view:"text",label:"Адрес сервера",name:"host"},{view:"text",label:"Порт",name:"port",width:100,pattern:{mask:"##########################",allow:/[0-9]/g},validate:function(e){return e.length}}]},{cols:[{},{view:"switch",labelRight:"Включено",labelWidth:120,labelPosition:"top",name:"active",id:"active",width:150}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10},rules:{password:function(t){return!!e.id||t.length>0}}},o={id:"window-channels",view:"window",position:"center",move:!0,modal:!0,resize:!0,scroll:!0,height:530,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  канал",align:"left"},{view:"icon",icon:"wxi-close",click:function(){t.closeWindow()}}]},body:{padding:17,rows:[i,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]},on:{onShow:function(){webix.extend($$("channelName"),webix.ProgressBar)}}};webix.ui(o).show(),$$("form-channels").setValues(e)},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){var t=$$("scripts_lst").getValue();if(!t)return void webix.message({type:"error",text:"Выберите скрипт"});var i=$$("script_stages").getSelectedId(!1),o=e.id?e.id:0;if(!i)return void webix.message({type:"error",text:"Выберите этап скрипта перед добавление элементов этапа скрипта."});webix.ui({id:"add_script_element_win",view:"window",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:o?"Изменение элемента этапа скрипта":"Добавление элемент этапа скрипта"},{view:"icon",icon:"wxi-close",click:"$$('add_script_element_win').close();"}]},resize:!0,width:700,height:500,center:!0,position:"center",modal:!0,move:!0,body:{view:"form",id:"stage_elements_form",elements:[{view:"richselect",name:"type",label:"Тип",options:[{id:"button",value:"Кнопка"},{id:"text",value:"Текст"},{id:"webpage",value:"Веб-страница"},{id:"form",value:"Форма"},{id:"transfer",value:"Выбор сотрудника для переадресации"},{id:"sms",value:"Отправить SMS клиенту"},{id:"email",value:"Отправить Email клиенту"}],on:{onChange:function(e){switch($$("label").hide(),$$("action").hide(),$$("text").hide(),$$("url").hide(),$$("form_elements").hide(),$$("form_to").hide(),e){case"button":$$("label").show(),$$("action").show();break;case"text":$$("text").show();break;case"webpage":$$("url").show();break;case"form":$$("form_elements").show(),$$("form_to").show();break;case"sms":case"email":$$("text").show()}}}},{view:"text",name:"label",label:"Лейбл",id:"label",hidden:!0},{view:"nic-editor",config:{},label:"Текст",name:"text",id:"text",hidden:!0},{view:"text",name:"url",label:"URL",id:"url",hidden:!0},{view:"datatable",id:"form_elements",autowidth:!0,editable:!0,hidden:!0,height:200,columns:[{id:"name",header:"Название",width:250,editor:"text"},{id:"type",header:"Тип",width:80,editor:"select",options:[{id:"text",value:"Текст"}]},{id:"placeholder",header:"Подсказка",width:250,editor:"text"}],data:[{}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)},onBeforeContextMenu:function(e){webix.delay(function(){this.select(e)})}},ready:function(){}},{view:"text",id:"form_to",name:"form_to",label:"Email",hidden:!0},{hidden:!0,view:"richselect",name:"action",label:"Действие",id:"action",options:[{id:"jump",value:"Переход к другому скрипту"},{id:"next",value:"Переход к другому блоку"},{id:"transfer",value:"Переадресация вызова"},{id:"email",value:"Отправка Email"},{id:"sms",value:"Отправка SMS"}],on:{onChange:function(e){switch($$("action_script").hide(),$$("action_block").hide(),$$("action_text").hide(),$$("action_transfer").hide(),e){case"jump":$$("action_script").show();break;case"next":$$("action_block").show();break;case"transfer":$$("action_transfer").show();break;case"email":case"sms":$$("action_text").show()}}}},{view:"combo",label:"Скрипт",name:"action_script",id:"action_script",hidden:!0,options:"/legacy/ext/scripts/list"},{view:"combo",label:"Блок",name:"action_block",id:"action_block",hidden:!0,suggest:{body:{view:"tree",url:"/legacy/ext/scripts/liststages/"+t}}},{view:"textarea",label:"Текст",name:"action_text",id:"action_text",height:"400",hidden:!0},{view:"text",label:"Номер",name:"action_transfer",id:"action_transfer",hidden:!0},{cols:[{view:"button",label:"Сохранить",click:function(){var e=$$("stage_elements_form");if(e.validate()){e.disable();var t=e.getValues();t.stage_id=i,o&&(t.id=o),"form"==t.type&&(t.form=JSON.stringify($$("form_elements").serialize())),webix.ajax().post("/legacy/ext/scripts/save/stageelements",t,function(t,o,r){e.enable();var o=o.json();1==o.result?($$("add_script_element_win").close(),$$("script_elements").clearAll(),$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+i)):webix.message({type:"error",text:o.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!o,click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить элемент этапа "'+e.label+'"?',type:"confirm-error",callback:function(e){if(e){var t={id:o,delete:1};webix.ajax().post("/legacy/ext/scripts/save/stageelements",t,function(e,t,o){var t=t.json();1==t.result?($$("add_script_element_win").close(),$$("script_elements").clearAll(),$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+i)):webix.message({type:"error",text:t.message})})}}})}}]}],rules:{type:webix.rules.isNotEmpty,label:webix.rules.isNotEmpty,action:webix.rules.isNotEmpty,url:webix.rules.isNotEmpty,action_script:webix.rules.isNotEmpty,action_block:webix.rules.isNotEmpty,action_text:webix.rules.isNotEmpty,action_transfer:webix.rules.isNotEmpty}},on:{onShow:function(){$$("stage_elements_form").setValues(e),e.type&&"form"==e.type&&($$("form_elements").clearAll(),$$("form_elements").parse(e.form),0==$$("form_elements").count()&&$$("form_elements").add({}))}}}).show()}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("scripts",this)}return e.prototype.roleAllowed=function(){return["phc.admin","erpico.admin"]},e.prototype.getView=function(){return{id:"scripts",hidden:!0,type:"clean",rows:[{rows:[{cols:[{view:"organogram",id:"script_stages",borderless:!0,select:!0,scroll:"xy",data:[],on:{onSelectChange:function(){$$("script_elements").clearAll();var e=$$("script_stages").getSelectedId(!1);e&&$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+e)},onItemDblClick:function(e){$$("script_stages").getItem(e)}}},{view:"resizer"},{rows:[{type:"space",responsive:"e1",margin:0,padding:0,cols:[{view:"label",label:"<strong>Элементы этапа скрипта</strong>"},{view:"button",label:"Добавить",click:function(){r([])}},{view:"button",label:"Изменить",click:function(){var e=$$("script_elements").getSelectedId();if(e){var t=$$("script_elements").getItem(e);t&&r(t)}else webix.message({type:"error",text:"Выберите элемент этапа скрипта для редактирования."})}}]},{id:"script_elements",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"id",header:[{text:""}],template:"{common.treetable()} #value#",width:50},{id:"type",header:[{text:"Тип"}],width:150},{id:"label",header:[{text:"Содержимое"}],width:200}],on:{onItemDblClick:function(e,t,i){}}}]}]}]}]}},e.prototype.loadData=function(){webix.AppFilter.hide(),$$("scripts_toolbar").show()},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("phones_groups",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.getView=function(){var e=0;return{hidden:!0,id:"phones_groups",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!1,navigation:!0,select:!0,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"code",header:[{text:"Код"},{content:"serverFilter"}]},{id:"pattern",header:[{text:"Шаблон"},{content:"serverFilter"}],fillspace:1,options:"/config/sip"},{id:"rules",header:[{text:"Правила набора"},{content:"serverFilter"}],fillspace:1,options:"/config/extensions"},{id:"outgoing_phone",header:[{text:"Исходящий номер"},{content:"serverFilter"}],fillspace:1},{id:"phones_names",header:[{text:"Телефоны в группе"},{content:"serverMultiComboFilter"}],fillspace:1}],on:{onItemDblClick:function(){var e=this.getSelectedItem();phonesGroupsWindow.show(e)},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}}}},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),$$("phones_groups")&&(webix.extend($$("phones_groups"),webix.ProgressBar),this.loaded||$$("phones_groups").load("/phones/groups/list","json",function(){e.loaded=1})),$$("phones_groups_toolbar").show()},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("extended_calls",this),this.dst_change="",this.src_change="",this.optionsWindowId="win_option_cdr_report",this.toolBarId="extended_calls_toolbar",this.filterId="extended_calls_filter",this.id="extended_calls"}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.prototype.getGrid=function(){return{id:"extended_calls",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",multiselect:!0,navigation:!0,css:"my_style",columns:[{id:"calldate",header:[{text:translate("Date"),height:25},{content:"textFilter",height:40}],sort:"string",width:180,template:"#calldate2#",footer:{text:translate("Total:"),colspan:2,height:30}},{id:"fullname",header:[{text:translate("Staffer")},{content:"selectFilter"}],sort:"string",width:160},{id:"src",header:[{text:translate("Source")},{content:"textFilter"}],sort:"string",width:155,footer:{content:"avgColumn"}},{id:"dst",header:[{text:translate("Dialed number")},{content:"textFilter"}],sort:"string",width:155},{id:"status",header:[{text:translate("Status")},{content:"selectFilter"}],sort:"string",width:120,template:"<span class='state #disposition#'>#status#</span>"},{id:"ratesec",header:[{text:translate("Duration")},{content:"textFilter"}],sort:"string",width:140},{id:"channel",header:[{text:translate("Канал 1")},{content:"textFilter"}],sort:"string",width:200},{id:"dstchannel",header:[{text:translate("Канал 2")},{content:"textFilter"}],sort:"string",width:200}],data:[],ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getTraffic=function(){return{id:"extended_calls_trafic",rows:[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>"+translate("Traffic for period")+"</center>"}]},{id:"cdr_report_trafic",view:"datatable",height:75,navigation:!0,resizeColumn:!0,resizeRow:!0,css:"my_style",columns:[{id:"1",header:[{text:translate("Duration"),height:25}],width:180},{id:"2",header:[{text:translate("Calls")}],width:180},{id:"3",header:[{text:"ACD, "+translate("min")}],width:180},{id:"4",header:["ASR, %"],width:180},{id:"5",header:[{text:"PDD, "+translate("sec")}],width:180}],data:[],ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.loadReport=function(){$$("extended_calls").enable(),$$("cdr_report_trafic").enable(),$$("extended_calls").getFilter("calldate").value="",$$("extended_calls").getFilter("fullname").value="",$$("extended_calls").getFilter("src").value="",$$("extended_calls").getFilter("dst").value="",$$("extended_calls").getFilter("status").value="",$$("extended_calls").getFilter("ratesec").value="";var e=webix.guiutils.getDateRange("reportDateRange"),t=e.end,i=e.start,o="extended_calls/list",r="?filter[t1]="+i+"&filter[t2]="+t;""!=$$("srcFilters").getValue()&&(r+="&filter[src]="+$$("srcFilters").getValue()),""!=$$("dstFilters").getValue()&&(r+="&filter[dst]="+$$("dstFilters").getValue()),$$("cdr_report_trafic").showProgress({type:"icon",hide:!0}),$$("extended_calls").showProgress({type:"icon",hide:!0}),$$("extended_calls").clearAll(),$$("cdr_report_trafic").clearAll(),$$("extended_calls").load(o+r,"json",function(){$$("extended_calls").hideProgress({type:"icon",hide:!0})}),$$("cdr_report_trafic").load(o+"/trafic"+r,"json",function(){$$("cdr_report_trafic").hideProgress({type:"icon",hide:!0})})},e.prototype.getToolBar=function(){var e=this;return{id:this.getThis().toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{id:"search",view:"button",type:"icon",icon:"wxi-search",width:200,label:translate("Show report"),click:function(){e.loadReport()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:translate("Export to Excel"),click:function(){var e=webix.guiutils.getDateRange("reportDateRange");webix.toExcel($$("extended_calls"),{filterHTML:!0,filename:"Расширенные звонки с "+e.end+" по "+e.start})}}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getView=function(){return{id:this.id,rows:[this.getGrid(),this.getTraffic()]}},e.prototype.loadData=function(){var e=this;this.setToolBar(),$$("extended_calls")&&($$("extended_calls_trafic").show(),webix.AppFilter.show(),$$("defaultsForTraffic").show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.loadReport()}),webix.AppFilter.setReset(function(){webix.AppFilter.resetDefaultTraffic()}),webix.extend($$("extended_calls"),webix.ProgressBar),webix.extend($$("cdr_report_trafic"),webix.ProgressBar),this.loaded||(webix.AppFilter.submit(),this.loaded=1))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){o(this,e),this.loaded=0,webix.Manager.setComponent("extended_contact_calls",this),this.toolBarId="extended_contact_calls_toolbar",this.filterId="extended_contact_calls_filter",this.id="extended_contact_calls"}return e.prototype.roleAllowed=function(){return["phc.reports","erpico.admin"]},e.prototype.getThis=function(){return this},e.filterBySecondsCompare=function(e,t){console.log(e),console.log(t)},e.filterGridBySecond=function(e,t,i){var o=e.split(":");if(o&&o[0]&&o[1]){var r=o[1],n=o[0],a=60*n+r;return a>=t&&a<=i}return!1},e.prototype.getGrid=function(){return{id:"extended_contact_calls",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"calldate",header:[{text:translate("Date"),height:25}],sort:"date",width:180,template:"#calldate2#",footer:{text:translate("Total:"),height:30}},{id:"queue",header:[{text:translate("Queue"),content:"excelFilter",mode:"text"}],sort:"string",width:130,footer:{content:"avgColumn"}},{id:"agentname",header:[{text:translate("Agent"),content:"excelFilter",mode:"text"}],sort:"string",width:160},{id:"agent",header:[{text:translate("Agent name"),content:"excelFilter",mode:"text"}],sort:"string",width:155},{id:"src",header:[{text:translate("Source"),content:"excelFilter",mode:"text"}],sort:"string",width:155,footer:{text:translate("Average:")}},{id:"holdtime",header:[{text:translate("Waiting time"),content:"excelFilter",filterConfig:webix.guiutils.timeFilterConfig()}],sort:"int",width:155,footer:{content:"avgTime"},template:function(e){return webix.guiutils.formatTime(e.holdtime)}},{id:"talktime",header:[{text:translate("Talktime"),content:"excelFilter",filterConfig:webix.guiutils.timeFilterConfig()}],sort:"int",width:150,footer:{content:"avgTime"},template:function(e){return webix.guiutils.formatTime(e.talktime)}},{id:"ringtime",header:[{text:translate("Ringtime"),content:"excelFilter",filterConfig:webix.guiutils.timeFilterConfig()}],sort:"int",width:150,footer:{content:"avgTime"},template:function(e){return webix.guiutils.formatTime(e.ringtime)}},{id:"position",header:[{text:translate("Position"),content:"excelFilter",mode:"text"}],sort:"int",width:140},{id:"status",header:[{text:translate("Reason of completing"),content:"excelFilter",mode:"text"}],sort:"int",width:185,template:"<span class='state #reason#'>#status#</span>"},{id:"channel",header:[{text:translate("Канал"),content:"excelFilter",mode:"text"}],sort:"string",width:200},{id:"uid",header:[{text:translate("UID"),content:"excelFilter",mode:"text"}],sort:"string",width:200}],data:[],on:{onBeforeFilter:function(){this.showProgress()},onAfterFilter:function(){this.hideProgress()}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.getReportData=function(){$$("extended_contact_calls").enable(),$$("extended_contact_calls").filter();var e=webix.guiutils.getDateRange("reportDateRange"),t="/extended_contact_calls/list?filter[t1]="+e.start+"&filter[t2]="+e.end;""!=$$("srcFilters").getValue()&&(t+="&filter[src]="+$$("srcFilters").getValue()),""!=$$("filterReports").getValue()&&(t+="&filter[filter]="+$$("filterReports").getValue()),$$("extended_contact_calls").clearAll(),$$("extended_contact_calls").load(t,"json",function(){$$("extended_contact_calls").showProgress({type:"icon",hide:!0})})},e.prototype.getToolBar=function(){var e=this.getThis();return{id:"extended_contact_calls_toolbar",css:"top-menu-right-item",hidden:!0,cols:[{responsive:"extended_contact_calls_toolbar",cols:[{id:"search_contact_cdr_report",view:"button",type:"icon",icon:"wxi-search",width:200,label:translate("Show report"),click:function(){e.getReportData()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:translate("Export to Excel"),click:function(){var e=webix.guiutils.getDateRange("reportDateRange");webix.toExcel($$("extended_contact_calls"),{columns:{date:{template:function(e){return e.calldate},header:"Дата"},queue:{template:function(e){return e.queue},header:"Очередь"},agentname:{template:function(e){return e.agentname},header:"Агент"},agent:{template:function(e){return e.agent},header:"Имя агента"},src:{template:function(e){return e.src},header:"Источник"},holdtime:{template:function(e){return webix.guiutils.formatTime(e.holdtime)},header:"Время ожидания"},talktime:{template:function(e){return webix.guiutils.formatTime(e.talktime)},header:"Время разговора"},ringtime:{template:function(e){return webix.guiutils.formatTime(e.ringtime)},header:"Время ответа"},position:{template:function(e){return e.position},header:"Позиция"},status:{template:function(e){return e.status},header:"Причина завершения"},channel:{template:function(e){return e.channel},header:"Канал"},uid:{template:function(e){return e.uid},header:"UID"}},filterHTML:!0,filename:"Расширенные входящие с "+e.end+" по "+e.start})}}]}]}},e.prototype.setToolBar=function(){$$(this.toolBarId)||$$("top-menu").addView(this.getToolBar(),5),$$("reportDateRange").show(),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show()},e.prototype.getView=function(){return{rows:[this.getGrid()]}},e.prototype.loadData=function(){var e=this;this.setToolBar(),$$("extended_contact_calls")&&(webix.AppFilter.show(),webix.AppFilter.setBody(this.id,{id:this.filterId}),webix.AppFilter.setSubmit(function(){e.getReportData()}),webix.AppFilter.setReset(function(){webix.AppFilter.resetDefaultTraffic()}),$$("defaultsForTraffic").show(),$$("dstFilters").hide(),$$("defaultsForReports").show(),$$("queueReports").hide(),$$("filterReports").show(),webix.extend($$("extended_contact_calls"),webix.ProgressBar),this.loaded||(webix.AppFilter.submit(),this.loaded=1))},e}();t.default=r},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(61),n=function(){function e(){o(this,e),this.loaded=0,this.toolBarId="blacklist_toolbar",webix.Manager.setComponent("blacklist",this)}return e.prototype.roleAllowed=function(){return["erpico.admin"]},e.prototype.loadData=function(){var e=this;webix.AppFilter.hide(),this.setToolBar(),$$("blacklist")&&!this.loaded&&$$("blacklist").load("/blacklist","json",function(){e.loaded=1})},e.prototype.getToolBar=function(){return{id:this.toolBarId,css:"top-menu-right-item",hidden:!0,cols:[{css:"last-button-on-left-position",view:"button",type:"icon",icon:"wxi-plus-circle",width:240,label:"Добавить в черный список",click:function(){$$("blacklist").unselectAll(),this.$scope.ui(r.BlacklistWindow).showWindow(this.$scope.$view)}},{},{view:"button",type:"icon",icon:"fa fa-sync",width:56,css:"disable_margin_btn_tbar",click:function(){webix.guiutils.loadBlacklistTable()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:206,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("blacklist"),{filterHTML:!0,filename:"Blacklist"})}}]}},e.prototype.setToolBar=function(){$$("top-menu").addView(this.getToolBar(),5),this.showToolBar()},e.prototype.showToolBar=function(){$$(this.toolBarId).show(),$$("reportDateRange").hide()},e.prototype.init=function(){this.win2=this.ui(WindowsView)},e.prototype.getView=function(){var e=0;return{id:"blacklist",view:"datatable",hidden:!0,resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,tooltip:!0,fixedRowHeight:!1,css:"my_style",yCount:0,autoConfig:!0,columns:[{id:"id",header:[{text:"ID"},{content:"serverFilter"}],width:50},{id:"phone",header:[{text:"Номер телефона"},{content:"serverFilter"}],fillspace:1},{id:"comment",header:[{text:"Описание"},{content:"serverFilter"}],fillspace:1},{id:"action",header:[{text:"Действие"},{content:"serverSelectFilter",options:r.BlacklistWindow.userStates}],width:200},{id:"message",header:[{text:"Сообщение перед сбросом"},{content:"serverFilter"}],fillspace:1},{id:"number",header:[{text:"Номер для перевода"},{content:"serverFilter"}],fillspace:1}],ready:function(){webix.extend(this,webix.ProgressBar),$$("cmenu")||webix.ui({view:"contextmenu",width:180,id:"cmenu",data:[{id:"edit",value:"Изменить",icon:"wxi-pencil"},{id:"delete",value:"Удалить",icon:"wxi-trash"}],on:{onMenuItemClick:function(e){switch(e){case"edit":var t=$$("blacklist").$scope.ui(r.BlacklistWindow);t&&t.showWindow();break;case"delete":var i=$$("blacklist").getSelectedId();i?webix.guiutils.removeFromTable(parseInt(i),"/blacklist/"+parseInt(i)+"/remove","blacklist",function(){webix.guiutils.loadBlacklistTable()}):webix.message({type:"error"})}}}}),$$("cmenu").attachTo(this)},on:{onItemDblClick:function(){var e=this.$scope.ui(r.BlacklistWindow);e&&e.showWindow(this.$scope.$view)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)},onAfterSelect:function(){e=this.getSelectedId()},onAfterContextMenu:function(e){e.row&&$$("blacklist").select(e.row)}}}},e}();t.default=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"BlacklistWindow",function(){return l});var a=i(0),s=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),l=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){var e=this.getThis();return{view:"window",id:"add-win-blacklist",position:"center",maxWidth:700,css:"window-label-left",resize:!1,move:!0,modal:!0,borderless:!0,head:{height:450,minHeight:450,width:700,borderless:!0,rows:[{elementsConfig:{labelWidth:100},view:"form",id:"add-form-blacklist",scroll:!0,minHeight:450,height:390,borderless:!0,elements:[{cols:[{view:"tabview",borderless:!0,tabbar:{optionWidth:180},cells:[{id:"settings",header:"Данные номера",body:{padding:17,minHeight:450,width:700,rows:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"phone",label:"Телефон",inputAlign:"left",labelWidth:150,required:!0,width:650,placeholder:"Введите телефон"},{view:"select",name:"action",id:"blacklist.action",label:"Действие",inputAlign:"left",labelWidth:150,required:!0,width:650,placeholder:"Выберите действие",options:t.userStates,on:{onChange:function(e){}}},{view:"text",name:"comment",label:"Описание",inputAlign:"left",labelWidth:150,width:650,placeholder:"Введите описание"},{view:"text",name:"message",id:"blacklist.message",label:"Сообщение",inputAlign:"left",labelWidth:150,width:650,placeholder:"Введите сообщение перед сбросом"},{view:"text",id:"blacklist.number",name:"number",label:"Номер",inputAlign:"left",labelWidth:150,width:650,placeholder:"Введите номер для перевода"}]}}],on:{onBeforeTabClick:function(e){}}},{rows:[{view:"icon",icon:"wxi-close",css:"window_close",click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("add-win-blacklist").close()}})}}]}]}],rules:{}},{padding:17,margin:10,cols:[{css:"custom_trash_button",view:"button",label:"Удалить",type:"icon",hidden:!$$("blacklist").getSelectedItem(),align:"center",width:110,icon:"wxi-trash",click:function(){webix.confirm({text:"Удалить номер <br> Продолжить?",callback:function(e){if(e){var t=$$("add-form-blacklist"),i=t.getValues();t.disable(),t.showProgress(),webix.ajax().post("/blacklist/"+i.id+"/remove",i).then(function(e){e=e.json(),e.result?(webix.guiutils.loadBlacklistTable(),webix.message({type:"success",text:e.message}),webix.$$("add-win-blacklist").close()):webix.message({type:"error",text:e.message})}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),console.error(e)}).finally(function(){t.enable(),t.hideProgress()})}}})}},{},{css:"optional_btn",view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("add-win-blacklist").close()}})}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("add-form-blacklist");if(e.validate()){e.disable(),e.showProgress();var t=e.getValues(),i=JSON.stringify({action:t.action,number:"transfer"==t.action?t.number:"",message:t.message}),o={id:t.id,phone:t.phone,comment:t.comment,action:i};webix.ajax().post(0!=o.id?"/blacklist/"+o.id+"/update":"/blacklist/add",o).then(function(t){e.enable(),t=t.json(),t.result?(webix.guiutils.loadBlacklistTable(),webix.message({type:"success",text:t.message}),webix.$$("add-win-blacklist").close()):webix.message({type:"error",text:t.message})}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),console.error(e)}).finally(function(){e.enable(),e.hideProgress()})}else webix.message({type:"error",text:"Заполните обязательные поля"})}}]}]},body:{height:1},on:{onShow:function(){webix.extend($$("add-form-blacklist"),webix.ProgressBar);var t=$$("blacklist").getSelectedItem();t&&t.id&&(e.setId(t.id),t.action=e.setEngAction(t.action),$$("add-form-blacklist").setValues(t),t.action=e.setRuAction(t.action))}}}},t.prototype.getThis=function(){return this},t.prototype.getId=function(){return this.clientId},t.prototype.setId=function(e){this.clientId=e},t.prototype.showWindow=function(){this.getRoot().show()},t.prototype.setRuAction=function(e){return"disconnect"==e?e="Сброс":"transfer"==e&&(e="Перевод"),e},t.prototype.setEngAction=function(e){return"Сброс"==e?e="disconnect":"Перевод"==e&&(e="transfer"),e},s(t,null,[{key:"userStates",get:function(){return[{id:"disconnect",value:"Сброс"},{id:"transfer",value:"Перевод"}]}}]),t}(a.b)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var o=function(){function e(){this.webixJet=!0,this._id=webix.uid(),this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id);for(var i in this._subs){var o=this._subs[i].view;o&&o.destructor()}this._events=this._container=this.app=this._parent=null},e.prototype.setParam=function(e,t,i){this._data[e]!==t&&(this._data[e]=t,this.app.callEvent("app:paramchange",[this,e,t,i])&&i&&this.show((o={},o[e]=t,o)));var o},e.prototype.getParam=function(e,t){var i=this._data[e];if(void 0!==i||!t)return i;var o=this.getParentView();return o?o.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._url},e.prototype.render=function(e,t,i){var o=this;this._parent=i,t&&(this._index=t[0].index),this._init_url_data(t),e=e||document.body;var r="string"==typeof e?webix.toNode(e):e;return this._container!==r?(this._container=r,this._render(t).then(function(){return o.getRoot()})):this._urlChange(t).then(function(){return o.getRoot()})},e.prototype.getIndex=function(){return this._index},e.prototype.getId=function(){return this._id},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView(function(i){return(i.config.id===e||i.config.localId===e)&&i.$scope===t.$scope},"self")}return e},e.prototype.on=function(e,t,i){var o=e.attachEvent(t,i);return this._events.push({obj:e,id:o}),o},e.prototype.contains=function(e){for(var t in this._subs){var i=this._subs[t].view;if(i===e||i.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:this._parent?this._parent.getSubViewInfo(e):null},e.prototype.getName=function(){return this._name},e.prototype._init_url_data=function(e){e&&e[0]&&(this._data={},webix.extend(this._data,e[0].params,!0)),this._url=e},e}()},function(e,t,i){"use strict";function o(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),i=[],o=0;o<t.length;o++){var r=t[o],n={},a=r.indexOf(":");if(-1===a&&(a=r.indexOf("?")),-1!==a)for(var s=r.substr(a+1).split(/[\:\?\&]/g),l=0,c=s;l<c.length;l++){var d=c[l],u=d.split("=");n[u[0]]=decodeURIComponent(u[1])}i[o]={page:a>-1?r.substr(0,a):r,params:n,index:o+1}}return i}function r(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i];t.push("/"+r.page);var a=n(r.params);a&&t.push("?"+a)}return t.join("")}function n(e){var t=[];for(var i in e)t.length&&t.push("&"),t.push(i+"="+encodeURIComponent(e[i]));return t.join("")}t.a=o,t.b=r},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var o=i(90),r=i.n(o),n=function(){function e(e,t){var i=this;this.config=t||{},this._prefix=this.config.routerPrefix,void 0===this._prefix&&(this._prefix="!");var o=function(e){};r()(this._prefix+"*",function(){return i._lastUrl="",o(i.get())}),o=e}return e.prototype.set=function(e,t){if(this.config.routes){var i=e.split("?",2);for(var o in this.config.routes)if(this.config.routes[o]===i[0]){e=o+(i.length>1?"?"+i[1]:"");break}}this._lastUrl=e,r.a.navigate(this._prefix+e,t)},e.prototype.get=function(){var e=this._lastUrl||(window.location.hash||"").replace("#"+this._prefix,"");if(this.config.routes){var t=e.split("?",2),i=this.config.routes[t[0]];i&&(e=i+(t.length>1?"?"+t[1]:""))}return e},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(2),l=i(3),c=i(5),d=i(8),u=i(9),h=i(10),p=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{css:"top-menu",cols:[{view:"button",type:"icon",icon:"fa fa-bars",align:"left",css:"app_button menu-burger-button",click:function(){$$("sidebar").toggle(),$$("sidebar").getState().collapsed?$$("logobox").hide():$$("logobox").show()}},{type:"header",borderless:!0,height:56,width:152,id:"logobox",template:"<img src='./assets/imgs/logo.png' valign='middle' class='logo' style=\"margin-left: -18px;\"><font class='logo_text' style=\"vertical-align: middle; font-weight: bold;\" > PBX</font>"},{view:"template",id:"app:title",template:"#title#",css:"pbx-title",autowidth:!0},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",id:"phoneExcelButton",hidden:!1,click:function(){webix.toExcel($$("phone"),{filterHTML:!0,filename:"Телефоны"})}},{id:"operators_work_report_toolbar",hidden:!0,cols:[{id:"search_operators_work_report",view:"button",type:"icon",icon:"wxi-search",width:200,label:"Показать отчет",click:function(){webix.guiutils.contact_operators_work_report_refresh()}},{view:"button",type:"icon",icon:"fa fa-file-excel",width:200,label:"Выгрузить в Excel",click:function(){webix.toExcel($$("operators_work_report"),{filterHTML:!0,filename:"Operators"})}},{}]},l.default,c.default,groups_toolbar,d.default,u.default,h.default,{},{height:56,id:"person_template",css:"header_person",borderless:!0,width:200,template:function(e){var t="<div style='height:80%;width:80%;margin-top:0;float: right;' onclick='webix.$$(\"profilePopup\").show(this)'>";return t+="<img class='photo' src='./assets/imgs/photos/4.png' width='30' /><span class='name'>"+webix.auth.getFullname()+"</span>",t+="<span class='webix_icon wxi-angle-down'></span></div>"}}]}},t.prototype.init=function(){this.win2=this.ui(s.default)},t}(a.b);t.default=p},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"a",function(){return n});var r=i(15),n=function(){function e(){o(this,e),this.token=0,this.name="unauth",this.fullname="Не авторизован",this.tokenFromGet=webix.guiutils.getUrlParameter("token"),this.OptionWindow=new r.OptionWindow}return e.prototype.authUser=function(e){var t=this;webix.ui({view:"window",id:"loginWindow",css:"login_window",fullscreen:!0,borderless:!0,modal:!0,move:!0,head:{},body:{id:"loginForm",view:"form",borderless:!0,elements:[{rows:[{},{},{cols:[{},{width:430,height:160,id:"logobox",css:"logobox",align:"middle",borderless:!0,template:"<img src='../assets/imgs/erpico-logo-pbx.png' valign='middle' style=\"width: 100%\">"},{}]},{},{cols:[{},{},{view:"text",label:"Логин",value:"",name:"login",invalidMessage:"Укажите логин",id:"auth_login",height:96,width:390,inputWidth:390,inputHeight:60,css:"input_sign input_login",on:{onFocus:function(e){webix.html.addCss($$("auth_login").getNode(),"selected")}}},{},{}]},{cols:[{},{},{css:"input_sign ",cols:[{css:"input_sign input_password",view:"text",type:"password",label:"Пароль",name:"password",invalidMessage:"Укажите пароль",id:"auth_password",height:96,width:390,inputWidth:390,inputHeight:60,on:{onFocus:function(e){webix.html.addCss($$("auth_password").getNode(),"selected")}}}]},{},{}]},{cols:[{view:"label",label:"",inputWidth:390,height:70,align:"center",id:"message",css:"login_message"}]},{cols:[{},{},{view:"button",value:"Войти",hotkey:"enter",id:"auth_enter",height:86,width:390,click:function(){var i=$$("loginForm");i.disable();var o=i.getValues();webix.ajax().post("/auth/login",o,{error:function(e,t,i){webix.message({type:"error",text:e})},success:function(o,r,n){var a=r.json();if(i.enable(),!a||void 0===a.error)return void webix.message({type:"error",text:"Unknow error: "+o});0==a.error?($$("loginWindow")&&$$("loginWindow").close(),t.token=a.token,webix.storage.cookie.put("token",a.token),t.check(e)):$$("message").setValue("Неверный логин или пароль")}})}},{},{}]},{},{},{}]}]},on:{onShow:function(){}}}).show()},e.prototype.check=function(e){var t=this;if(!this.token&&!webix.storage.cookie.get("token")&&!t.tokenFromGet)return this.authUser(e);webix.ajax().get("/auth/info",{token:t.tokenFromGet},{error:function(e,t,i){webix.message({type:"error",text:e})},success:function(i,o,r){var n=o.json();if(!n||void 0===n.error)return void webix.message({type:"error",text:"Unknow error: "+i});n.error?t.authUser(e):(t.tokenFromGet&&webix.storage.cookie.put("token",t.tokenFromGet),t.roles=n.roles,t.name=n.name,t.fullname=n.fullname,e&&e())}})},e.prototype.logout=function(e){var t=this;webix.ajax().get("/auth/logout",{error:function(e,t,i){webix.message({type:"error",text:e})},success:function(e,i,o){var r=i.json();if(!r||void 0===r.error)return void webix.message({type:"error",text:"Unknow error: "+e});r.error?webix.message({type:"error",text:"Ошибка: "+r.message}):(t.token=0,webix.storage.cookie.put("token",""),document.location.reload())}})},e.prototype.settings=function(e){this.OptionWindow.showWindow()},e.prototype.getFullname=function(){return this.fullname},e.prototype.isAllowedRoles=function(e){return!webix.auth||!webix.auth.roles||webix.auth.roles.filter(function(t){return e.includes(t)}).length},e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=i(16),l=i(17),c=i(2),d=i(3),u=i(5),h=i(8),p=i(9),f=i(10),w=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{id:"menuBar",rows:[{css:"top-menu",id:"top-menu",cols:[{view:"button",type:"icon",icon:"fa fa-bars",width:48,align:"left",css:"app_button menu-burger-button",click:function(){$$("sidebar").toggle(),$$("sidebar").getState().collapsed?$$("logobox").hide():$$("logobox").show()}},{type:"header",borderless:!0,height:56,width:152,id:"logobox",template:"<img src='./assets/imgs/logo.png' valign='middle' class='logo' style=\"margin-left: -17px;\">"},{view:"template",id:"app:title",template:"",css:"pbx-title",width:1},{height:56,id:"person_template",css:"header_person top-menu-right-item",view:"button",width:64,borderless:!0,tooltip:webix.auth.getFullname(),template:function(e){var t="<div onclick='webix.win2.showPopup()'>";return t+="<img class='photo' src='./assets/imgs/photos/4.png' width='30' />",t+="</div>"}},d.default,u.default,h.default,p.default,f.default]},{cols:[{id:"menuCol",rows:[l.default]},{id:"filterCol",rows:[webix.AppFilter.getView()]},{id:"bodyCol",rows:[s.default]}]}]}},t.prototype.init=function(){webix.win2=this.ui(c.default),webix.uiForUseModals=this.ui},t}(a.b);t.default=w},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){var e=this;return{view:"popup",id:"langSelector",width:300,padding:0,css:"submenu_language",body:{type:"clean",borderless:!0,rows:[{view:"list",autoheight:!0,data:[{id:"en",value:"English"},{id:"ru",value:"Russian"}],type:{height:45,template:" <img class='flag' src='assets/imgs/photos/#id#.png' /><span class='text'>#value#</span>"},select:!0,on:{onSelectChange:function(){return e.toggleLanguage()}}}]},on:{onShow:function(){var e=this.$scope.app.getService("locale");this.queryView({view:"list"}).select(e.getLang())}}}},t.prototype.showWindow=function(){this.getRoot().show()},t.prototype.toggleLanguage=function(){var e=this.app.getService("locale"),t=this.getRoot().queryView({view:"list"}).getSelectedId();t!=e.getLang()&&(e.setLang(t),location.reload())},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"analysis_outgoing_calls_layout_1",view:"scrollview",batch:1,scroll:"y",body:{height:1120,rows:[{cols:[grouped_reports,{view:"resizer"},grouped_reports7]},{view:"resizer"},{cols:[grouped_reports6,{view:"resizer"},grouped_reports2]},{view:"resizer"},{cols:[grouped_reports5,{view:"resizer"},grouped_reports3]},{view:"resizer"},{cols:[grouped_reports4]}]}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{id:"call_recording_layout",rows:[{rows:[{id:"call_recording",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",footer:!0,navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Общее количество:",height:30}},{id:"call",header:[{text:"Звонки"},{content:"selectFilter"}],sort:"string",width:120},{id:"user",header:[{text:"Сотрудник"},{content:"serverFilter"}],sort:"string",width:230},{id:"src",header:[{text:"Источник"},{content:"serverFilter"}],sort:"string",width:155,footer:{text:"Общая продолжительность:",colspan:2,height:30}},{id:"dst",header:[{text:"Направление"},{content:"serverFilter"}],sort:"string",width:140},{id:"duration",header:[{text:"Длительность"},{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"size",header:[{text:"Размер, кбайт"},{content:"textFilter"}],sort:"int",width:140,footer:{content:"avgColumn"}}],disabled:!1,url:"/legacy/call_recording",ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{height:100,cols:[{id:"myplayer_call_recording",view:"datatable",scroll:!1,width:500,columns:[{id:"download",header:"",width:40,template:"<center><a target='_blank' href='#link'>#download#</center>",tooltip:"Скачать"},{id:"card",header:[{text:"Прослушать запись",height:30}],width:320}],data:[{download:"",name:"",card:""}]},{view:"checkbox",labelRight:"Автовоспроизведение",labelWidth:"auto",value:webix.storage.cookie.get("autoplay")?webix.storage.cookie.get("autoplay"):0,click:function(){var e=this.getValue();webix.storage.cookie.put("autoplay",e)}}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{type:"clean",rows:[{rows:[{id:"contact_cdr_report",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Всего:",height:30}},{id:"queue",header:[{text:"Очередь"},{content:"selectFilter"}],sort:"string",width:130,footer:{content:"avgColumn"}},{id:"agentname",header:[{text:"Агент"},{content:"selectFilter"}],sort:"string",width:160},{id:"agent",header:[{text:"Имя агента"},{content:"selectFilter"}],sort:"string",width:155},{id:"src",header:[{text:"Источник"},{content:"textFilter"}],sort:"string",width:155,footer:{text:"Среднее:"}},{id:"holdtime",header:[{text:"Время ожидания"},{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"talktime",header:[{text:"Время разговора"},{content:"textFilter"}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"ringtime",header:[{text:"Время ответа"},{content:"textFilter"}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"position",header:[{text:"Позиция"},{content:"textFilter"}],sort:"string",width:140},{id:"reason",header:[{text:"Причина завершения"},{content:"selectFilter"}],sort:"int",width:185},{id:"channel",header:[{text:"Канал"},{content:"textFilter"}],sort:"string",width:200},{id:"uid",header:[{text:"UID"},{content:"textFilter"}],sort:"string",width:200}],disabled:!1,url:"/legacy/contact_cdr_report",ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"PBXPhonesWindow",function(){return s});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.getFormValues=function(){var e=$$("form-phone");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},t.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/"+e.id+"/save",e).then(function(e){$$("form-phone").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-phone").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-phone").enable())})},t.prototype.loadTable=function(){webix.guiutils.loadTable("phones","/phones/list")},t.prototype.closeWindow=function(){webix.confirm({text:"Вы не сохранили изменения! <br> Продолжить?",callback:function(e){e&&webix.$$("window-phone").close()}})},t.prototype.hide=function(){$$("window-phone").close()},t.prototype.getThis=function(){return this},t.prototype.show=function(e){var t=this.getThis(),i={view:"form",id:"form-phone",padding:17,scroll:!0,elements:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Номер телефона",name:"phone",required:!0},{view:"combo",label:"Модель",id:"phone_model",name:"model",options:"./assets/options/models.json"},{view:"text",label:"MAC-адрес",name:"mac"},{view:"combo",label:"Пользователь",name:"user_id",options:"/groups/users/short"},{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"},{view:"combo",label:"Правила набора",name:"rules",suggest:"./assets/options/rules.json",filter:function(e,t){return-1!==e.value.indexOf(t)}},{view:"text",label:"Внешний номер по умолчанию",name:"default_phone"},{view:"combo",label:"Группа",name:"group_id",options:{body:{url:"/phones/groups/list/short",template:"#name#"}}},{cols:[{},{view:"button",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}},{}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top",margin:10},rules:{password:function(t){return!!e.id||t.length>0},user_id:function(e){return"erpico"!=$$("phone_model").getValue()||e.length}}},o={id:"window-phone",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:700,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close",click:function(){t.closeWindow()}}]},body:i};webix.ui(o).show(),$$("form-phone").setValues(e)},t}(a.b)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"record_contact_center_layout",rows:[{rows:[{id:"record_contact_center",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",footer:!0,navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Общее количество:",height:30}},{id:"queue",header:[{text:"Очередь"},{content:"selectFilter"}],sort:"string",width:140,footer:{content:"avgColumn"}},{id:"src",header:[{text:"Источник"},{content:"serverFilter"}],sort:"string",width:155,footer:{text:"Общая продолжительность:",colspan:2,height:30}},{id:"dst",header:[{text:"Агент"},{content:"serverFilter"}],sort:"string",width:140},{id:"duration",header:[{text:"Длительность"},{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}}],disabled:!1,url:"legacy/record_contact_center",ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{height:100,cols:[{id:"myplayer_record_contact_center",view:"datatable",scroll:!1,width:500,columns:[{id:"download",header:"",width:40,template:"<center><a target='_blank' href='#link'>#download#</center>",tooltip:"Скачать"},{id:"card",header:[{text:"Прослушать запись",height:30}],width:320}],data:[{download:"",name:"",card:""}]},{view:"checkbox",labelRight:"Автовоспроизведение",labelWidth:"auto",value:webix.storage.cookie.get("autoplay2")?webix.storage.cookie.get("autoplay2"):0,click:function(){var e=this.getValue();webix.storage.cookie.put("autoplay2",e)}}]}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t){webix.Date.add(new Date,-7,"day"),webix.Date.add(new Date,1,"day"),npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip},function(e,t){},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,i){$$("phone")&&($$("phone").setValue(e),$$("fio").setValue(t),$$("org").setValue(i),webix.ajax().get("bigam_getinfo.php",{cid:e},function(e,t){t=t.json(),$$("fio").setValue(t.fio),$$("org").setValue(t.org)}))}function s(e){for(e||(e=this),e.hide();e&&(!e.config.epbx_line||1!=e.config.epbx_line);)e=e.getParentView();var t=e.getParentView().getChildViews(),i=e.getParentView().index(e),o=e.getParentView().index(e)+1,r=t[i].getChildViews()[0],n=r.config;if(e.getChildViews()[1].hide(),"form"==n.type&&n.epbx_action&&"sendEmail"==n.epbx_action){if(!r.validate())return webix.message({type:"error",text:"Заполните обязательные поля."}),void e.getChildViews()[2].show();var a=r.getValues();a.epbx_rcpt=n.epbx_rcpt,a.epbx_subject=n.epbx_subject;var s=JSON.stringify(a);webix.message({type:"debug",text:"Отправляем письмо... Ожидайте."}),webix.ajax().post("/queues/send_mail.php",s,{error:function(t,i,o){e.getChildViews()[2].show()},success:function(i,r,n){0==r.json().result?t[o].show(!0,!0):(e.getChildViews()[2].show(),webix.message({type:"error",text:"Произошла ошибка при отправке письма."}))}})}else t[o].show(!0,!0)}function l(e){for(e||(e=this);e&&(!e.config.epbx_line||1!=e.config.epbx_line);)e=e.getParentView();var t=e.getParentView().getChildViews();e.hide();var i=e.getParentView().index(e)-1;0!=i&&t[i].getChildViews()[t[i].getChildViews().length-2].show(!0,!0),t[i].getChildViews()[t[i].getChildViews().length-1].show(!0,!0)}function c(e){var t=[],i=0;return e.forEach(function(o){i++,"object"!==(void 0===o?"undefined":f(o))&&(o={type:"template",css:"green-block",template:o,height:50}),t.push({epbx_line:1,hidden:1!=i,cols:[o,{view:"button",value:"Назад",hidden:1==i,click:function(){l(this)},width:100},{view:"button",value:"Дальше",hidden:i==e.length,click:function(){s(this)},width:100}]})}),t}function d(e,t){this&&this.data&&this.data.id&&0==e&&(e=this.data.id);var i=$$("mainView"),o="script_"+e;if($$(o))return $$(o).show({type:"flip",subtype:"horizontal"}),void i.showView(o);var r=$$("mainBody");r.disable(),webix.ajax().get("/legacy/scripts",{id:m,sid:e,nps_id:parseInt(b("nps"))||0},function(t,n,a){var s=n.json(),l=s.elements;window.actionsInfo=l,window.actionsId=e;var h;if(1==parseInt(s.autobuttons)){for(var p=[],f=0;f<s.substages.length;f++){var w={view:"button",label:s.substages[f].name,epbx_action:"next",epbx_action_block:s.substages[f].id,click:u,level:r.getChildViews().length,script_id:e};s.substages[f].used&&(h=w,d(w.epbx_action_block,w)),p.push(w)}l.push({cols:p})}else for(var b in l)l[b].used&&(h=l[b],d(l[b].epbx_action_block,l[b]));var m={animate:{type:"flip",subtype:"horizontal"},hidden:!0,rows:1==parseInt(s.show_prevnext)?c(l):l};m.id=o,r.addView(m,r.getChildViews().length-1),$$(o).show({type:"flip",subtype:"horizontal"}),i.showView(o),g=o,r.enable(),$$("$multiselect1")&&$$("$multiselect1").attachEvent("onChange",function(e,t){var i=$$("$multiselect1").getValue();-1!=i.indexOf(",Затрудняюсь ответить")&&(i=i.replace(",Затрудняюсь ответить",""),$$("$multiselect1").setValue(i)),-1!=i.indexOf("Затрудняюсь ответить,")&&(i=i.replace("Затрудняюсь ответить,",""),$$("$multiselect1").setValue(i))}),h&&h.id&&$$(h.id)&&webix.html.addCss($$(h.id).getNode().childNodes[0].childNodes[0],"toggleOn")})}function u(){for(var e=$$(this).config,t=$$(this).getParentView().getChildViews(),i=0;i<t.length;i++){var o=t[i].config.id;"button"==$$(o).config.view&&webix.html.removeCss($$(o).getNode().childNodes[0].childNodes[0],"toggleOn")}webix.html.addCss($$(e.id).getNode().childNodes[0].childNodes[0],"toggleOn");for(var r=$$(this).getParentView(),n=r.getParentView(),a=$$("mainBody"),s=0,i=0;i<a.getChildViews().length;i++)s&&$$(a.getChildViews()[i].config.id).hide({type:"flip",subtype:"horizontal"}),a.getChildViews()[i].config.id!=n.config.id&&a.getChildViews()[i].config.id!=r.config.id||(s=i);e.epbx_action_script;switch(e.epbx_action){case"next":if(94==e.epbx_action_block)window.close();else if(93==e.epbx_action_block)var l={nps_id:parseInt(b("nps")),answer:$$("$textarea1").getValue(),question_id:parseInt(e.script_id)||window.actionsId,answer_type:1};var c={nps_id:parseInt(b("nps")),answer:parseInt(e.epbx_action_block),question_id:parseInt(e.script_id)||window.actionsId,answer_type:2};if(window.actionsInfo&&!l)for(var u in window.actionsInfo)if(window.actionsInfo[u]&&("radio"==window.actionsInfo[u].view||"multiselect"==window.actionsInfo[u].view||"textarea"==window.actionsInfo[u].view)&&$$(window.actionsInfo[u].id)&&""!=$$(window.actionsInfo[u].id).getValue())var l={nps_id:parseInt(b("nps")),answer:$$(window.actionsInfo[u].id).getValue(),question_id:parseInt(window.actionsId),answer_type:1};l&&console.log("secondData",l),console.log("data",c),c?webix.ajax().post("/legacy/scripts/set_answer",{data:c},function(t){t=JSON.parse(t),t.result?(window.actionsInfo=[],l?webix.ajax().post("/legacy/scripts/set_answer",{data:l},function(t){t=JSON.parse(t),t.result?(91==l.question_id&&window.close(),d(e.epbx_action_block,e)):(webix.message({type:"error",text:t.msg}),console.log("err",t.data))}):d(e.epbx_action_block,e)):(webix.message({type:"error",text:t.msg}),console.log("err",t.data))}):d(e.epbx_action_block,e);break;case"jump":document.location.href="/#!/main/script?id="+e.epbx_action_script;break;default:alert("Unknow action: "+e.epbx_action)}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;10!=parseInt(b("id"))?webix.ui({view:"scrollview",scroll:"y",id:"mainView",body:{id:"mainBody",rows:[{cols:[{rows:[{type:"header",template:"Сценарий разговора"},{rows:c(["«Должность» «Имя оператора» <strong>Здравствуйте! Чем могу помочь?</strong>","<strong>Скажите пожалуйста, как я могу к Вам обращаться?</strong>","«Имя клиента»<strong>, очень приятно!  Из какого города Вы звоните?</strong>"])}]},{rows:[{type:"header",template:"Информация о клиенте"},{view:"form",id:"info_form",elements:[{cols:[{view:"text",label:"Телефон:",name:"phone",id:"phone",labelWidth:110,readonly:!0,labelAlign:"right"},{view:"text",label:"Организация",name:"org",id:"org",labelWidth:110,labelAlign:"right"}]},{view:"text",label:"ФИО клиента",name:"fio",id:"fio",labelWidth:110,labelAlign:"right"},{view:"text",label:"Город",name:"city",labelWidth:110,labelAlign:"right"}]}]}]},{}]},ready:function(){}}).show():webix.ui({view:"scrollview",scroll:"y",id:"mainView",body:{id:"mainBody",rows:[{}]},ready:function(){}}).show(),d(e)}Object.defineProperty(t,"__esModule",{value:!0});var p=i(0),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return{rows:[{view:"form",id:"qwer",elements:[]}]}},t}(p.b);t.default=w;var g=0;window.epbxAction=u;var b=function(e){var t,i,o=decodeURIComponent(window.location.hash.substring(15)),r=o.split("&");for(i=0;i<r.length;i++)if(t=r[i].split("="),t[0]===e)return void 0===t[1]||t[1]},m=parseInt(b("id"));console.log(parseInt(b("id"))),$$("menuBar").hide(),webix.ajax().get("/legacy/scripts/getstageid",{id:m},function(e,t){t=t.json(),webix.ready(function(){h(parseInt(parseInt(t.result))),a()})})},function(e,t){webix.protoUI({name:"ckeditor",$init:function(){this.$view.className+=" webix_selectable"},defaults:{borderless:!0,toolbar:[["Bold","Italic","-","NumberedList","BulletedList","-","Link","Unlink"],["FontSize","TextColor","BGColor"]]},_init_ckeditor_once:function(){var e=this.config.textAreaID="t"+webix.uid();this.$view.innerHTML="<textarea id='"+e+"'>"+this.config.value+"</textarea>",window.CKEDITOR_BASEPATH=webix.codebase+"ckeditor/";var t={toolbar:this.config.toolbar,width:this.$width-2,height:this.$height-44};webix.extend(t,this.config.editor||{}),webix.require("ckeditor/ckeditor.js",function(){this._3rd_editor=window.CKEDITOR.replace(this.config.textAreaID,t)},this)},_set_inner_size:function(e,t){this._3rd_editor&&this._3rd_editor.container&&this.$width&&this._3rd_editor.resize(e,t)},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&(this._init_ckeditor_once(),this._set_inner_size(e,t))},setValue:function(e){this.config.value=e,this._3rd_editor?this._3rd_editor.setData(e):webix.delay(function(){this.setValue(e)},this,[],100)},getValue:function(){return this._3rd_editor?this._3rd_editor.getData():this.config.value},focus:function(){this._focus_await=!0,this._3rd_editor&&this._3rd_editor.focus()},getEditor:function(){return this._3rd_editor.getData()}},webix.ui.view)},function(e,t){webix.protoUI({name:"icon",$skin:function(){this.defaults.height=webix.skin.$active.inputHeight},defaults:{template:function(e){var t="<button style='height:100%;width:100%;line-height:"+e.aheight+"px' class='webix_icon_button'>";return t+="<span class='webix_icon fa-"+e.icon+"'></span>",e.value&&(t+="<span class='webix_icon_count'>"+e.value+"</span>"),t+="</button>"},width:33},_set_inner_size:function(){}},webix.ui.button)},function(e,t){webix.type(webix.ui.tree,{name:"menuTree",height:40,icon:function(){return""},folder:function(e){return e.icon?"<span class='webix_icon icon fa-"+e.icon+"'></span>":""}}),webix.type(webix.ui.tree,{name:"menuTree2",height:40,icon:function(e){for(var t="",i=1;i<=e.$level;i++)if(i==e.$level&&e.$count){var o=e.open?"down":"right";t+="<span class=' webix_icon fa-angle-"+o+"'></span>"}return t},folder:function(e){return e.icon?"<span class='webix_icon icon fa-"+e.icon+"'></span>":""}})},function(e,t){webix.protoUI({name:"dhx-scheduler",defaults:{tabs:["day","week","month"]},getScheduler:function(){return this._scheduler},$init:function(){this.$ready.push(function(){var e=this.config.tabs,t=["<div class='dhx_cal_container' style='width:100%; height:100%;'><div class='dhx_cal_navline'><div class='dhx_cal_prev_button'>&nbsp;</div><div class='dhx_cal_next_button'>&nbsp;</div><div class='dhx_cal_today_button'></div><div class='dhx_cal_date'></div>"];if(e)for(var i=0;i<e.length;i++)t.push("<div class='dhx_cal_tab"+(0===i?" dhx_cal_tab_first":"")+(i==e.length-1?" dhx_cal_tab_last":"")+"' name='"+e[i]+"_tab' ></div>");t.push("</div><div class='dhx_cal_header'></div><div class='dhx_cal_data'></div></div>"),this.$view.innerHTML=t.join(""),webix.delay(webix.bind(this._render_once,this))})},_render_once:function(){var e=this._scheduler=window.Scheduler?window.Scheduler.getSchedulerInstance():window.scheduler;this.config.init&&this.config.init.call(this),e.init(this.$view.firstChild,this.config.date||new Date,this.config.mode||"week"),this.config.ready&&this.config.ready.call(this)}},webix.ui.view)},function(e,t){webix.i18n.locales["en-US"]={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,dateFormat:"%m/%d/%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%m/%d/%Y %h:%i %A",am:["am","AM"],pm:["pm","PM"],price:"${obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2},fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hours:"Hours",minutes:"Minutes",done:"Done",clear:"Clear",today:"Today"},dataExport:{page:"Page",of:"of"},PDFviewer:{of:"of",automaticZoom:"Automatic Zoom",actualSize:"Actual Size",pageFit:"Page Fit",pageWidth:"Page Width",pageHeight:"Page Height"},aria:{calendar:"Calendar",increaseValue:"Increase value",decreaseValue:"Decrease value",navMonth:["Previous month","Next month"],navYear:["Previous year","Next year"],navDecade:["Previous decade","Next decade"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Hours: %h %A",minuteFormat:"Minutes: %i",removeItem:"Remove item",pages:["First page","Previous page","Next page","Last page"],page:"Page",headermenu:"Header menu",openGroup:"Open column group",closeGroup:"Close column group",closeTab:"Close tab",showTabs:"Show more tabs",resetTreeMap:"Reset tree map",navTreeMap:"Level up",nextTab:"Next tab",prevTab:"Previous tab",multitextSection:"Add section",multitextextraSection:"Remove section",showChart:"Show chart",hideChart:"Hide chart",resizeChart:"Resize chart"},richtext:{underline:"Underline",bold:"Bold",italic:"Italic"},combo:{select:"Select",selectAll:"Select all",unselectAll:"Unselect all"},message:{ok:"OK",cancel:"Cancel"}}},function(e,t){webix.i18n.locales["ru-RU"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d.%m.%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} руб.",priceSettings:null,calendar:{monthFull:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShort:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFull:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],hours:"Часы",minutes:"Минуты",done:"Гoтовo",clear:"Очистить",today:"Сегодня"},dataExport:{page:"Страница",of:"из"},PDFviewer:{of:"из",automaticZoom:"Автоматический зум",actualSize:"Настоящий размер",pageFit:"Размер страницы",pageWidth:"Ширина страницы",pageHeight:"Высота страницы"},aria:{calendar:"Календарь",increaseValue:"Увеличить значение",decreaseValue:"Уменьшить значение",navMonth:["Предыдущий месяц","Следующий месяц"],navYear:["Предыдущий год","Следующий год"],navDecade:["Предыдущие десять лет","Следующие десять лет"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Часы: %H",minuteFormat:"Минуты: %i",removeItem:"Удалить элемент",pages:["Первая страница","Предыдущая страница","Следующая страница","Последняя страница"],page:"Страница",headermenu:"Меню шапки таблицы",openGroup:"Развернуть группу столбцов",closeGroup:"Свернуть группу столбцов",closeTab:"Закрыть вкладку",showTabs:"Показать больше вкладок",resetTreeMap:"Вернуться к первоначальному представлению",navTreeMap:"Перейти на уровень выше",nextTab:"Следующая вкладка",prevTab:"Предыдущая вкладка",multitextSection:"Добавить элемент",multitextextraSection:"Удалить элемент",showChart:"Показать чарт",hideChart:"Спрятать чарт",resizeChart:"Изменить размер чарта"},richtext:{underline:"Подчеркивание",bold:"Жирный",italic:"Курсив"},combo:{select:"Выбрать",selectAll:"Выбрать все",unselectAll:"Сброс выбора"},message:{ok:"OK",cancel:"Отмена"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(84),r=(i.n(o),i(85)),n=(i.n(r),i(86)),a=(i.n(n),i(0)),s=i(66),l=i(105),c=i(13),d=i(19),u=i(14);webix.codebase="/webix",webix.ready(function(){webix.CustomScroll.init(),webix.ui.fullScreen();var e=new a.a({id:"erpicopbx",name:"ErpicoPBX",version:"4.0",start:"/main/cti"}),t=new l.a;webix.guiutils=t,webix.AppConfig=new c.default,webix.Manager=new d.default,webix.AppFilter=new u.default,webix.Manager.initViews();var i=new s.a;webix.auth=i,webix.i18n.setLocale("ru-RU"),webix.Date.startOnMonday=!0,webix.ui.datafilter.customFilterSelect=webix.extend({inputtype:"combo"},webix.ui.datafilter.serverRichSelectFilter),e.attachEvent("app:error:resolve",function(e,t){var i=this;window.console.error(t),webix.delay(function(){i.show("/main/cti")})}),webix.startDayDateTime=new Date,webix.startDayDateTime.setHours(0),webix.startDayDateTime.setMinutes(0),webix.startDayDateTime.setSeconds(0),webix.endDayDateTime=new Date,webix.endDayDateTime.setHours(23),webix.endDayDateTime.setMinutes(59),webix.endDayDateTime.setSeconds(59),i.check(function(){e.render().then(function(){var e=document.location.hash.split("/")[document.location.hash.split("/").length-1];e.indexOf("?")&&(e=e.split("?"),e=e[0]),e.length?$$("sidebar")&&($$("sidebar").getItem(e)?($$("sidebar").select(e),$$("sidebar").getSelectedItem().$parent&&$$("sidebar").open($$("sidebar").getSelectedItem().$parent)):(webix.guiutils.hideAllToolbars(),$$("sidebar").select("cti"))):(webix.guiutils.hideAllToolbars(),$$("sidebar")&&$$("sidebar").select("cti"))}),$$("person_template")&&$$("person_template").refresh()})})},function(e,t){},function(e,t){var i;webix.ui.datafilter.avgColumn=webix.extend({refresh:function(e,t,o){i=0,e.mapCells(null,o.columnId,null,1,function(e){return i++,e}),t.firstChild.innerHTML=i}},webix.ui.datafilter.summColumn),webix.ui.datafilter.minColumn=webix.extend({refresh:function(e,t,i){var o=0;e.mapCells(null,i.columnId,null,1,function(e){return e*=1,isNaN(e)||(o+=e),e}),t.firstChild.innerHTML=o.toFixed(2)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.avaregeColumn=webix.extend({refresh:function(e,t,i){var o=0,r=0;e.mapCells(null,i.columnId,null,1,function(e){return e*=1,isNaN(e)||(o+=e,r++),e}),t.firstChild.innerHTML=(o/r).toFixed(2)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.summTimeColumn=webix.extend({refresh:function(e,t,i){var o=0,r=0,n=0,a=0,s=0,l=0,c=0,d=new Array,u=new Array,h=new Array;for(e.mapCells(null,i.columnId,null,1,function(e){return e&&(d=e.split(" "),2==d.length?(u=d[0].split(translate("d")),o+=parseInt(u[0],10),h=d[1].split(":"),r+=parseInt(h[0],10),a+=parseInt(h[1],10),l+=parseInt(h[2],10)):(h=d[0].split(":"),3==h.length?(r+=parseInt(h[0],10),a+=parseInt(h[1],10),l+=parseInt(h[2],10)):(a+=parseInt(h[0],10),l+=parseInt(h[1],10)))),e});l>=60;)l-=60,c++;for(a+=c;a>=60;)a-=60,s++;for(r+=s;r>=24;)r-=24,n++;o+=n,l<10&&(l="0"+l),a<10&&(a="0"+a);var p="";o>0&&(p=p+o+translate("d")+" "),r>0?p=p+r+":":o>0&&(p+="0:"),a>0?p=p+a+":":p+="00:",p+=l>0?l:"00",t.firstChild.innerHTML=p}},webix.ui.datafilter.summColumn),webix.ui.datafilter.avaregeTimeColumn=webix.extend({refresh:function(e,t,i){var o=0,r=0,n=0,a=0,s=0,l=0,c=new Array;e.mapCells(null,i.columnId,null,1,function(e){return e&&(c=e.split(":"),r+=parseInt(c[0],10),a+=parseInt(c[1],10),l++),e});var d=60*r+a;for(a=d/l,a=Math.round(a);a>=60;)a-=60,s++;for(r=s;r>=60;)r-=60,n++;o+=n,a<10&&(a="0"+a),r<10&&(r="0"+r);var u=o+":";r>0?u=u+r+":":u+="00:",u+=a>0?a:"00",t.firstChild.innerHTML=u}},webix.ui.datafilter.summColumn),webix.ui.datafilter.avgTime=webix.extend({refresh:function(e,t,i){var o=0,r=0,n=0,a=0,s=0,l=0,c=0;for(e.mapCells(null,i.columnId,null,1,function(e){return e&&(c+=e,l++),e}),a=c/l,a=Math.round(a);a>=60;)a-=60,s++;for(r=s;r>=60;)r-=60,n++;o+=n,a<10&&(a="0"+a),r<10&&(r="0"+r);var d=o+":";r>0?d=d+r+":":d+="00:",d+=a>0?a:"00",t.firstChild.innerHTML=d}},webix.ui.datafilter.summColumn)},function(e,t){webix.protoUI({name:"nic-editor",defaults:{config:{buttonList:["fontSize","bold","italic","underline","strikeThrough","subscript","superscript"]},value:""},$init:function(e){this.$view.innerHTML="<div style='padding:10px'>Loading...</div>",this.$view.className+=" webix_selectable",this._waitEditor=webix.promise.defer(),this.$ready.push(this._init_nic_editor)},_init_nic_editor:function(){if(!1===this.config.cdn)return void this._render_nic_editor();var e=[],t=this.config.cdn?this.config.cdn:"https://cdnjs.cloudflare.com/ajax/libs/NicEdit/0.93";e.push(t+"/nicEdit.js"),webix.require(e).then(webix.bind(this._render_nic_editor,this)).catch(function(e){console.log(e)})},_render_nic_editor:function(){if(!this._editorCss){var e=".nicEdit-panel{height:auto}\n";e+=".nicEdit-panelContain{border-top-width:0px !important;}\n",e+=".webix_selectable>div:nth-child(2){overflow-y:auto;}",webix.html.addStyle(e),this._editorCss=!0}this.config.cdn&&!this.config.config.iconsPath&&(this.config.config.iconsPath=cdn+"/nicEditorIcons.gif");var t=new nicEditor(this.config.config).panelInstance(this.$view.firstChild);this._3rd_editor=t.nicInstances[t.nicInstances.length-1],this._set_inner_size(),this._waitEditor.resolve(this._3rd_editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){if(this._3rd_editor&&this.$width){var e=this.$view.firstChild;e.style.width=this.$width+"px",e=e.nextSibling,e.style.width=this.$width-20+"px",e.style.height=this.$height-46+"px"}},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this._set_inner_size()},setValue:function(e){this.config.value=e,this._3rd_editor&&this._3rd_editor.setContent(e)},getValue:function(){return this._3rd_editor?this._3rd_editor.getContent():this.config.value},focus:function(){this._focus_await=!0,this._3rd_editor&&this._3rd_editor.elm.focus()},getEditor:function(e){return e?this._waitEditor:this._3rd_editor}},webix.ui.view)},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var o=i(62),r=i(88),n=i(89),a=i(64),s=i(63),l=i(91),c=(i.n(l),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),u=function(e){function t(t){var i=e.call(this)||this;return i.webix=t.webix||webix,i.config=i.webix.extend({name:"App",version:"1.0",start:"/home"},t,!0),i._name=i.config.name,i._services={},webix.extend(i,webix.EventSystem),i}return d(t,e),t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.copyConfig=function(e,t,i){if(e.$ui?e={$subview:new r.a(this,"",e)}:(e instanceof o.a||"function"==typeof e&&e.prototype instanceof o.a)&&(e={$subview:e}),e.$subview)return this.addSubView(e,t,i);t=t||(e instanceof Array?[]:{});for(var n in e){var a=e[n];"function"==typeof a&&a.prototype instanceof o.a&&(a={$subview:a}),!a||"object"!==(void 0===a?"undefined":c(a))||a instanceof webix.DataCollection||a instanceof RegExp?t[n]=a:a instanceof Date?t[n]=new Date(a):t[n]=this.copyConfig(a,a instanceof Array?[]:{},i)}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e){if(e){var t=e.target||e.srcElement;if(t&&t.getAttribute){var i=t.getAttribute("trigger");i&&this.trigger(i);var o=t.getAttribute("route");o&&this.show(o)}}},t.prototype.refresh=function(){var e=this._container;this._view._name=webix.uid()+"",this._container=null,e.tagName&&this._view&&(this._view.destructor(),this._view=null),this.render(e,Object(s.a)(this.getRouter().get()),this._parent)},t.prototype.loadView=function(e){var t=this,o=this.config.views,r=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{o&&"string"==typeof(r="function"==typeof o?o(e):o[e])&&(e=r,r=null),r||(e=e.replace(/\./g,"/"),r=i(92)("./"+e))}catch(t){r=this._loadError(e,t)}return r.then||(r=Promise.resolve(r)),r=r.then(function(e){return e.__esModule?e.default:e}).catch(function(i){return t._loadError(e,i)})},t.prototype.createFromURL=function(e,t){var i=this,o=e[0],r=o.page;return t&&t.getName()===r?Promise.resolve(t):this.loadView(o.page).then(function(e){return i.createView(e,r)})},t.prototype.createView=function(e,t){if("function"==typeof e){if(e.prototype instanceof o.a)return new e(this,t);e=e()}return e instanceof o.a?e:e.$ui?new r.a(this,t,e):new n.a(this,t,e)},t.prototype.show=function(e){return this.$router.get()!==e?this._render(e):Promise.resolve(!0)},t.prototype.canNavigate=function(e,t){var i={url:Object(s.a)(e),redirect:e,confirm:Promise.resolve(!0)};return this.callEvent("app:guard",[e,t||this._view,i])?i.confirm.catch(function(){return i.redirect=null}).then(function(){return i.redirect}):Promise.reject("")},t.prototype.destructor=function(){this._view.destructor()},t.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.apply(e,t)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.apply(e,t)},this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var i=0;i<t.length;i++)if(console.error(t[i]),t[i]instanceof Error){var o=t[i].message;0===o.indexOf("Module build failed")?(o=o.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+o+"</pre>"):(o+="<br><br>Check console for more details",webix.message({type:"error",text:o,expire:-1}))}},t.prototype._render=function(e){var t=this;!this.$router&&(webix.attachEvent("onClick",function(e){return t.clickHandler(e)}),e=this._first_start(e));var i="string"==typeof e?e:Object(s.b)(e);return this.canNavigate(i).then(function(e){return null!==e?(t.$router.set(e,{silent:!0}),t._render_stage(e)):null})},t.prototype._render_stage=function(e){var t=this,i="string"==typeof e?Object(s.a)(e):e;return webix.ui.freeze(function(){return t.createFromURL(i,t._view).then(function(e){var o=t._view;return t._view=e,e.render(t._container,i,t._parent).then(function(r){return o&&o!==t._view&&o.destructor(),t._view.getRoot().getParentView()&&(t._container=r),t._root=r,t.callEvent("app:route",[i]),e})}).catch(function(e){t.error("app:error:render",[e])})})},t.prototype._urlChange=function(e){return alert("Not implemented"),Promise.resolve(!0)},t.prototype._first_start=function(e){var t=this,i=function(e){return setTimeout(function(){t._render(e)},1)};if(this.$router=new(this.config.router||a.a)(i,this.config),this._container===document.body&&!1!==this.config.animation){var o=this._container;webix.html.addCss(o,"webixappstart"),setTimeout(function(){webix.html.removeCss(o,"webixappstart"),webix.html.addCss(o,"webixapp")},10)}return e&&1!==e.length||(e=this.$router.get()||this.config.start,this.$router.set(e,{silent:!0})),e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,i){var r=!0!==e.$subview?e.$subview:null,n=e.name||(r?this.webix.uid():"default");t.id=e.id||"s"+this.webix.uid();var a=i[n]={id:t.id,url:r};return a.url instanceof o.a&&(a.view=a.url),t},t}(o.a)},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var o=i(12),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=function(e){function t(t,i,o){var r=e.call(this,t,i)||this;return r._ui=o,r._windows=[],r}return r(t,e),t.prototype.getRoot=function(){if(this.app.config.jet1xMode){var e=this.getParentView();if(e)return e.getRoot()}return this._root},t.prototype.config=function(){return this._ui.$ui||this._ui},t.prototype.destructor=function(){var t=this._ui.$ondestroy;t&&t();for(var i=0,o=this._windows;i<o.length;i++){o[i].destructor()}e.prototype.destructor.call(this)},t.prototype.show=function(t,i){if(0===t.indexOf("/")||0===t.indexOf("./"))return e.prototype.show.call(this,t,i);e.prototype.show.call(this,"../"+t,i)},t.prototype.init=function(){this.app.config.legacyEarlyInit&&this._realInitHandler()},t.prototype.ready=function(){this.app.config.legacyEarlyInit||this._realInitHandler()},t.prototype._realInitHandler=function(){var e=this._ui.$oninit;if(e){var i=this.getRoot();e(i,i.$scope)}var o=this._ui.$onevent;if(o)for(var r in o)this.on(this.app,r,o[r]);var n=this._ui.$windows;if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];if(l.$ui){var c=new t(this.app,this.getName(),l);c.render(document.body),this._windows.push(c)}else this.ui(l)}},t.prototype._urlChange=function(t){var i=this;return e.prototype._urlChange.call(this,t).then(function(){var e=i._ui.$onurlchange;if(e){var o=i.getRoot();e(t[0].params,t.slice(1),o.$scope)}})},t}(o.a)},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var o=i(12),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=function(e){function t(t,i,o){var r=e.call(this,t,i)||this;return r._ui=o,r}return r(t,e),t.prototype.config=function(){return this._ui},t}(o.a)},function(e,t,i){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){var i,r=[],n={},a=e.routie,s=function(e,t){this.name=t,this.path=e,this.keys=[],this.fns=[],this.params={},this.regex=l(this.path,this.keys,!1,!1)};s.prototype.addHandler=function(e){this.fns.push(e)},s.prototype.removeHandler=function(e){for(var t=0,i=this.fns.length;t<i;t++){if(e==this.fns[t])return void this.fns.splice(t,1)}},s.prototype.run=function(e){for(var t=0,i=this.fns.length;t<i;t++)if(!1===this.fns[t].apply(this,e))return!1;return!0},s.prototype.match=function(e,t){var i=this.regex.exec(e);if(!i)return!1;for(var o=1,r=i.length;o<r;++o){var n=this.keys[o-1],a="string"==typeof i[o]?decodeURIComponent(i[o]):i[o];n&&(this.params[n.name]=a),t.push(a)}return!0},s.prototype.toURL=function(e){var t=this.path;for(var i in e)t=t.replace("/:"+i,"/"+e[i]);if(t=t.replace(/\/:.*\?/g,"/").replace(/\?/g,""),-1!=t.indexOf(":"))throw new Error("missing parameters for url: "+t);return t};var l=function(e,t,i,o){return e instanceof RegExp?e:(e instanceof Array&&(e="("+e.join("|")+")"),e=e.concat(o?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,i,o,r,n,a){return t.push({name:r,optional:!!a}),i=i||"",(a?"":i)+"(?:"+(a?i:"")+(o||"")+(n||o&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")}).replace(/([/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",i?"":"i"))},c=function(e,t){var i=e.split(" "),o=2==i.length?i[0]:null;e=2==i.length?i[1]:i[0],n[e]||(n[e]=new s(e,o),r.push(n[e])),n[e].addHandler(t)},d=function e(t,i){if("function"==typeof i)c(t,i),e.reload();else if("object"==(void 0===t?"undefined":o(t))){for(var r in t)c(r,t[r]);e.reload()}else void 0===i&&e.navigate(t)};d.lookup=function(e,t){for(var i=0,o=r.length;i<o;i++){var n=r[i];if(n.name==e)return n.toURL(t)}},d.remove=function(e,t){var i=n[e];i&&i.removeHandler(t)},d.removeAll=function(){n={},r=[],i=""},d.navigate=function(e,t){t=t||{};var i=t.silent||!1;i&&w(),setTimeout(function(){window.location.hash=e,i&&setTimeout(function(){f()},1)},1)},d.noConflict=function(){return e.routie=a,d};var u=function(){return window.location.hash.substring(1)},h=function(e,t){var i=[];return t.match(e,i)?!1!==t.run(i)?1:0:-1},p=d.reload=function(){for(var e=u(),t=0,o=r.length;t<o;t++){var n=r[t],a=h(e,n);if(1===a){i=e;break}if(0===a){d.navigate(i,{silent:!0});break}}},f=function(){e.addEventListener?e.addEventListener("hashchange",p,!1):e.attachEvent("onhashchange",p)},w=function(){e.removeEventListener?e.removeEventListener("hashchange",p):e.detachEvent("onhashchange",p)};if(f(),i=u(),t)return d;e.routie=d};e.exports=r(window,!0),e.exports.default=e.exports},function(e,t){var i=webix,o=webix.version.split(".");10*o[0]+1*o[1]<53&&(i.ui.freeze=function(e){var t=e();return t&&t.then?t.then(function(e){return i.ui.$freeze=!1,i.ui.resize(),e}):(i.ui.$freeze=!1,i.ui.resize()),t});var r=i.ui.baselayout.prototype.addView,n=i.ui.baselayout.prototype.removeView,a={addView:function(e,t){if(this.$scope&&this.$scope.webixJet){var i=this.$scope,o={};e=i.app.copyConfig(e,{},o),r.apply(this,[e,t]);for(var n in o)!function(e){i._renderFrame(e,o[e],i.getUrl()).then(function(){i._subs[e]=o[e]})}(n);return e.id}return r.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var t in e)webix.$$(e[t].id)||delete e[t]}}};i.extend(i.ui.layout.prototype,a,!0),i.extend(i.ui.baselayout.prototype,a,!0),webix.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var t=webix.uid().toString();e.body={id:t},this.$ready.push(function(){this.$app.render(webix.$$(t))})}},webix.ui.proxy)},function(e,t,i){function o(e){return i(r(e))}function r(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var n={"./appconfig":13,"./appconfig.js":13,"./appfilter":14,"./appfilter.js":14,"./apptoolbar":65,"./apptoolbar.js":65,"./appview":16,"./appview.js":16,"./main":67,"./main.js":67,"./manager":19,"./manager.js":19,"./menu":17,"./menu.js":17,"./menus/list":68,"./menus/list.js":68,"./menus/profile":2,"./menus/profile.js":2,"./models/BlacklistWindow":61,"./models/BlacklistWindow.js":61,"./models/GroupsWindow":48,"./models/GroupsWindow.js":48,"./models/PBXChannelsWindow":55,"./models/PBXChannelsWindow.js":55,"./models/PhonesWindow":52,"./models/PhonesWindow.js":52,"./models/ReportsWindow":23,"./models/ReportsWindow.js":23,"./models/analysis_outgoing_calls_layout":69,"./models/analysis_outgoing_calls_layout.js":69,"./models/call_recording_tables":70,"./models/call_recording_tables.js":70,"./models/clientwnd":6,"./models/clientwnd.js":6,"./models/contact_cdr_report":71,"./models/contact_cdr_report.js":71,"./models/contact_group_wnd":50,"./models/contact_group_wnd.js":50,"./models/menudata":18,"./models/menudata.js":18,"./models/option_client_wnd":15,"./models/option_client_wnd.js":15,"./models/phones_window":72,"./models/phones_window.js":72,"./models/record_contact_center":73,"./models/record_contact_center.js":73,"./models/settings_wnd":7,"./models/settings_wnd.js":7,"./modules/dashboardnps":74,"./modules/dashboardnps.js":74,"./modules/npsTooltip":75,"./modules/npsTooltip.js":75,"./modules/phones_groups_toolbar":10,"./modules/phones_groups_toolbar.js":10,"./modules/queues_toolbar":8,"./modules/queues_toolbar.js":8,"./modules/scripts_toolbar":9,"./modules/scripts_toolbar.js":9,"./modules/users_toolbar":5,"./modules/users_toolbar.js":5,"./outgoingcampaign":1,"./outgoingcampaign/":1,"./outgoingcampaign/form":44,"./outgoingcampaign/form.js":44,"./outgoingcampaign/index":1,"./outgoingcampaign/index.js":1,"./outgoingcampaign/outgoingcampaigns":43,"./outgoingcampaign/outgoingcampaigns.js":43,"./outgoingcampaign/ruleswnd":4,"./outgoingcampaign/ruleswnd.js":4,"./outgoingcampaign/toolbar":3,"./outgoingcampaign/toolbar.js":3,"./script":76,"./script.js":76,"./views/aliases":45,"./views/aliases.js":45,"./views/analysis_outgoing_calls":29,"./views/analysis_outgoing_calls.js":29,"./views/blacklist":60,"./views/blacklist.js":60,"./views/cdr_reports":22,"./views/cdr_reports.js":22,"./views/channels":54,"./views/channels.js":54,"./views/checklist":39,"./views/checklist.js":39,"./views/clients":42,"./views/clients.js":42,"./views/compare_calls":35,"./views/compare_calls.js":35,"./views/contact_groups":49,"./views/contact_groups.js":49,"./views/cti":20,"./views/cti.js":20,"./views/daily_report":32,"./views/daily_report.js":32,"./views/dashboard":40,"./views/dashboard.js":40,"./views/ext_dashboard":24,"./views/ext_dashboard.js":24,"./views/ext_incoming_external":36,"./views/ext_incoming_external.js":36,"./views/ext_incoming_internal":37,"./views/ext_incoming_internal.js":37,"./views/ext_outgoing":38,"./views/ext_outgoing.js":38,"./views/extended_calls":58,"./views/extended_calls.js":58,"./views/extended_contact_calls":59,"./views/extended_contact_calls.js":59,"./views/grouped_reports":25,"./views/grouped_reports.js":25,"./views/grouped_reports_by_agents":26,"./views/grouped_reports_by_agents.js":26,"./views/grouped_reports_by_queues":27,"./views/grouped_reports_by_queues.js":27,"./views/groups":47,"./views/groups.js":47,"./views/hourly_load":34,"./views/hourly_load.js":34,"./views/interval_reports":31,"./views/interval_reports.js":31,"./views/lost_calls":28,"./views/lost_calls.js":28,"./views/month_traffic":33,"./views/month_traffic.js":33,"./views/operators_work_report":30,"./views/operators_work_report.js":30,"./views/phone":21,"./views/phone.js":21,"./views/phones":51,"./views/phones.js":51,"./views/phones_groups":57,"./views/phones_groups.js":57,"./views/queues":53,"./views/queues.js":53,"./views/reports":41,"./views/reports.js":41,"./views/scripts":56,"./views/scripts.js":56,"./views/setup":46,"./views/setup.js":46,"./views/users":11,"./views/users.js":11,"./webix/ckeditor":77,"./webix/ckeditor.js":77,"./webix/icon":78,"./webix/icon.js":78,"./webix/menutree":79,"./webix/menutree.js":79,"./webix/scheduler":80,"./webix/scheduler.js":80};o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=92},function(e,t,i){"use strict";!function(){function e(e,t){this.name=t.storeName||t.id+":route",this.cb=e}e.prototype.set=function(e,t){var i=this;webix.storage.session.put(this.name,e),t&&t.silent||setTimeout(function(){return i.cb(e)},1)},e.prototype.get=function(){return webix.storage.session.get(this.name)}}()},function(e,t,i){"use strict";!function(){function e(e,t){var i=this;this.cb=e,window.onpopstate=function(){return i.cb(i.get())},this.prefix=t.routerPrefix||""}e.prototype.set=function(e,t){var i=this;this.get()!==e&&window.history.pushState(null,null,this.prefix+e),t&&t.silent||setTimeout(function(){return i.cb(e)},1)},e.prototype.get=function(){var e=window.location.pathname.replace(this.prefix,"");return"/"!==e?e:""}}()},function(e,t,i){"use strict";!function(){function e(e,t){this.path="",this.cb=e}e.prototype.set=function(e,t){var i=this;this.path=e,t&&t.silent||setTimeout(function(){return i.cb(e)},1)},e.prototype.get=function(){return this.path}}()},function(e,t,i){"use strict";function o(e,t,i){t.on(e,"app:guard",function(e,o,r){if(o===t||o.contains(t)){var n=i();r.confirm=!1===n?Promise.reject(n):r.confirm.then(function(){return n})}})}t.a=o},function(e,t,i){"use strict";function o(e,t,o){o=o||{};var r=o.storage,a=r?r.get("lang")||"en":o.lang||"en",s={_:null,polyglot:null,getLang:function(){return a},setLang:function(t,l){var c=(o.path?o.path+"/":"")+t,d=i(99)("./"+c);d.__esModule&&(d=d.default);var u=s.polyglot=new n.a({phrases:d});u.locale(t),s._=webix.bind(u.t,u),a=t,r&&r.put("lang",a),l||e.refresh()}};e.setService("locale",s),s.setLang(a,!0)}t.a=o;var r=i(98),n=i.n(r)},function(e,t,i){"use strict";function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(e,t,i){for(var r in e)o(e,r)&&t.call(i||e,e[r],r,e)}function n(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function a(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}function s(e){var t={};return r(e,function(e,i){r(e,function(e){t[e]=i})}),t}function l(e){var t=s(v);return t[e]||t[g.call(e,/-/,1)[0]]||t.en}function c(e,t){return _[l(e)](t)}function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function u(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if(t===b||i===b)throw new RangeError('"'+b+'" token is reserved for pluralization');return new RegExp(d(t)+"(.*?)"+d(i),"g")}function h(e,t,i,r){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,s=r||y,l="number"==typeof t?{smart_count:t}:t;if(null!=l.smart_count&&a){var d=g.call(a,b);a=n(d[c(i||"en",l.smart_count)]||d[0])}return a=w.call(a,s,function(e,t){return o(l,t)&&null!=l[t]?w.call(l[t],x,$):e})}function p(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?h:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||a,this.tokenRegex=u(t.interpolation)}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=String.prototype.replace,g=String.prototype.split,b="||||",m=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},_={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:m,chinese:function(){return 0},croatian:m,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:m,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},v={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]},x=/\$/g,$="$$",y=/%\{(.*?)\}/g;p.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},p.prototype.extend=function(e,t){r(e,function(e,i){var o=t?t+"."+i:i;"object"===(void 0===e?"undefined":f(e))?this.extend(e,o):this.phrases[o]=e},this)},p.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:r(e,function(e,i){var o=t?t+"."+i:i;"object"===(void 0===e?"undefined":f(e))?this.unset(e,o):delete this.phrases[o]},this)},p.prototype.clear=function(){this.phrases={}},p.prototype.replace=function(e){this.clear(),this.extend(e)},p.prototype.t=function(e,t){var i,o,r=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof r._)i=r._;else if(this.onMissingKey){var n=this.onMissingKey;o=n(e,r,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),o=e;return"string"==typeof i&&(o=h(i,r,this.currentLocale,this.tokenRegex)),o},p.prototype.has=function(e){return o(this.phrases,e)},p.transformPhrase=function(e,t,i){return h(e,t,i)},e.exports=p},function(e,t,i){function o(e){return i(r(e))}function r(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var n={"./en":81,"./en.js":81,"./ru":82,"./ru.js":82};o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=99},function(e,t,i){"use strict";function o(e,t,i){t.urls&&(i=t.urls[i]||i),e.show("./"+i)}function r(e,t,i){var r=t.$$(i.id||i),n=!1;r.attachEvent("onchange",function(){n||o(t,i,this.getValue())}),r.attachEvent("onafterselect",function(){if(!n){var e=null;r.setValue?e=this.getValue():r.getSelectedId&&(e=r.getSelectedId()),o(t,i,e)}}),t.on(e,"app:route",function(e){var i=e[t.getIndex()];if(i){n=!0;var o=i.page;r.setValue&&r.getValue()!==o?r.setValue(o):r.select&&r.exists(o)&&r.getSelectedId()!==o&&r.select(o),n=!1}})}t.a=r},function(e,t,i){"use strict";function o(e,t,i){function o(e){var o=t.$$(i.target);o&&(e||(e="<div class='status_"+p+"'><span class='webix_icon fa-"+m[p]+"'></span> "+b[p]+"</div>"),o.setHTML(e))}function a(){f--,u("good")}function s(e){f--,u("error",e)}function l(e){f++,u("saving"),e&&e.then&&e.then(a,s)}function c(){return p}function d(){0===f&&o(" ")}function u(t,i){f<0&&(f=0),"saving"===t?(p="saving",o()):(w="error"===t,0===f&&(p=w?"error":"good",w?e.error("app:error:server",[i.responseText||i]):g&&setTimeout(d,g),o()))}function h(e){var i=webix.dp(e);i&&(t.on(i,"onAfterDataSend",l),t.on(i,"onAfterSaveError",function(e,t,i){return s(i)}),t.on(i,"onAfterSave",a))}var p="good",f=0,w=!1,g=i.expire;g||!1===g||(g=2e3);var b=i.texts||n,m=i.icons||r;"string"==typeof i&&(i={target:i}),e.setService("status",{getStatus:c,setStatus:u,track:h}),i.remote&&t.on(webix,"onRemoteCall",l),i.ajax&&t.on(webix,"onBeforeAjax",function(e,t,i,o,r,n,a){l(a)}),i.data&&h(i.data)}t.a=o;var r={good:"check",error:"warning",saving:"refresh fa-spin"},n={good:"Ok",error:"Error",saving:"Connecting..."}},function(e,t,i){"use strict";function o(e,t,i){i=i||{};var o=i.storage,r=o?o.get("theme")||"flat-default":i.theme||"flat-default",n={getTheme:function(){return r},setTheme:function(t,i){for(var n=t.split("-"),a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s].getAttribute("title");l&&(l===t||l===n[0]?a[s].disabled=!1:a[s].disabled=!0)}webix.skin.set(n[0]),webix.html.removeCss(document.body,"theme-"+r),webix.html.addCss(document.body,"theme-"+t),r=t,o&&o.put("theme",t),i||e.refresh()}};e.setService("theme",n),n.setTheme(r,!0)}t.a=o},function(e,t,i){"use strict";function o(e,t,i){for(var o=0;o<i.length;o++)e.setParam(i[o],t[o+1]?t[o+1].page:"")}function r(e,t,i){var r=i.route||i;t.on(e,"app:urlchange",function(e,i){t===e&&(o(t,i,r),i.splice(1,r.length))}),t.on(e,"app:paramchange",function(e,i,o,n){if(t===e&&n)for(var a=0;a<r.length;a++)if(r[a]===i)return t.show([a,o]),!1}),o(t,t.getUrl(),r)}t.a=r},function(e,t,i){"use strict";function o(e,t,i){function o(e,t){e===n?(u.logout(),t.redirect=s):e===r||u.getStatus()||(t.redirect=r)}i=i||{};var r=i.login||"/login",n=i.logout||"/logout",a=i.afterLogin||e.config.start,s=i.afterLogout||"/login",l=i.ping||3e5,c=i.model,d=i.user,u={getUser:function(){return d},getStatus:function(e){return e?c.status().catch(function(){return null}).then(function(e){d=e}):null!==d},login:function(t,i){return c.login(t,i).then(function(t){if(d=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[d]),e.show(a)})},logout:function(){return d=null,c.logout().then(function(t){return e.callEvent("app:user:logout",[]),t})}};e.setService("user",u),e.attachEvent("app:guard",function(e,t,i){return void 0===d&&(i.confirm=u.getStatus(!0).then(function(){return o(e,i)})),o(e,i)}),l&&setInterval(function(){return u.getStatus(!0)},l)}t.a=o},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"a",function(){return r});var r=(i(11),function(){function e(){o(this,e),this.filter_grouped_reports=1,this.queue_grouped_reports="",this.type_grouped_reports=1}return e.prototype.yesterday=function(e){return e.setDate(e.getDate()-1),e},e.prototype.hideAllToolbars=function(){$$("ext_dashboard_toolbar")&&$$("ext_dashboard_toolbar").hide(),$$("grouped_reports_toolbar")&&$$("grouped_reports_toolbar").hide(),$$("extended_calls_trafic")&&$$("extended_calls_trafic").hide(),$$("extended_calls_toolbar")&&$$("extended_calls_toolbar").hide(),$$("extended_contact_calls_toolbar")&&$$("extended_contact_calls_toolbar").hide(),$$("reportDateRange").hide(),$$("cdr_toolbar")&&$$("cdr_toolbar").hide(),$$("analysis_outgoing_calls_toolbar")&&$$("analysis_outgoing_calls_toolbar").hide(),$$("grouped_reports_toolbar")&&$$("grouped_reports_toolbar").hide(),$$("phoneExcelButton")&&$$("phoneExcelButton").hide(),$$("lost_calls_toolbar")&&$$("lost_calls_toolbar").hide(),$$("agents_grouped_reports_toolbar")&&$$("agents_grouped_reports_toolbar").hide(),$$("queues_grouped_reports_toolbar")&&$$("queues_grouped_reports_toolbar").hide(),$$("operators_work_report_toolbar")&&$$("operators_work_report_toolbar").hide(),$$("interval_reports_toolbar")&&$$("interval_reports_toolbar").hide(),$$("daily_report_toolbar")&&$$("daily_report_toolbar").hide(),$$("month_traffic_toolbar")&&$$("month_traffic_toolbar").hide(),$$("hourly_traffic_toolbar")&&$$("hourly_traffic_toolbar").hide(),$$("compare_calls_toolbar")&&$$("compare_calls_toolbar").hide(),$$("ext_incoming_external_toolbar")&&$$("ext_incoming_external_toolbar").hide(),$$("ext_incoming_internal_toolbar")&&$$("ext_incoming_internal_toolbar").hide(),$$("ext_outgoing_toolbar")&&$$("ext_outgoing_toolbar").hide(),$$("checklist_toolbar")&&$$("checklist_toolbar").hide(),$$("dashboard_toolbar")&&$$("dashboard_toolbar").hide(),$$("reports_toolbar")&&$$("reports_toolbar").hide(),$$("outgoingcampaign-toolbar")&&$$("outgoingcampaign-toolbar").hide(),$$("users_toolbar")&&$$("users_toolbar").hide(),$$("aliases_toolbar")&&$$("aliases_toolbar").hide(),$$("groups_toolbar")&&$$("groups_toolbar").hide(),$$("contact_groups_toolbar")&&$$("contact_groups_toolbar").hide(),$$("phones_toolbar")&&$$("phones_toolbar").hide(),$$("queues_toolbar")&&$$("queues_toolbar").hide(),$$("channels_toolbar")&&$$("channels_toolbar").hide(),$$("scripts_toolbar")&&$$("scripts_toolbar").hide(),$$("clients_toolbar")&&$$("clients_toolbar").hide(),$$("phones_groups_toolbar")&&$$("phones_groups_toolbar").hide(),$$("blacklist_toolbar")&&$$("blacklist_toolbar").hide()},e.prototype.removeFromTable=function(e,t,i,o,r){t&&e&&($$(o)&&(webix.extend($$(o),webix.ProgressBar),$$(o).disable(),$$(o).showProgress()),webix.ajax().post(t,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),$$(o)&&($$(o).enable(),$$(o).hideProgress())},success:function(t,n,a){n=n.json(),$$(o)&&($$(o).enable(),$$(o).hideProgress()),n.result?(webix.message({type:"success",text:n.message}),r?r():$$(i)&&$$(i).remove(e)):webix.message({type:"error",text:n.message})}}))},e.prototype.loadTable=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!$$(e))return!1;t?(console.log(1),$$(e).load(t,"json",function(){i&&i()})):$$(e)._feed_last.url&&(console.log(2),$$(e).load($$(e)._feed_last.url,"json",function(){i&&i()})),$$(e).filterByAll()},e.prototype.loadAliasesTable=function(){$$("aliases").clearAll(),$$("aliases").loadNext(null,null,null,"/aliases/list")},e.prototype.loadUserTable=function(){$$("users").clearAll(),$$("users").loadNext(null,null,null,"/users/list")},e.prototype.loadBlacklistTable=function(){$$("blacklist").clearAll(),$$("blacklist").loadNext(null,null,null,"/blacklist")},e.prototype.getDateRange=function(e){var t=$$(e).getValue(),i=t.start,o=i.getMonth()+1,r=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),n=t.end;if(n)var a=n.getMonth()+1,s=n.getFullYear()+"-"+a+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":59";else var s="";return{start:r,end:s}},e.prototype.billing_analysis_outgoing_calls_refresh=function(){var e=webix.guiutils.getDateRange("reportDateRange"),t="?filter[t1]="+e.start+"&filter[t2]="+e.end;$$("traffic_for_period").load("/legacy/traffic_for_period"+t),$$("popular_city_for_period").load("/legacy/popular_city_for_period"+t),$$("popular_longdistance_over_period").load("/legacy/popular_longdistance_over_period"+t),$$("popular_cell_for_period").load("/legacy/popular_cell_for_period"+t),$$("most_calling_employees_for_period").load("/legacy/most_calling_employees_for_period"+t)},e.prototype.checklistFillWindow=function(e,t,i){webix.ui({id:"checklist_fill_win",view:"window",title:"",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:i?"Результаты заполнения чеклиста":"Заполнение чеклиста"},{view:"icon",icon:"wxi-close",click:"$$('checklist_fill_win').close();"}]},resize:!0,width:700,height:500,center:!0,position:"center",modal:!0,move:!0,body:{rows:[{view:"datepicker",label:"Дата",labelWidth:100,labelAlign:"right",editable:!0,timepicker:!1,format:"%D, %d.%m.%Y",value:i?t:new Date,id:"questions_answers_date",stringResult:!1},{view:"richselect",id:"questions_answers_agent",label:"Менеджер",labelWidth:100,labelAlign:"right",options:"/legacy/ext_dashboard_agentslist/"+e+"/short"},{view:"richselect",id:"questions_answers_checklist",label:"Группа",labelWidth:100,labelAlign:"right",options:"/legacy/ext/checklists/groups/",on:{onChange:function(e,t){$$("questions_answers").clearAll();var i=$$("questions_answers_checklist_block");i.getList().clearAll(),i.getList().load("/legacy/ext/checklists/groups/"+e),i.setValue(0),i.show()}}},{view:"richselect",id:"questions_answers_checklist_block",label:"Блок",labelWidth:100,labelAlign:"right",options:[],hidden:!0,on:{onChange:function(i,o){$$("questions_answers").clearAll(),i?($$("questions_answers").load("/legacy/ext/checklist/list/"+i+"/"+e+"/"+t),$$("questions_answers_save").enable()):$$("questions_answers_save").disable()}}},{view:"datatable",id:"questions_answers",autowidth:!0,editable:!0,columns:[{id:"question",header:"Вопрос",width:250},{id:"answer",header:"Ответ",width:80,editor:"select",options:["0","3","5"]},{id:"comment",header:"Комментарий",width:250,editor:"text"}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{},{id:"questions_answers_save",view:"button",label:"Сохранить",disable:!0,click:function(){var e=[];$$("questions_answers").editStop();var t=$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(i){i.user_id=t,e.push(i)});var i=JSON.stringify(e),o=webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklists/fill/"+o,i,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при сохранении."})},success:function(e,t,i){webix.message({type:"success",text:"Операция сохранения успешно завершена."}),$$("checklist_fill_win").close()}})}},{view:"button",label:"Закрыть",click:"$$('checklist_fill_win').close();"},{view:"button",id:"delete_change_answers",label:"Удалить запись",click:function(){var e=[];$$("questions_answers").editStop();$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(t){e.push(t)});var t=JSON.stringify(e);webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklist/deleteanswer",t,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при удалении"})},success:function(e,t,i){webix.message({type:"success",text:"Успешно удалено."}),$$("checklist_fill_win").close();var o=$$("ext_checklist_table"),r=o.getSelectedItem();o.remove(r.id);var n=$$("ext_checklist_start").getValue(),a=$$("ext_checklist_finish").getValue();o.load("/legacy/ext/checklist/tree/"+n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+"/"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"/"+r.$parent)}})}},{view:"button",id:"save_change_answers",label:"Сохранить изменения",click:function(){var t=[];$$("questions_answers").editStop();$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(i){i.user_id=e,t.push(i)});var i=JSON.stringify(t),o=webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklists/change/"+o,i,{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при изменении."})},success:function(e,t,i){webix.message({type:"success",text:"Успешно изменено."}),$$("checklist_fill_win").close();var r=$$("ext_checklist_table"),n=r.getSelectedItem();o!=n.date&&r.remove(n.id),1==n.open&&r.remove(n.id);var a=$$("ext_checklist_start").getValue(),s=$$("ext_checklist_finish").getValue();r.load("/legacy/ext/checklist/tree/"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"/"+s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+"/"+n.$parent)}})}}]}]},on:{onShow:function(){0==i&&($$("delete_change_answers").hide(),$$("save_change_answers").hide()),0!=i&&($$("questions_answers").clearAll(),$$("questions_answers").load("/legacy/ext/checklist/list/"+i+"/"+e+"/"+t),$$("questions_answers_save").hide(),$$("questions_answers_agent").hide(),$$("questions_answers_checklist").hide(),$$("questions_answers_checklist_block").hide())}}}).show()},e.prototype.getNpsFilter=function(){if($$("rangePickerFilter")){var e=$$("rangePickerFilter").getValue();if(e.start)var t=webix.Date.dateToStr("%Y-%m-%d %H:%i:%s")(new Date(e.start));if(e.end)var i=webix.Date.dateToStr("%Y-%m-%d %H:%i:%s")(new Date(e.end))}if($$("filialFilter"))var o=$$("filialFilter").getText();if($$("cityFilter"))var r=$$("cityFilter").getText();if($$("channel"))var n=$$("channel").getText();webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/count",{filter:{end:i,start:t,city:r,filial:o,channel:n}},{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,i){var o=t.json();$$("countList").clearAll(),$$("countList").parse(o)}}),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/count",{filter:{end:i,start:t,city:r,filial:o,channel:n},byCities:1},{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,i){var o=t.json();$$("countListByCities").clearAll(),$$("countListByCities").parse(o)}}),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/promoters",{filter:{end:i,start:t,city:r,filial:o,channel:n}},{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,a,s){webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/detractors",{filter:{end:i,start:t,city:r,filial:o,channel:n}},{error:function(e,t,i){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,i){var o=a.json(),r=t.json(),n=[],s=[];if(r&&o){for(var l in r)r[l].sales==o[l].sales&&0==o[l].sales||(n.push(o[l]),s.push(r[l]));$$("detractorsList").clearAll(),$$("detractorsList").parse(s),$$("promotersList").clearAll(),$$("promotersList").parse(n)}}})}})},e.prototype.getPdfChart=function(e){webix.require("https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js").then(function(){domtoimage.toJpeg($$(e).$view,{quality:.95,bgcolor:"#fff"}).then(function(e){pdfjs.load("//cdn.webix.com//extras/pt-sans.regular.ttf",function(t,i){var o=new pdfjs.Document;pdfjs.load(e,function(e,t){var i=new pdfjs.Image(t);o.image(i);var r=o.render(),n=new Blob([r.toString()],{type:"application/pdf"}),a=$$("rangePickerFilter").getValue();if(a.start)var s=webix.Date.dateToStr("%d.%m.%Y")(new Date(a.start));else if(a.end)var s=webix.Date.dateToStr("%d.%m%Y")(new Date(a.end));if(a.end)var l=webix.Date.dateToStr("%d.%m%Y")(new Date(a.end));else var l=s;webix.html.download(n,"NPS_Dashboard_"+s+"-"+l+".pdf")})})})})},e.prototype.getExtDashboardFilterData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=$$("reportDateRange").getValue(),i=t.start,o=i.getMonth()+1,r=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),n=t.end;if(n)var a=n.getMonth()+1,s=n.getFullYear()+"-"+a+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":59";else var s="";var l=$$("queues-select").getValue(),c=$$("agents").getValue(),d=$$("hours").getValue();return e?"filter[t1]="+r+"&filter[t2]="+s+"&filter[queues]="+l+"&filter[agents]="+c+"&filter[hours]="+d:{"filter[t1]":r,"filter[t2]":s,"filter[queues]":l,"filter[agents]":c,"filter[hours]":d}},e.prototype.getUrlParameter=function(e){var t=decodeURIComponent(window.location.search.substring(1));t||window.location.href.split("?")[1]&&(t=window.location.href.split("?")[1]);var i,o,r=t.split("&");for(o=0;o<r.length;o++)if(i=r[o].split("="),i[0]===e)return void 0===i[1]||i[1]},e.prototype.formatTime=function(e){var t=Math.floor(e/60),i=e-60*t;return t+":"+(i>9?i:"0"+i)},e.prototype.timeFilterConfig=function(){return{mode:"number",conditions:[{id:"greater",value:"больше",batch:"counter",handler:function(e,t){return e>t}},{id:"less",value:"меньше",batch:"counter",handler:function(e,t){return e<t}},{id:"between",value:"между",batch:"rangeslider",handler:function(e,t){return e>=t[0]&&e<=t[1]}}],inputs:["text",{view:"counter",batch:"counter",on:{onChange:function(){this.queryView("filter","parent").applyFilter()},onTimedKeyPress:function(){this.queryView("filter","parent").applyFilter()}}},{view:"rangeslider",max:120,min:0,step:1,moveTitle:!1,batch:"rangeslider",title:function(e){var t=e.value;return(t[0]===t[1]?t[0]:t[0]+" - "+t[1])+" сек."},on:{onChange:function(){this.queryView("filter","parent").applyFilter()}}}]}},e.prototype.sqlDate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return webix.Date.dateToStr("%Y-%m-%d")(e)},e.prototype.sqlDateTime=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return webix.Date.dateToStr("%Y-%m-%d %H:%i:%s")(e)},e.prototype.formatTime=function(e){var t=Math.floor(e/60),i=e-60*t;return t+":"+(i>9?i:"0"+i)},e.prototype.сallReasonToTxt=function(e){var t="";switch(e){case"EXITWITHTIMEOUT":t="Не дождался ответа";break;case"ANSWERED":t="Разговор состоялся";break;case"COMPLETEAGENT":t="Завершен оператором";break;case"RINGNOANSWER":t="Оператор не ответил";break;case"NO ANSWER":t="Нет ответа";break;case"ABANDON":t="Брошенный";break;case"FAILED":t="Ошибка набора";break;case"BUSY":t="Занято";break;case"TRANSFER":t="Переведен";break;case"COMPLETECALLER":t="Завершен клиентом";break;default:t=e}return t},e.prototype.сallStateToTxt=function(e){var t="";switch(e){case"1":t="активный";break;case"2":t="заблокирован";break;case"3":t="удален";break;case"4":t="скрытый";break;default:t=e}return t},e.prototype.getColorCicle=function(e){var t="";switch(e){case"1":t="greencircle_state";break;case"2":case"3":t="redcircle_state";break;case"4":t="disablecircle_state";break;default:t=e}return t},e.prototype.roundNumber=function(e,t){if((""+e).includes("e")){var i=(""+e).split("e"),o="";return+i[1]+t>0&&(o="+"),+(Math.round(+i[0]+"e"+o+(+i[1]+t))+"e-"+t)}return+(Math.round(e+"e+"+t)+"e-"+t)},e.prototype.getMenuData=function(e){var t=[];return e.forEach(function(e){if(e.hasOwnProperty("rules")&&e.rules){if(webix.auth.isAllowedRoles(e.rules))t.push(e);else if(e.subrules){var i=webix.guiutils.getMenuData(e.data);i&&i.length&&(e.data=i,t.push(e))}}else t.push(e)}),t},e.prototype.updateControls=function(){var e=$$("cfwd.noanswer.switch"),t=$$("cfwd.all.switch"),i=$$("cfwd.divert"),o=$$("cfwd.duration.of.redirection"),r=$$("cfwd.notify");if(e&&t){1==e.getValue()?($$("cfwd.noanswer.timeout").enable(),$$("cfwd.noanswer").enable()):($$("cfwd.noanswer.timeout").disable(),$$("cfwd.noanswer").disable(),$$("cfwd.noanswer").setValue(""),$$("cfwd.noanswer.timeout").setValue(""));if(1==t.getValue()?$$("cfwd.all").enable():($$("cfwd.all").disable(),$$("cfwd.all").setValue("")),i&&o){o=o.getValue();if(1==i.getValue()?("2"==o?($$("cfwd.limit.from").enable(),$$("cfwd.limit.to").enable()):($$("cfwd.limit.from").setValue(""),$$("cfwd.limit.to").setValue(""),$$("cfwd.limit.from").disable(),$$("cfwd.limit.to").disable()),$$("cfwd.limit.days").enable(),$$("cfwd.duration.of.redirection").enable()):($$("cfwd.limit.from").disable(),$$("cfwd.limit.to").disable(),$$("cfwd.limit.days").disable(),$$("cfwd.duration.of.redirection").disable(),$$("cfwd.limit.from").setValue(""),$$("cfwd.limit.to").setValue(""),$$("cfwd.duration.of.redirection").setValue(1),$$("cfwd.limit.days").setValue("")),r){"2"==r.getValue()?$$("cfwd.notify.message").enable():$$("cfwd.notify.message").disable()}}}},e}())}]);
!function(e){function t(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/codebase/",t(t.s=98)}([function(e,t,o){"use strict";var i=o(102);o.d(t,"a",function(){return i.a});var n=o(31);o.d(t,"b",function(){return n.a});var r=(o(78),o(108),o(109),o(110),o(111)),a=o(112),s=o(115),l=o(116),c=o(117),u=o(118),d=o(119);r.a,a.a,s.a,c.a,d.a,l.a,u.a;window.Promise||(window.Promise=webix.promise)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(60),l=o(61),c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.getView=function(){return{id:"outgoingcampaign",hidden:!0,rows:[(new s.default).getView(),(new l.default).getView()]}},t.prototype.init=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="",l="",c=1,u=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"interval_reports_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"option_interval_reports",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"src_change_interval_reports",view:"text",type:"search",label:"Источник",value:l},{id:"filter_interval_reports",view:"richselect",label:"Тип звонков",labelWidth:100,width:333,value:s,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{id:"interval_interval_reports",view:"richselect",label:"Тип звонков",labelWidth:100,width:266,value:c,options:[{id:1,value:"По дням"},{id:2,value:"По дням недели"},{id:3,value:"По часам"},{id:4,value:"По месяцам"}],on:{onChange:function(){c=$$("interval_interval_reports").getValue()}}},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("filter_interval_reports").getValue()&&e++,s=$$("filter_interval_reports").getValue(),""!=$$("src_change_interval_reports").getValue()&&e++,l=$$("src_change_interval_reports").getValue(),e>0?($$("option_interval_reports").define("badge",e),$$("option_interval_reports").define("label","Опции"),$$("option_interval_reports").define("icon","check"),$$("option_interval_reports").refresh()):($$("option_interval_reports").define("badge",e),$$("option_interval_reports").define("label","Доп.опции"),$$("option_interval_reports").define("icon","wxi-plus"),$$("option_interval_reports").refresh()),$$("filter_interval_reports").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("filter_interval_reports").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_interval_reports",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_interval_reports")}},{id:"search_interval_reports",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){$$("interval_reports_table").enable(),$$("chart_total_calls").enable(),$$("chart_served_calls").enable(),$$("chart_unserved_calls").enable(),$$("chart_talktime").enable(),$$("chart_holdtime").enable(),$$("interval_reports_table").getFilter("calldate").value="",$$("interval_reports_table").getFilter("calls_total").value="",$$("interval_reports_table").getFilter("calls_served").value="",$$("interval_reports_table").getFilter("calls_unserved").value="",$$("interval_reports_table").getFilter("sum_talktime").value="",$$("interval_reports_table").getFilter("sum_holdtime").value="";var e=webix.guiutils.getDateRange("reportDateRange"),t="?filter[t1]="+e.start+"&filter[t2]="+e.end;""!=l&&(t+="&filter[src]="+l),""!=s&&(t+="&filter[filter]="+s),""!=c&&(t+="&filter[type]="+c),$$("interval_reports_table").clearAll(),$$("interval_reports_table").load("/legacy/interval_reports_day"+t),1==s?($$("chart_total_calls_l").show(),$$("chart_served_calls_l").show(),$$("chart_unserved_calls_l").show(),$$("chart_talktime_l").show(),$$("chart_holdtime_l").show()):2==s?($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").show(),$$("chart_unserved_calls_l").hide(),$$("chart_talktime_l").show(),$$("chart_holdtime_l").show()):3==s?($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").hide(),$$("chart_unserved_calls_l").show(),$$("chart_talktime_l").hide(),$$("chart_holdtime_l").show()):4==s&&($$("chart_total_calls_l").hide(),$$("chart_served_calls_l").hide(),$$("chart_unserved_calls_l").hide(),$$("chart_talktime_l").hide(),$$("chart_holdtime_l").hide()),$$("chart_total_calls").clearAll(),$$("chart_total_calls").load("/legacy/interval_reports_day_chart1"+t),$$("chart_served_calls").clearAll(),$$("chart_served_calls").load("/legacy/interval_reports_day_chart2"+t),$$("chart_unserved_calls").clearAll(),$$("chart_unserved_calls").load("/legacy/interval_reports_day_chart3"+t),$$("chart_talktime").clearAll(),$$("chart_talktime").load("/legacy/interval_reports_day_chart4"+t),$$("chart_holdtime").clearAll(),$$("chart_holdtime").load("/legacy/interval_reports_day_chart5"+t)}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){switch(s){case 1:filter_interval_reports_text="Входящие - все";break;case 2:filter_interval_reports_text="Входящие - обслуженные";break;case 3:filter_interval_reports_text="Входящие - необслуженные";break;case 4:filter_interval_reports_text="Исходящие";break;default:filter_interval_reports_text="Входящие - все"}switch(c){case 1:interval_interval_reports_text="По дням";break;case 2:interval_interval_reports_text="По дням недели";break;case 3:interval_interval_reports_text="По часам";break;case 4:interval_interval_reports_text="По месяцам"}webix.toExcel($$("interval_reports_table"),{filterHTML:!0,filename:"Входящие - "+interval_interval_reports_text+" - "+filter_interval_reports_text})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=u},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="",l="",c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"daily_report_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"option_daily_report",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"dst_change_daily",view:"text",type:"search",label:"Набранный номер",value:s},{id:"src_change_daily",view:"text",type:"search",label:"Источник",value:l},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("dst_change_daily").getValue()&&e++,s=$$("dst_change_daily").getValue(),""!=$$("src_change_daily").getValue()&&e++,l=$$("src_change_daily").getValue(),e>0?($$("option_daily_report").define("badge",e),$$("option_daily_report").define("label","Опции"),$$("option_daily_report").define("icon","check"),$$("option_daily_report").refresh()):($$("option_daily_report").define("badge",e),$$("option_daily_report").define("label","Доп.опции"),$$("option_daily_report").define("icon","wxi-plus"),$$("option_daily_report").refresh()),$$("dst_change_daily").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("dst_change_daily").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_daily_report",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_daily_report")}},{id:"search_daily_report",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){$$("daily_report_table").enable();var e=webix.guiutils.getDateRange("reportDateRange"),t="/legacy/daily_report?filter[t1]="+e.start+"&filter[t2]="+e.end;""!=l&&(t+="&filter[src]="+l),""!=s&&(t+="&filter[dst]="+s),$$("daily_report_table").clearAll(),$$("daily_report_table").showProgress({type:"icon",hide:!0}),$$("daily_report_table").load(t)}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("daily_report_table"),{filterHTML:!0,filename:"По дням"})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="",l="",c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"month_traffic_toolbar",hidden:!0,cols:[{cols:[{id:"startDate_month_traffic",view:"richselect",label:"Период от",labelWidth:150,labelAlign:"right",width:300,options:"/legacy/month_traffic_period"},{}]},{cols:[{id:"finishDate_month_traffic",view:"richselect",label:"Диапазон месяцев:",labelWidth:150,labelAlign:"right",width:300,options:[{id:1,value:"-1 месяц"},{id:2,value:"-2 месяца"},{id:3,value:"-3 месяца"},{id:4,value:"-4 месяца"},{id:5,value:"-5 месяцев"},{id:6,value:"-6 месяцев"}]},{}]},{cols:[{width:27},{id:"option_month_traffic",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"dst_change_month_traffic",view:"text",type:"search",label:"Набранный номер",value:s},{id:"src_change_month_traffic",view:"text",type:"search",label:"Источник",value:l},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("dst_change_month_traffic").getValue()&&e++,s=$$("dst_change_month_traffic").getValue(),""!=$$("src_change_month_traffic").getValue()&&e++,l=$$("src_change_month_traffic").getValue(),e>0?($$("option_month_traffic").define("badge",e),$$("option_month_traffic").define("label","Опции"),$$("option_month_traffic").define("icon","check"),$$("option_month_traffic").refresh()):($$("option_month_traffic").define("badge",e),$$("option_month_traffic").define("label","Доп.опции"),$$("option_month_traffic").define("icon","wxi-plus"),$$("option_month_traffic").refresh()),$$("dst_change_month_traffic").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("dst_change_month_traffic").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_month_traffic",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_month_traffic")}},{id:"search_month_traffic",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.loadMonthTrafficReports(l,s)}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("month_traffic_table"),{filterHTML:!0,filename:"По месяцам"})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="",l="",c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"hourly_traffic_toolbar",hidden:!0,cols:[{cols:[{id:"startDate_hourly_load",view:"datepicker",width:350,label:"Период от",labelWidth:100,labelAlign:"right",timepicker:!1,format:"%Y-%m-%d",value:new Date},{}]},{cols:[{width:27},{id:"option_hourly_load",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"dst_change_hourly_load",view:"text",type:"search",label:"Набранный номер",value:s},{id:"src_change_hourly_load",view:"text",type:"search",label:"Источник",value:l},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("dst_change_hourly_load").getValue()&&e++,s=$$("dst_change_hourly_load").getValue(),""!=$$("src_change_hourly_load").getValue()&&e++,l=$$("src_change_hourly_load").getValue(),e>0?($$("option_hourly_load").define("badge",e),$$("option_hourly_load").define("label","Опции"),$$("option_hourly_load").define("icon","check"),$$("option_hourly_load").refresh()):($$("option_hourly_load").define("badge",e),$$("option_hourly_load").define("label","Доп.опции"),$$("option_hourly_load").define("icon","wxi-plus"),$$("option_hourly_load").refresh()),$$("dst_change_hourly_load").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("dst_change_hourly_load").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_hourly_load",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_hourly_load")}},{}]},{cols:[{width:27},{id:"search_hourly_load",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){$$("hourly_load_table").enable(),$$("hourly_load_chart").enable(),$$("hourly_load_chart_asr").enable();var e="/legacy/hourly_load",t="";if(""!=$$("startDate_hourly_load").getValue()){var o=new Date($$("startDate_hourly_load").getValue()),i=o.getDate(),n=o.getMonth()+1;t+="?filter[t1]="+o.getFullYear()+"-"+n+"-"+i}""!=l&&(t.length?t+="&":t+="?",t+="filter[src]="+l),""!=s&&(t.length?t+="&":t+="?",t+="filter[dst]="+s);var r=webix.ajax(e+t,function(e){return e});$$("hourly_load_table").clearAll(),$$("hourly_load_table").showProgress({type:"icon",hide:!0}),$$("hourly_load_table").parse(r),$$("hourly_load_chart").clearAll(),$$("hourly_load_chart").load(e+"_chart1"+t),$$("hourly_load_chart").refresh(),$$("hourly_load_chart_asr").clearAll(),$$("hourly_load_chart_asr").load(e+"_chart2"+t),$$("hourly_load_chart_asr").refresh()}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("hourly_load_table"),{filterHTML:!0,filename:"По часам"})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="",l="",c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"compare_calls_toolbar",hidden:!0,cols:[{cols:[{id:"startDate_compare_calls",view:"datepicker",width:344,label:"Период от",labelWidth:200,labelAlign:"right",timepicker:!1,format:"%Y-%m-%d",value:new Date},{}]},{cols:[{id:"finishDate_compare_calls",view:"richselect",label:"Диапазон дней для сравнения:",labelWidth:223,width:344,value:1,options:[{id:1,value:"-1 день"},{id:2,value:"-2 дня"},{id:3,value:"-3 дня"},{id:4,value:"-4 дня"},{id:5,value:"-5 дней"}]},{}]},{cols:[{width:71},{id:"option_compare_calls",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"dst_change_compare_calls",view:"text",type:"search",label:"Набранный номер",value:s},{id:"src_change_compare_calls",view:"text",type:"search",label:"Источник",value:l},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("dst_change_compare_calls").getValue()&&e++,s=$$("dst_change_compare_calls").getValue(),""!=$$("src_change_compare_calls").getValue()&&e++,l=$$("src_change_compare_calls").getValue(),e>0?($$("option_compare_calls").define("badge",e),$$("option_compare_calls").define("label","Опции"),$$("option_compare_calls").define("icon","check"),$$("option_compare_calls").refresh()):($$("option_compare_calls").define("badge",e),$$("option_compare_calls").define("label","Доп.опции"),$$("option_compare_calls").define("icon","wxi-plus"),$$("option_compare_calls").refresh()),$$("dst_change_compare_calls").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("dst_change_compare_calls").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_compare_calls",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_compare_calls")}},{id:"search_compare_calls",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){$$("compare_calls_table").enable();var e="";if(""!=$$("startDate_compare_calls").getValue()){var t=new Date($$("startDate_compare_calls").getValue()),o=t.getDate(),i=t.getMonth()+1,n=t.getFullYear();e+="?filter[t1]="+n+"-"+i+"-"+o}""!=$$("finishDate_compare_calls").getValue()&&(e+="&filter[t2]="+$$("finishDate_compare_calls").getValue()),""!=l&&(e+="&filter[src]="+l),""!=s&&(e+="&filter[dst]="+s),webix.extend($$("compare_calls_table"),webix.ProgressBar),$$("compare_calls_table").showProgress();var r=webix.ajax("/legacy/compare_calls"+e,function(e){return $$("compare_calls_table").hideProgress(),e});$$("compare_calls_table").clearAll(),$$("compare_calls_table").parse(r),$$("compare_calls_chart").clearAll(),$$("compare_calls_chart").load("/legacy/compare_calls_chart"+e);var t=new Date($$("startDate_compare_calls").getValue()),o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear(),a=o+"-"+i+"-"+n;t=new Date($$("startDate_compare_calls").getValue()-864e5),o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear();var c=o+"-"+i+"-"+n;t=new Date($$("startDate_compare_calls").getValue()-1728e5),o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear();var u=o+"-"+i+"-"+n;t=new Date($$("startDate_compare_calls").getValue()-2592e5),o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear();var d=o+"-"+i+"-"+n;t=new Date($$("startDate_compare_calls").getValue()-3456e5),o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear();var p=o+"-"+i+"-"+n;1==$$("finishDate_compare_calls").getValue()?$$("compare_calls_chart").define({legend:{values:[{text:a,color:"#1293f8"}],align:"right",valign:"middle",layout:"y",width:100,margin:8}}):2==$$("finishDate_compare_calls").getValue()?$$("compare_calls_chart").define({legend:{values:[{text:c,color:"#1293f8"},{text:a,color:"#66cc00"}],align:"right",valign:"middle",layout:"y",width:100,margin:8}}):3==$$("finishDate_compare_calls").getValue()?$$("compare_calls_chart").define({legend:{values:[{text:u,color:"#1293f8"},{text:c,color:"#66cc00"},{text:a,color:"#FF6633"}],align:"right",valign:"middle",layout:"y",width:100,margin:8}}):4==$$("finishDate_compare_calls").getValue()?$$("compare_calls_chart").define({legend:{values:[{text:d,color:"#1293f8"},{text:u,color:"#66cc00"},{text:c,color:"#FF6633"},{text:a,color:"#CC0033"}],align:"right",valign:"middle",layout:"y",width:100,margin:8}}):5==$$("finishDate_compare_calls").getValue()&&$$("compare_calls_chart").define({legend:{values:[{text:p,color:"#1293f8"},{text:d,color:"#66cc00"},{text:u,color:"#FF6633"},{text:c,color:"#CC0033"},{text:a,color:"#009933"}],align:"right",valign:"middle",layout:"y",width:100,margin:8}}),$$("compare_calls_chart").refresh()}},{}]},{cols:[{width:71},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("compare_calls_table"),{filterHTML:!0,filename:"Сравнить"})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"ext_incoming_external_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"search_ext_incoming_external",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){var e=webix.guiutils.getDateRange("reportDateRange"),t="legacy/ext_incoming_external_total?filter[t1]="+e.start+"&filter[t2]="+e.end;$$("ext_incoming_external_table").clearAll(),$$("ext_incoming_external_table").load(t)}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e=webix.guiutils.getDateRange("reportDateRange");if($$("ext_incoming_internal_talbe").isVisible())var t=$$("ext_incoming_internal_talbe").getFilter("number").value,o=$$("ext_incoming_internal_talbe").getFilter("user_name").value;else var t="",o="";var i="/legacy/ext_incoming_internal?filter[t1]="+e.start+"&filter[t2]="+e.end;return o.length&&(i+="&filter[user_name]="+o),t.length&&(i+="&filter[number]="+t),i}return{id:"ext_incoming_internal_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"search_ext_incoming_internal",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",on:{onItemClick:function(){$$("ext_incoming_internal_talbe").clearAll(),$$("ext_incoming_internal_talbe").load(e())}}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"ext_outgoing_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"search_ext_outgoing",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",on:{onItemClick:function(){var e=webix.guiutils.getDateRange("reportDateRange");if($$("ext_outgoing_table").isVisible())var t=$$("ext_outgoing_table").getFilter("number").value,o=$$("ext_outgoing_table").getFilter("user_name").value;else var t="",o="";var i="/legacy/ext_outgoing?filter[t1]="+e.start+"&filter[t2]="+e.end;o.length&&(i+="&filter[user_name]="+o),t.length&&(i+="&filter[number]="+t),$$("ext_outgoing_table").clearAll(),$$("ext_outgoing_table").load(i)}}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e;webix.ui((e={id:"checklist_setup_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('salary_setup_win').close();"}},e.head={view:"toolbar",margin:-4,cols:[{view:"label",label:"Список вопросов чеклиста"},{view:"icon",icon:"wxi-close-circle",click:"$$('checklist_setup_win').close();"}]},e.resize=!0,e.width=600,e.height=500,e.center=!0,e.position="center",e.modal=!0,e.move=!0,e.body={rows:[{cols:[{view:"richselect",id:"questions_checklist",label:"Группа",labelWidth:100,labelAlign:"right",options:"/legacy/ext/checklists/groups/",on:{onChange:function(e,t){$$("questions_list").clearAll();var o=$$("questions_checklist_block");o.getList().clearAll(),o.setValue(0),e&&(o.getList().load("/legacy/ext/checklists/groups/"+e),$$("row_questions_checklist_block").show())}}},{id:"questions_checklist_add",view:"button",type:"iconButton",icon:"wxi-plus",width:36,click:function(){t(0)}},{id:"questions_checklist_delete",view:"button",type:"iconButton",icon:"wxi-minus",width:36,click:function(){o($$("questions_checklist").getValue())}}]},{id:"row_questions_checklist_block",hidden:!0,cols:[{view:"richselect",id:"questions_checklist_block",label:"Блок",labelWidth:100,labelAlign:"right",options:[],value:1,on:{onChange:function(e,t){$$("questions_list").clearAll(),e&&($$("questions_list").load("/legacy/ext/checklist/list/"+e),$$("questions_checklist_save").enable())}}},{id:"questions_checklist_block_add",view:"button",type:"iconButton",icon:"wxi-plus",width:36,click:function(){t($$("questions_checklist").getValue())}},{id:"questions_checklist_block_delete",view:"button",type:"iconButton",icon:"wxi-minus",width:36,click:function(){o($$("questions_checklist_block").getValue())}}]},{view:"treetable",id:"questions_list",autowidth:!0,editable:!0,columns:[{id:"question",header:"Вопрос",width:450,editor:"text"}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{view:"button",id:"questions_checklist_save",disabled:!1,label:"Сохранить",click:function(){var e=$$("questions_checklist_block").getValue();if(e){var t=[];$$("questions_list").editStop(),$$("questions_list").data.each&&$$("questions_list").data.each(function(e){t.push(e)});var o=JSON.stringify(t);webix.ajax().post("/legacy/ext/checklist/questions/save/"+e,o,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при сохранении."})},success:function(e,t,o){webix.message({type:"success",text:"Операция сохранения успешно завершена."})}})}}},{view:"button",label:"Закрыть окно",click:"$$('checklist_setup_win').close();"}]}]},e)).show()}function t(e){webix.ui({view:"window",height:200,width:300,modal:!0,position:"center",head:e?"Добавление блока":"Добавление группы",body:{view:"form",elements:[{view:"text",name:"name",label:"Название",value:""},{cols:[{view:"button",label:"Добавить",click:function(){var t=this.getFormView().elements.name.getValue(),o={addgroup:t,parent_id:e};this.getFormView().getParentView().close(),webix.ajax().post("/legacy/ext/checklist/addgroup",o,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при добавлении."})},success:function(t,o,i){if(webix.message({type:"success",text:"Операция добавления успешно завершена."}),e){$$("questions_list").clearAll();var n=$$("questions_checklist_block");n.getList().clearAll(),n.getList().load("/legacy/ext/checklists/groups/"+e),n.setValue(o.json().id)}else{$$("questions_list").clearAll();var n=$$("questions_checklist_block");n.getList().clearAll(),n.setValue(0),n=$$("questions_checklist"),n.getList().clearAll(),n.getList().load("/legacy/ext/checklists/groups/"),n.setValue(o.json().id)}}})}},{view:"button",label:"Отмена",click:function(){this.getFormView().getParentView().close()}}]}]}}).show()}function o(e){webix.ui({view:"window",height:200,width:300,modal:!0,position:"center",head:"Удалить выбранную группу вопросов?",body:{view:"form",elements:[{cols:[{view:"button",label:"Удалить",click:function(){var t={deletegroup:e};this.getFormView().getParentView().close(),webix.ajax().post("/legacy/ext/checklist/deletegroup",t,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при удалении."})},success:function(e,t,o){webix.message({type:"success",text:"Операция удаления успешно завершена."});var i=$$("questions_checklist_block");i.getList().clearAll(),i.setValue(0),i=$$("questions_checklist"),i.getList().clearAll(),i.getList().load("/legacy/ext/checklists/groups/"),i.setValue(0),$$("questions_checklist_save").disable(),$$("row_questions_checklist_block").hide()}})}},{view:"button",label:"Отмена",click:function(){this.getFormView().getParentView().close()}}]}]}}).show()}return{id:"checklist_toolbar",hidden:!0,cols:[{id:"checklist_questions_fill",view:"button",type:"iconButton",icon:"wxi-commenting-o",width:155,label:"Заполнить",click:function(){webix.guiutils.checklistFillWindow(0,0,0)}},{view:"daterangepicker",id:"date_checklist",width:380,label:"Период",timepicker:!0,format:"%d.%m.%Y %H:%i",value:{start:webix.Date.add(new Date,-1,"month"),end:new Date}},{id:"checklist_reload",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Поиск",click:function(){$$("ext_checklist_table").clearAll();var e=webix.guiutils.getDateRange("reportDateRange");webix.extend($$("ext_checklist_table"),webix.ProgressBar),$$("ext_checklist_table").showProgress(),$$("ext_checklist_table").load("/legacy/ext/checklist/tree?start="+e.start+"&finish="+e.end)}},{view:"button",type:"iconButton",icon:"wxi-file",width:185,label:"Поиск и развернуть",click:function(){$$("ext_checklist_table").clearAll();var e=webix.guiutils.getDateRange("reportDateRange");webix.extend($$("ext_checklist_table"),webix.ProgressBar),$$("ext_checklist_table").showProgress(),$$("ext_checklist_table").load("/legacy/ext/checklist/tree?start="+e.start+"&finish="+e.end+"&open=1")}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:155,label:"Экспорт в Excel",click:function(){webix.toExcel($$("ext_checklist_table"))}},{},{id:"checklist_questions_list",view:"button",type:"iconButton",icon:"fa fa-question",width:155,label:"Вопросы",click:function(){e()}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"dashboard_toolbar",hidden:!0,cols:[{view:"multiselect",label:"Город",id:"cityFilter",width:260,on:{onChange:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/city"},{view:"multiselect",label:"Филиал",id:"filialFilter",width:300,on:{onChange:function(){webix.guiutils.getNpsFilter()},onAfterRender:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/filial"},{width:260,view:"multiselect",label:"Канал",id:"channel",on:{onChange:function(){webix.guiutils.getNpsFilter()}},options:"/legacy/nps/options/channel"},{width:115,view:"button",type:"iconButton",icon:"wxi-sync",label:"Обновить",click:function(){webix.guiutils.getNpsFilter()}},{view:"button",label:"Export to PDF",width:140,click:function(){webix.guiutils.getPdfChart("charts")}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"reports_toolbar",hidden:!0,cols:[{width:115,view:"button",type:"iconButton",icon:"wxi-sync",label:"Обновить",click:function(){$$("reports").clearAll(),webix.extend($$("reports"),webix.ProgressBar),$$("reports").showProgress(),$$("reports").load("legacy/nps/report"),$$("reports").filterByAll()}},{view:"button",label:"Export to PDF",width:140,click:function(){var e=$$("reportDateRange").getValue();if(e.start)var t=webix.Date.dateToStr("%d.%m.%Y")(new Date(e.start));else if(e.end)var t=webix.Date.dateToStr("%d.%m%Y")(new Date(e.end));if(e.end)var o=webix.Date.dateToStr("%d.%m%Y")(new Date(e.end));else var o=t;webix.toExcel($$("reports"),{filename:"NPS_Report_"+t+"-"+o,name:"NPS_Report_"+t+"-"+o})}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e=$$("clients");if(e){var t=e.getSelectedItem();t&&t.id?webix.confirm({text:"Клиент и результаты его анкетирования будут удалены. <br> Продолжить?",callback:function(e){if(!e)return!1;webix.ajax().get("legacy/nps/clients/remove",{id:t.id},function(e){e=JSON.parse(e),e.result?(webix.message({text:"Клиент удален"}),$$("clients").remove(t.id)):(webix.message({type:"error",text:e.msg}),console.log("err",e.data))})}}):webix.message({type:"error",text:"Выберите клиента!"})}else webix.message({type:"error",text:"Произошла ошибка!"})}function t(){webix.ui({view:"window",id:"importWindow",position:"center",move:!0,resizw:!0,modal:!0,width:700,height:500,scroll:!0,head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Импорт клиентов"},{view:"icon",icon:"times-circle",click:function(){webix.confirm({text:"Внесенные изменения не будут сохранены. <br/> Продолжить?",ok:"Ок",cancel:"Отмена",callback:function(e){e&&$$("importWindow").close()}})}}]},body:{id:"importForm",view:"form",elements:[{view:"uploader",value:translate("Выберите Excel или CSV файл"),on:{onBeforeFileAdd:function(e){var t=[{id:"phone",value:translate("Телефон")},{id:"name",value:translate("Имя клиента")},{id:"buyer_status",value:translate("Статус покупателя")},{id:"lastbuy_date",value:translate("Дата последней покупки")},{id:"city",value:translate("Город")},{id:"filial",value:translate("Филиал")},{id:"channel",value:translate("Канал")},{id:"motivational_p",value:translate("Мотивационная программа")}];if(t.unshift({id:"empty",value:"Выберите зачение"}),"xlsx"==e.type||"xls"==e.type)webix.DataDriver.excel.toObject(e.file).then(function(e){for(var o=e.data,i=webix.toArray($$("importData").config.columns),n=0;n<o[0].length;n++)i.insertAt({id:"field"+n,header:[{content:"selectFilter",options:t}]},n);$$("importData").refreshColumns();for(var n=0;n<o.length;n++){for(var r={},a=0;a<o[n].length;a++)r["field"+a]=o[n][a];o[n]=r}$$("importData").clearAll(),$$("importData").parse(o)});else{if("csv"==e.type){var o=new FileReader;return o.onload=function(e){for(var o=e.target.result.split("\n"),i=0;i<o.length;i++){var n={};o[i]=o[i].split("\t");for(var r=0;r<o[i].length;r++)n["field"+(r+1)]=o[i][r];o[i]=n}for(var a=[],i=0;i<o.length;i++)a.push(o[i].field1.split(";",-1));for(var s=webix.toArray($$("importData").config.columns),i=0;i<a[0].length;i++)s.insertAt({id:"field"+i,header:[{content:"selectFilter",options:t}]},i);$$("importData").refreshColumns(),$$("importData").clearAll();for(var i=0;i<a.length;i++){for(var n={},r=0;r<a[i].length;r++)n["field"+r]=a[i][r];a[i]=n,$$("importData").parse(a[i])}},o.readAsText(e.file),!1}webix.message({type:"erro",text:"Неизвестный тип файла!"})}}}},{view:"datatable",id:"importData",select:!0,resize:!0,resizeColumn:!0,columns:[],ready:function(){this.filterByAll=function(){}}},{margin:20,cols:[{view:"label",id:"import_process"},{view:"button",value:"Отмена",width:200,click:function(){$$("importWindow").close()},hidden:!0},{view:"button",id:"importButton",type:"form",value:"Импортировать",width:200,align:"right",click:function(){var e=o();i(0,$$("importData").serialize(),e)}}]}]},ready:function(){webix.extend($$("importWindow"),webix.ProgressBar)}}).show()}function o(){var e=$$("importData").serialize(),t=[];if(e&&e.length)for(var o in e[0])"id"!=o&&t.push($$("importData").getFilter(o).value);var i=!1;for(var n in t){if("phone"==t[n]){i=!0;break}i=!1}if(!i)return void webix.message({type:"error",text:"Выберите телефон"});var r=[];for(var a in t)-1!=t[a].indexOf("phone")&&(r.phone=a),-1!=t[a].indexOf("name")&&(r.name=a),-1!=t[a].indexOf("buyer_status")&&(r.buyer_status=a),-1!=t[a].indexOf("lastbuy_date")&&(r.lastbuy_date=a),-1!=t[a].indexOf("city")&&(r.city=a),-1!=t[a].indexOf("filial")&&(r.filial=a),-1!=t[a].indexOf("channel")&&(r.channel=a),-1!=t[a].indexOf("motivational_p")&&(r.motivational_p=a);return $$("importForm").disable(),webix.extend($$("importWindow"),webix.ProgressBar),webix.extend($$("importButton"),webix.ProgressBar),$$("importWindow").showProgress({type:"bottom",hide:!1,position:.1}),$$("importButton").showProgress({type:"icon",hide:!1}),r}function i(e,t,o){if(webix.extend($$("importWindow"),webix.ProgressBar),$$("importWindow").showProgress({type:"bottom",hide:!1,position:e/t.length==0?.01:e/t.length}),!(e>t.length)){for(var n=[],r=e;r<e+10&&r<t.length;r++)if(t[r]){var a={phone:String(t[r]["field"+o.phone]),name:"undefined"!=String(t[r]["field"+o.name])?String(t[r]["field"+o.name]):null,buyer_status:"undefined"!=String(t[r]["field"+o.buyer_status])?String(t[r]["field"+o.buyer_status]):null,lastbuy_date:"undefined"!=String(t[r]["field"+o.lastbuy_date])?String(t[r]["field"+o.lastbuy_date]):null,city:"undefined"!=String(t[r]["field"+o.city])?String(t[r]["field"+o.city]):null,filial:"undefined"!=String(t[r]["field"+o.filial])?String(t[r]["field"+o.filial]):null,channel:"undefined"!=String(t[r]["field"+o.channel])?String(t[r]["field"+o.channel]):null,motivational_p:"undefined"!=String(t[r]["field"+o.motivational_p])?String(t[r]["field"+o.motivational_p]):null};a.phone.length&&n.push(a)}console.log(n),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/clients/import",{data:JSON.stringify(n)},{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e}),$$("importForm").enable(),$$("importWindow").hideProgress(),$$("importButton").hideProgress()},success:function(e,n,a){var s=n.json();if(!s||!s.result)return webix.message({type:"error",text:"Произошла ошибка при обработке данных.<br/>"+e}),$$("importForm").enable(),$$("importWindow").hideProgress(),void $$("importButton").hideProgress();$$("import_process").setHTML("Импортировано "+r+" из "+t.length),$$("import_process").show(),r<t.length-1?i(r,t,o):($$("importButton").hideProgress(),$$("importButton").hide(),$$("importWindow").showProgress({type:"bottom",hide:!1,position:1}),webix.alert("Импорт успешно завершен",function(e){e&&($$("importWindow").close(),$$("clients").loadNext(20,0,null,"controllers/clients.php"))}))}})}}return{id:"clients_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-file",width:260,label:translate("Import from Excel or CSV"),click:function(){t()}},{view:"button",type:"iconButton",id:"reloadClients",width:115,icon:"wxi-sync",label:"Обновить",click:function(){$$("clients").load($$("clients").config.url)}},{view:"button",type:"iconButton",icon:"wxi-trash",width:105,label:translate("Удалить"),click:function(){e()}},{width:0}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(15),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";$$("outgoingcampaign-toolbar").hide(),$$("outgoingcampaigns").hide(),$$("outgoingcampaign-form").show(),e&&$$("co-form").setValues(e)}function t(e,t){webix.ajax().get("outgoingcampaign/"+t+"/state/"+e).then(function(e){var t=e.json();t.result?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),$$("outgoingcampaigns").load($$("outgoingcampaigns").config.url)):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}return{id:"outgoingcampaign-toolbar",hidden:!0,cols:[{view:"button",maxWidth:"300",label:"Новая кампания",click:function(){e()}},{view:"button",maxWidth:"300",label:"Правила по умолчанию",click:function(){this.$scope.ui(s.OCRulesWnd).showWindow(this.$scope.$view),$$("co-settings-result").load("/outgoingcampaign/0/settings").then(function(){$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")})}},{view:"button",maxWidth:"150",label:"СТАРТ",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(2,e.id):webix.message({type:"error",text:"Выберите кампанию для запуска"})}},{view:"button",maxWidth:"150",label:"ПАУЗА",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(3,e.id):webix.message({type:"error",text:"Выберите кампанию для приостановки"})}},{view:"button",maxWidth:"150",label:"СТОП",click:function(){var e=$$("outgoingcampaigns").getSelectedItem();e&&e.id?t(4,e.id):webix.message({type:"error",text:"Выберите кампанию для остановки"})}}]}},t.prototype.init=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"OCRulesWnd",function(){return l});var a=o(0),s=function(){var e=[];return $$("co-settings-result").serialize().forEach(function(t){var o={};parseInt(t.pause)&&(o.pause=1,o.pause_time=t.pause_time),parseInt(t.stop)?o.stop=1:parseInt(t.postpone_for_radio)?o.postpone_for=t.postpone_for:parseInt(t.postpone_to)&&(o.postpone_to=t.postpone_to_date),o.result=t.id,e.push(o)}),e},l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e=$$("co-form").getValues();$$("min_call_time")&&!$$("min_call_time").getValue()&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))}return{id:"co-setup-window",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:500,width:900,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Расширенные настройки",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){$$("co-setup-window").close()}}]},body:{view:"form",id:"co-setup-form",scroll:!0,elements:[{view:"fieldset",label:"Действия после звонка",body:{rows:[{view:"form",id:"settings-form",elements:[{cols:[{view:"fieldset",label:"Результат",body:{view:"list",width:250,height:200,select:"row",id:"co-settings-result",data:[],on:{onAfterSelect:function(){e(),$$("settings-form").save()},onAfterRender:function(){e()},onDataUpdate:function(){}},ready:function(){}}},{view:"fieldset",label:"Campaning",width:200,body:{height:200,rows:[{view:"checkbox",name:"pause",labelRight:"Пауза обработки после звонка",labelWidth:0},{view:"counter",name:"pause_time",value:0,label:"секунд",labelAlign:"right"},{view:"text",name:"result",label:"result"}]}},{view:"fieldset",label:"Контакт",body:{height:200,rows:[{view:"radio",name:"stop",id:"stop",value:0,options:[{id:1,value:"Прекратить"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_to_date").disable(),$$("postpone_for").disable(),$$("postpone_to").setValue(0),$$("postpone_for_radio").setValue(0))}}},{cols:[{view:"radio",value:0,id:"postpone_for_radio",name:"postpone_for_radio",options:[{id:1,value:"Отложить на"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_for").enable(),$$("postpone_to_date").disable(),$$("postpone_to").setValue(0),$$("stop").setValue(0))}}},{view:"counter",value:0,name:"postpone_for",id:"postpone_for",labelRight:"секунд",disabled:!0,on:{onChange:function(e,t){e?($$("postpone_for_radio").setValue(1),this.enable(),$$("stop").setValue(0),$$("postpone_to").setValue(0),$$("postpone_to_date").disable()):($$("postpone_for_radio").setValue(0),this.disable())}}}]},{cols:[{view:"radio",value:0,name:"postpone_to",id:"postpone_to",options:[{id:1,value:"Отложить до"}],on:{onChange:function(e,t){parseInt(e)>0&&($$("postpone_for").disable(),$$("postpone_to_date").enable(),$$("postpone_for_radio").setValue(0),$$("stop").setValue(0))}}},{view:"datepicker",name:"postpone_to_date",id:"postpone_to_date",timepicker:!0,disabled:!0,placeholder:"Click to select"}]}]}}]}]},{rows:[{cols:[{view:"label",label:"Минимальное время соединения для фиксации успеха"},{view:"counter",id:"min_call_time",name:"min_call_time",labelRight:"секунд"}]},{cols:[{view:"label",label:"Количество одновременных звонков"},{view:"counter",id:"concurrent_calls_limit",name:"concurrent_calls_limit"}]},{cols:[{},{view:"button",label:"Ок",click:function(){if($$("co-form")&&$$("co-form").isVisible())window.concurrent_calls_limit=$$("concurrent_calls_limit").getValue(),window.min_call_time=$$("min_call_time").getValue(),window.settingsResult=$$("co-settings-result").serialize(),$$("settings-form").save(),$$("co-setup-window").close();else{$$("settings-form").save(),console.log(s());var e=s();webix.ajax().post("outgoingcampaign/0/settings/save",{settings:e}).then(function(e){var t=e.json();t.result?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),$$("co-setup-window").close()):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}}},{view:"button",label:"Отмена",click:function(){$$("co-setup-window").close()}}]}]}]}}]}}},t.prototype.showWindow=function(){this.getRoot().show(),$$("settings-form").bind($$("co-settings-result"));var e=$$("co-form").getValues();$$("min_call_time")&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(17),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"users_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Добавить",click:function(){$$("users").unselectAll(),this.$scope.ui(s.ClientsWindow).showWindow(this.$scope.$view)}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){if($$("users").getSelectedItem()){this.$scope.ui(s.ClientsWindow).showWindow(this.$scope.$view)}else webix.message({type:"error",text:"Выберите пользователя для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("users"),{filterHTML:!0,filename:"Пользователи"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){webix.guiutils.loadUserTable()}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"ClientsWindow",function(){return l});var a=o(0),s=o(18),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e,t=[{id:"1",value:"Активный"},{id:"2",value:"Заблокирован"},{id:"3",value:"Удален"},{id:"4",value:"Скрытый"}],o=this.getThis();return{view:"window",id:"add-win",position:"center",minHeight:500,maxHeight:1500,move:!0,modal:!0,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:($$("users").getSelectedItem()?"Изменить ":"Добавить")+"  пользователя",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("add-win").close()}})}}]},body:{rows:[(e={paddingY:20,paddingX:30,elementsConfig:{labelWidth:100},width:600,view:"form",id:"add-form",minHeight:500,autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"name",label:"Логин",inputAlign:"left",labelWidth:120,required:!0},{view:"text",name:"fullname",label:"ФИО",inputAlign:"left",labelWidth:120,required:!0},{view:"textarea",name:"description",label:"Описание",inputAlign:"left",labelWidth:120,height:100},{view:"text",name:"password",id:"user-password",label:"Пароль",type:"password",inputAlign:"left",labelWidth:120},{view:"text",name:"phone",label:"Номер",inputAlign:"left",labelWidth:120},{view:"select",name:"state",label:"Статус",inputAlign:"left",labelWidth:120,options:t},{view:"multicombo",name:"user_groups_ids",label:"Группы",inputAlign:"left",labelWidth:120,autoheight:!0,options:"/users/user_groups"},{view:"multicombo",name:"rules",label:"Права доступа",inputAlign:"left",labelWidth:120,options:{body:{template:"#name#"},url:"/rules/list"}},{height:10}]},e.elementsConfig={inputAlign:"left",labelPosition:"top"},e.rules={password:function(e){return!!$$("users").getSelectedItem()||e.length}},e),{margin:10,cols:[{},{view:"button",label:"Настройки",align:"center",width:120,click:function(){this.$scope.ui(s.SettingsWindow).showWindow(o.getId(),"user")}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("add-form");if(e.validate()){e.disable();var t=e.getValues();webix.ajax().post("/users/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.message({type:"success",text:t.message}),e.enable(),webix.$$("add-win").close(),webix.guiutils.loadUserTable()):(webix.message({type:"error",text:t.message}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable(),console.log(t)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("add-win").close()}})}}]}]},on:{onShow:function(){var e=$$("users").getSelectedItem();e?e.id?(o.setId(e.id),$$("add-form").setValues(e)):o.setId(0):($$("add-form").setValues({id:0}),o.setId(0))}}}},t.prototype.getThis=function(){return this},t.prototype.getId=function(){return this.clientId},t.prototype.setId=function(e){this.clientId=e},t.prototype.showWindow=function(){this.getRoot().show()},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"SettingsWindow",function(){return s});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e=this.getThis();return{view:"window",id:"settings-win",position:"center",move:!0,modal:!0,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Настройки",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("settings-win").close()}})}}]},body:{width:800,view:"form",id:"settings-form",minHeight:500,scroll:!0,elements:[{view:"datatable",id:"settings-table",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,editable:!0,columns:[{id:"handle",header:"",fillspace:2,minWidth:50},{id:"val",header:"",fillspace:2,minWidth:150,editor:"text"},{id:"changed",hidden:!0}],ready:function(){this.getChangedSettings=function(){var e=this.serialize(),t=[];return e.forEach(function(e){parseInt(e.changed)&&t.push(e)}),t},this.save=function(){var t=$$("settings-table");t.disable();var o=t.getChangedSettings();if(!o.length)return webix.message({type:"error",text:"Изменений не зафиксированно"}),void t.enable();webix.ajax().post("/settings/"+e.getType()+"/"+e.getTypeId()+"/save",{settings:o}).then(function(e){t.enable(),e=e.json(),e.result?(webix.message({type:"success",text:"Сохранение пришло успешно"}),t.enable(),webix.$$("settings-win").close()):(webix.message({type:"error",text:"Произошла ошибка сохранения"}),t.enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),t.enable(),console.log(e)})}},on:{onEditorChange:function(e,t){this.getItem(e.row)[e.column]!=t&&(this.getItem(e.row).changed=1,this.refresh(e.row))}},scheme:{$init:function(e){e.main||(e.$css="good-row")}}},{margin:10,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){webix.confirm({text:"Все измененные данные будут сохранены. <br> Продолжить?",callback:function(e){e&&$$("settings-table").save()}})}},{view:"button",label:"Закрыть",align:"center",width:120,click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("settings-win").close()}})}}]}]},on:{onShow:function(){if(!parseInt(e.typeId))return webix.message({type:"error",text:"Произошла ошибка получения настроек"}),webix.$$("settings-win").close(),!1;$$("settings-table").load("/settings/"+e.getType()+"/"+e.getTypeId())}}}},t.prototype.getThis=function(){return this},t.prototype.setType=function(e){this.type=e},t.prototype.setTypeId=function(e){this.typeId=e},t.prototype.getType=function(){return this.type},t.prototype.getTypeId=function(){return this.typeId},t.prototype.showWindow=function(e,t){this.setType(t),this.setTypeId(e),this.getRoot().show()},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(20),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"groups_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Добавить",click:function(){$$("groups").unselectAll(),this.$scope.ui(s.GroupsWindow).showWindow(this.$scope.$view)}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){if($$("groups").getSelectedItem()){this.$scope.ui(s.GroupsWindow).showWindow(this.$scope.$view)}else webix.message({type:"error",text:"Выберите группу для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("groups"),{filterHTML:!0,filename:"Группы"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){webix.guiutils.loadTable("groups","/groups/list")}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"GroupsWindow",function(){return l});var a=o(0),s=o(18),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e=this.getThis();return{view:"window",id:"group-add-win",position:"center",move:!0,modal:!0,minHeight:500,maxHeight:1500,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Группа",inputWidth:100,align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&$$("group-add-win").close()}})}}]},body:{rows:[{view:"form",id:"group-add-form",paddingY:20,paddingX:30,width:600,minHeight:500,autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"name",label:"Название",inputAlign:"left",labelWidth:120,required:!0},{view:"textarea",name:"description",label:"Описание",inputAlign:"left",labelWidth:120,height:100},{view:"multicombo",name:"list_users_ids",label:"Пользователи",inputAlign:"left",labelWidth:120,options:"/groups/users/short"},{view:"multicombo",name:"rules",label:"Права доступа",inputAlign:"left",labelWidth:120,options:{body:{template:"#name#"},url:"/rules/list"}}],elementsConfig:{inputAlign:"left",labelPosition:"top"}},{margin:10,cols:[{},{view:"button",label:"Настройки",align:"center",width:120,click:function(){this.$scope.ui(s.SettingsWindow).showWindow(e.getId(),"group")}},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("group-add-form");if(e.validate()){e.disable();var t=e.getValues();console.log(t),webix.ajax().post("/groups/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.message({type:"success",text:t.message}),e.enable(),webix.$$("group-add-win").close(),webix.guiutils.loadTable("groups","/groups/list")):(webix.message({type:"error",text:t.text}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable(),console.log(t)})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&$$("group-add-win").close()}})}}]}]},on:{onShow:function(){var t=$$("groups").getSelectedItem();t?t.id?(e.setId(t.id),$$("group-add-form").setValues(t)):e.setId(0):($$("group-add-form").setValues({id:0}),e.setId(0))}}}},t.prototype.getThis=function(){return this},t.prototype.getId=function(){return this.groupId},t.prototype.setId=function(e){this.groupId=e},t.prototype.showWindow=function(){this.getRoot().show()},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(22),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"contact_groups_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Добавить",click:function(){$$("contact_groups").unselectAll(),this.$scope.ui(s.ContactsGroupsWindow).showWindow(this.$scope.$view)}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){if($$("contact_groups").getSelectedItem()){this.$scope.ui(s.ContactsGroupsWindow).showWindow(this.$scope.$view)}else webix.message({type:"error",text:"Выберите группу для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("contact_groups"),{filterHTML:!0,filename:"Контактные группы"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){webix.guiutils.loadTable("contact_groups","/contact_groups/list")}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"ContactsGroupsWindow",function(){return s});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{view:"window",id:"contact-groups-add-win",position:"center",move:!0,modal:!0,minHeight:500,maxHeight:1500,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Контактная группа",inputWidth:450,align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&$$("contact-groups-add-win").close()}})}}]},body:{rows:[{view:"form",id:"group-add-form",paddingY:20,paddingX:30,width:600,minHeight:500,autoheight:!0,scroll:!0,elements:[{view:"text",name:"id",label:"id",value:0,hidden:!0},{view:"text",name:"name",label:"Название",inputAlign:"left",labelWidth:200,required:!0},{view:"text",name:"queue",label:"Входящая очередь",inputAlign:"left",labelWidth:200,readonly:!0},{view:"multicombo",name:"queues",label:"Входящие очереди",inputAlign:"left",labelWidth:200,options:{body:{template:"#fullname#"},url:"/queues/list/short"}},{view:"multicombo",name:"items_users",label:"Пользователи в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#value#"},url:"/groups/users/short"}},{view:"multicombo",name:"items_queues",label:"Очереди в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#fullname#"},url:"/queues/list/short"}}],elementsConfig:{inputAlign:"left",labelPosition:"top"}},{margin:10,cols:[{},{view:"button",label:"Сохранить",type:"form",align:"center",width:120,click:function(){var e=$$("group-add-form");if(e.validate()){e.disable();var t=e.getValues();webix.ajax().post("/contact_groups/"+t.id+"/save",t).then(function(t){e.enable(),t=t.json(),t.result?(webix.message({type:"success",text:t.message}),e.enable(),webix.$$("contact-groups-add-win").close(),webix.guiutils.loadTable("contact_groups","/contact_groups/list")):(webix.message({type:"error",text:t.text}),e.enable())}).catch(function(t){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),e.enable()})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Отмена",align:"center",width:120,click:function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&$$("contact-groups-add-win").close()}})}}]}]},on:{onShow:function(){var e=$$("contact_groups").getSelectedItem();e&&e.id?(e.items_users=e.items.users,e.items_queues=e.items.queues,$$("group-add-form").setValues(e)):$$("group-add-form").setValues({id:0})}}}},t.prototype.showWindow=function(){this.getRoot().show()},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(){function e(){r(this,e)}return e.prototype.getFormValues=function(){var e=$$("form-phone");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/"+e.id+"/save",e).then(function(e){$$("form-phone").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-phone").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-phone").enable())})},e.prototype.loadTable=function(){webix.guiutils.loadTable("phones","/phones/list")},e.prototype.closeWindow=function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("window-phone").close()}})},e.prototype.hide=function(){$$("window-phone").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),o={view:"form",id:"form-phone",scroll:!0,minHeight:500,autoheight:!0,elements:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Номер телефона",name:"phone",required:!0},{view:"combo",label:"Модель",id:"phone_model",name:"model",options:"./assets/options/models.json"},{view:"text",label:"MAC-адрес",name:"mac"},{view:"combo",label:"Пользователь",name:"user_id",options:"/groups/users/short"},{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"},{view:"combo",label:"Правила набора",name:"rules",suggest:"./assets/options/rules.json",filter:function(e,t){return-1!==e.value.indexOf(t)}},{view:"text",label:"Внешний номер по умолчанию",name:"default_phone"},{view:"combo",label:"Группа",name:"group_id",options:{body:{url:"/phones/groups/list/short",template:"#name#"}}},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top"},rules:{password:function(t){return!!e.id||t.length>0},user_id:function(e){return"erpico"!=$$("phone_model").getValue()||e.length}}},i={id:"window-phone",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,minHeight:500,maxHeight:1500,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){t.closeWindow()}}]},body:{rows:[o,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]}};webix.ui(i).show(),$$("form-phone").setValues(e)},e}(),l=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return window.phonesWindow=new s,{id:"phones_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:150,label:"Добавить",click:function(){phonesWindow.show({})}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("phones").getSelectedId()?phonesWindow.show($$("phones").getSelectedItem()):webix.message({type:"error",text:"Выберите телефон для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("phones"),{filterHTML:!0,filename:"Телефоны"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){phonesWindow.loadTable()}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(){function e(){r(this,e)}return e.prototype.getFormValues=function(){var e=$$("form-queues");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.getQueueCode=function(e,t){webix.ajax().get("/queues/code",{name:e}).then(function(e){e=e.json(),e.result&&t&&t(e)})},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/queues/"+e.id+"/save",e).then(function(e){$$("form-queues").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-queues").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-queues").enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),$$("form-queues").enable(),console.log(e)})},e.prototype.loadTable=function(){webix.guiutils.loadTable("queues","/queues/list")},e.prototype.closeWindow=function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("window-queues").close()}})},e.prototype.hide=function(){$$("window-queues").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),o={view:"form",id:"form-queues",scroll:!0,minHeight:500,autoheight:!0,elements:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"fullname",keyPressTimeout:100,required:!0,on:{onTimedKeyPress:function(){var e=this.getValue(),o=$$("form-queues").getValues();e.length>=3&&t.getQueueCode(e,function(e){o.name=e.message,$$("form-queues").setValues(o)})}}},{view:"text",label:"Код",name:"name",required:!0}]},{view:"textarea",name:"description",label:"Описание",labelWidth:120,height:100},{view:"text",label:"Адрес скрипта обработки",name:"url"},{view:"text",label:"Закрытие страницы после обработки",name:"close_on_hangup"},{view:"text",label:"SL",name:"sl"},{view:"combo",name:"pattern",label:"Шаблон",required:!0,filter:function(e,t){return-1!==t.indexOf(t)},options:{body:{url:"./assets/options/pattern.json",template:"#value#"}}},{view:"text",label:"ID сервиса",name:"service_id"},{view:"multicombo",name:"users_ids",id:"queues_users_id",label:"Операторы",inputAlign:"left",labelWidth:120,options:"/groups/users/short"},{cols:[{view:"switch",label:"Приоритетная очередь",name:"viq"},{view:"switch",label:"Скрытая очередь",name:"hidden"}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top"}},i={id:"window-queues",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,minHeight:500,maxHeight:1500,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  очередь",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){t.closeWindow()}}]},body:{rows:[o,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]}};webix.ui(i).show(),$$("form-queues").setValues(e),e.agents&&e.agents.ids&&$$("queues_users_id").setValue(e.agents.ids)},e}(),l=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return window.queuesWindow=new s,{id:"queues_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:150,label:"Добавить",click:function(){queuesWindow.show({})}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("queues").getSelectedId()?queuesWindow.show($$("queues").getSelectedItem()):webix.message({type:"error",text:"Выберите очередь для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("queues"),{filterHTML:!0,filename:"Очереди"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){queuesWindow.loadTable()}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(){function e(){r(this,e)}return e.prototype.getFormValues=function(){var e=$$("form-channels");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.getCode=function(e,t){webix.ajax().get("/channels/code",{name:e}).then(function(e){e=e.json(),e.result&&t&&t(e)})},e.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/channels/"+e.id+"/save",e).then(function(e){$$("form-channels").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-channels").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-channels").enable())}).catch(function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу"}),$$("form-channels").enable(),console.log(e)})},e.prototype.loadTable=function(){webix.guiutils.loadTable("channels","/channels/list")},e.prototype.closeWindow=function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("window-channels").close()}})},e.prototype.hide=function(){$$("window-channels").close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis(),o={view:"form",id:"form-channels",scroll:!0,minHeight:500,autoheight:!0,elements:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"fullname",keyPressTimeout:100,required:!0,on:{onTimedKeyPress:function(){var e=this.getValue(),o=$$("form-channels").getValues();e.length>=3&&t.getCode(e,function(e){o.name=e.message,$$("form-channels").setValues(o)})}}},{view:"text",label:"Код",name:"name",required:!0}]},{view:"text",label:"Номер телефона",name:"phone"},{view:"combo",label:"Провайдер",name:"provider",options:"./assets/options/providers.json"},{view:"text",label:"Адрес сервера",name:"host"},{view:"text",label:"Порт",name:"port",pattern:{mask:"##########################",allow:/[0-9]/g},validate:function(e){return e.length}},{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"},{view:"combo",label:"Правила обработки",name:"rules",suggest:"./assets/options/rules.json",filter:function(e,t){return-1!==e.value.indexOf(t)}},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top"},rules:{password:function(t){return!!e.id||t.length>0}}},i={id:"window-channels",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,minHeight:500,maxHeight:1500,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  канал",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){t.closeWindow()}}]},body:{rows:[o,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]}};webix.ui(i).show(),$$("form-channels").setValues(e)},e}(),l=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){return window.channels=new s,{id:"channels_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:150,label:"Добавить",click:function(){channels.show({})}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("channels").getSelectedId()?channels.show($$("channels").getSelectedItem()):webix.message({type:"error",text:"Выберите телефон для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("channels"),{filterHTML:!0,filename:"Каналы"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){channels.loadTable()}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(e){var t,o=$$("scripts_lst").getValue();if(!o)return void webix.message({type:"error",text:"Выберите\\добавьте скрипт перед добавление этапа"});var i=e.parent_id?e.parent_id:$$("script_stages").getSelectedId(!1),n=e.id?e.id:0;webix.ui((t={id:"add_script_stage_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('add_script_stage_win').close();"}},t.head={view:"toolbar",margin:-4,cols:[{view:"label",label:n?"Редактирование этапа скрипта":"Добавление этапа скрипта"},{view:"icon",icon:"times-circle",click:"$$('add_script_stage_win').close();"}]},t.resize=!0,t.width=700,t.height=500,t.center=!0,t.position="center",t.modal=!0,t.move=!0,t.body={view:"form",id:"script_stage_form",elements:[{view:"text",label:"Название",name:"name"},{view:"checkbox",labelRight:"Отображать название как заголовок",name:"show_name"},{view:"checkbox",labelRight:"Автоматическая генерация кнопок для перехода на подэтапы",name:"autobuttons"},{view:"checkbox",labelRight:'Отображать кнопки "Назад"/"Вперед"',name:"show_back_next"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=$$("script_stage_form");if(e.validate()){e.disable();var t=e.getValues();t.script_id=o,t.parent_id=i,n&&(t.id=n),webix.ajax().post("/legacy/ext/scripts/save/stage",t,function(t,i,n){e.enable();var i=i.json();1==i.result?($$("add_script_stage_win").close(),$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+o),$$("script_stages").select(i.id)):webix.message({type:"error",text:i.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!n,click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить этап "'+e.name+'"?',type:"confirm-error",callback:function(e){if(e){var t={id:n,delete:1};webix.ajax().post("/legacy/ext/scripts/save/stage",t,function(e,t,i){var t=t.json();1==t.result?($$("add_script_stage_win").close(),$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+o)):webix.message({type:"error",text:t.message})})}}})}}]}],rules:{name:webix.rules.isNotEmpty}},t.on={onShow:function(){$$("script_stage_form").setValues(e)}},t)).show()}function t(e){var t,o=e.id?e.id:0;webix.ui((t={id:"add_script_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('add_script_win').close();"}},t.head={view:"toolbar",margin:-4,cols:[{view:"label",label:o?e.copy?"Копирование скрипта":"Редактирование скрипта":"Добавление скрипта"},{view:"icon",icon:"times-circle",click:"$$('add_script_win').close();"}]},t.resize=!0,t.width=700,t.height=300,t.center=!0,t.position="center",t.modal=!0,t.move=!0,t.body={view:"form",id:"script_form",elements:[{view:"text",label:"Название",name:"name"},{cols:[{view:"button",label:o&&e.copy?"Копировать":"Сохранить",click:function(){var t=$$("script_form");if(t.validate()){t.disable();var i=t.getValues();o&&(i.id=o),e.copy&&(i.copy=e.copy),webix.ajax().post("/legacy/ext/scripts/save",i,function(e,o,i){t.enable();var o=o.json();1==o.result?($$("add_script_win").close(),$$("scripts_lst").getList().clearAll(),$$("scripts_lst").getList().load("/legacy/ext/scripts/list"),$$("scripts_lst").setValue(o.id)):webix.message({type:"error",text:o.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!(o&&!e.copy),click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить скрипт "'+e.name+'"?',type:"confirm-error",callback:function(e){if(e){var t={id:o,delete:1};webix.ajax().post("/legacy/ext/scripts/save",t,function(e,t,o){var t=t.json();1==t.result?($$("add_script_win").close(),$$("scripts_lst").getList().clearAll(),$$("scripts_lst").getList().load("/legacy/ext/scripts/list")):webix.message({type:"error",text:t.message})})}}})}}]}],rules:{name:webix.rules.isNotEmpty}},t.on={onShow:function(){$$("script_form").setValues(e)}},t)).show()}return{id:"scripts_toolbar",hidden:!0,cols:[{view:"button",label:"Добавить этап",width:150,click:function(){e([])}},{view:"button",label:"Изменить этап",width:150,click:function(){var t=$$("script_stages").getSelectedId(!1);if(!t)return void webix.message({type:"error",text:"Выберите этап"});e($$("script_stages").getItem(t))}},{},{view:"combo",label:"Скрипт",width:400,options:"/legacy/ext/scripts/list",id:"scripts_lst",on:{onChange:function(e){$$("script_stages").clearAll(),$$("script_stages").load("/legacy/ext/scripts/liststages/"+e),$$("script_elements").clearAll()}}},{view:"button",label:"Добавить",width:100,click:function(){t([])}},{view:"button",label:"Изменить",width:100,click:function(){var e=$$("scripts_lst").getValue();if(e){var o=$$("scripts_lst").getList().getItem(e);o&&t(o)}else webix.message({type:"error",text:"Выберите скрипт для редактирования"})}},{view:"button",label:"Копировать",width:100,click:function(){var e=$$("scripts_lst").getValue();if(e){var o=$$("scripts_lst").getList().getItem(e);o&&(o.copy=1,t(o))}else webix.message({type:"error",text:"Выберите скрипт для копирования"})}},{view:"button",label:"Тест",width:100,click:function(){$$("scripts_lst").getValue()||webix.message({type:"error",text:"Выберите скрипт для тестирования"})}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"agents_grouped_reports_filter",cols:[{id:"queue_agent_grouped_reports",view:"richselect",label:"Очередь",labelWidth:100,width:333,options:"/legacy/grouped_queues_name/short"},{id:"filter_agent_grouped_reports",view:"richselect",label:"Тип звонков",labelWidth:100,value:1,width:370,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{cols:[{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Показать отчет",click:function(){var e=$$("reportDateRange").getValue(),t=e.start,o=t.getMonth()+1,i=t.getFullYear()+"-"+o+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),n=e.end;if(n)var r=n.getMonth()+1,a=n.getFullYear()+"-"+r+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();else var a="";var s="/legacy/grouped_agents_reports?filter[t1]="+i+"&filter[t2]="+a;$$("filter_agent_grouped_reports").getValue()&&(s+="&filter[filter]="+$$("filter_agent_grouped_reports").getValue()),$$("queue_agent_grouped_reports").getValue()&&(s+="&filter[queue]="+$$("queue_agent_grouped_reports").getValue()),$$("agents_reports").clearAll(),webix.extend($$("agents_reports"),webix.ProgressBar),$$("agents_reports").showProgress(),$$("agents_reports").load(s)}}]},{cols:[{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel"}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){function e(){var e=$$("filter_queues_grouped_reports").getValue(),t=$$("queue_queues_grouped_reports").getValue(),o=$$("reportDateRange").getValue(),i=o.start,n=i.getMonth()+1,r=i.getFullYear()+"-"+n+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),a=o.end;if(a)var s=a.getMonth()+1,l=a.getFullYear()+"-"+s+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();else var l="";var c="?filter[t1]="+r+"&filter[t2]="+l;1==e?($$("report_queues_chart1_l").show(),$$("report_queues_chart2_l").show(),$$("report_queues_chart3_l").show(),$$("report_queues_chart4_l").show(),$$("report_queues_chart5_l").show()):2==e?($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").show(),$$("report_queues_chart3_l").hide(),$$("report_queues_chart4_l").show(),$$("report_queues_chart5_l").show()):3==e?($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").hide(),$$("report_queues_chart3_l").show(),$$("report_queues_chart4_l").hide(),$$("report_queues_chart5_l").show()):4==e&&($$("report_queues_chart1_l").hide(),$$("report_queues_chart2_l").hide(),$$("report_queues_chart3_l").hide(),$$("report_queues_chart4_l").hide(),$$("report_queues_chart5_l").hide()),""!=e&&(c+="&filter[filter]="+e),""!=t&&(c+="&filter[queue]="+t),$$("report_queues_table").clearAll(),webix.extend($$("report_queues_table"),webix.ProgressBar),$$("report_queues_table").showProgress(),$$("report_queues_table").load("/legacy/grouped_queues_table_total"+c),$$("report_queues_chart1").clearAll(),webix.extend($$("report_queues_chart1"),webix.ProgressBar),$$("report_queues_chart1").showProgress(),$$("report_queues_chart1").load("/legacy/grouped_queues_table_chart1"+c),$$("report_queues_chart2").clearAll(),webix.extend($$("report_queues_chart2"),webix.ProgressBar),$$("report_queues_chart2").showProgress(),$$("report_queues_chart2").load("/legacy/grouped_queues_table_chart2"+c),$$("report_queues_chart3").clearAll(),webix.extend($$("report_queues_chart3"),webix.ProgressBar),$$("report_queues_chart3").showProgress(),$$("report_queues_chart3").load("/legacy/grouped_queues_table_chart3"+c),$$("report_queues_chart4").clearAll(),webix.extend($$("report_queues_chart4"),webix.ProgressBar),$$("report_queues_chart4").showProgress(),$$("report_queues_chart4").load("/legacy/grouped_queues_table_chart4"+c),$$("report_queues_chart5").clearAll(),webix.extend($$("report_queues_chart5"),webix.ProgressBar),$$("report_queues_chart5").showProgress(),$$("report_queues_chart5").load("/legacy/grouped_queues_table_chart5"+c)}return{id:"queues_grouped_reports_filter",cols:[{id:"queue_queues_grouped_reports",view:"richselect",label:"Очередь",labelWidth:100,width:333,options:"/legacy/grouped_queues_name/short"},{id:"filter_queues_grouped_reports",view:"richselect",label:"Тип звонков",labelWidth:100,value:1,width:370,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{cols:[{view:"button",id:"queues_grouped_reports_load_button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Показать отчет",click:function(){e()},on:{itemClick:function(){e()}}}]},{cols:[{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel"}]}]}},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(){function e(){r(this,e),this.formName="form-phonesGroups",this.tableName="phones_groups",this.windowName="window-phone"}return e.prototype.getCode=function(e,t){webix.ajax().get("/phones/groups/code",{name:e}).then(function(e){e=e.json(),e.result&&t&&t(e)})},e.prototype.getFormValues=function(){var e=$$(this.formName);return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},e.prototype.saveFormValues=function(e,t){var o=this.getThis();parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/groups/"+e.id+"/save",e).then(function(e){return $$(o.formName).enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$(o.formName).enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$(o.formName).enable()),!0},function(e){webix.message({type:"error",text:"Произошла ошибка обращения к серверу. Скорее всего, один из телефонов уже принадлежит другой группе"}),$$(o.formName).enable(),console.log(e)})},e.prototype.loadTable=function(){webix.guiutils.loadTable(this.tableName,"/phones/groups/list")},e.prototype.closeWindow=function(){var e=this.getThis();webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(t){t&&webix.$$(e.windowName).close()}})},e.prototype.hide=function(){$$(this.windowName).close()},e.prototype.getThis=function(){return this},e.prototype.show=function(e){var t=this.getThis();console.log(e);var o={view:"form",id:t.formName,scroll:!0,minHeight:500,autoheight:!0,elements:[{cols:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Название",name:"name",keyPressTimeout:100,required:!0,on:{onTimedKeyPress:function(){var e=this.getValue(),o=$$(t.formName).getValues();e.length>=3&&t.getCode(e,function(e){o.code=e.message,$$(t.formName).setValues(o)})}}},{view:"text",label:"Код",name:"code",required:!0}]},{view:"combo",name:"pattern",label:"Шаблон",required:!0,filter:function(e,t){return-1!==t.indexOf(t)},options:{body:{url:"./assets/options/pattern.json",template:"#value#"}}},{view:"combo",label:"Правила набора",name:"rules",suggest:"./assets/options/rules.json",filter:function(e,t){return-1!==e.value.indexOf(t)}},{view:"text",label:"Исходящий номер",name:"outgoing_phone"},{view:"multicombo",name:"phones",label:"Телефоны в группе",inputAlign:"left",labelWidth:200,options:{body:{template:"#phone#"},url:"/phones/list/short"}},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top"}},i={id:this.windowName,view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,minHeight:500,maxHeight:1500,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){t.closeWindow()}}]},body:{rows:[o,{cols:[{},{view:"button",type:"form",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}}]}]}};webix.ui(i).show(),$$(this.formName).setValues(e)},e}(),l=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return n(t,e),t.prototype.config=function(){window.phonesGroupsWindow=new s;return{id:"phones_groups_toolbar",hidden:!0,cols:[{view:"button",type:"iconButton",icon:"wxi-plus",width:150,label:"Добавить",click:function(){phonesGroupsWindow.show({})}},{view:"button",type:"iconButton",icon:"wxi-pencil",width:150,label:"Изменить",click:function(){$$("phones_groups").getSelectedId()?phonesGroupsWindow.show($$("phones_groups").getSelectedItem()):webix.message({type:"error",text:"Выберите группу телефонов для редактирования"})}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("phones_groups"),{filterHTML:!0,filename:"Группы телефонов"})}},{view:"button",type:"iconButton",icon:"fa fa-sync",width:50,click:function(){phonesGroupsWindow.loadTable()}},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e="",t="";return{id:"extended_calls_toolbar",hidden:!0,margin:0,padding:0,cols:[{width:27},{id:"option_cdr_report",badge:0,view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:translate("Add options"),click:function(){var o={view:"form",borderless:!0,elements:[{id:"dst_change",view:"text",type:"search",label:translate("Dialed number"),value:e},{id:"src_change",view:"text",type:"search",label:translate("Source"),value:t},{cols:[{view:"button",value:translate("Add"),click:function(){var o=0;""!=$$("dst_change").getValue()&&o++,e=$$("dst_change").getValue(),""!=$$("src_change").getValue()&&o++,t=$$("src_change").getValue(),o>0?($$("option_cdr_report").define("badge",o),$$("option_cdr_report").define("label",translate("Options")),$$("option_cdr_report").define("icon","check"),$$("option_cdr_report").refresh()):($$("option_cdr_report").define("badge",o),$$("option_cdr_report").define("label",translate("Add options")),$$("option_cdr_report").define("icon","plus"),$$("option_cdr_report").refresh()),$$("dst_change").getTopParentView().close()}},{view:"button",value:"Cancel",click:function(){$$("dst_change").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_cdr_report",width:300,position:"center",modal:!0,head:"Additional options",body:webix.copy(o)}),function(e,t){if($$("win_option_cdr_report"))return void $$("win_option_cdr_report").show();$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_cdr_report")}},{id:"search",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:translate("Show report"),click:function(){$$("extended_calls").enable(),$$("cdr_report_trafic").enable(),$$("extended_calls").getFilter("calldate").value="",$$("extended_calls").getFilter("fullname").value="",$$("extended_calls").getFilter("src").value="",$$("extended_calls").getFilter("dst").value="",$$("extended_calls").getFilter("status").value="",$$("extended_calls").getFilter("ratesec").value="";var o=webix.guiutils.getDateRange("reportDateRange"),i=o.end,n=o.start,r="extended_calls/list",a="?filter[t1]="+n+"&filter[t2]="+i;""!=t&&(a+="&filter[src]="+t),""!=e&&(a+="&filter[dst]="+e),$$("cdr_report_trafic").showProgress({type:"icon",hide:!0}),$$("extended_calls").showProgress({type:"icon",hide:!0}),$$("extended_calls").clearAll(),$$("cdr_report_trafic").clearAll(),$$("extended_calls").load(r+a,"json",function(){$$("extended_calls").hideProgress({type:"icon",hide:!0})}),$$("cdr_report_trafic").load(r+"/trafic"+a,"json",function(){$$("cdr_report_trafic").hideProgress({type:"icon",hide:!0})})}},{},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:translate("Export to Excel"),click:function(){var e=webix.guiutils.getDateRange("reportDateRange");webix.toExcel($$("extended_calls"),{filterHTML:!0,filename:"Расширенные звонки с "+e.end+" по "+e.start})}},{}]},{}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";o.d(t,"a",function(){return s});var i=o(76),n=o(77),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(e){function t(t,o){var i=e.call(this)||this;return i.app=t,i._name=o,i._children=[],i}return a(t,e),t.prototype.ui=function(e,t){t=t||{};var o=t.container||e.container,n=this.app.createView(e);return this._children.push(n),n.render(o,null,this),"object"!==(void 0===e?"undefined":r(e))||e instanceof i.a?n:n.getRoot()},t.prototype.show=function(e,t){var o=this;if(t=t||{},"string"==typeof e){if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("../")){var i=this.getParentView();return void(i?i.show("./"+e.substr(3),t):this.app.show("/"+e.substr(3)))}0===e.indexOf("./")&&(e=e.substr(2));var a=this.getSubViewInfo(t.target);if(!a)return this.app.show("/"+e);if(a.parent!==this)return a.parent.show(e,t)}var s=Object(n.a)(this.app.getRouter().get());if("object"===(void 0===e?"undefined":r(e)))if(webix.isArray(e)){var l=this._index+e[0];s[l]||(s[l]={}),s[l].page=e[1],e=""}else{var c=[];for(var u in e)c.push(encodeURIComponent(u)+"="+encodeURIComponent(e[u]));e="?"+c.join("&")}if("string"==typeof e){if("?"===e.substr(0,1)){var d=e.indexOf("/"),p=e;d>-1&&(p=e.substr(0,d));var h=Object(n.a)(p);webix.extend(s[this._index-1].params,h[0].params,!0),e=d>-1?e.substr(d+1):""}var f=""===e?s.slice(this._index):Object(n.a)(e),w=null;if(this._index){w=s.slice(0,this._index).concat(f);for(var g=0;g<w.length;g++)w[g].index=g+1;var b=Object(n.b)(w);return this.app.canNavigate(b,this).then(function(e){return null!==e?b!==e?o.app.show(e):o._finishShow(w,e):null})}return this._finishShow(f,"")}},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this.app=this._parentFrame=null,this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){var e=this;this._destroyKids();var t=[];this._index>1&&(t=Object(n.a)(this.app.getRouter().get()).slice(this._index-1)),this._render(t).then(function(){e._parentFrame.id=e.getRoot().config.id})},t.prototype._render=function(e){var t=this,o=this.config();return o.then?o.then(function(o){return t._render_final(o,e)}):this._render_final(o,e)},t.prototype._render_final=function(e,t){var o=this,i=this._container;if(i&&i.$destructed)return Promise.reject("Container destroyed");var n,r={ui:{}};this.app.copyConfig(e,r.ui,this._subs),this.app.callEvent("app:render",[this,t,r]),r.ui.$scope=this;try{if(i&&i.getParentView){var a=i.getParentView();a&&"multiview"===a.name&&!r.ui.id&&(r.ui.id=i.config.id)}this._root=this.app.webix.ui(r.ui,this._container),this._root.getParentView()&&(this._container=this._root),this._init(this._root,t),n=this._urlChange(t).then(function(){return o.ready(o._root,t)})}catch(e){n=Promise.reject(e)}return n.catch(function(e){return o._initError(o,e)})},t.prototype._init=function(e,t){return this.init(e,t)},t.prototype._urlChange=function(e){var t=this;this.app.callEvent("app:urlchange",[this,e,this._index]);var o=[];for(var i in this._subs){var n=this._renderFrame(i,this._subs[i],e);n&&o.push(n)}return Promise.all(o).then(function(){t.urlChange(t._root,e)})},t.prototype._renderFrame=function(e,t,o){if(t.url){if("string"==typeof t.url){var i=Object(n.a)(t.url);return i.map(function(e){e.index=0}),this._createSubView(t,i)}var r=t.view;return"function"!=typeof t.url||r instanceof t.url||(r=new t.url(this.app,"")),r||(r=t.url),this._renderSubView(t,r,o)}if("default"===e&&o&&o.length>1){var a=o.slice(1);return this._createSubView(t,a)}},t.prototype._initError=function(e,t){return this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var o=this;return this.app.createFromURL(t,e.view).then(function(i){return o._renderSubView(e,i,t)})},t.prototype._renderSubView=function(e,o,i){var n=this.app.webix.$$(e.id);return o.render(n,i,this).then(function(i){return e.view&&e.view!==o&&e.view.destructor(),e.view=o,e.id=i.config.id,o instanceof t&&(o._parentFrame=e),i})},t.prototype._finishShow=function(e,t){var o;return this._index?(o=this._renderPartial(e.slice(this._index-1)),this.app.getRouter().set(t,{silent:!0}),this.app.callEvent("app:route",[e])):(e.map(function(e){return e.index=0}),o=this._renderPartial([null].concat(e))),o},t.prototype._renderPartial=function(e){return this._init_url_data(e),this._urlChange(e)},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(i.a)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(){i(this,e),this.phonesLoaded=0,this.intervalReportsLoaded=0,this.groupedAgentsReportsLoaded=0,this.extOutgoingReportsLoaded=0,this.extIncomingReportsLoaded=0,this.dailyReportsLoaded=0,this.hourlyReportsLoaded=0,this.compareCallsLoaded=0,this.channelsLoaded=0,this.queuesLoaded=0,this.contactGroupsLoaded=0,this.groupsLoaded=0,this.usersLoaded=0,this.clientsLoaded=0,this.outgoingcampaignsLoaded=0,this.extIncomingExternalReportsLoaded=0}return e.prototype.hideAllView=function(){$$("sidebar").serialize().forEach(function(e){$$(e.id)&&($$(e.id).hide(),webix.guiutils.hideAllToolbars()),e.data&&e.data.forEach(function(e){$$(e.id)&&$$(e.id).hide()})})},e.prototype.loadPhoneReport=function(){$$("phoneExcelButton").show()},e.prototype.loadGroupedReport=function(){},e.prototype.loadPhonesReport=function(){},e.prototype.loadIntervalReports=function(){},e.prototype.loadExtOutgoingReports=function(){},e.prototype.loadExtIncomingExternalReports=function(){},e.prototype.loadExtIncomingReports=function(){},e.prototype.loadDailyReports=function(){},e.prototype.loadHourlyReports=function(){},e.prototype.loadCompareCallsReports=function(){},e.prototype.loadChannelsReports=function(){},e.prototype.loadQueuesReports=function(){},e.prototype.loadContactGroupsReports=function(){},e.prototype.loadGroupsReports=function(){},e.prototype.loadUsersReports=function(){},e.prototype.loadClientsReports=function(){},e.prototype.loadOutgoingcampaignsReports=function(){},e.prototype.showHideView=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if($$(e)){this.hideAllView();var o=webix.Manager.getComponent(e);"object"==(void 0===o?"undefined":n(o))&&o.loadData(),parseInt(t)?$$(e).hide():$$(e).show()}else console.log(e)},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(34),l=o(35),c=o(36),u=o(37),d=o(42),p=o(43),h=o(44),f=o(45),w=o(46),g=o(47),b=o(48),_=o(49),m=o(50),v=o(51),x=o(52),$=o(53),y=o(54),k=o(55),C=o(56),j=o(57),P=o(58),S=o(59),F=o(1),O=o(62),V=o(63),T=o(64),E=o(65),D=o(66),A=o(67),R=o(68),q=o(69),B=o(70),M=o(71),I=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.init=function(){console.log((new F.default).getView())},t.prototype.config=function(){return{rows:[(new s.default).getView(),(new l.default).getView(),(new c.default).getView(),(new u.default).getView(),(new d.default).getView(),(new p.default).getView(),(new h.default).getView(),(new f.default).getView(),(new w.default).getView(),(new g.default).getView(),(new b.default).getView(),(new _.default).getView(),(new m.default).getView(),(new v.default).getView(),(new x.default).getView(),(new $.default).getView(),(new y.default).getView(),(new k.default).getView(),(new C.default).getView(),(new j.default).getView(),(new F.default).getView(),(new P.default).getView(),(new S.default).getView(),(new O.default).getView(),(new V.default).getView(),(new T.default).getView(),(new E.default).getView(),(new D.default).getView(),(new A.default).getView(),(new R.default).getView(),(new q.default).getView(),(new B.default).getView(),(new M.default).getView()]}},t}(a.b);t.default=I},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),webix.Manager.setComponent("cti",this)}return e.prototype.getView=function(){return{id:"cti",view:"htmlform",scroll:"y",template:'<div style="padding: 0px 20px 20px 20px"><h1>Памятка по использованию IP-АТС ErpicoPBX</h1><p>Для совершения исходящих вызовов наберите номер телефона и нажмите клавишу «#» или «Набор». При звонке на городские номера нет необходимости набирать префикс, на сотовые и междугородние номера вызов осуществляется через «8» без дополнительных префиксов.</p><h2>Переадресация</h2><p>Для переадресации звонка нажмите два раза клавишу «#» во время разговора, система Вам сообщит об инициализации перевода, наберите внутренний номер сотрудника и нажмите еще раз «#». После ответа сотрудника или когда услышите сигнал вызова положите трубку – вызов уйдет сотруднику. Для возвращения к звонку до завершения переадресации нажмите клавишу «*».<br/>Краткая формула: ## номер #<br/>Возврат: *</p><h2>Перехват</h2><p>Для перехвата звонка наберите «*» и вызов.<br/>Краткая формула: *#</p><h2>Телефонный клиент</h2><p>Телефонный клиент предоставляет расширенные функции телефонии и доступ к онлайн-контролю, статистики и записи разговоров.<br/><br/>Для установки скачайте телефонный клиент по ссылке <a href="https://dl.erpico.ru/ErpicoPBX.msi">ErpicoPBX.msi</a></p><p>Для запуска телефонного клиента щелкните по иконке на рабочем столе. Если программа запускается первый раз нужно верно указать имя сервера, логин и пароль. Уточните эти реквизиты у Вашего системного администратора. Адрес совпадает с адресом АТС, логин, как правило, совпадает с номером телефона.</p><p>Если программа запущена щелкните по иконке на панели задач.</p><p>Когда телефонный клиент запущен Вы можете набирать номера используя функцию Copy2Call. Для осуществления звонка Вам достаточно выделить на любом сайте или в любой программе номер телефона, по которому Вы хотите позвонить и два раза скопировать его в буфер обмена при помощи клавиатуры: Ctrl+C</p><p>На Ваш телефон придет служебный вызов, ответьте на него и система начнет автоматически набор номера.</p><p>Так же в телефонном клиенте Вам доступен справочник сотрудников и история Ваших звонков.</p><h2>Техподдержка</h2><p>По всем вопросам использования АТС и телефонного клиента обращайтесь в нашу службу техподдержки: 8 (4852) 593-100, добавочный код: 2</p></div>'}},e.prototype.loadData=function(){},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("phone",this)}return e.prototype.getView=function(){return{id:"phone",hidden:!0,view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"group",header:[{text:"Группа",height:30},{content:"textFilter",height:35}],sort:"int",width:160,template:"{common.icon()} #group#"},{id:"number",header:[{text:"Номер",height:30},{content:"textFilter",height:35}],sort:"int",width:160},{id:"fio",header:[{text:"ФИО"},{content:"textFilter"}],sort:"int",width:200}]}},e.prototype.loadData=function(){$$("phoneExcelButton").show(),this.loaded||$$("phone")&&($$("phone").load("/legacy/phones"),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if((""+e).includes("e")){var o=(""+e).split("e"),i="";return+o[1]+t>0&&(i="+"),+(Math.round(+o[0]+"e"+i+(+o[1]+t))+"e-"+t)}return+(Math.round(e+"e+"+t)+"e-"+t)}Object.defineProperty(t,"__esModule",{value:!0});var r=(o(0),this),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"my_suggest1",$init:function(e){console.log(e);var t=e.body.rows.length;t>1&&(e.body.rows[t]={view:"counter",step:10,value:0,label:"От",id:e.id+"_from"},e.body.rows[t+1]={view:"counter",step:10,value:0,label:"До",id:e.id+"_to"},e.body.rows[t+2]={view:"button",label:"Применить",click:function(){$$("cdr_reports").filterByAll()}})}},webix.ui.checksuggest),webix.ui.datafilter.sum_duration=webix.extend({refresh:function(e,t,o){e.config.serverFooter&&e.config.serverFooter.sum_duration&&(t.firstChild.innerHTML=e.config.serverFooter.sum_duration)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.sum_billsec=webix.extend({refresh:function(e,t,o){e.config.serverFooter&&e.config.serverFooter.sum_duration&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML=n(e.config.serverFooter.sum_duration/60,2))}},webix.ui.datafilter.summColumn),webix.ui.datafilter.count_answered=webix.extend({refresh:function(e,t,o){e.config.serverFooter&&e.config.serverFooter.total&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML="ASR "+n(e.config.serverFooter.count_answered/e.config.serverFooter.total*100,2)+" %")}},webix.ui.datafilter.summColumn),webix.ui.datafilter.pdd=webix.extend({refresh:function(e,t,o){e.config.serverFooter&&e.config.serverFooter.sum_billsec&&e.config.serverFooter.sum_duration&&e.config.serverFooter.count_answered&&(t.firstChild.innerHTML=n((e.config.serverFooter.sum_duration-e.config.serverFooter.sum_billsec)/e.config.serverFooter.count_answered,2))}},webix.ui.datafilter.summColumn),webix.ui.datafilter.summTotal=webix.extend({refresh:function(e,t,o){var i=e.count();t.firstChild.innerHTML=i&&0!=i&&4e6!=i?"Звонков: "+i||"0":""}},webix.ui.datafilter.summColumn),webix.ui.datafilter.playback=webix.extend({refresh:function(e,t,o){}},webix.ui.datafilter.summColumn),webix.ui.datafilter.customPlayback={getValue:function(){},setValue:function(){},refresh:function(e,t,o){t.onchange=function(){console.log("On change...")},t.onclick=function(){console.log("On click...")}},render:function(e,t){return console.log("Render..."),"..."}},webix.proxy.calldatePartialLoad={$proxy:!0,load:function(e,t){if(t&&(t.filter||t.sort)){var o=this.source+(-1==this.source.indexOf("?")?"?":"&"),i=[];for(var n in t)"filter"!=n&&"sort"!=n&&i.push(n+"="+t[n]),"start"==n&&0==t[n]&&$$("cdr_reports").clearAll();t.sort&&i.push("sort["+t.sort.id+"]="+encodeURIComponent(t.sort.dir)),t.filter&&(t.filter.hold=JSON.stringify({from:$$("$my_suggest11_from").getValue(),to:$$("$my_suggest11_to").getValue()})),t.filter.talk=JSON.stringify({from:$$("$my_suggest12_from").getValue(),to:$$("$my_suggest12_to").getValue()});for(var r in t.filter){var s=t.filter[r];"object"===(void 0===s?"undefined":a(s))?i.push("filter["+r+"]="+encodeURIComponent(JSON.stringify(s))):""!==s&&i.push("filter["+r+"]="+encodeURIComponent(s))}var l=0,c=0;return $$("cdr_reports").data.each(function(e){e&&e.time&&(l=e.time,c++)}),i.push("lcd="+encodeURIComponent(l)),i.push("lli="+encodeURIComponent(c)),o+=i.join("&"),webix.ajax().get(o)}return webix.ajax().get(this.source,t)}};var s={id:"cdr_reports",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,disabled:!1,multiselect:!1,hidden:!0,tooltip:!0,columns:[{id:"status",header:"",width:30,template:function(e){return e.answered?"<span class='greencircle'>&nbsp;</span>":"<span class='redcircle'>&nbsp;</span>"},footer:{content:"summTotal",colspan:2}},{id:"time",header:["Дата/время",{content:"serverDateRangeFilter",inputConfig:{timepicker:!0,start:new Date,finish:new Date}}],width:250,sort:"date",format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"id",header:["ID",{content:"textFilter"}],sort:"string",width:200,hidden:!0},{id:"agent",header:["Сотрудник",{content:"customFilterSelect",options:"/groups/users/short?nameasvalue=1",suggest:{body:{template:"#value#"},filter:function(e,t){return-1!==e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}}],sort:"string",width:200,footer:{text:"Выберите звонок для прослушивания",colspan:4}},{id:"queue",header:["Очередь",{content:"customFilterSelect",options:"/queues/list/short?nameasvalue=1",suggest:{body:{template:"#value#"},filter:function(e,t){return-1!==e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}}],sort:"string",width:200},{id:"src",header:["От кого",{content:"textFilter",placeholder:"Введите номер для поиска...",colspan:2}],sort:"string",width:130,template:function(e){return e.src&&e.src.length>4?e.src+" <span class='webix_icon fa fa-phone' style='cursor: pointer'></span>":e.src}},{id:"dst",header:["Кому"],sort:"string",width:130,template:function(e){return e.dst&&e.dst.length>4?e.dst+" <span class='webix_icon fa fa-phone' style='cursor: pointer'></span>":e.dst}},{id:"hold",header:["Ожидание",{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],width:100,sort:"int",footer:{content:"pdd"},template:function(e){return l(e.hold)}},{id:"talk",header:["Разговор",{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],width:80,sort:"int",footer:{content:"sum_billsec"},template:function(e){return l(e.talk)}},{id:"reason",header:["Результат",{content:"richSelectFilter",suggest:{fitMaster:!1,width:220},options:[{id:"EXITWITHTIMEOUT",value:"Не дождался ответа"},{id:"RINGNOANSWER",value:"Оператор не ответил"},{id:"NO ANSWER",value:"Нет ответа"},{id:"ABANDON",value:"Брошенный"},{id:"FAILED",value:"Ошибка набора"},{id:"BUSY",value:"Занято"},{id:"ANSWERED",value:"Разговор состоялся"},{id:"COMPLETEAGENT",value:"Завершен оператором"},{id:"COMPLETECALLER",value:"Завершен клиентом"},{id:"TRANSFER",value:"Переведен"}]}],width:190,footer:{content:"count_answered"},template:function(e){var t='<span class = "state '+e.reason+'">';return t+=c(e.reason),t+="</span>"}},{id:"userfield",header:["Входящий номер"],sort:"string",width:160,template:function(e){return e.userfield}}],on:{onBeforeFilter:function(){},onBeforeLoad:function(){webix.extend(this,webix.ProgressBar)},"data->onParse":function(e,t){if(0==t.data.length){var o=0;$$("cdr_reports").data.each(function(e){e&&e.time&&o++}),t.total_count=o}t.server_footer&&(this.config.$serverFooter=t.server_footer,this.config.serverFooter=t.server_footer)},onAfterSelect:function(e){var t=$$("cdr_reports"),o=t.getSelectedItem(),i="Выберите звонок для прослушивания";o&&(i="<audio style='height:32px;width:400px;' controls='true' src='/recording/"+o.uid+".mp3' type='audio/mpeg' preload='none'/>"),t.getColumnConfig("agent").footer[0].text=i,t.refreshColumns()}},ready:function(){webix.extend(r,webix.ProgressBar)}},l=function(e){var t=Math.floor(e/60),o=e-60*t;return t+":"+(o>9?o:"0"+o)},c=function(e){var t="";switch(e){case"EXITWITHTIMEOUT":t="Не дождался ответа";break;case"ANSWERED":t="Разговор состоялся";break;case"COMPLETEAGENT":t="Завершен оператором";break;case"RINGNOANSWER":t="Оператор не ответил";break;case"NO ANSWER":t="Нет ответа";break;case"ABANDON":t="Брошенный";break;case"FAILED":t="Ошибка набора";break;case"BUSY":t="Занято";break;case"TRANSFER":t="Переведен";break;case"COMPLETECALLER":t="Завершен клиентом";break;default:t=e}return t},u=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("cdr_reports",this)}return e.prototype.getView=function(){return{rows:[s]}},e.prototype.loadData=function(){var e=this;$$("cdr_reports")&&($$("cdr_toolbar").show(),webix.extend($$("cdr_reports"),webix.ProgressBar),this.loaded||$$("cdr_reports").load("calldatePartialLoad->/cdr/list","json",function(){e.loaded=1}))},e}();t.default=u},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(){var e=webix.guiutils.getExtDashboardFilterData();$$("ext_dashboard_managers").clearAll(),$$("dashboard_tree").clearAll(),$$("callschart").clearAll(),$$("hourschart").clearAll(),$$("operatorsworktime").clearAll(),$$("operatorschart").clearAll(),s=e;e.t1,e.t2,e.queues,e.agents,e.hours;webix.ajax("/legacy/ext_dashboard_getgages",e,function(t,o,i){o=o.json(),$$("gage_sl").setValue(o.sl),$$("gage_lcr").setValue(o.lcr),$$("gage_fcr").setValue(o.fcr);var n=$$("box3").getValues();n.items[0].value=o.cost+" р.",$$("box3").setValues(n),$$("gage_ans").setValue(parseFloat(o.aat.replace(/,/,"."))),$$("gage_avg").setValue(o.att),webix.extend($$("ext_dashboard_managers"),webix.ProgressBar),webix.extend($$("operatorschart"),webix.ProgressBar),webix.extend($$("callschart"),webix.ProgressBar),webix.extend($$("hourschart"),webix.ProgressBar),webix.extend($$("dashboard_tree"),webix.ProgressBar),webix.extend($$("operatorsworktime"),webix.ProgressBar),$$("ext_dashboard_managers").showProgress(),$$("operatorschart").showProgress(),$$("callschart").showProgress(),$$("hourschart").showProgress(),$$("dashboard_tree").showProgress(),$$("operatorsworktime").showProgress(),webix.ajax("/legacy/ext_dashboard_agents_stat",e,function(t,o,i){var n=o.json();$$("ext_dashboard_managers").parse(n.data),$$("operatorschart").parse(n.data),$$("ext_dashboard_managers").hideProgress(),$$("operatorschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_callschart",e,function(t,o,i){$$("callschart").parse(t),$$("callschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_hourschart",e,function(t,o,i){$$("hourschart").parse(t),$$("hourschart").hideProgress(),webix.ajax("/legacy/ext_dashboard_treetable",e,function(t,o,i){$$("dashboard_tree").parse(t),$$("dashboard_tree").attachEvent("onDataRequest",function(t){return webix.message("Получение данных "+t),this.parse(webix.ajax().get("/legacy/ext_dashboard_treetable?filter[parent]="+t,e).then(function(e){return e=e.json()})),!1}),$$("dashboard_tree").hideProgress()})})})})}),webix.ajax("/legacy/ext_dashboard_worktimechart",e,function(e,t,o){$$("operatorsworktime").parse(e),$$("operatorsworktime").hideProgress()})}function r(e,t){for(var o,i=[],n=0;n<e.length;n++){var a=e[n],s=t+"."+n,l={id:s,open:!1,checked:!0};void 0!==a.value&&(l.value=a.value),void 0!==a.elem&&(l.elem=a.elem),void 0!==a.col&&(l.col=a.col),void 0!==a.data&&(o=r(a.data,s),l.data=o),console.log(l),i.push(l)}return i}function a(){var e=[{elem:"gages_row",value:"Показатели",data:[{elem:"gage_sl",value:"SL"},{elem:"gage_lcr",value:"LCR"},{elem:"gage_ans",value:"Ср. ответа"},{elem:"gage_avg",value:"Ср. разговора"},{elem:"gage_fcr",value:"FCR"},{elem:"box3",value:"Стоимость звонка"}]},{elem:"ext_dashboard_managers",value:"Менеджеры",data:[{elem:"ext_dashboard_managers",col:"agent_name",value:"Менеджер"},{elem:"ext_dashboard_managers",col:"total",value:"Звонков"},{elem:"ext_dashboard_managers",col:"served",value:"Принятых"},{elem:"ext_dashboard_managers",col:"served_more20s",value:"После SL"},{elem:"ext_dashboard_managers",col:"unserved",value:"Не принятых"},{elem:"ext_dashboard_managers",col:"served_call_per",value:"Отвеченные(%)"},{elem:"ext_dashboard_managers",col:"sl",value:"SL"},{elem:"ext_dashboard_managers",col:"lcr",value:"LCR"},{elem:"ext_dashboard_managers",col:"avg_answer",value:"Ср. ответа"},{elem:"ext_dashboard_managers",col:"avg_duration",value:"Ср. разговора ВХ"},{elem:"ext_dashboard_managers",col:"out_count",value:"Исходящих"},{elem:"ext_dashboard_managers",col:"out_avg",value:"Ср. разговора ИСХ"},{elem:"ext_dashboard_managers",col:"int_count",value:"Внутренних"},{elem:"ext_dashboard_managers",col:"int_avg",value:"Ср. разговора ВН"}]},{elem:"ext_dashboard_charts",value:"Графики по звонкам",data:[{elem:"callschart",value:"По дням"},{elem:"hourschart",value:"По часам"}]},{elem:"ext_dashboard_charts2",value:"Графики по операторам",data:[{elem:"operatorsworktime",value:"Рабочее время"},{elem:"operatorschart",value:"Среднее время разговоров"}]},{elem:"dashboard_tree",value:"Данные по периодам",data:[{elem:"dashboard_tree",col:"period",value:"Период"},{elem:"dashboard_tree",col:"total",value:"Всего"},{elem:"dashboard_tree",col:"served",value:"Принято"},{elem:"dashboard_tree",col:"served20",value:"Принято > SL"},{elem:"dashboard_tree",col:"unserved",value:"Потеряно"},{elem:"dashboard_tree",col:"lost20",value:"Потеряно > SL"},{elem:"dashboard_tree",col:"served_call_per",value:"Отв (%)"},{elem:"dashboard_tree",col:"sl",value:"SL(%)"},{elem:"dashboard_tree",col:"agents",value:"Операторов"},{elem:"dashboard_tree",col:"avg_lost",value:"ВХ Ср. пот."},{elem:"dashboard_tree",col:"avg_ans",value:"ВХ Ср. отв."},{elem:"dashboard_tree",col:"avg_talk",value:"ВХ Ср. разг."},{elem:"dashboard_tree",col:"max_wait",value:"ВХ Макс. отв."},{elem:"dashboard_tree",col:"max_talk",value:"ВХ Макс. разг."},{elem:"dashboard_tree",col:"out_count",value:"Исходящих"},{elem:"dashboard_tree",col:"out_avg",value:"Ср. разговора ИСХ"},{elem:"dashboard_tree",col:"int_count",value:"Внутренних"},{elem:"dashboard_tree",col:"int_avg",value:"Ср. разговора ВН"}]}];return window.response=r(e,"ft"),console.log(response),response}Object.defineProperty(t,"__esModule",{value:!0});for(var s,l=(o(0),o(38)),c=o(39),u=o(40),d=o(41),p=[],h=0;h<24;h++)p.push({id:h,value:h+":00-"+h+"-59"});var f=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("ext_dashboard",this)}return e.prototype.getView=function(){return{id:"ext_dashboard",hidden:!0,type:"clean",rows:[{rows:[{view:"scrollview",id:"verses",scroll:"y",body:{rows:[{type:"space",id:"e1",margin:0,padding:0,rows:[{cols:[{rows:[{type:"space",responsive:"e1",margin:0,padding:0,cols:[{view:"daterangepicker",id:"date_ext_dash",width:380,label:"Период",timepicker:!0,format:"%d.%m.%Y %H:%i",value:{start:webix.Date.add(new Date,-1,"month"),end:new Date}},{view:"multiselect",id:"hours",label:"Часы",labelAlign:"right",labelWidth:100,options:p}]},{cols:[{view:"multiselect",id:"queues-select",label:"Очереди",labelAlign:"right",width:600,options:"/legacy/grouped_queues_name/short"},{view:"multiselect",id:"agents",label:"Операторы",labelWidth:100,labelAlign:"right",options:"/legacy/ext_dashboard_agentslist/0/short"}]}]},{rows:[{id:"ext_dashboard_fields",view:"button",type:"iconButton",icon:"fa fa-list",width:155,label:"Поля",click:function(){if($$("fields_setup_win"))return void $$("fields_setup_win").show();webix.ui({id:"fields_setup_win",view:"window",title:"",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Настройка полей"},{view:"icon",icon:"wxi-close-circle",click:"$$('fields_setup_win').close();"}]},resize:!0,width:600,height:500,center:!0,position:"center",modal:!1,move:!0,body:{rows:[{id:"fields_tree",view:"tree",template:"{common.icon()} {common.checkbox()} {common.folder()} <span>#value#</span>",select:!0,data:a(),on:{onItemCheck:function(e){var t=$$("fields_tree").getItem(e);t.checked?void 0!==t.col?$$(t.elem).showColumn(t.col):$$(t.elem).show():void 0!==t.col?$$(t.elem).hideColumn(t.col):$$(t.elem).hide()}}}]}}).show()}},{id:"ext_dashboard_salary",view:"button",type:"iconButton",icon:"fa fa-dollar-sign",width:155,label:"Оклады",click:function(){var e;webix.ui((e={id:"salary_setup_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('salary_setup_win').close();"}},e.head={view:"toolbar",margin:-4,cols:[{view:"label",label:"Настройка окладов"},{view:"icon",icon:"wxi-close",click:"$$('salary_setup_win').close();"}]},e.resize=!0,e.width=600,e.height=500,e.center=!0,e.position="center",e.modal=!0,e.move=!0,e.body={rows:[{view:"datatable",id:"salary_agents",autowidth:!0,editable:!0,columns:[{id:"value",header:"Сотрудник",width:400},{id:"salary",header:"Оклад",width:100,editor:"text"}],url:"/legacy/ext_dashboard_agentslist/",on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{view:"button",label:"Сохранить",click:function(){}}]}]},e)).show()}}]},{id:"search_ext_dashboard",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){n()},on:{onItemClick:function(){n()}}}]}]},l.default,c.default,u.default,d.default]}}]}]}},e.prototype.loadData=function(){this.loaded||($$("search_ext_dashboard").callEvent("onItemClick"),this.loaded=1)},e}();t.default=f},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){return e<20?"green":e<50?"orange":"red"},l=function(e){return e<50?"red":e<80?"orange":"greed"},c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"gages_row",rows:[{id:"gages",cols:[{},{id:"gage_sl",view:"gage",minRange:0,maxRange:100,color:l,value:0,label:"SL",placeholder:"%"},{id:"gage_lcr",view:"gage",minRange:0,maxRange:100,color:s,value:0,label:"LCR",placeholder:"%"},{id:"gage_ans",view:"gage",minRange:0,maxRange:20,color:s,value:0,label:"Ср.ответа",placeholder:"сек"},{id:"gage_avg",view:"gage",minRange:0,maxRange:120,color:s,value:0,label:"Ср.разговора",placeholder:"сек"},{id:"gage_fcr",view:"gage",minRange:0,maxRange:100,color:l,value:0,label:"FCR",placeholder:"%"},{id:"box3",view:"template",height:136,css:"tiles",width:250,template:function(e){for(var t=null,o=e.items,i="<div class='flex_tmp'>",n=0;n<o.length;n++)t=o[n],i+="<div class='item "+t.css+"'>",i+="<div class='webix_icon icon fa-"+t.icon+"'></div>",i+="<div class='details'><div class='text'>"+t.text+"</div><div class='value'>"+t.value+"</div></div>",i+="</div>";return i+="</div>"},data:{items:[{id:"evidences",text:"Стоимость звонка",icon:"wxi-usd",css:"feedbacks",value:""}]}},{}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"ext_dashboard_managers",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,height:300,columns:[{id:"agent_name",header:[{text:"Менеджеров"}],sort:"string",width:160},{id:"total",header:[{text:"Звонков"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"served_more20s",header:[{text:"После SL"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"served_call_per",header:[{text:"Отвеченные(%)"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. разговора ВХ"}],width:160},{id:"out_count",header:[{text:"Исходящих"}],width:160},{id:"out_avg",header:[{text:"Ср. разговора ИСХ"}],width:160},{id:"int_count",header:[{text:"Внутренних"}],width:160},{id:"int_avg",header:[{text:"Ср. разговора ВН"}],width:160}],onBeforeLoad:function(){this.showProgress()},onAfterLoad:function(){this.hideProgress()},ready:function(){webix.extend(this,webix.ProgressBar)}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s="<table border=0><tr><td colspan=2><b>#agent_name#</td></tr><tr><td>Готов:</td><td>#ready# ч.</td></tr><tr><td>Не готов:</td><td>#notready# ч.</td></tr><tr><td>Обед:</td><td>#lunch# ч.</td></tr><tr><td>Отдых:</td><td>#rest# ч.</td></tr><tr><td>Постобработка:</td><td>#afterwork# ч.</td></tr><tr><td>Собрание:</td><td>#meeting# ч.</td></tr><tr><td>Доп. задачи:</td><td>#tasks# ч.</td></tr><tr><td>Разговоров:</td><td>#talktime# ч.</td></tr><tr><td>Утилизация:</td><td>#utilization# %</td></tr></table>",l="<table border=0><tr><td colspan=2><b>#agent_name#</td></tr><tr><td>Ср. разговора:</td><td>#avg_duration#</td></tr><tr><td>Ср. исходящие:</td><td>#out_avg#</td></tr><tr><td>Ср. внутренние:</td><td>#int_avg#</td></tr></table>",c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"ext_dashboard_charts",rows:[{height:300,cols:[{id:"callschart",view:"chart",type:"bar",barWidth:20,radius:2,alpha:.7,gradient:"rising",xAxis:{template:"'#period#"},yAxis:{property:"value"},legend:{values:[{text:"Звонки",color:"#4aa397"},{text:"SL",color:"#de619c",markerType:"item"}],valign:"middle",align:"right",width:90,layout:"y"},series:[{value:"#calls#",color:"#4aa397",tooltip:{template:"Звонков: #calls#, SL: #sl#%"}},{type:"line",value:"#slg#",color:"#36abee",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:"Звонков: #calls#, SL: #sl#%"}}]},{id:"hourschart",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#time#"},yAxis:{},legend:{values:[{text:"Принятые > SL",color:"#36abee"},{text:"Принято < SL",color:"#f7ae70"},{text:"Потеряно > SL",color:"#a7ee70"},{text:"Потеряно < SL",color:"#07eef0"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#unserved20#",color:"#07eef0",label:"#unserved20#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#unserved#",color:"#a7ee70",label:"#unserved#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#served20#",color:"#f7ae70",label:"#served20#",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}},{value:"#served#",label:"#served#",color:"#36abee",tooltip:{template:"<table border=0><tr><td>Принятые > SL:</td><td>#served#</td></tr><tr><td>Принятые <= SL:</td><td>#served20#</td></tr><tr><td>Потеряно > SL:</td><td>#unserved#</td></tr><tr><td>Потеряно <= SL:</td><td>#unserved20#</td></tr>"}}]}]},{id:"ext_dashboard_charts2",rows:[{height:300,id:"operatorsworktime",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#agent_name_short#"},yAxis:{},legend:{values:[{text:"Готов",color:"#36abee"},{text:"Не готов",color:"#f7ae70"},{text:"Обед",color:"#a7fe70"},{text:"Отдых",color:"#f7aeff"},{text:"Постобработка",color:"#a7ae70"},{text:"Собрание",color:"#36cbfe"},{text:"Доп.задачи",color:"#36fffe"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#notready#",color:"#f7ae70",label:"#notready# ч.",tooltip:{template:s}},{value:"#lunch#",color:"#a7fe70",label:"#lunch# ч.",tooltip:{template:s}},{value:"#rest#",color:"#f7aeff",label:"#rest# ч.",tooltip:{template:s}},{value:"#afterwork#",color:"#a7ae70",label:"#afterwork# ч.",tooltip:{template:s}},{value:"#meeting#",color:"#36cbfe",label:"#meeting# ч.",tooltip:{template:s}},{value:"#tasks#",color:"#36fffe",label:"#tasks# ч.",tooltip:{template:s}},{value:"#ready#",color:"#36abee",label:"#ready# ч.",tooltip:{template:s}},{type:"line",value:"#utg#",color:"#36abee",label:"#utilization#%",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:s}}]},{height:300,id:"operatorschart",view:"chart",type:"stackedBar",barWidth:60,gradient:"falling",xAxis:{template:"#agent_name_short#"},yAxis:{},legend:{values:[{text:"Ср. разговора",color:"#36abee"},{text:"Ср. исходящие",color:"#f6abee"},{text:"Ср. внутренние",color:"#36fbee"}],valign:"middle",align:"right",width:160,layout:"y"},series:[{value:"#avg_duration_sec#",color:"#36abee",label:"#avg_duration#",tooltip:{template:l}},{value:"#out_avg_sec#",color:"#f6abee",label:"#out_avg#",tooltip:{template:l}},{value:"#int_avg_sec#",color:"#36fbee",label:"#int_avg#",tooltip:{template:l}}]}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"dashboard_tree",type:"lineTree",view:"treetable",columns:[{id:"period",header:[{text:"Период"}],width:250,template:"{common.treetable()}&nbsp;#period#"},{id:"total",header:[{text:"Всего"}]},{id:"served",header:[{text:"Принято"}]},{id:"served20",header:[{text:"Принято > SL"}],width:150},{id:"unserved",header:[{text:"Потеряно"}]},{id:"lost20",header:[{text:"Потеряно > SL"}],width:150},{id:"served_call_per",header:[{text:"Отв (%)"}]},{id:"sl",header:[{text:"SL(%)"}]},{id:"agents",header:[{text:"Операторов"}]},{id:"avg_lost",header:[{text:"ВХ Ср. потер."}],width:130},{id:"avg_ans",header:[{text:"ВХ Ср. отв."}]},{id:"avg_talk",header:[{text:"ВХ Ср. разг."}]},{id:"max_wait",header:[{text:"ВХ Макс. отв."}],width:130},{id:"max_talk",header:[{text:"ВХ Макс. разг."}],width:130},{id:"out_count",header:[{text:translate("Исходящих")}],width:160},{id:"out_avg",header:[{text:translate("Ср. разговора ИСХ")}],width:160},{id:"int_count",header:[{text:translate("Внутренних")}],width:160},{id:"int_avg",header:[{text:translate("Ср. разговора ВН")}],width:160}],resizeColumn:!0,height:500,select:!0,on:{onDataRequest:function(e){webix.message("Получение данных "+e);var t=webix.guiutils.getExtDashboardFilterData();return this.parse(webix.ajax().get("/legacy/ext_dashboard_treetable?filter[parent]="+e,t).then(function(e){return e=e.json()})),!1}}}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n={id:"grouped_reports1_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонки</center>"}],height:30},{id:"grouped_reports1",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},r={id:"grouped_reports2_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Суммарное время разговора, ожидания (мин.)</center>"}],height:30},{id:"grouped_reports2",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},a={id:"grouped_reports3_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Причина завершения обслуженных звонков</center>"}],height:30},{id:"grouped_reports3",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},s={id:"grouped_reports4_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Причина завершения необслуженных звонков</center>"}],height:30},{id:"grouped_reports4",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},l={id:"grouped_reports5_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"grouped_reports5",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},c={id:"grouped_reports6_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"grouped_reports6",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},u={id:"grouped_reports7_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонки по уровню обслуживания (обслуженные в интервале ожидания)</center>"}],height:30},{id:"grouped_reports7",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},d=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("grouped_reports",this)}return e.prototype.getView=function(){return{id:"grouped_reports",hidden:!0,type:"clean",rows:[{rows:[{visibleBatch:"1",rows:[{id:"analysis_outgoing_calls_layout_1",view:"scrollview",batch:1,scroll:"y",body:{height:1120,rows:[{cols:[n,{view:"resizer"},u]},{view:"resizer"},{cols:[c,{view:"resizer"},r]},{view:"resizer"},{cols:[l,{view:"resizer"},a]},{view:"resizer"},{cols:[s]}]}}]}]}]}},e.prototype.loadData=function(){$$("grouped_reports_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.guiutils.contact_grouped_reports_refresh(),this.loaded=1)},e}();t.default=d},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("grouped_reports_by_agents",this)}return e.prototype.getView=function(){return{id:"grouped_reports_by_agents",hidden:!0,type:"clean",rows:[{rows:[{rows:[{id:"agents_reports",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"agent",header:[{text:"<b>Агент</b>",rowspan:3,height:25},{text:"",height:25},{text:"",height:25},{content:"selectFilter"}],sort:"string",template:"#agent#",width:115,footer:{text:"Total:",height:30}},{id:"agent_name",header:[{text:"<b>Имя агента</b>",rowspan:3},{text:""},{text:""},{content:"selectFilter"}],sort:"string",width:120,footer:{content:"avgColumn"}},{id:"total_call",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",footer:{content:"summColumn"}},{id:"unserved_call",header:[{text:""},{text:"Необслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:140,template:"#unserved_call_chart#",footer:{content:"summColumn"}},{id:"served_call",header:[{text:""},{text:"Обслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:140,template:"#served_call_chart#",footer:{content:"summColumn"}},{id:"investment_unserved",header:[{text:"<b>Вклад, %</b>",colspan:2},{text:"Необслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:135},{id:"investment_served",header:[{text:""},{text:"Обслуженные",rowspan:2},{text:""},{content:"textFilter"}],sort:"int",width:130},{id:"time_sum_hold",header:[{text:"<b>Время, мин.</b>",colspan:4},{text:"Всего",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"int",width:140,template:"#time_sum_hold_chart#",footer:{content:"summTimeColumn"}},{id:"time_sum_talk",header:[{text:""},{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"int",width:140,template:"#time_sum_talk_chart#",footer:{content:"summTimeColumn"}},{id:"time_avg_hold",header:[{text:""},{text:"Среднее",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"int",width:100,footer:{content:"avaregeTimeColumn"}},{id:"time_avg_talk",header:[{text:""},{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"int",width:100,footer:{content:"avaregeTimeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}},e.prototype.loadData=function(){var e=this;$$("agents_grouped_reports_filter").show(),$$("reportDateRange").show(),$$("agents_reports")&&(webix.extend($$("agents_reports"),webix.ProgressBar),this.loaded||$$("agents_reports").load("/legacy/grouped_agents_reports","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("grouped_reports_by_queues",this)}return e.prototype.getView=function(){return{id:"grouped_reports_by_queues",hidden:!0,type:"clean",rows:[{rows:[{id:"report_queues",batch:3,view:"scrollview",scroll:"y",body:{height:1010,rows:[{rows:[{id:"report_queues_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"name_queue",header:[{text:"<b>Очередь</b>",rowspan:2,height:25},{text:"",height:25}],width:150,footer:{text:"Всего:",height:30}},{id:"calls_total",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего"}],width:120,footer:{content:"summColumn"}},{id:"unserved_call",header:[{text:""},{text:"Необслуженные"}],width:140,template:"#unserved_call_chart#",footer:{content:"summColumn"}},{id:"served_call",header:[{text:""},{text:"Обслуженные"}],width:140,template:"#served_call_chart#",footer:{content:"summColumn"}},{id:"sum_holdtime",header:[{text:"<b>Суммарное время, мин.</b>",colspan:2},{text:"Ожидание"}],width:140,template:"#sum_holdtime_chart#",footer:{content:"summTimeColumn"}},{id:"sum_talktime",header:[{text:""},{text:"Разговор"}],width:140,template:"#sum_talktime_chart#",footer:{content:"summTimeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{cols:[{id:"report_queues_chart1_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Всего звонков</center>"}],height:30},{id:"report_queues_chart1",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"report_queues_chart2_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Обслуженные звонки</center>"}],height:30},{id:"report_queues_chart2",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:"#month#"},yAxis:{start:0,step:10},legend:{values:[{text:"Перевод",color:"#66CCFF"},{text:"Завершен оператором",color:"#FFCC33"},{text:"Завершен клиентом",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FFCC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{cols:[{id:"report_queues_chart4_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"report_queues_chart4",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:"#month#"},yAxis:{start:0,step:10},legend:{values:[{text:"Минимум",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимум",color:"#66CC33"}],valign:"middle",align:"right",width:130,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"report_queues_chart5_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"report_queues_chart5",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:"#month#"},yAxis:{start:0,step:10},legend:{values:[{text:"Минимум",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимум",color:"#66CC33"}],valign:"middle",align:"right",width:130,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{rows:[{id:"report_queues_chart3_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Необслуженные звонки</center>"}],height:30},{id:"report_queues_chart3",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",xAxis:{template:"#month#"},yAxis:{start:0,step:10},legend:{values:[{text:"Прерванные клиентом",color:"#66CCFF"},{text:"Таймаут вызова клиента",color:"#FF3333"},{text:"По нажатию кнопки клиентом",color:"#66CC33"},{text:"По причине пустой очереди",color:"#CC6633"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"}},{value:"#sales2#",color:"#FF3333",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales2#</div>",tooltip:{template:"#sales2#"}},{value:"#sales3#",color:"#66CC33",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales3#</div>",tooltip:{template:"#sales3#"}},{value:"#sales4#",color:"#CC6633",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales4#</div>",tooltip:{template:"#sales4#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}}]}]}},e.prototype.loadData=function(){$$("queues_grouped_reports_filter").show(),$$("reportDateRange").show(),this.loaded||($$("queues_grouped_reports_load_button").callEvent("itemClick"),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("lost_calls",this)}return e.prototype.getView=function(){return{id:"lost_calls",hidden:!0,type:"clean",rows:[{rows:[{id:"lost_calls_table",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!1,navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"title_unserved_calls",header:[{text:"<b>"+translate("Report for period")+"</b>",colspan:5,height:25},{text:"",rowspan:2,height:25},{text:"",height:25}],fillspace:!0},{id:"client_callback",header:[{text:""},{text:translate("Client called back himself"),rowspan:2},{text:""}],fillspace:!0},{id:"manager_callback",header:[{text:""},{text:translate("Manager called back to client"),colspan:2},{text:translate("Total")}],fillspace:!0},{id:"speed_callback",header:[{text:""},{text:""},{text:translate("Average speed of callback, h.")}],fillspace:!0},{id:"call_was_lost",header:[{text:""},{text:translate("Lost call"),rowspan:2},{text:""}],fillspace:!0}],on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}},ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{id:"lost_calls_list",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"number",header:[{text:"<b>"+translate("List of lost calls during period")+"</b>",height:25},{content:"textFilter",height:30}],sort:"string",fillspace:!0,footer:{text:"<center><b>"+translate("Total:")+"</b></center>",height:30},template:function(e){return'<a href="tel:'+e.number+'">'+e.number+"</a>"}},{id:"date",header:["<b>"+translate("Date and time of last call during period")+"</b>",{content:"textFilter"}],sort:"string",fillspace:!0,footer:{content:"avgColumn"},format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"queue",header:["<b>Очередь</b>",{content:"textFilter"}],sort:"string",fillspace:!0},{id:"agent",header:["<b>Оператор</b>",{content:"textFilter"}],sort:"string",fillspace:!0}],on:{onAfterRender:function(){webix.extend(this,webix.ProgressBar)}},ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadData=function(){$$("lost_calls_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.guiutils.contact_lost_calls_refresh(),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n={id:"traffic_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"name",header:[{text:"Направление",height:30}],fillspace:2},{id:"count",header:[{text:"Звонки"}],fillspace:2},{id:"duration",header:[{text:"Длительность"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}},r={id:"popular_city_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}},a={id:"popular_longdistance_over_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}},s={id:"popular_cell_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"dst",header:[{text:"Номер телефона",height:30}],fillspace:2},{id:"count_dst",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_src",header:[{text:"Сотрудники"}],fillspace:2}],ready:function(){webix.extend(this,webix.ProgressBar)}},l={id:"most_calling_employees_for_period",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"src",header:[{text:"Сотрудник",height:30}],fillspace:2},{id:"count_src",header:[{text:"Звонки"}],fillspace:2},{id:"floor",header:[{text:"Длительность"}],fillspace:2},{id:"group_dst",header:[{text:"Номера"}],fillspace:4,tooltip:"<div style:'color:#000000;'>#group_dst#</div>"}],ready:function(){webix.extend(this,webix.ProgressBar)}},c=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("analysis_outgoing_calls",this)}return e.prototype.getView=function(){return{id:"analysis_outgoing_calls",hidden:!0,type:"clean",rows:[{rows:[{id:"analysis_outgoing_calls_layout",view:"scrollview",scroll:"y",body:{rows:[{height:250,rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Трафик за период</center>"}],height:30},n]},{view:"resizer"},{height:280,rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Популярные городские звонки за период</center>"}],height:30},r]},{view:"resizer"},{height:280,rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Популярные междугородние звонки за период</center>"}],height:30},a]},{view:"resizer"},{height:280,rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Популярные сотовые звонки за период</center>"}],height:30},s]},{view:"resizer"},{height:280,rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Самые звонящие сотрудники за период</center>"}],height:30},l]}]}}]}]}},e.prototype.loadData=function(){$$("analysis_outgoing_calls_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.guiutils.billing_analysis_outgoing_calls_refresh(),this.loaded=1)},e}();t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("operators_work_report",this)}return e.prototype.getView=function(){return{id:"operators_work_report",hidden:!0,type:"clean",rows:[{rows:[{id:"operators_work_table",view:"datatable",resizeColumn:!0,resizeRow:!0,footer:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"operator_name",header:[{text:"Имя оператора",height:25},{content:"textFilter"}],sort:"string",width:210,footer:{text:"Всего:",height:30}},{id:"time_ready",header:[{text:"Время, сколько был готов"},{content:"textFilter"}],sort:"string",width:200,footer:{content:"avgColumn"}},{id:"time_unready",header:[{text:"Суммарное время"},{content:"textFilter"}],sort:"string",width:160},{id:"time_post",header:[{text:"Суммарное время постобработки"},{content:"textFilter"}],sort:"string",width:260},{id:"time_first",header:[{text:"Время первого входа"},{content:"textFilter"}],sort:"string",width:260,template:function(e){if(!e)return"";if(e.time_first){var t=e.time_first.split(" ");return t[0]&&t[1]?t[0]+" в "+t[1]:e.time_first}return""}},{id:"time_last",header:[{text:"Последнего выхода"},{content:"textFilter"}],sort:"string",width:260,template:function(e){if(!e)return"";if(e.time_last){var t=e.time_last.split(" ");return t[0]&&t[1]?t[0]+" в "+t[1]:e.time_last}return""}},{id:"include",header:[{text:"Включений в очереди"},{content:"textFilter"}],sort:"string",width:260},{id:"take_part",header:[{text:"Очереди, в которых принимал участие"},{content:"textFilter"}],sort:"string",width:450}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{id:"operators_work_report_list",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",navigation:!0,multiselect:!0,css:"my_style",tooltip:!0,scheme:{$change:function(e){"Начало смены"==e.type&&(e.$css="highlightB"),"Не готов"==e.type&&(e.$css="highlightY"),"Завершение смены"==e.type&&(e.$css="highlightR")}},columns:[{id:"type",header:[{text:"<b>Тип</b>",height:25},{content:"textFilter"}],sort:"string",width:250,template:"{common.treetable()} #type#"},{id:"calldate",header:["<b>Время</b>",{content:"textFilter"}],sort:"string",width:180,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"duration",header:["<b>Длительность</b>",{content:"textFilter"}],sort:"string",width:150},{id:"queue",header:["<b>Очередь</b>",{content:"textFilter"}],sort:"string",width:0}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadData=function(){$$("operators_work_report_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.guiutils.contact_operators_work_report_refresh(),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("interval_reports",this)}return e.prototype.getView=function(){return{type:"clean",id:"interval_reports",hidden:!0,rows:[{rows:[{view:"scrollview",scroll:"y",body:{height:1120,rows:[{id:"interval_reports_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"<b>Интервал</b>",rowspan:2,height:25},{text:"",height:25},{content:"textFilter"}],sort:"string",width:130,footer:{text:"Всего:",height:30},format:webix.Date.dateToStr("%d.%m.%Y")},{id:"calls_total",header:[{text:"<b>Звонки</b>",colspan:3},{text:"Всего"},{content:"textFilter"}],sort:"string",width:85,footer:{content:"summColumn"}},{id:"calls_unserved",header:[{text:""},{text:"Необслуженные"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summColumn"},template:"#calls_unserved_chart#"},{id:"calls_served",header:[{text:""},{text:"Обслуженные"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summColumn"},template:"#calls_served_chart#"},{id:"sum_holdtime",header:[{text:"<b>Суммарное время, мин.</b>",colspan:2},{text:"Ожидание"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summTimeColumn"},template:"#sum_holdtime_chart#"},{id:"sum_talktime",header:[{text:""},{text:"Разговор"},{content:"textFilter"}],sort:"string",width:140,footer:{content:"summTimeColumn"},template:"#sum_talktime_chart#"}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{cols:[{id:"chart_total_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Всего звонков</center>"}],height:30},{id:"chart_total_calls",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",legend:{values:[{text:"Всего звонков",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},tooltip:{template:"<b>Date: </b>#month#<br><b>Всего звонков: </b>#sales#"},xAxis:{template:""},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"chart_served_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Обслуженные звонки</center>"}],height:30},{id:"chart_served_calls",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Трансфер звонков",color:"#66CCFF"},{text:"Завершенные агентом",color:"#FFCC33"},{text:"Завершенные клиентом",color:"#FF3333"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Трансфер звонков: </b>#sales#"}},{value:"#sales2#",color:"#FFCC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Завершенные агентом: </b>#sales2#"}},{value:"#sales3#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Завершенные клиентом: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{cols:[{id:"chart_unserved_calls_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Необслуженные звонки</center>"}],height:30},{id:"chart_unserved_calls",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Прерванные клиентом",color:"#66CCFF"},{text:"Таймаут вызова агента",color:"#FF3333"},{text:"По нажатию кнопки клиентом",color:"#66CC33"},{text:"По причине пустой очереди",color:"#CC6633"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Прерванные клиентом: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Таймаут вызова агента: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>По нажатию кнопки клиентом: </b>#sales3#"}},{value:"#sales4#",color:"#CC6633",tooltip:{template:"<b>Date: </b>#year#<br><b>По причине пустой очереди: </b>#sales4#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{id:"chart_talktime_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время разговора (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"chart_talktime",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Минимальное",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимальное",color:"#66CC33"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Минимальное: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Среднее: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Максимальное: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]},{view:"resizer"},{cols:[{id:"chart_holdtime_l",rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Время ожидания (минимальное, среднее, максимальное), сек.</center>"}],height:30},{id:"chart_holdtime",view:"chart",type:"bar",gradient:"rising",xAxis:{template:""},yAxis:{start:0,step:10},legend:{values:[{text:"Минимальное",color:"#66CCFF"},{text:"Среднее",color:"#FF3333"},{text:"Максимальное",color:"#66CC33"}],valign:"middle",align:"right",width:250,layout:"y"},series:[{value:"#sales#",color:"#66CCFF",tooltip:{template:"<b>Date: </b>#year#<br><b>Минимальное: </b>#sales#"}},{value:"#sales2#",color:"#FF3333",tooltip:{template:"<b>Date: </b>#year#<br><b>Среднее: </b>#sales2#"}},{value:"#sales3#",color:"#66CC33",tooltip:{template:"<b>Date: </b>#year#<br><b>Максимальное: </b>#sales3#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}}]}]}},e.prototype.loadData=function(){var e=this;$$("interval_reports_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.extend($$("chart_total_calls"),webix.ProgressBar),webix.extend($$("interval_reports_table"),webix.ProgressBar),webix.extend($$("chart_served_calls"),webix.ProgressBar),webix.extend($$("chart_unserved_calls"),webix.ProgressBar),webix.extend($$("chart_talktime"),webix.ProgressBar),webix.extend($$("chart_holdtime"),webix.ProgressBar),$$("chart_total_calls").load("/legacy/interval_reports_day_chart1"),$$("interval_reports_table").load("/legacy/interval_reports_day"),$$("chart_served_calls").load("/legacy/interval_reports_day_chart2"),$$("chart_unserved_calls").load("/legacy/interval_reports_day_chart3"),$$("chart_talktime").load("/legacy/interval_reports_day_chart4"),$$("chart_holdtime").load("/legacy/interval_reports_day_chart5","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("daily_report",this)}return e.prototype.getView=function(){return{id:"daily_report",hidden:!0,type:"clean",rows:[{id:"daily_report_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",navigation:!0,multiselect:!0,tooltip:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:25},{content:"textFilter"}],sort:"string",width:180,template:"#calldate2#",footer:{text:"Всего:",height:30}},{id:"1",header:["Длительность",{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:["Звонки",{content:"textFilter"}],sort:"int",width:155,template:"#share#",footer:{content:"summColumn"}},{id:"3",header:["ACD, мин",{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %",{content:"textFilter"}],sort:"string",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:["PDD, сек",{content:"textFilter"}],sort:"string",width:140,footer:{content:"avaregeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}},e.prototype.loadData=function(){var e=this;$$("daily_report_toolbar").show(),$$("reportDateRange").show(),$$("daily_report_table")&&(webix.extend($$("daily_report_table"),webix.ProgressBar),this.loaded||$$("daily_report_table").load("/legacy/daily_report","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("month_traffic",this)}return e.prototype.getView=function(){return{id:"month_traffic",hidden:!0,type:"clean",rows:[{id:"month_traffic_layout",rows:[{id:"month_traffic_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",columns:[{id:"10",header:[{text:"Месяц",height:25},{content:"selectFilter"}],sort:"string",width:180,template:"#month#",footer:{text:"Всего:",height:30}},{id:"1",header:["Длительность",{content:"textFilter"}],sort:"int",template:"#time#",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:["Звонки",{content:"textFilter"}],sort:"int",width:155,template:function(e){return e&&e.share?e.share:e[1]},footer:{content:"summColumn"}},{id:"3",header:["ACD, мин",{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %",{content:"textFilter"}],sort:"int",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:["PDD, сек",{content:"textFilter"}],sort:"int",width:140,footer:{content:"avaregeColumn"}}],disabled:!0,ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{id:"month_traffic_chart",view:"chart",type:"pie3D",value:"#sales#",color:"#color#",tooltip:{template:"#month#"},pieInnerText:"",shadow:0,disabled:!0,legend:{layout:"y",width:250,align:"right",valign:"middle",template:"<div style='color:#111;font-weight:bold;'>#month#</div>"},ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadData=function(){$$("month_traffic_toolbar").show(),this.loaded||(webix.guiutils.loadMonthTrafficReports(),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("hourly_load",this)}return e.prototype.getView=function(){return{id:"hourly_load",hidden:!0,type:"clean",rows:[{id:"hourly_load_layout",rows:[{id:"hourly_load_table",view:"datatable",resizeColumn:!0,resizeRow:!0,height:85,navigation:!0,multiselect:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:30}],width:180,format:webix.Date.dateToStr("%d.%m.%Y")},{id:"1",header:[{text:"Длительность"}],width:130},{id:"2",header:[{text:"Звонки"}],template:"#share#",width:155},{id:"3",header:[{text:"ACD, мин"}],width:155},{id:"4",header:["ASR, %"],width:120},{id:"5",header:[{text:"PDD, сек"}],width:140}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{borderless:!0,cols:[{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонков в час</center>"}],height:30},{id:"hourly_load_chart",view:"chart",type:"bar",value:"#sales#",color:"#color#",gradient:"rising",label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]},{view:"resizer"},{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>ASR% по часам</center>"}],height:30},{id:"hourly_load_chart_asr",view:"chart",type:"line",value:"#sales#",item:{borderColor:"#ffffff",color:"#000000"},line:{color:"#ff9900",width:3},label:"<div style='color:#111;font-weight:bold;font-size:1.4em;'>#sales#</div>",tooltip:{template:"#sales#"},xAxis:{template:"#month#"},yAxis:{start:0,end:100,step:10},ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}]}},e.prototype.loadData=function(){var e=this;$$("hourly_traffic_toolbar").show(),this.loaded||(webix.extend($$("hourly_load_table"),webix.ProgressBar),webix.extend($$("hourly_load_chart"),webix.ProgressBar),webix.extend($$("hourly_load_chart_asr"),webix.ProgressBar),$$("hourly_load_table").load("/legacy/hourly_load"),$$("hourly_load_chart").load("/legacy/hourly_load_chart1"),$$("hourly_load_chart_asr").load("/legacy/hourly_load_chart2","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=new Date,r=n.getDate()<10?"0"+n.getDate():n.getDate(),a=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,s=r+"-"+a+"-"+n.getFullYear(),l=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("compare_calls",this)}return e.prototype.getView=function(){return{id:"compare_calls",hidden:!0,type:"clean",rows:[{id:"compare_calls_layout",rows:[{id:"compare_calls_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,height:250,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",columns:[{id:"0",header:[{text:"Дата",height:30}],sort:"string",width:180,footer:{text:"Всего:",height:30},format:webix.Date.dateToStr("%d.%m.%Y")},{id:"1",header:[{text:"Длительность"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"2",header:[{text:"Звонки"}],sort:"string",width:155,template:"#share#",footer:{content:"summColumn"}},{id:"3",header:[{text:"ACD, мин"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"4",header:["ASR, %"],sort:"int",width:120,footer:{content:"avaregeColumn"}},{id:"5",header:[{text:"PDD, сек"}],sort:"int",width:140,footer:{content:"avaregeColumn"}}],ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{rows:[{view:"toolbar",elements:[{view:"label",label:"<center>Звонков в час</center>"}],height:30},{id:"compare_calls_chart",view:"chart",type:"line",xAxis:{template:"#hour#"},yAxis:{start:0,step:10},legend:{values:[{text:s,color:"#1293f8"}],align:"right",valign:"middle",layout:"y",width:100,margin:8},series:[{value:"#sales1#",item:{borderColor:"#1293f8",color:"#ffffff"},line:{color:"#1293f8",width:3},tooltip:{template:"Звонки: #sales1# <br>Дата: #day1#"}},{value:"#sales2#",item:{borderColor:"#66cc00",color:"#ffffff"},line:{color:"#66cc00",width:3},tooltip:{template:"Звонки: #sales2# <br>Дата: #day2#"}},{value:"#sales3#",item:{borderColor:"#996600",color:"#ffffff"},line:{color:"#996600",width:3},tooltip:{template:"Звонки: #sales3# <br>Дата: #day3#"}},{value:"#sales4#",item:{borderColor:"#CC0033",color:"#ffffff"},line:{color:"#CC0033",width:3},tooltip:{template:"Звонки: #sales4# <br>Дата: #day4#"}},{value:"#sales5#",item:{borderColor:"#009933",color:"#ffffff"},line:{color:"#009933",width:3},tooltip:{template:"Звонки: #sales5# <br>Дата: #day5#"}}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}]}},e.prototype.loadData=function(){var e=this;$$("compare_calls_toolbar").show(),this.loaded||(webix.extend($$("compare_calls_table"),webix.ProgressBar),webix.extend($$("compare_calls_chart"),webix.ProgressBar),$$("compare_calls_table").load("/legacy/compare_calls"),$$("compare_calls_chart").load("/legacy/compare_calls_chart","json",function(){e.loaded=1}))},e}();t.default=l},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("ext_incoming_external",this)}return e.prototype.getView=function(){return{id:"ext_incoming_external",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_incoming_external_table",view:"datatable",subview:{view:"datatable",columns:[{id:"agent_name",header:[{text:"Оператор"}],sort:"string",width:309},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"rcr",header:[{text:"% повторных"}],width:160},{id:"fcr",header:[{text:"FCR"}],width:160},{id:"transfer",header:[{text:"Переводов"}],width:160},{id:"cost",header:[{text:"Себестоимость"}],width:160},{id:"ready",header:[{text:"Готов"}],width:160},{id:"notready",header:[{text:"Не готов"}],width:160}],data:[],height:300,resizeColumn:!0,resizeRow:!0,select:!0},resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"queue_name",header:[{text:"Линия"}],template:"{common.subrow()} #queue_name#",sort:"string",width:160},{id:"agents",header:[{text:"Операторов"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160},{id:"rcr",header:[{text:"% повторных"}],width:160},{id:"fcr",header:[{text:"FCR"}],width:160},{id:"transfer",header:[{text:"Переводов"}],width:160},{id:"nwh",header:[{text:"Не рабочее время"}],width:160},{id:"cost",header:[{text:"Себестоимость"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)},on:{onSubViewCreate:function(e,t){var o=webix.guiutils.getDateRange("reportDateRange");e.load("legacy/ext_incoming_external_personal?filter[t1]="+o.start+"&filter[t2]="+o.end+"&filter[queue]="+t.queue)}}}]}]}},e.prototype.loadData=function(){$$("ext_incoming_external_toolbar").show(),$$("reportDateRange").show(),this.loaded||$$("ext_incoming_external_table")&&(webix.extend($$("ext_incoming_external_table"),webix.ProgressBar),$$("ext_incoming_external_table").load("legacy/ext_incoming_external_total"),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("ext_incoming_internal",this)}return e.prototype.getView=function(){return{id:"ext_incoming_internal",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_incoming_internal_talbe",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"number",header:[{text:"Вн. номер"},{content:"serverFilter"}],width:160},{id:"user_name",header:[{text:"Сотрудник"},{content:"serverFilter"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Принятых"}],width:160},{id:"unserved",header:[{text:"Не принятых"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160},{id:"lcr",header:[{text:"LCR"}],width:160},{id:"sl",header:[{text:"SL"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadData=function(){$$("ext_incoming_internal_toolbar").show(),$$("reportDateRange").show(),$$("ext_incoming_internal_talbe")&&(webix.extend($$("ext_incoming_internal_talbe"),webix.ProgressBar),this.loaded||($$("search_ext_incoming_internal").callEvent("onItemClick"),this.loaded=1))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("ext_outgoing",this)}return e.prototype.getView=function(){return{id:"ext_outgoing",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_outgoing_table",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"number",header:[{text:"Вн. номер"},{content:"serverFilter"}],width:160},{id:"user_name",header:[{text:"Сотрудник"},{content:"serverFilter"}],width:160},{id:"total",header:[{text:"Всего"}],width:160},{id:"served",header:[{text:"Отвеченных"}],width:160},{id:"unserved",header:[{text:"Не отвеченных"}],width:160},{id:"avg_answer",header:[{text:"Ср. ответа"}],width:160},{id:"avg_duration",header:[{text:"Ср. обращения"}],width:160},{id:"avg_wait",header:[{text:"Ср. ожидания"}],width:160},{id:"max_wait",header:[{text:"Макс. ожидания"}],width:160},{id:"min_wait",header:[{text:"Мин. ожидания"}],width:160}],ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},e.prototype.loadData=function(){$$("ext_outgoing_toolbar").show(),$$("reportDateRange").show(),$$("ext_outgoing_table")&&(webix.extend($$("ext_outgoing_table"),webix.ProgressBar),this.loaded||($$("search_ext_outgoing").callEvent("onItemClick"),this.loaded=1))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){if(e.block){if(1==e.$level)return"<span class='webix_icon fa-angle-double-right'></span>";if(2==e.$level)return"<span class='webix_icon fa-question'></span>"}else{if(1==e.$level)return"<span class='webix_icon fa fa-calendar'></span>";if(2==e.$level)return"<span class='webix_icon fa fa-star'></span>";if(3==e.$level)return"<span class='webix_icon fa fa-adjust'></span>";if(4==e.$level)return"<span class='webix_icon fa fa-stopwatch'></span>";if(5==e.$level)return""}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("checklist",this)}return e.prototype.getView=function(){return{id:"checklist",hidden:!0,type:"clean",rows:[{rows:[{id:"ext_checklist_table",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,type:{folder:n},columns:[{id:"value",header:[{text:""}],template:"{common.treetable()} #value#",width:300},{id:"total",header:[{text:"Итоговый балл"}],width:200},{id:"percent",header:[{text:"Процент"}],width:300}],on:{onItemDblClick:function(e,t,o){var i=$$("ext_checklist_table").getItem(e);4==i.$level&&webix.guiutils.checklistFillWindow(i.user_id,i.date,i.checklist_id)},onAfterLoad:function(e){}}}]}]}},e.prototype.loadData=function(){if($$("checklist_toolbar").show(),$$("reportDateRange").show(),$$("ext_checklist_table")&&!this.loaded){var e=webix.guiutils.getDateRange("reportDateRange");webix.extend($$("ext_checklist_table"),webix.ProgressBar),$$("ext_checklist_table").showProgress(),$$("ext_checklist_table").load("/legacy/ext/checklist/tree?start="+e.start+"&finish="+e.end),this.loaded=1}},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n="<strong>#name#:</strong><table><tr><td>Промоутеры: &nbsp;</td><td>#promouters#%</td></tr><tr><td>Нейтралы:</td><td>#neutrals#%</td></tr><tr><td>Детракторы:</td><td>#detractors#%</td></tr><tr><td>NPS:</td><td>#nps#%</td></tr><tr><td>Клиентов:</td><td>#allClients#</td></tr></table>",r={id:"nps/dashboard",view:"panel",x:0,y:0,dx:1,dy:1,header:"NPS по городам",body:{view:"chart",id:"countListByCities",minWidth:500,minHeight:500,type:"stackedBar",barWidth:30,radius:2,padding:{bottom:110},css:"nps_chart nps_chart_cities",legend:{values:[{text:"Детракторы",color:"#d81b1b"},{text:"Нейтралы",color:"#d4dbd3"},{text:"Промоутеры",color:"#27ae60"},{text:"NPS",color:"#ff9900"}],valign:"middle",align:"center",width:400,height:30,layout:"x"},xAxis:{template:"#name#",width:100},yAxis:{start:0,step:25,end:100,lines:!0},series:[{value:"#detractors#",color:"#d81b1b",tooltip:{template:n}},{value:"#neutrals#",color:"#d4dbd3",tooltip:{template:n}},{value:"#promouters#",color:"#27ae60",tooltip:{template:n}},{type:"line",value:"#nps#",color:"#ff9900",label:"#nps#%(#numberNps#)",item:{borderColor:"#ff9900",color:"#ff9900",type:"s",radius:6,borderWidth:1,shadow:!0},line:{color:"#ff9900",width:3},tooltip:{template:n}}],ready:function(){webix.extend(this,webix.ProgressBar),webix.guiutils.getNpsFilter()}}},a={id:"dashboardNps",view:"panel",x:0,y:0,dx:1,dy:1,header:"NPS по филиалам",body:{view:"chart",id:"countList",minWidth:500,minHeight:500,type:"stackedBar",barWidth:30,radius:2,padding:{bottom:110},css:"nps_chart nps_chart_filials",legend:{values:[{text:"Детракторы",color:"#d81b1b"},{text:"Нейтралы",color:"#d4dbd3"},{text:"Промоутеры",color:"#27ae60"},{text:"NPS",color:"orange"}],valign:"middle",align:"center",width:400,height:30,layout:"x"},xAxis:{template:function(e){if(!e)return"";if(!e.name)return"";if(e.name.toString().length>10){var t=e.name.substring(0,7);return t+="..",t+=e.name.substring(e.name.length-2)}return e.name},width:200},yAxis:{start:0,step:25,end:100,lines:!0},series:[{value:"#detractors#",color:"#d81b1b",tooltip:{template:n}},{value:"#neutrals#",color:"#d4dbd3",tooltip:{template:n}},{value:"#promouters#",color:"#27ae60",tooltip:{template:n}},{type:"line",value:"#nps#",color:"#ff9900",label:"#nps#%(#numberNps#)",item:{borderColor:"#ff9900",color:"#ff9900",type:"s",radius:6,borderWidth:1,shadow:!0},line:{color:"#ff9900",width:3},tooltip:{template:n}}]}},s={view:"chart",id:"detractorsList",type:"barH",height:450,css:"flip-horizontal-chart chart-detractor",value:"#sales#",tooltip:{template:"#comments#"},label:"<strong>#label#</strong> <span class='chart-number'>#sales#%</span>",barWidth:35,padding:{top:30,left:0,right:10,bottom:20},color:"#d81b1b",legend:{values:[{text:"Детракторы",color:"#d81b1b"}],valign:"middle",align:"center",height:22,layout:"x"},xAxis:{start:0,step:25,end:100,lines:!1}},l={view:"chart",id:"promotersList",type:"barH",css:"no-flip-horizontal-chart chart-promouter",value:"#sales#",tooltip:{template:"#comments#"},InnerText:"#sales#",label:" <span class='chart-number'>#sales#%</span> <strong>#label#</strong>",barWidth:35,padding:{top:30,left:0,right:10,bottom:20},color:"#27ae60",legend:{values:[{text:"Промоутеры",color:"#27ae60"}],valign:"middle",align:"center",height:22,layout:"x"},xAxis:{start:0,step:25,end:100,lines:!1}},c={rows:[r,a]},u={cols:[s,l]},d=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("dashboard",this)}return e.prototype.getView=function(){return{view:"scrollview",id:"dashboard",hidden:!0,body:{rows:[c,u]}}},e.prototype.loadData=function(){$$("dashboard_toolbar").show(),$$("reportDateRange").show(),this.loaded||(webix.guiutils.getNpsFilter(),this.loaded=1)},e}();t.default=d},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("reports",this)}return e.prototype.getView=function(){return webix.protoUI({name:"my_suggest",$init:function(e){var t=e.body.rows.length;t>1&&(e.body.rows[t]={view:"select",label:"От",id:"markFrom",options:["","0","1","2","3","4","5","6","7","8","9","10"]},e.body.rows[t+1]={view:"select",label:"До",id:"markTo",options:["","0","1","2","3","4","5","6","7","8","9","10"]},e.body.rows[t+2]={view:"button",label:"Применить",click:function(){$$("reports");$$("reports").filterByAll()}})}},webix.ui.checksuggest),webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,o){t.firstChild.innerHTML="Итого:  "+e.count()||"0"}},webix.ui.datafilter.summColumn),{id:"reports",hidden:!0,view:"datatable",select:!0,css:"my_style",tooltip:!0,footer:!0,resizeColumn:!0,columns:[{id:"id",header:[{text:translate("ID")},{content:"serverFilter"}],sort:"int",width:40,footer:{content:"rowCount",colspan:2}},{id:"city",header:[{text:translate("Город")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/city"}],sort:"int",width:150,footer:{content:"rowCount",colspan:1}},{id:"filial",header:[{text:translate("Филиал")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/filial"}],sort:"int",width:150},{id:"channel",header:[{text:translate("Канал")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/channel"}],sort:"int",width:150},{id:"name",header:[{text:translate("ФИО клиента")},{content:"serverFilter"}],sort:"int",width:150},{id:"lastbuy_date",header:[{text:translate("Дата последней покупки ")},""],width:220},{id:"buyer_status",header:[{text:translate("Статус покупателя")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"}},options:[{id:"Первичный"},{id:"Повторный"}]}],width:180},{id:"motivational_p",header:[{text:translate("Мотивационная программа")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/motivational_p"}],sort:"int",width:180},{id:"recomendations_mark",header:[{text:translate("Шкала рекомендаций")},{content:"multiSelectFilter",suggest:{view:"my_suggest",fitMaster:!1,width:200}}],sort:"int",width:180},{id:"reason_plus",header:[{text:translate("Причина положительной оценки")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/reasonPlus"}],sort:"int",width:250},{id:"reason_minus",header:[{text:translate("Причина отрицательной оценки")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:"legacy/nps/options/reasonPlus"}],sort:"int",width:250},{id:"recomendations",header:[{text:translate("Рекомендации по улучшению")},{content:"multiSelectFilter",suggest:{fitMaster:!1,body:{tooltip:function(e){return e.id},template:"#id#"},tooltip:!0},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}},options:"legacy/nps/options/recomendations"}],width:250,sort:"int"}],on:{onBeforeContextMenu:function(e){this.select(e)}},ready:function(){$$("reports").registerFilter($$("reportDateRange"),{columnId:"date"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),$$("reports").registerFilter($$("markFrom"),{columnId:"markFrom"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),$$("reports").registerFilter($$("markTo"),{columnId:"markTo"},{getValue:function(e){return e.getValue()},setValue:function(e,t){e.setValue(t)}}),webix.extend(this,webix.ProgressBar),webix.ui({view:"contextmenu",submenu:"data",width:300,data:[{value:"Анкета",id:"open"}],on:{onMenuItemClick:function(e){if("open"===this.getMenuItem(e).id){var t=$$("reports")?$$("reports").getSelectedItem():0;t?window.open(window.location.origin+"/#!/main/script?id=10&nps="+t.id,"_blank"):webix.message({type:"error",text:"Произошла ошибка"})}}}}).attachTo(this)}}},e.prototype.loadData=function(){$$("reports_toolbar").show(),$$("reportDateRange").show(),this.loaded||($$("reports").load("legacy/nps/report"),this.loaded=1)},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n={fitMaster:!1,width:250,body:{template:"#id#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}};webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,o){t.firstChild.innerHTML="Итого:  "+e.count()||"0"}},webix.ui.datafilter.summColumn),webix.ui.datafilter.rowCount=webix.extend({refresh:function(e,t,o){t.firstChild.innerHTML="Итого: "+e.count()||"0"}},webix.ui.datafilter.summColumn);var r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("clients",this)}return e.prototype.getView=function(){return{id:"clients",hidden:!0,view:"datatable",select:!0,css:"my_style",tooltip:!0,scrollY:!0,scrollX:!0,scrollAlignY:!0,footer:!0,resizeColumn:!0,columns:[{id:"id",header:[{text:translate("ID")},{content:"serverFilter"}],sort:"int",width:40,footer:{content:"rowCount",colspan:2}},{id:"created",header:[{text:translate("Дата добавления")},{content:"serverDateRangeFilter"}],sort:"int",width:180,format:webix.Date.dateToStr("%d.%m.%Y в %H:%i:%s")},{id:"phone",header:[{text:translate("Номер телефон")},{content:"serverFilter"}],sort:"int",width:150,template:function(e){return window.MakeCall?"<a href=\"javascript:window.MakeCall('"+e.phone+"');\">"+e.phone+"</a>":'<a href="tel:'+e.phone+'">'+e.phone+"</a>"}},{id:"name",header:[{text:translate("Имя клиента")},{content:"serverFilter"}],sort:"int",width:220},{id:"called",header:[{text:translate("Последний звонок")},{content:"serverDateRangeFilter"}],sort:"int",width:220},{id:"buyer_status",header:[{text:translate("Статус покупателя")},{content:"multiSelectFilter",suggest:n,options:[{id:"Первичный"},{id:"Повторный"}]}],sort:"int",width:180},{id:"lastbuy_date",header:[{text:translate("Дата последней покупки")},""],sort:"int",width:220},{id:"city",header:[{text:translate("Город")},{content:"multiSelectFilter",suggest:n,options:"legacy/nps/options/city"}],sort:"int",width:180},{id:"filial",header:[{text:translate("Филиал")},{content:"multiSelectFilter",suggest:n,options:"legacy/nps/options/filial"}],sort:"int",width:180},{id:"channel",header:[{text:translate("Канал")},{content:"multiSelectFilter",suggest:n,options:"legacy/nps/options/channel"}],sort:"int",width:180},{id:"state",header:[{text:translate("Результат звонка")},{content:"multiSelectFilter",suggest:{fitMaster:!1,width:250,body:{template:"#value#"},on:{onBeforeShow:function(){var e=this.getList(),t=[];e.data.each(function(e){t.push(e.id)});var o=webix.html.getTextSize(t,"webix_list_item").width+100;this.define("width",o),this.resize()}}},options:[{id:0,value:"Не звонили"},{id:1,value:"Не отвечает"},{id:2,value:"Занят"},{id:3,value:"Перезвонить"},{id:4,value:"Состоялся"}]}],sort:"int",template:function(e){var t=["Не звонили","Не отвечает","Занят","Перезвонить","Состоялся"];return e&&e.state?3==e.state&&e.called?t[e.state]+" в "+e.called:t[e.state]:""},width:180},{id:"anketa",width:120,header:[{text:translate("Анкета")},{text:""}],sort:"int",template:function(e){return e?e.id?'<div class="webix_view webix_control webix_el_button" style="display: inline-block; vertical-align: top; border-width: 0px; width: 100px; height: 38px;"><div class="webix_el_box" style="width:100px; height:30px"><button type="button" class="webix_img_btn_abs webixtype_base accountDone" style="width:100%; "><center>Анкета</center></button></div></div></div>':void 0:""}}],datafetch:20,loadahead:10,on:{onBeforeContextMenu:function(e){this.select(e)},onItemClick:function(e){if("anketa"==e.column){var t=$$("clients").getSelectedItem();window.open(window.location.origin+"/#!/main/script?id=10&nps="+t.id,"_blank")}},onAfterFilter:function(){},onBeforeFilter:function(e,t,o){}},ready:function(){webix.extend(this,webix.ProgressBar),webix.ui({view:"contextmenu",submenu:"data",width:300,data:[{value:"Изменить статус",id:"editStatus",submenu:[{id:"0",value:"Не звонили"},{id:1,value:"Не отвечает"},{id:2,value:"Занят"},{id:3,value:"Перезвонить"},{id:4,value:"Совершен"}]},{value:"Анкета",id:"open"}],on:{onMenuItemClick:function(e){var t=this.getMenuItem(e);if("open"==t.id){var o=$$("clients")?$$("clients").getSelectedItem():0;o?window.open(window.location.origin+"/#!/main/script?id=10&nps="+o.id,"_blank"):webix.message({type:"error",text:"Произошла ошибка"})}else if("editStatus"!=t.id){var i=$$("clients").getSelectedItem();webix.ajax().get("legacy/nps/clients/setstate",{npsId:i.id,state:t.id},function(e){e=JSON.parse(e),e.result?(webix.message({text:"Статус звонка изменен"}),$$("clients").clearAll(),$$("clients").load($$("clients").config.url)):(webix.message({type:"error",text:e.msg}),console.log("err",e.data))})}}}}).attachTo(this)}}},e.prototype.loadData=function(){var e=this;$$("clients_toolbar").show(),$$("clients")&&(this.loaded||(webix.extend($$("clients"),webix.ProgressBar),$$("clients").load("legacy/nps/clients","json",function(){e.loaded=1})))},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("outgoingcampaign",this)}return e.prototype.getView=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if($$("outgoingcampaign-toolbar").hide(),$$("outgoingcampaigns").hide(),$$("outgoingcampaign-form").show(),e){if($$("co-form").setValues(e),!e.id)return;webix.ajax().get("outgoingcampaign/"+e.id+"/queues").then(function(e){var t=e.json();t.length&&$$("oc-queues").parse(t)}),webix.ajax().get("outgoingcampaign/"+e.id+"/results").then(function(e){var t=e.json();t.length&&$$("oc-results").parse(t)})}}return{view:"datatable",id:"outgoingcampaigns",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,columns:[{id:"tm_created",header:"Создан(а)",width:150,minWidth:50,template:function(e){var t="";switch(e.state){case"1":t+="<img src='./assets/imgs/oc-states/2.png'>";break;case"2":t+="<img src='./assets/imgs/oc-states/3.png'>";break;case"3":t+="<img src='./assets/imgs/oc-states/4.png'>";break;case"4":t+="<img src='./assets/imgs/oc-states/5.png'>";break;case"5":t+="<img src='./assets/imgs/oc-states/6.png'>";break;default:t+="<img src='./assets/imgs/oc-states/1.png'>"}return t+=webix.Date.dateToStr("%d.%m.%y в %H:%i")(e.tm_created)}},{id:"name",header:"Название",fillspace:2,minWidth:90},{id:"method",header:"Рассписание",fillspace:2,minWidth:90,template:function(e){var t=webix.Date.dateToStr("%d.%m")(e.date_start);return t+="-"+webix.Date.dateToStr("%d.%m")(e.date_finish),t+=" "+Object.values(e.days).join(","),t+=" c "+e.time_start,t+=" до "+e.time_finish}},{id:"state",header:"Статус",width:200,minWidth:90,sort:"text",template:function(e){if(!e)return"1";if(!e.state)return"2";switch(e.state){case"1":return"Создан(а)";case"2":return"Выполняется";case"3":return"Приостановлен(а)";case"4":return"Остановлен(а)";case"5":return"Завершен(а)";default:return""}}}],ready:function(){},on:{onItemDblClick:function(t,o,i){var n=this.getSelectedItem();if(n.time_start){var r=n.time_start.split(":",2);2==r.length&&(n.minutes_start=r[1],n.hours_start=r[0]);var a=n.time_finish.split(":",2);2==a.length&&(n.minutes_finish=a[1],n.hours_finish=a[0])}var s={};for(var l in n.days)s[l]=1;$$("weekDays-form").setValues(s),n.settings.length?n.result=n.settings[0].result:n.result=0,console.log(n),e(n)}}}},e.prototype.loadData=function(){var e=this;$$("outgoingcampaign-toolbar").show(),$$("outgoingcampaigns")&&(this.loaded||(webix.extend($$("outgoingcampaigns"),webix.ProgressBar),$$("outgoingcampaigns").load("/outgoingcampaign/list","json",function(){e.loaded=1})))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(15),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e,t=[{id:1,value:"В очереди"},{id:2,value:"Вызывается"},{id:3,value:"Занят"},{id:4,value:"Ошибка"},{id:5,value:"Переход"},{id:6,value:"Завершен"},{id:7,value:"Остановлен"},{id:8,value:"Запланирован"}];return{id:"co-calls-window",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:500,width:900,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:"Звонки контакту",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){$$("co-calls-window").hide()}}]},body:(e={view:"datatable",id:"co-calls-table",scroll:!0,tooltip:!0,resizeColumn:!0},e.scroll=!0,e.columns=[{id:"time",header:"Дата и время",fillspace:2,format:webix.Date.dateToStr("%d.%m.%y в %H:%i"),minWidth:100},{id:"rbt_duration",header:"Вызов(сек)",fillspace:2,minWidth:100},{id:"duration",header:"Разговор(сек)",fillspace:2,minWidth:100},{id:"hangup_code",header:"Код завершения",fillspace:4,minWidth:100,template:function(e){return e?e.status_text?e.status_text:e.hangup_code?e.hangup_code:"":""}},{id:"state",header:"Результат",width:100,template:function(e){if(console.log(e.state),6==e.state||3==e.state)var o=t[e.state].value+"(a)";else var o=t[e.state].value;return o}}],e)}},t.prototype.showWindow=function(e){e&&e.id&&this.$$("co-calls-table").load("/outgoingcampaign/result/"+e.id+"/calls"),this.getRoot().show()},t}(a.b),c=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.getView=function(){for(var e=this,t=[],o=["00","10","20","30","40","50","59"],i=["1","3","5","10","15","20"],n=[{id:1,value:"В очереди"},{id:2,value:"Вызывается"},{id:3,value:"Занят"},{id:4,value:"Ошибка"},{id:5,value:"Переход"},{id:6,value:"Завершен"},{id:7,value:"Остановлен"},{id:8,value:"Запланирован"}],r=["OCA_MANAGER","OCS_PHONE","OCS_QUEUE","OCS_PLAYFILE"],a=function(e,t){r.forEach(function(t){if(t==e)return!1;$$(t)&&$$(t).setValue(0)})},l=function(e){var t={};return r.forEach(function(o){if(0!=e[o])return t.action=e[o],void(t.value=e[o+"value"])}),t},c=function(){$$("oc-queues").clearAll(),$$("oc-results").clearAll(),$$("co-form").setValues({}),$$("outgoingcampaign-toolbar").show(),$$("outgoingcampaigns").show(),$$("outgoingcampaign-form").hide(),$$("outgoingcampaigns").load("/outgoingcampaign/list")},u=function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")},d=function(e){var t=[],o=window.settingsResult?window.settingsResult:e.settings;return!!o&&(o.forEach(function(e){var o={};parseInt(e.pause)&&(o.pause=1,o.pause_time=e.pause_time),parseInt(e.stop)?o.stop=1:parseInt(e.postpone_for_radio)?o.postpone_for=e.postpone_for:parseInt(e.postpone_to)&&(o.postpone_to=e.postpone_to_date),o.result=e.id,t.push(o)}),t)},p=function(){var e=$$("co-form").getValues(),t={};t.id=parseInt(e.id)?e.id:0,0==t.id&&(t.state=1),t.name=e.name,t.description=e.description,t.date_finish=webix.Date.dateToStr("%Y-%m-%d")(e.date_finish),t.date_start=webix.Date.dateToStr("%Y-%m-%d")(e.date_start),t.time_start=e.hours_start.toString()+":"+e.minutes_start.toString()+":00",t.time_finish=e.hours_finish.toString()+":"+e.minutes_finish.toString()+":00",t.days=u($$("weekDays-form").getValues()),t.call_tries=e.call_tries;var o=l(e);t.action=o.action,t.action_value=o.value,t.min_call_time=window.min_call_time,t.concurrent_calls_limit=window.concurrent_calls_limit;var i=d(e);return i&&(t.settings=i),t.phones=$$("oc-queues").serialize(),t},h=0,f=function(){webix.ui({view:"window",id:"importPhoneWindow",position:"center",move:!0,resizw:!0,modal:!0,width:700,height:500,scroll:!0,head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Импорт телефонов"},{view:"icon",icon:"times-circle",click:function(){webix.confirm({text:"Внесенные изменения не будут сохранены. <br/> Продолжить?",ok:"Ок",cancel:"Отмена",callback:function(e){e&&$$("importPhoneWindow").close()}})}}]},body:{id:"importForm",view:"form",elements:[{view:"uploader",value:translate("Выберите CSV файл"),on:{onBeforeFileAdd:function(e){var t=[{id:"phone",value:translate("Номер телефона")},{id:"name",value:translate("Имя контакта")},{id:"description",value:translate("Примечание")},{id:"state",value:translate("Состояние")}];if("csv"==e.type){var o=new FileReader;return o.onload=function(e){for(var o=e.target.result.split("\n"),i=0;i<o.length;i++){var n={};o[i]=o[i].split("\t");for(var r=0;r<o[i].length;r++)n["field"+(r+1)]=o[i][r];o[i]=n}for(var a=[],i=0;i<o.length;i++)a.push(o[i].field1.split(";",-1));for(var s=webix.toArray($$("importData").config.columns),i=0;i<a[0].length;i++)s.insertAt({id:"field"+i,header:[{content:"selectFilter",options:t}]},i);$$("importData").refreshColumns(),$$("importData").clearAll();for(var i=0;i<a.length;i++){for(var n={},r=0;r<a[i].length;r++)n["field"+r]=a[i][r];a[i]=n,$$("importData").parse(a[i])}},o.readAsText(e.file),!1}webix.message({type:"error",text:"Неизвестный тип файла!"})}}},{view:"datatable",id:"importData",select:!0,resize:!0,resizeColumn:!0,columns:[],ready:function(){this.filterByAll=function(){}}},{margin:20,cols:[{view:"button",id:"importButton",type:"form",value:"Импортировать",align:"right",click:function(){var t=w(),o=[],i=$$("importData").serialize();if(!t||!t.phone)return webix.message({type:"error",text:"Выберите телефон"}),!1;for(var n in i)if(i[n]){var r={phone:String(i[n]["field"+t.phone]),name:"undefined"!=String(i[n]["field"+t.name])?String(i[n]["field"+t.name]):null,description:"undefined"!=String(i[n]["field"+t.description])?String(i[n]["field"+t.description]):null,state:"undefined"!=String(i[n]["field"+t.state])?String(i[n]["field"+t.state]):null,id:webix.uid()};r.phone.length&&o.push(r)}o?(e.$$("oc-queues").parse(o),g(),webix.message({type:"success",text:"Телефоны импортированы в таблицу!"}),$$("importPhoneWindow").close()):webix.message({type:"error",text:"Нет данных!"})}}]}]},ready:function(){webix.extend($$("importPhoneWindow"),webix.ProgressBar)}}).show()},w=function(){var e=$$("importData").serialize(),t=[];if(e&&e.length)for(var o in e[0])"id"!=o&&t.push($$("importData").getFilter(o).value);var i=!1;for(var n in t){if("phone"==t[n]){i=!0;break}i=!1}if(i){var r=[];for(var a in t)-1!=t[a].indexOf("phone")&&(r.phone=a),-1!=t[a].indexOf("name")&&(r.name=a),-1!=t[a].indexOf("description")&&(r.description=a),-1!=t[a].indexOf("state")&&(r.state=a);return r}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$$("oc-queues").serialize(),t=$$("oc-results").serialize().length,o=0,i=0,n=0;for(var r in e){var a=e[r];switch(parseInt(a.state)){case 1:++n;break;case 6:++t;break;case 3:++o;break;case 4:++i}}$$("phones-total-info").setValue("Контактов в списке: "+e.length+" Завершено: "+t+", Занят/не отвечает: "+o+", Ошибка дозвона: "+i+", В очереди: "+n)};h<=23;)h<=9&&(h="0"+h.toString()),t.push(h.toString()),h++;return{hidden:!0,id:"outgoingcampaign-form",rows:[{template:"Редактирование кампании",type:"header"},{view:"form",id:"co-form",padding:24,scroll:!0,rows:[{rows:[{margin:10,cols:[{view:"fieldset",label:"Название",body:{view:"text",name:"name",required:!0,tooltip:"Название кампании: #value#"}},{view:"fieldset",label:"Период проведения",body:{cols:[{required:!0,view:"datepicker",name:"date_start",label:"Начало",labelPosition:"left",placeholder:"Click to select"},{required:!0,view:"datepicker",name:"date_finish",label:"Конец",labelPosition:"left",placeholder:"Click to select"}]}},{view:"fieldset",label:"Время звонка",body:{cols:[{view:"label",label:"С:",width:20},{view:"richselect",name:"hours_start",options:t,required:!0},{view:"richselect",name:"minutes_start",options:o,required:!0},{view:"label",label:"По:",width:50},{view:"richselect",name:"hours_finish",options:t,required:!0},{view:"richselect",name:"minutes_finish",options:o,required:!0}]}}]},{margin:10,cols:[{view:"fieldset",label:"Описание кампании",body:{required:!0,view:"textarea",name:"description",tooltip:"Описание кампании: #value#"}},{view:"fieldset",label:"Дни недели",body:{view:"form",id:"weekDays-form",elements:[{name:"weekDays",rows:[{cols:[{view:"checkbox",name:1,labelRight:"Пн",labelWidth:0},{view:"checkbox",name:2,labelRight:"Вт",labelWidth:0},{view:"checkbox",name:3,labelRight:"Ср",labelWidth:0},{view:"checkbox",name:4,labelRight:"Чт",labelWidth:0},{view:"checkbox",name:5,labelRight:"Пт",labelWidth:0},{view:"checkbox",name:6,labelRight:"Сб",labelWidth:0},{view:"checkbox",name:7,labelRight:"Вс",labelWidth:0}]},{cols:[{view:"checkbox",name:8,labelRight:"Рабочие дни",labelWidth:0,disabled:!0},{view:"checkbox",name:9,labelRight:"Выходные",labelWidth:0,disabled:!0},{view:"checkbox",name:10,labelRight:"Праздники",labelWidth:0,disabled:!0}]}]}]}},{rows:[{view:"fieldset",label:"Настройка",body:{cols:[{view:"richselect",label:"Попыток",options:i,name:"call_tries",tooltip:"Попыток: #value#",required:!0},{view:"button",label:"Расширенные",click:function(){this.$scope.ui(s.OCRulesWnd).showWindow(this.$scope.$view);var e=$$("co-form").getValues();parseInt(e.id)?($$("co-settings-result").parse(e.settings),$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")):$$("co-settings-result").load("/outgoingcampaign/0/settings").then(function(){$$("co-settings-result").unselectAll(),$$("co-settings-result").select("0")})}}]}},{},{cols:[{view:"button",label:"Обновить статусы",click:function(){var e=$$("co-form").getValues();parseInt(e.id)||(e.id=0),$$("oc-queues").clearAll(),$$("oc-results").clearAll(),$$("oc-queues").load("outgoingcampaign/"+e.id+"/queues","json",function(){g()}),$$("oc-results").load("outgoingcampaign/"+e.id+"/results","json",function(){g()})}}]}]}]},{margin:10,cols:[{view:"tabview",id:"co-tabview",cells:[{header:"Очередь",width:150,body:{id:"oc-queues-tab",rows:[{view:"datatable",id:"oc-queues",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,minHeight:200,editable:!0,columns:[{id:"phone",header:"Номер телефона",width:150,minWidth:50,editor:"text"},{id:"name",header:"Имя контакта",fillspace:2,minWidth:90,editor:"text"},{id:"description",header:"Примечание",fillspace:2,minWidth:90,editor:"text"},{id:"state",header:"Состояние",fillspace:2,minWidth:90,options:n,editor:"select"}],on:{"data->onParse":function(e,t){g(t)}},scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",type:"iconButton",icon:"wxi-file",width:260,label:"Импорт из CSV...",click:function(){f()}},{view:"button",type:"iconButton",icon:"fa fa-plus",width:60,click:function(){var t=e.$$("oc-queues").add({});e.$$("oc-queues").select(t),$$("oc-queues").showCell(),$$("oc-queues").editCell(t,"phone",!0,!0),g()}},{},{}]}]}},{header:"Результаты",width:170,body:{id:"oc-results-tab",rows:[{view:"datatable",id:"oc-results",select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,minHeight:200,columns:[{id:"phone",header:"Номер телефона",width:150,minWidth:50},{id:"name",header:"Имя контакта",fillspace:2,minWidth:90},{id:"description",header:"Примечание",fillspace:1,minWidth:90},{id:"state",header:"Состояние",fillspace:2,minWidth:90,template:function(e){var t="",o=parseInt(e.state)-1;return 6==e.state||3==e.state?t+=n[o].value+"(a)":t+=n[o].value,3!=e.state&&4!=e.state||(t+=" "+e.dial_result),t+=", звонков: "+e.tries+", последний: "+webix.Date.dateToStr("%d.%m в %H:%i")(e.last_call)}}],on:{onItemDblClick:function(){this.$scope.callsWindow.showWindow(this.getSelectedItem())}},scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",label:"Импорт из CSV...",width:150,disabled:!0},{},{view:"button",label:"Звонки контакту",width:150,click:function(){$$("oc-results").getSelectedItem()?this.$scope.callsWindow.showWindow($$("oc-results").getSelectedItem()):webix.alert({type:"error",text:"Выберите контакт для просмотра звонков"})}}]}]}},{header:"Журнал",width:120,body:{id:"oc-journal-tab",rows:[{view:"datatable",id:"oc-journal",minHeight:200,select:!0,tooltip:!0,resizeColumn:!0,scroll:!0,columns:[{id:"datatime",header:"Дата и время",width:150,minWidth:50},{id:"value",header:"Сообщение",fillspace:2,minWidth:90}],scheme:{$init:function(e){parseInt(6==e.state||4==e.state)?e.$css="bad-row":e.$css="good-row"}}},{cols:[{view:"button",label:"Импорт из CSV...",width:150,disabled:!0},{},{}]}]}}]}]},{margin:10,cols:[{view:"button",label:"Создать отчет",width:150,click:function(){switch($$("co-tabview").getValue()){case"oc-journal-tab":var e="oc-journal";break;case"oc-queues-tab":var e="oc-queues";break;case"oc-results-tab":var e="oc-results"}webix.csv.delimiter.cols=";",webix.toCSV($$(e),{filename:e})}},{view:"label",id:"phones-total-info",align:"right",label:"Контактов в списке: 0, Завершено: 0, Занят/не отвечает: 0, Ошибка дозвона: 0, В очереди: 1"}]},{margin:10,cols:[{view:"fieldset",label:"Действие при дозвоне",body:{rows:[{cols:[{view:"radio",value:0,name:r[0],id:r[0],options:[{id:1,value:"Соединение с менеджером"}],disabled:!0,on:{onChange:function(e,t){a(this.config.id)}}},{view:"radio",value:0,name:r[1],id:r[1],options:[{id:2,value:"Вызов номера или группы:"}],on:{onChange:function(e,t){e&&(a(this.config.id),$$(r[1]+"value").enable(),$$(r[2]+"value").disable())}}},{view:"text",name:r[1]+"value",id:r[1]+"value",disabled:!0,on:{onChange:function(e,t){""!=e&&$$(r[2]+"value").setValue("")}}},{view:"radio",value:0,name:r[2],id:r[2],options:[{id:3,value:"Вызов звонковой очереди"}],on:{onChange:function(e,t){e&&(a(this.config.id),$$(r[2]+"value").enable(),$$(r[1]+"value").disable())}}},{view:"text",name:r[2]+"value",id:r[2]+"value",disabled:!0,on:{onChange:function(e,t){""!=e&&$$(r[1]+"value").setValue("")}}}]},{cols:[{view:"radio",value:0,name:r[3],id:r[3],options:[{id:3,value:"Проигрывать записанный файл"}],disabled:!0,on:{onChange:function(e,t){a(this.config.id)}}},{view:"richselect",value:"Recorded file",options:["Recorded file"],disabled:!0},{view:"button",label:"Прослушать",disabled:!0},{view:"button",label:"Записать",disabled:!0}]}]}},{width:150,rows:[{view:"button",label:"Сохранить",click:function(){if(!$$("co-form").validate())return webix.message({type:"error",text:"Заполните обязательные параметры"}),!1;$$("oc-queues").editStop();var e=p();webix.ajax().post("outgoingcampaign/"+e.id+"/save",e).then(function(e){var t=e.json();t.result&&!t.errors.length?(t.message?webix.message({type:"success",text:t.message}):webix.message({type:"success",text:"Операция прошла успешно"}),c()):t.errors.length?(webix.message({type:"error",text:"При сохранении номеров произошла ошибка"}),t.errors.forEach(function(e){var t="";t=e.errorInfo[2]?e.errorInfo[2]:e.errorInfo?e.errorInfo.toString():e.toString(),webix.message({type:"error",text:t})})):webix.message({type:"error",text:"Произошла ошибка выполнения операции"})}).fail(function(e){webix.message({type:"error",text:"Произошла ошибка выполнения операции"})})}},{},{view:"button",label:"Отмена",click:function(){webix.confirm({text:"Не сохраненные изменения будут утеряны. Продолжить?",callback:function(e){if(e)return void c()}})}}]}]}]}],rules:{name:webix.rules.isNotEmpty},on:{onValues:function(){var e=$$("co-form").getValues();if(e[r[e.action-1]]==e.action)return!1;e[r[e.action-1]]=e.action,e[r[e.action-1]+"value"]=e.action_value,console.log(e),$$("co-form").setValues(e),$$("min_call_time")&&!$$("min_call_time").getValue()&&($$("min_call_time").setValue(e.min_call_time),$$("concurrent_calls_limit").setValue(e.concurrent_calls_limit))}}}]}},t.prototype.setFormValues=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(e),this.$$("co-form").setValues(e)},t.prototype.init=function(){this.callsWindow=this.ui(l)},t}(a.b);t.default=c},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=o(17),r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("users",this)}return e.prototype.getView=function(){var e=0,t=[{id:"1",value:"Активный"},{id:"2",value:"Заблокирован"},{id:"3",value:"Удален"},{id:"4",value:"Скрытый"}];return{id:"users",view:"datatable",hidden:!0,resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,tooltip:!0,fixedRowHeight:!1,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50,template:function(e){return e.id}},{id:"name",header:[{text:"Логин"},{content:"serverFilter"}],fillspace:1},{id:"fullname",header:[{text:"Ф.И.О."},{content:"serverFilter"}],fillspace:1},{id:"phone",header:[{text:"Номер"},{content:"serverFilter"}],fillspace:1},{id:"user_groups",header:["Группы",""],fillspace:1},{id:"description",header:[{text:"Описание"},{content:"serverFilter"}],fillspace:1},{id:"state",header:[{text:"Статус"},{content:"serverSelectFilter",options:t}],fillspace:1,options:t}],on:{onItemDblClick:function(){var e=this.$scope.ui(n.ClientsWindow);e&&e.showWindow(this.$scope.$view)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e),this.adjustRowHeight("user_groups")},onAfterSelect:function(){e=this.getSelectedId()}},ready:function(){webix.extend(this,webix.ProgressBar),this.adjustRowHeight("user_groups")}}},e.prototype.loadData=function(){var e=this;$$("users_toolbar").show(),$$("users")&&(this.loaded||(webix.extend($$("users"),webix.ProgressBar),$$("users").load("/users/list","json",function(){$$("users").filterByAll(),e.loaded=1})))},e.prototype.init=function(){this.win2=this.ui(WindowsView)},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=o(20),r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("groups",this)}return e.prototype.getView=function(){var e=0;return{id:"groups",hidden:!0,view:"datatable",resizeColumn:!0,resizeRow:!0,scroll:!0,scrollX:!0,navigation:!0,select:!0,css:"my_style",fixedRowHeight:!1,tooltip:!0,columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"description",header:[{text:"Описание"},{content:"serverFilter"}],fillspace:1},{id:"list_users_str",header:["Список пользователей",""],fillspace:3}],on:{onItemDblClick:function(){var e=this.$scope.ui(n.GroupsWindow);e&&e.showWindow(this.$scope.$view)},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e),this.adjustRowHeight("list_users_str")}},ready:function(){webix.extend(this,webix.ProgressBar),this.adjustRowHeight("list_users_str")}}},e.prototype.loadData=function(){var e=this;$$("groups_toolbar").show(),$$("groups")&&(this.loaded||(webix.extend($$("groups"),webix.ProgressBar),$$("groups").load("/groups/list","json",function(){e.loaded=1})))},e.prototype.init=function(){this.win2=this.ui(WindowsView)},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=o(22),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("contact_groups",this)}return e.prototype.getView=function(){var e=0;return{hidden:!0,id:"contact_groups",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!0,scrollX:!0,navigation:!0,select:!0,css:"my_style",fixedRowHeight:!1,tooltip:!0,columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"queue",header:[{text:"Входяшая очередь"},{content:"serverFilter"}],fillspace:1},{id:"queues",header:[{text:"Входяшии очереди"},{text:""}],fillspace:1,template:function(e){if(!e||!Array.isArray(e.queues))return"";var t="";return e.queues.forEach(function(e){t.length&&(t+=","),t+=e.fullname}),t}},{id:"items",header:[{text:"Члены группы"},{text:""}],fillspace:3,template:function(e){var t="";return e&&"object"===r(e.items)&&Array.isArray(e.items.queues)&&Array.isArray(e.items.users)?(e.items.queues.forEach(function(e){t.length&&(t+=","),t+=e.fullname}),e.items.users.forEach(function(e){t.length&&(t+=","),t+=e.fullname}),t):"error"}}],on:{onAfterSelect:function(){e=this.getSelectedId()},onItemDblClick:function(){this.$scope.ui(n.ContactsGroupsWindow).showWindow(this.$scope.$view)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.loadData=function(){var e=this;$$("contact_groups_toolbar").show(),$$("contact_groups")&&(this.loaded||(webix.extend($$("contact_groups"),webix.ProgressBar),$$("contact_groups").load("/contact_groups/list","json",function(){e.loaded=1})))},e.prototype.init=function(){this.win2=this.ui(n.ContactsGroupsWindow)},e}();t.default=a},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("phones",this)}return e.prototype.getView=function(){var e=0;return{hidden:!0,id:"phones",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollX:!0,scrollY:!0,navigation:!0,select:!0,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"phone",header:[{text:"Номер"},{content:"serverFilter"}],fillspace:1},{id:"model",header:[{text:"Модель"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/models.json"},{id:"mac",header:[{text:"MAC-адрес "},{content:"serverFilter"}],fillspace:1},{id:"user_id",header:[{text:"Пользователь "},{content:"serverFilter"}],fillspace:1,options:"/groups/users/short"},{id:"login",header:[{text:"Логин"},{content:"serverFilter"}],fillspace:1},{id:"rules",header:[{text:"Правила набора номера "},{content:"serverFilter"}],fillspace:1,options:"./assets/options/rules.json"},{id:"default_phone",header:[{text:"Внешний номер по умолчанию"},{content:"serverFilter"}],fillspace:1}],on:{onItemDblClick:function(){var e=this.getSelectedItem();phonesWindow.show(e)},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}}}},e.prototype.loadData=function(){var e=this;$$("phones")&&(webix.extend($$("phones"),webix.ProgressBar),this.loaded||$$("phones").load("/phones/list","json",function(){e.loaded=1})),$$("phones_toolbar").show()},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("queues",this)}return e.prototype.getView=function(){var e=0;return{hidden:!0,id:"queues",view:"datatable",resizeColumn:!0,resizeRow:!0,scroll:!0,navigation:!0,select:!0,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Код"},{content:"serverFilter"}],fillspace:1},{id:"fullname",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"url",header:[{text:"URI"},{content:"serverFilter"}],fillspace:1},{id:"close_on_hangup",header:[{text:"Закрытие страницы после обработки "},{content:"serverFilter"}],fillspace:1},{id:"sl",header:[{text:"SL"},{content:"serverFilter"}],fillspace:1},{id:"viq",header:[{text:"Приоритетная очередь"},{content:"serverRichSelectFilter"}],fillspace:1,options:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]},{id:"service_id",header:[{text:"Сервис"},{content:"serverFilter"}],fillspace:1},{id:"pattern",header:[{text:"Шаблон"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/pattern.json"},{id:"agents",header:["Операторы",""],fillspace:3,template:function(e){return e.agents&&e.agents.names?e.agents.names.join(","):""}},{id:"hidden",header:[{text:"Скрытая"},{content:"serverRichSelectFilter"}],fillspace:1,options:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]}],on:{onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)},onAfterSelect:function(){e=this.getSelectedId()},onItemDblClick:function(){var e=this.getSelectedItem();queuesWindow.show(e)}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.loadData=function(){var e=this;$$("queues_toolbar").show(),$$("queues")&&(this.loaded||$$("queues").load("/queues/list","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("channels",this)}return e.prototype.getView=function(){var e=0;return{hidden:!0,id:"channels",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!1,navigation:!0,select:!0,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Код"},{content:"serverFilter"}],fillspace:1},{id:"fullname",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"provider",header:[{text:"Провайдер"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/providers.json"},{id:"login",header:[{text:"Логин"},{content:"serverFilter"}],fillspace:1},{id:"phone",header:[{text:"Номер телефона"},{content:"serverFilter"}],fillspace:1},{id:"host",header:[{text:"Адрес сервера"},{content:"serverFilter"}],fillspace:1},{id:"port",header:[{text:"Порт"},{content:"serverFilter"}],fillspace:1},{id:"rules",header:[{text:"Правила обработки"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/rules.json"}],on:{onItemDblClick:function(){var e=this.getSelectedItem();window.channels.show(e)},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)},onAfterSelect:function(){e=this.getSelectedId()}},ready:function(){webix.extend(this,webix.ProgressBar)}}},e.prototype.loadData=function(){var e=this;$$("channels_toolbar").show(),$$("channels")&&(webix.extend($$("channels"),webix.ProgressBar),this.loaded||$$("channels").load("/channels/list","json",function(){e.loaded=1}))},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var t,o=$$("scripts_lst").getValue();if(!o)return void webix.message({type:"error",text:"Выберите скрипт"});var i=$$("script_stages").getSelectedId(!1),n=e.id?e.id:0;if(!i)return void webix.message({type:"error",text:"Выберите этап скрипта перед добавление элементов этапа скрипта."});webix.ui((t={id:"add_script_element_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('add_script_element_win').close();"}},t.head={view:"toolbar",margin:-4,cols:[{view:"label",label:n?"Изменение элемента этапа скрипта":"Добавление элемент этапа скрипта"},{view:"icon",icon:"wxi-close-circle",click:"$$('add_script_element_win').close();"}]},t.resize=!0,t.width=700,t.height=500,t.center=!0,t.position="center",t.modal=!0,t.move=!0,t.body={view:"form",id:"stage_elements_form",elements:[{view:"richselect",name:"type",label:"Тип",options:[{id:"button",value:"Кнопка"},{id:"text",value:"Текст"},{id:"webpage",value:"Веб-страница"},{id:"form",value:"Форма"},{id:"transfer",value:"Выбор сотрудника для переадресации"},{id:"sms",value:"Отправить SMS клиенту"},{id:"email",value:"Отправить Email клиенту"}],on:{onChange:function(e){switch($$("label").hide(),$$("action").hide(),$$("text").hide(),$$("url").hide(),$$("form_elements").hide(),$$("form_to").hide(),e){case"button":$$("label").show(),$$("action").show();break;case"text":$$("text").show();break;case"webpage":$$("url").show();break;case"form":$$("form_elements").show(),$$("form_to").show();break;case"sms":case"email":$$("text").show()}}}},{view:"text",name:"label",label:"Лейбл",id:"label",hidden:!0},{view:"nic-editor",config:{},label:"Текст",name:"text",id:"text",hidden:!0},{view:"text",name:"url",label:"URL",id:"url",hidden:!0},{view:"datatable",id:"form_elements",autowidth:!0,editable:!0,hidden:!0,height:200,columns:[{id:"name",header:"Название",width:250,editor:"text"},{id:"type",header:"Тип",width:80,editor:"select",options:[{id:"text",value:"Текст"}]},{id:"placeholder",header:"Подсказка",width:250,editor:"text"}],data:[{}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)},onBeforeContextMenu:function(e){webix.delay(function(){this.select(e)})}},ready:function(){}},{view:"text",id:"form_to",name:"form_to",label:"Email",hidden:!0},{hidden:!0,view:"richselect",name:"action",label:"Действие",id:"action",options:[{id:"jump",value:"Переход к другому скрипту"},{id:"next",value:"Переход к другому блоку"},{id:"transfer",value:"Переадресация вызова"},{id:"email",value:"Отправка Email"},{id:"sms",value:"Отправка SMS"}],on:{onChange:function(e){switch($$("action_script").hide(),$$("action_block").hide(),$$("action_text").hide(),$$("action_transfer").hide(),e){case"jump":$$("action_script").show();break;case"next":$$("action_block").show();break;case"transfer":$$("action_transfer").show();break;case"email":case"sms":$$("action_text").show()}}}},{view:"combo",label:"Скрипт",name:"action_script",id:"action_script",hidden:!0,options:"/legacy/ext/scripts/list"},{view:"combo",label:"Блок",name:"action_block",id:"action_block",hidden:!0,suggest:{body:{view:"tree",url:"/legacy/ext/scripts/liststages/"+o}}},{view:"textarea",label:"Текст",name:"action_text",id:"action_text",height:"400",hidden:!0},{view:"text",label:"Номер",name:"action_transfer",id:"action_transfer",hidden:!0},{cols:[{view:"button",label:"Сохранить",click:function(){var e=$$("stage_elements_form");if(e.validate()){e.disable();var t=e.getValues();t.stage_id=i,n&&(t.id=n),"form"==t.type&&(t.form=JSON.stringify($$("form_elements").serialize())),webix.ajax().post("/legacy/ext/scripts/save/stageelements",t,function(t,o,n){e.enable();var o=o.json();1==o.result?($$("add_script_element_win").close(),$$("script_elements").clearAll(),$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+i)):webix.message({type:"error",text:o.message})})}else webix.message({type:"error",text:"Заполните обязательные поля"})}},{view:"button",label:"Удалить",hidden:!n,click:function(){webix.confirm({title:"Подтверждение удаления",ok:"Удалить",cancel:"Отмена",text:'Вы действительно хотите удалить элемент этапа "'+e.label+'"?',type:"confirm-error",callback:function(e){if(e){var t={id:n,delete:1};webix.ajax().post("/legacy/ext/scripts/save/stageelements",t,function(e,t,o){var t=t.json();1==t.result?($$("add_script_element_win").close(),$$("script_elements").clearAll(),$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+i)):webix.message({type:"error",text:t.message})})}}})}}]}],rules:{type:webix.rules.isNotEmpty,label:webix.rules.isNotEmpty,action:webix.rules.isNotEmpty,url:webix.rules.isNotEmpty,action_script:webix.rules.isNotEmpty,action_block:webix.rules.isNotEmpty,action_text:webix.rules.isNotEmpty,action_transfer:webix.rules.isNotEmpty}},t.on={onShow:function(){$$("stage_elements_form").setValues(e),e.type&&"form"==e.type&&($$("form_elements").clearAll(),$$("form_elements").parse(e.form),0==$$("form_elements").count()&&$$("form_elements").add({}))}},t)).show()}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("scripts",this)}return e.prototype.getView=function(){return{id:"scripts",hidden:!0,type:"clean",rows:[{rows:[{cols:[{view:"organogram",id:"script_stages",borderless:!0,select:!0,scroll:"xy",data:[],on:{onSelectChange:function(){$$("script_elements").clearAll();var e=$$("script_stages").getSelectedId(!1);e&&$$("script_elements").load("/legacy/ext/scripts/list/stageelements/"+e)},onItemDblClick:function(e){$$("script_stages").getItem(e)}}},{view:"resizer"},{rows:[{type:"space",responsive:"e1",margin:0,padding:0,cols:[{view:"label",label:"<strong>Элементы этапа скрипта</strong>"},{view:"button",label:"Добавить",click:function(){n([])}},{view:"button",label:"Изменить",click:function(){var e=$$("script_elements").getSelectedId();if(e){var t=$$("script_elements").getItem(e);t&&n(t)}else webix.message({type:"error",text:"Выберите элемент этапа скрипта для редактирования."})}}]},{id:"script_elements",view:"treetable",resizeColumn:!0,resizeRow:!0,select:!0,columns:[{id:"id",header:[{text:""}],template:"{common.treetable()} #value#",width:50},{id:"type",header:[{text:"Тип"}],width:150},{id:"label",header:[{text:"Содержимое"}],width:200}],on:{onItemDblClick:function(e,t,o){}}}]}]}]}]}},e.prototype.loadData=function(){$$("scripts_toolbar").show()},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("phones_groups",this)}return e.prototype.getView=function(){var e=0;return{hidden:!0,id:"phones_groups",view:"datatable",resizeColumn:!0,resizeRow:!0,scrollY:!1,navigation:!0,select:!0,css:"my_style",columns:[{id:"id",header:[{text:"№"},{content:"serverFilter"}],width:50},{id:"name",header:[{text:"Название"},{content:"serverFilter"}],fillspace:1},{id:"code",header:[{text:"Код"},{content:"serverFilter"}]},{id:"pattern",header:[{text:"Шаблон"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/pattern.json"},{id:"rules",header:[{text:"Правила набора"},{content:"serverFilter"}],fillspace:1,options:"./assets/options/rules.json"},{id:"outgoing_phone",header:[{text:"Исходящий номер"},{content:"serverFilter"}],fillspace:1},{id:"phones_names",header:[{text:"Телефоны в группе"},{content:"serverMultiComboFilter"}],fillspace:1}],on:{onItemDblClick:function(){var e=this.getSelectedItem();phonesGroupsWindow.show(e)},onAfterSelect:function(){e=this.getSelectedId()},onAfterLoad:function(){e&&this.getItem(e)&&this.select(e)}}}},e.prototype.loadData=function(){var e=this;$$("phones_groups")&&(webix.extend($$("phones_groups"),webix.ProgressBar),this.loaded||$$("phones_groups").load("/phones/groups/list","json",function(){e.loaded=1})),$$("phones_groups_toolbar").show()},e}();t.default=n},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n={id:"extended_calls",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,hover:"myhover",multiselect:!0,navigation:!0,css:"my_style",columns:[{id:"calldate",header:[{text:translate("Date"),height:25},{content:"textFilter",height:40}],sort:"string",width:180,template:"#calldate2#",footer:{text:translate("Total:"),colspan:2,height:30}},{id:"fullname",header:[{text:translate("Staffer")},{content:"selectFilter"}],sort:"string",width:160},{id:"src",header:[{text:translate("Source")},{content:"textFilter"}],sort:"string",width:155,footer:{content:"avgColumn"}},{id:"dst",header:[{text:translate("Dialed number")},{content:"textFilter"}],sort:"string",width:155},{id:"status",header:[{text:translate("Status")},{content:"selectFilter"}],sort:"string",width:120,template:"<span class='state #disposition#'>#status#</span>"},{id:"ratesec",header:[{text:translate("Duration")},{content:"textFilter"}],sort:"string",width:140},{id:"channel",header:[{text:translate("Канал 1")},{content:"textFilter"}],sort:"string",width:200},{id:"dstchannel",header:[{text:translate("Канал 2")},{content:"textFilter"}],sort:"string",width:200}],data:[],ready:function(){webix.extend(this,webix.ProgressBar)}},r={id:"extended_calls_trafic",rows:[{view:"toolbar",height:30,elements:[{view:"label",label:"<center>"+translate("Traffic for period")+"</center>"}]},{id:"cdr_report_trafic",view:"datatable",height:75,navigation:!0,resizeColumn:!0,resizeRow:!0,css:"my_style",columns:[{id:"1",header:[{text:translate("Duration"),height:25}],width:180},{id:"2",header:[{text:translate("Calls")}],width:180},{id:"3",header:[{text:"ACD, "+translate("min")}],width:180},{id:"4",header:["ASR, %"],width:180},{id:"5",header:[{text:"PDD, "+translate("sec")}],width:180}],data:[],ready:function(){webix.extend(this,webix.ProgressBar)}}]},a=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("extended_calls",this)}return e.prototype.getView=function(){return{rows:[n,r]}},e.prototype.loadData=function(){var e=this;$$("extended_calls")&&($$("reportDateRange").show(),$$("extended_calls_toolbar").show(),$$("extended_calls_trafic").show(),webix.extend($$("extended_calls"),webix.ProgressBar),this.loaded||$$("extended_calls").load("extended_calls/list","json",function(){e.loaded=1}))},e}();t.default=a},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n={id:"extended_contact_calls",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"calldate",header:[{text:translate("Date"),height:25},{content:"textFilter",height:40}],sort:"string",width:180,template:"#calldate2#",footer:{text:translate("Total:"),height:30}},{id:"queue",header:[{text:translate("Queue")},{content:"selectFilter"}],sort:"string",width:130,footer:{content:"avgColumn"}},{id:"agentname",header:[{text:translate("Agent")},{content:"selectFilter"}],sort:"string",width:160},{id:"agent",header:[{text:translate("Agent name")},{content:"selectFilter"}],sort:"string",width:155},{id:"src",header:[{text:translate("Source")},{content:"textFilter"}],sort:"string",width:155,footer:{text:translate("Average:")}},{id:"holdtime",header:[{text:translate("Waiting time")},{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"talktime",header:[{text:translate("Talktime")},{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"ringtime",header:[{text:translate("Ringtime")},{content:"multiSelectFilter",options:[],suggest:{view:"my_suggest1",fitMaster:!1,width:200}}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"position",header:[{text:translate("Position")},{content:"textFilter"}],sort:"string",width:140},{id:"status",header:[{text:translate("Reason of completing")},{content:"selectFilter"}],sort:"int",width:185,template:"<span class='state #reason#'>#status#</span>"},{id:"channel",header:[{text:translate("Канал")},{content:"textFilter"}],sort:"string",width:200},{id:"uid",header:[{text:translate("UID")},{content:"textFilter"}],sort:"string",width:200}],data:[],ready:function(){webix.extend(this,webix.ProgressBar),this.filterByAll=function(){var e=this.getFilter("calldate").value,t=this.getFilter("queue").value,o=this.getFilter("agentname").value,i=this.getFilter("agent").value,n=this.getFilter("src").value,r=this.getFilter("position").value,a=this.getFilter("status").value,s=this.getFilter("channel").value,l=this.getFilter("uid").value,c=$$("$my_suggest11_from").getValue(),u=$$("$my_suggest11_to").getValue(),d=$$("$my_suggest12_from").getValue(),p=$$("$my_suggest12_to").getValue(),h=$$("$my_suggest13_from").getValue(),f=$$("$my_suggest13_to").getValue();this.filter(function(w){return console.log(w),w.agent||(w.agent=0),!!(-1!=w.calldate.toString().toLowerCase().indexOf(e.toLowerCase())&&-1!=w.queue.toString().toLowerCase().indexOf(t.toLowerCase())&&-1!=w.agentname.toString().toLowerCase().indexOf(o.toLowerCase())&&-1!=w.agent.toString().toLowerCase().indexOf(i.toLowerCase())&&-1!=w.src.toLowerCase().indexOf(n.toLowerCase())&&-1!=w.position.toLowerCase().indexOf(r.toLowerCase())&&-1!=w.status.toLowerCase().indexOf(a.toLowerCase())&&-1!=w.channel.toLowerCase().indexOf(s.toLowerCase())&&-1!=w.uid.toLowerCase().indexOf(l.toLowerCase())&&filterBySeconds(w.holdtime,c,u)&&filterBySeconds(w.talktime,d,p)&&filterBySeconds(w.ringtime,h,f))})}}},r=function(){function e(){i(this,e),this.loaded=0,webix.Manager.setComponent("extended_contact_calls",this)}return e.prototype.getView=function(){return{rows:[n]}},e.prototype.loadData=function(){var e=this;$$("extended_contact_calls")&&($$("reportDateRange").show(),$$("extended_contact_calls_toolbar").show(),webix.extend($$("extended_contact_calls"),webix.ProgressBar),this.loaded||$$("extended_contact_calls").load("/extended_contact_calls/list","json",function(){e.loaded=1}))},e}();t.default=r},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(73),l=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{width:200,collapsed:!1,collapsedWidth:40,view:"sidebar",id:"sidebar",css:"sidebar",layout:"y",scroll:"y",select:!0,data:s.data,on:{onAfterRender:function(){},onAfterSelect:function(e){document.location.hash="!/main/"+e;var t=this.getItem(e);return webix.$$("app:title").parse({title:t.value}),webix.AppConfig.showHideView(e),!1}}}},t.prototype.init=function(e){e.parse(s.data)},t}(a.b);t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"data",function(){return i});var i=[{id:"phone",value:"Телефоны",icon:"fa fa-phone-square"},{id:"cti",value:"Инструкция",icon:"fa fa-cubes",$css:""},{id:"cdr_reports",value:"Звонки",icon:"fa fa-phone-volume",$css:""},{id:"forms",value:"Отчеты",icon:"fa fa-chart-bar",data:[{id:"ext_dashboard",icon:"fa fa-chart-area",value:"Dashboard"},{id:"grouped_reports",icon:"fa fa-sign-in-alt",value:"Входящие"},{id:"grouped_reports_by_agents",icon:"fa fa-users",value:"По агентам"},{id:"grouped_reports_by_queues",icon:"fa fa-users-cog",value:"По очередям"},{id:"lost_calls",icon:"fa fa-microphone-slash",value:"Потерянные"},{id:"analysis_outgoing_calls",icon:"fa fa-sign-out-alt",value:"Исходящие"},{id:"operators_work_report",icon:"fa fa-address-card",value:"Сотрудники"},{id:"checklist",icon:"fa fa-tasks",value:"Чеклисты"}]},{id:"calendar",value:"Анализ трафика",icon:"fa fa-sliders-h",data:[{id:"interval_reports",icon:"fa fa-sign-in-alt",value:"Входящие"},{id:"daily_report",icon:"fa fa-calendar-week",value:"По дням"},{id:"month_traffic",icon:"fa fa-calendar-alt",value:"По месяцам"},{id:"hourly_load",icon:"fa fa-clock",value:"По часам"},{id:"compare_calls",icon:"fa fa-copy",value:"Сравнить"}]},{id:"statistics",value:"Статистика",icon:"fa fa-chart-bar",data:[{id:"ext_incoming_external",icon:"fa fa-external-link-alt",value:"Внешние"},{id:"ext_incoming_internal",icon:"fa fa-external-link-square-alt",value:"Внутренние"},{id:"ext_outgoing",icon:"fa fa-sign-out-alt",value:"Исходящие"}]},{id:"extended",value:"Расширенные",icon:"fa fa-th-large",data:[{id:"extended_calls",icon:"fa fa-external-link-alt",value:"Звонки"},{id:"extended_contact_calls",icon:"fa fa-external-link-square-alt",value:"Входящие"}]},{id:"nps",value:"NPS",icon:"fa fa-comments",data:[{id:"dashboard",icon:"fa fa-chart-area",value:"Dashboard Jet"},{id:"reports",icon:"fa fa-chart-bar",value:"Отчеты"},{id:"clients",icon:"fa fa-users",value:"Клиенты"}]},{id:"outgoingcampaign",value:"Кампании",icon:"fa fa-phone-square",$css:""},{id:"control",value:"Управление",icon:"fa fa-tools",data:[{id:"users",icon:"fa fa-user-friends",value:"Пользователи"},{id:"groups",icon:"fa fa-users",value:"Группы"},{id:"contact_groups",icon:"fa fa-users-cog",value:"Контактные группы"},{id:"phones",icon:"fa fa-phone",value:"Телефоны"},{id:"phones_groups",icon:"fa fa-phone",value:"Группы телефонов"},{id:"queues",icon:"fa fa-list-ol",value:"Очереди"},{id:"channels",icon:"fa fa-project-diagram",value:"Каналы"},{id:"scripts",icon:"fa fa-sort-amount-down",value:"Скрипты"}]}]},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e="",t="";return{id:"extended_contact_calls_toolbar",hidden:!0,margin:0,padding:0,cols:[{responsive:"extended_contact_calls_toolbar",margin:0,padding:0,cols:[{cols:[{width:27},{id:"option_contact_cdr_report",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:translate("Add options"),badge:0,click:function(){var o={view:"form",borderless:!0,elements:[{id:"src_change_contact_cdr_report",view:"text",type:"search",label:translate("Source"),value:t},{id:"filter_contact_cdr_report",view:"richselect",label:translate("Type of calls"),labelWidth:100,width:333,value:e,options:[{id:1,value:translate("Incoming - all")},{id:2,value:translate("Incoming - served")},{id:3,value:translate("Incoming - unserved")},{id:4,value:translate("Outgoing")}]},{cols:[{view:"button",value:translate("Add"),click:function(){var o=0;""!=$$("filter_contact_cdr_report").getValue()&&o++,e=$$("filter_contact_cdr_report").getValue(),""!=$$("src_change_contact_cdr_report").getValue()&&o++,t=$$("src_change_contact_cdr_report").getValue(),o>0?($$("option_contact_cdr_report").define("badge",o),$$("option_contact_cdr_report").define("label",translate("Options")),$$("option_contact_cdr_report").define("icon","check"),$$("option_contact_cdr_report").refresh()):($$("option_contact_cdr_report").define("badge",o),$$("option_contact_cdr_report").define("label",translate("Add options")),$$("option_contact_cdr_report").define("icon","plus"),$$("option_contact_cdr_report").refresh()),$$("filter_contact_cdr_report").getTopParentView().hide()}},{view:"button",value:translate("Cancel"),click:function(){$$("filter_contact_cdr_report").getTopParentView().hide()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_contact_cdr_report",width:300,position:"center",modal:!0,head:translate("Additional options"),body:webix.copy(o)}),function(e,t){if($$("win_option_contact_cdr_report"))return void $$("win_option_contact_cdr_report").show();$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_contact_cdr_report")}},{id:"search_contact_cdr_report",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:translate("Show report"),click:function(){$$("extended_contact_calls").enable(),$$("extended_contact_calls").getFilter("calldate").value="",$$("extended_contact_calls").getFilter("queue").value="",$$("extended_contact_calls").getFilter("agentname").value="",$$("extended_contact_calls").getFilter("agent").value="",$$("extended_contact_calls").getFilter("src").value="",$$("extended_contact_calls").getFilter("holdtime").value="",$$("extended_contact_calls").getFilter("talktime").value="",$$("extended_contact_calls").getFilter("position").value="",$$("extended_contact_calls").getFilter("status").value="";var o=webix.guiutils.getDateRange("reportDateRange"),i=o.end,n=o.start,r="/extended_contact_calls/list?filter[t1]="+n+"&filter[t2]="+i;""!=t&&(r+="&filter[src]="+t),""!=e&&(r+="&filter[filter]="+e),$$("extended_contact_calls").clearAll(),$$("extended_contact_calls").load(r,"json",function(){$$("extended_contact_calls").showProgress({type:"icon",hide:!0})})}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:translate("Export to Excel"),click:function(){var e=webix.guiutils.getDateRange("reportDateRange");webix.toExcel($$("extended_contact_calls"),{filterHTML:!0,filename:"Расширенные входящие с "+e.end+" по "+e.start})}},{}]},{}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t,o){i(this,e),this.components=[]}return e.prototype.setComponent=function(e,t){this.components[e]=t},e.prototype.getComponents=function(){return this.components},e.prototype.getComponent=function(e){return this.components[e]},e}();t.default=n},function(e,t,o){"use strict";o.d(t,"a",function(){return i});var i=function(){function e(){this.webixJet=!0,this._id=webix.uid(),this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id);for(var o in this._subs){var i=this._subs[o].view;i&&i.destructor()}this._events=this._container=this.app=this._parent=null},e.prototype.setParam=function(e,t,o){this._data[e]!==t&&(this._data[e]=t,this.app.callEvent("app:paramchange",[this,e,t,o])&&o&&this.show((i={},i[e]=t,i)));var i},e.prototype.getParam=function(e,t){var o=this._data[e];if(void 0!==o||!t)return o;var i=this.getParentView();return i?i.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._url},e.prototype.render=function(e,t,o){var i=this;this._parent=o,t&&(this._index=t[0].index),this._init_url_data(t),e=e||document.body;var n="string"==typeof e?webix.toNode(e):e;return this._container!==n?(this._container=n,this._render(t).then(function(){return i.getRoot()})):this._urlChange(t).then(function(){return i.getRoot()})},e.prototype.getIndex=function(){return this._index},e.prototype.getId=function(){return this._id},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView(function(o){return(o.config.id===e||o.config.localId===e)&&o.$scope===t.$scope},"self")}return e},e.prototype.on=function(e,t,o){var i=e.attachEvent(t,o);return this._events.push({obj:e,id:i}),i},e.prototype.contains=function(e){for(var t in this._subs){var o=this._subs[t].view;if(o===e||o.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:this._parent?this._parent.getSubViewInfo(e):null},e.prototype.getName=function(){return this._name},e.prototype._init_url_data=function(e){e&&e[0]&&(this._data={},webix.extend(this._data,e[0].params,!0)),this._url=e},e}()},function(e,t,o){"use strict";function i(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),o=[],i=0;i<t.length;i++){var n=t[i],r={},a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a)for(var s=n.substr(a+1).split(/[\:\?\&]/g),l=0,c=s;l<c.length;l++){var u=c[l],d=u.split("=");r[d[0]]=decodeURIComponent(d[1])}o[i]={page:a>-1?n.substr(0,a):n,params:r,index:i+1}}return o}function n(e){for(var t=[],o=0,i=e;o<i.length;o++){var n=i[o];t.push("/"+n.page);var a=r(n.params);a&&t.push("?"+a)}return t.join("")}function r(e){var t=[];for(var o in e)t.length&&t.push("&"),t.push(o+"="+encodeURIComponent(e[o]));return t.join("")}t.a=i,t.b=n},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var i=o(105),n=o.n(i),r=function(){function e(e,t){var o=this;this.config=t||{},this._prefix=this.config.routerPrefix,void 0===this._prefix&&(this._prefix="!");var i=function(e){};n()(this._prefix+"*",function(){return o._lastUrl="",i(o.get())}),i=e}return e.prototype.set=function(e,t){if(this.config.routes){var o=e.split("?",2);for(var i in this.config.routes)if(this.config.routes[i]===o[0]){e=i+(o.length>1?"?"+o[1]:"");break}}this._lastUrl=e,n.a.navigate(this._prefix+e,t)},e.prototype.get=function(){var e=this._lastUrl||(window.location.hash||"").replace("#"+this._prefix,"");if(this.config.routes){var t=e.split("?",2),o=this.config.routes[t[0]];o&&(e=o+(t.length>1?"?"+t[1]:""))}return e},e}()},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(2),l=o(3),c=o(4),u=o(5),d=o(6),p=o(7),h=o(8),f=o(9),w=o(10),g=o(11),b=o(12),_=o(13),m=o(14),v=o(16),x=o(19),$=o(21),y=o(23),k=o(24),C=o(25),j=o(26),P=o(27),S=o(28),F=o(29),O=o(30),V=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{css:"top-menu",cols:[{view:"button",type:"icon",icon:"fa fa-bars",width:40,align:"left",css:"app_button menu-burger-button",click:function(){$$("sidebar").toggle(),$$("sidebar").getState().collapsed?$$("logobox").hide():$$("logobox").show()}},{type:"header",borderless:!0,height:50,width:162,id:"logobox",template:"<img src='./assets/imgs/logo.png' valign='middle' class='logo' style=\"margin-left: -18px;\"><font class='logo_text' style=\"vertical-align: middle; font-weight: bold;\" > PBX</font>"},{view:"template",id:"app:title",template:"#title#",css:"pbx-title",autowidth:!0},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",id:"phoneExcelButton",hidden:!1,click:function(){webix.toExcel($$("phone"),{filterHTML:!0,filename:"Телефоны"})}},{view:"daterangepicker",id:"reportDateRange",width:380,hidden:!0,label:"Период",timepicker:!0,format:"%d.%m.%Y %H:%i",value:{start:webix.Date.add(new Date,-1,"month"),end:new Date},on:{onChange:function(e){e.start&&($$("startDate_hourly_load")&&$$("startDate_hourly_load").setValue(e.start),$$("startDate_compare_calls")&&$$("startDate_compare_calls").setValue(e.start),$$("date_ext_dash")&&$$("date_ext_dash").setValue({start:e.start,end:e.end}),$$("cdr_reports")&&$$("cdr_reports").getFilter("time")&&($$("cdr_reports").getFilter("time").config.value=e))}}},{id:"grouped_reports_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"option_grouped_reports",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"queue_grouped_reports",view:"richselect",label:"Очередь",labelWidth:100,width:333,value:webix.guiutils.queue_grouped_reports,options:"/legacy/grouped_queues_name/short"},{id:"filter_grouped_reports",view:"richselect",label:"Тип звонков",labelWidth:100,width:333,value:webix.guiutils.filter_grouped_reports,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("filter_grouped_reports").getValue()&&e++,webix.guiutils.filter_grouped_reports=$$("filter_grouped_reports").getValue(),""!=$$("queue_grouped_reports").getValue()&&e++,webix.guiutils.queue_grouped_reports=$$("queue_grouped_reports").getValue(),e>0?($$("option_grouped_reports").define("badge",e),$$("option_grouped_reports").define("label","Опции"),$$("option_grouped_reports").define("icon","check"),$$("option_grouped_reports").refresh()):($$("option_grouped_reports").define("badge",e),$$("option_grouped_reports").define("label","Доп.опции"),$$("option_grouped_reports").define("icon","wxi-plus"),$$("option_grouped_reports").refresh()),$$("filter_grouped_reports").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("filter_grouped_reports").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_grouped_reports",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_grouped_reports")}},{id:"search_grouped_reports",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_grouped_reports_refresh()}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",disabled:!0,id:"grouped_reports_export"},{}]},{}]},{id:"lost_calls_toolbar",hidden:!0,cols:[{id:"search_lost_calls",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_lost_calls_refresh()}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("lost_calls_list"),{filterHTML:!0,filename:"Lost"})}},{}]},{id:"analysis_outgoing_calls_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"search_analysis_outgoing_calls",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.billing_analysis_outgoing_calls_refresh()}},{width:155}]},{}]},{id:"operators_work_report_toolbar",hidden:!0,cols:[{id:"search_operators_work_report",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_operators_work_report_refresh()}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("operators_work_report"),{filterHTML:!0,filename:"Operators"})}},{}]},s.default,l.default,c.default,u.default,d.default,p.default,h.default,f.default,w.default,g.default,b.default,_.default,m.default,v.default,x.default,$.default,y.default,k.default,C.default,j.default,P.default,S.default,F.default,O.default,{},{height:50,id:"person_template",css:"header_person",borderless:!0,width:200,template:function(e){var t="<div style='height:80%;width:80%;margin-top:0;float: right;' onclick='webix.$$(\"profilePopup\").show(this)'>";return t+="<img class='photo' src='./assets/imgs/photos/4.png' width='30' /><span class='name'>"+webix.auth.getFullname()+"</span>"}}]}},t}(a.b);t.default=V},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=o(33),l=o(72),c=o(2),u=o(3),d=o(4),p=o(5),h=o(6),f=o(7),w=o(8),g=o(9),b=o(10),_=o(11),m=o(12),v=o(13),x=o(14),$=o(16),y=o(19),k=o(21),C=o(23),j=o(24),P=o(25),S=o(26),F=o(27),O=o(28),V=o(29),T=o(30),E=o(74),D=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"menuBar",rows:[{css:"top-menu",cols:[{view:"button",type:"icon",icon:"fa fa-bars",width:40,align:"left",css:"app_button menu-burger-button",click:function(){$$("sidebar").toggle(),$$("sidebar").getState().collapsed?$$("logobox").hide():$$("logobox").show()}},{type:"header",borderless:!0,height:50,width:162,id:"logobox",template:"<img src='./assets/imgs/logo.png' valign='middle' class='logo' style=\"margin-left: -18px;\"><font class='logo_text' style=\"vertical-align: middle; font-weight: bold;\" > PBX</font>"},{view:"template",id:"app:title",template:"#title#",css:"pbx-title",autowidth:!0,maxWidth:250},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",id:"phoneExcelButton",hidden:!1,click:function(){webix.toExcel($$("phone"),{filterHTML:!0,filename:"Телефоны"})}},{view:"daterangepicker",id:"reportDateRange",width:380,hidden:!0,label:"Период",timepicker:!0,format:"%d.%m.%Y %H:%i",value:{start:webix.Date.add(new Date,-1,"month"),end:new Date},on:{onChange:function(e){e.start&&($$("startDate_hourly_load")&&$$("startDate_hourly_load").setValue(e.start),$$("startDate_compare_calls")&&$$("startDate_compare_calls").setValue(e.start),$$("date_ext_dash")&&$$("date_ext_dash").setValue({start:e.start,end:e.end}),$$("cdr_reports")&&$$("cdr_reports").getFilter("time")&&($$("cdr_reports").getFilter("time").config.value=e))}}},{id:"cdr_toolbar",hidden:!0,cols:[{id:"cdr_refresh_button",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Обновить",click:function(){$$("cdr_reports").filterByAll()}},{}]},{id:"grouped_reports_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"option_grouped_reports",view:"button",type:"iconButton",icon:"wxi-plus",width:120,label:"Доп.опции",badge:0,click:function(){var e={view:"form",borderless:!0,elements:[{id:"queue_grouped_reports",view:"richselect",label:"Очередь",labelWidth:100,width:333,value:webix.guiutils.queue_grouped_reports,options:"/legacy/grouped_queues_name/short"},{id:"filter_grouped_reports",view:"richselect",label:"Тип звонков",labelWidth:100,width:333,value:webix.guiutils.filter_grouped_reports,options:[{id:1,value:"Входящие - все"},{id:2,value:"Входящие - обслуженные"},{id:3,value:"Входящие - необслуженные"},{id:4,value:"Исходящие"}]},{cols:[{view:"button",value:"Добавить",click:function(){var e=0;""!=$$("filter_grouped_reports").getValue()&&e++,webix.guiutils.filter_grouped_reports=$$("filter_grouped_reports").getValue(),""!=$$("queue_grouped_reports").getValue()&&e++,webix.guiutils.queue_grouped_reports=$$("queue_grouped_reports").getValue(),e>0?($$("option_grouped_reports").define("badge",e),$$("option_grouped_reports").define("label","Опции"),$$("option_grouped_reports").define("icon","check"),$$("option_grouped_reports").refresh()):($$("option_grouped_reports").define("badge",e),$$("option_grouped_reports").define("label","Доп.опции"),$$("option_grouped_reports").define("icon","wxi-plus"),$$("option_grouped_reports").refresh()),$$("filter_grouped_reports").getTopParentView().close()}},{view:"button",value:"Отмена",click:function(){$$("filter_grouped_reports").getTopParentView().close()}}]}],rules:{},elementsConfig:{labelPosition:"top"}};webix.ui({view:"window",id:"win_option_grouped_reports",width:300,position:"center",modal:!0,head:"Дополнительные опции",body:webix.copy(e)}),function(e,t){$$(e).getBody().clear(),$$(e).show(t),$$(e).getBody().focus()}("win_option_grouped_reports")}},{id:"search_grouped_reports",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_grouped_reports_refresh()}},{}]},{cols:[{width:27},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",disabled:!0,id:"grouped_reports_export"},{}]},{}]},{id:"lost_calls_toolbar",hidden:!0,cols:[{id:"search_lost_calls",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_lost_calls_refresh()}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("lost_calls_list"),{filterHTML:!0,filename:"Lost"})}},{}]},{id:"analysis_outgoing_calls_toolbar",hidden:!0,cols:[{cols:[{width:27},{id:"search_analysis_outgoing_calls",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.billing_analysis_outgoing_calls_refresh()}},{width:155}]},{}]},{id:"operators_work_report_toolbar",hidden:!0,cols:[{id:"search_operators_work_report",view:"button",type:"iconButton",icon:"wxi-search",width:155,label:"Показать отчет",click:function(){webix.guiutils.contact_operators_work_report_refresh()}},{view:"button",type:"iconButton",icon:"fa fa-file-excel",width:150,label:"Экспорт в Excel",click:function(){webix.toExcel($$("operators_work_report"),{filterHTML:!0,filename:"Operators"})}},{}]},c.default,u.default,d.default,p.default,h.default,f.default,w.default,g.default,b.default,_.default,m.default,v.default,x.default,$.default,y.default,k.default,C.default,j.default,P.default,S.default,F.default,O.default,V.default,T.default,E.default,{},{height:50,id:"person_template",css:"header_person",borderless:!0,width:200,template:function(e){var t="<div style='height:80%;width:80%;margin-top:0;float: right;' onclick='webix.$$(\"profilePopup\").show(this)'>";return t+="<img class='photo' src='./assets/imgs/photos/4.png' width='30' /><span class='name'>"+webix.auth.getFullname()+"</span>"}}]},{cols:[{id:"menuCol",rows:[l.default]},{id:"bodyCol",rows:[s.default]}]}]}},t}(a.b);t.default=D},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){var e=this;return{view:"popup",id:"langSelector",width:300,padding:0,css:"submenu_language",body:{type:"clean",borderless:!0,rows:[{view:"list",autoheight:!0,data:[{id:"en",value:"English"},{id:"ru",value:"Russian"}],type:{height:45,template:" <img class='flag' src='assets/imgs/photos/#id#.png' /><span class='text'>#value#</span>"},select:!0,on:{onSelectChange:function(){return e.toggleLanguage()}}}]},on:{onShow:function(){var e=this.$scope.app.getService("locale");this.queryView({view:"list"}).select(e.getLang())}}}},t.prototype.showWindow=function(){this.getRoot().show()},t.prototype.toggleLanguage=function(){var e=this.app.getService("locale"),t=this.getRoot().queryView({view:"list"}).getSelectedId();t!=e.getLang()&&(e.setLang(t),location.reload())},t}(a.b);t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(o(83),{view:"submenu",id:"profilePopup",width:150,padding:0,submenuConfig:{padding:0},data:[{id:1,icon:"language",value:"Язык",submenu:[{id:"EN",value:"Английский"},{$template:"Separator"},{id:"RU",value:"Русский"}]},{$template:"Separator"},{id:"logout",icon:"sign-out",value:"Выйти"}],on:{onMenuItemClick:function(e){"logout"==e&&webix.auth.logout()}},type:{template:function(e){return e.type?"<div class='separator'></div>":"<span class='webix_icon alerts fa-"+e.icon+"'></span><span>"+e.value+"</span>"}}});t.default=i},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}o.d(t,"a",function(){return n});var n=function(){function e(){i(this,e),this.token=0,this.name="unauth",this.fullname="Не авторизован",this.tokenFromGet=webix.guiutils.getUrlParameter("token")}return e.prototype.authUser=function(e){var t=this;webix.ui({view:"window",id:"loginWindow",width:400,position:"center",modal:!0,move:!0,head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Авторизация"},{view:"icon",icon:"wxi-close-circle",click:function(){$$("loginWindow").close()}}]},body:{id:"loginForm",view:"form",borderless:!0,elements:[{view:"text",label:"Логин",value:"",name:"login",invalidMessage:"Укажите логин",id:"auth_login"},{view:"text",type:"password",label:"Пароль",name:"password",invalidMessage:"Укажите пароль",id:"auth_password"},{view:"button",value:"Войти",hotkey:"enter",id:"auth_enter",click:function(){var o=$$("loginForm");o.disable();var i=o.getValues();webix.ajax().post("/auth/login",i,{error:function(e,t,o){webix.message({type:"error",text:e})},success:function(i,n,r){var a=n.json();if(o.enable(),!a||void 0===a.error)return void webix.message({type:"error",text:"Unknow error: "+i});0==a.error?($$("loginWindow")&&$$("loginWindow").close(),t.token=a.token,webix.storage.cookie.put("token",a.token),t.check(e)):webix.message({type:"error",text:"Ошибка авторизации: "+a.message})}})}}]},on:{onShow:function(){}}}).show()},e.prototype.check=function(e){var t=this;if(!this.token&&!webix.storage.cookie.get("token")&&!t.tokenFromGet)return this.authUser(e);webix.ajax().get("/auth/info",{token:t.tokenFromGet},{error:function(e,t,o){webix.message({type:"error",text:e})},success:function(o,i,n){var r=i.json();if(!r||void 0===r.error)return void webix.message({type:"error",text:"Unknow error: "+o});r.error?t.authUser(e):(t.tokenFromGet&&webix.storage.cookie.put("token",t.tokenFromGet),t.name=r.name,t.fullname=r.fullname,e&&e())}})},e.prototype.logout=function(e){var t=this;webix.ajax().get("/auth/logout",{error:function(e,t,o){webix.message({type:"error",text:e})},success:function(e,o,i){var n=o.json();if(!n||void 0===n.error)return void webix.message({type:"error",text:"Unknow error: "+e});n.error?webix.message({type:"error",text:"Ошибка: "+n.message}):(t.token=0,webix.storage.cookie.put("token",""),document.location.reload())}})},e.prototype.getFullname=function(){return this.fullname},e}()},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"analysis_outgoing_calls_layout_1",view:"scrollview",batch:1,scroll:"y",body:{height:1120,rows:[{cols:[grouped_reports,{view:"resizer"},grouped_reports7]},{view:"resizer"},{cols:[grouped_reports6,{view:"resizer"},grouped_reports2]},{view:"resizer"},{cols:[grouped_reports5,{view:"resizer"},grouped_reports3]},{view:"resizer"},{cols:[grouped_reports4]}]}}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{id:"call_recording_layout",rows:[{rows:[{id:"call_recording",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",footer:!0,navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Общее количество:",height:30}},{id:"call",header:[{text:"Звонки"},{content:"selectFilter"}],sort:"string",width:120},{id:"user",header:[{text:"Сотрудник"},{content:"serverFilter"}],sort:"string",width:230},{id:"src",header:[{text:"Источник"},{content:"serverFilter"}],sort:"string",width:155,footer:{text:"Общая продолжительность:",colspan:2,height:30}},{id:"dst",header:[{text:"Направление"},{content:"serverFilter"}],sort:"string",width:140},{id:"duration",header:[{text:"Длительность"},{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}},{id:"size",header:[{text:"Размер, кбайт"},{content:"textFilter"}],sort:"int",width:140,footer:{content:"avgColumn"}}],disabled:!1,url:"/legacy/call_recording",ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{height:100,cols:[{id:"myplayer_call_recording",view:"datatable",scroll:!1,width:500,columns:[{id:"download",header:"",width:40,template:"<center><a target='_blank' href='#link'>#download#</center>",tooltip:"Скачать"},{id:"card",header:[{text:"Прослушать запись",height:30}],width:320}],data:[{download:"",name:"",card:""}]},{view:"checkbox",labelRight:"Автовоспроизведение",labelWidth:"auto",value:webix.storage.cookie.get("autoplay")?webix.storage.cookie.get("autoplay"):0,click:function(){var e=this.getValue();webix.storage.cookie.put("autoplay",e)}}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{rows:[{id:"contact_cdr_report",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,footer:!0,navigation:!0,hover:"myhover",multiselect:!0,css:"my_style",tooltip:!0,columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Всего:",height:30}},{id:"queue",header:[{text:"Очередь"},{content:"selectFilter"}],sort:"string",width:130,footer:{content:"avgColumn"}},{id:"agentname",header:[{text:"Агент"},{content:"selectFilter"}],sort:"string",width:160},{id:"agent",header:[{text:"Имя агента"},{content:"selectFilter"}],sort:"string",width:155},{id:"src",header:[{text:"Источник"},{content:"serverFilter"}],sort:"string",width:155,footer:{text:"Среднее:"}},{id:"holdtime",header:[{text:"Время ожидания"},{content:"textFilter"}],sort:"string",width:155,footer:{content:"avaregeTimeColumn"}},{id:"talktime",header:[{text:"Время разговора"},{content:"textFilter"}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"ringtime",header:[{text:"Время ответа"},{content:"textFilter"}],sort:"string",width:150,footer:{content:"avaregeTimeColumn"}},{id:"position",header:[{text:"Позиция"},{content:"textFilter"}],sort:"string",width:140},{id:"reason",header:[{text:"Причина завершения"},{content:"selectFilter"}],sort:"int",width:185},{id:"channel",header:[{text:"Канал"},{content:"textFilter"}],sort:"string",width:200},{id:"uid",header:[{text:"UID"},{content:"textFilter"}],sort:"string",width:200}],disabled:!1,url:"/legacy/contact_cdr_report",ready:function(){webix.extend(this,webix.ProgressBar)}}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"PBXPhonesWindow",function(){return s});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.getFormValues=function(){var e=$$("form-phone");return e.validate()?e.getValues():(webix.message({type:"error",text:"Заполните обязательные поля"}),!1)},t.prototype.saveFormValues=function(e,t){parseInt(e.id)||(e.id=0),webix.ajax().post("/phones/"+e.id+"/save",e).then(function(e){$$("form-phone").enable(),e=e.json(),e.result?(webix.message({type:"success",text:e.message}),$$("form-phone").enable(),t&&t()):(webix.message({type:"error",text:e.message}),$$("form-phone").enable())})},t.prototype.loadTable=function(){$$("phones").load("/phones/list")},t.prototype.closeWindow=function(){webix.confirm({text:"Все несохраненные данные будут утеряны. <br> Продолжить?",callback:function(e){e&&webix.$$("window-phone").close()}})},t.prototype.hide=function(){$$("window-phone").close()},t.prototype.getThis=function(){return this},t.prototype.show=function(e){var t=this.getThis(),o={view:"form",id:"form-phone",scroll:!0,elements:[{view:"text",label:"id",name:"id",value:0,hidden:!0},{view:"text",label:"Номер телефона",name:"phone",required:!0},{view:"combo",label:"Модель",id:"phone_model",name:"model",options:"./assets/options/models.json"},{view:"text",label:"MAC-адрес",name:"mac"},{view:"combo",label:"Пользователь",name:"user_id",options:"/groups/users/short"},{view:"text",label:"Логин",name:"login",required:!0},{view:"text",label:"Пароль",name:"password",type:"password"},{view:"combo",label:"Правила набора",name:"rules",suggest:"./assets/options/rules.json",filter:function(e,t){return-1!==e.value.indexOf(t)}},{view:"text",label:"Внешний номер по умолчанию",name:"default_phone"},{view:"combo",label:"Группа",name:"group_id",options:{body:{url:"/phones/groups/list/short",template:"#name#"}}},{cols:[{},{view:"button",label:e.id?"Сохранить":"Добавить",click:function(){var e=t.getFormValues();e&&t.saveFormValues(e,function(){t.hide(),t.loadTable()})}},{view:"button",label:e.id?"Отменить":"Закрыть",click:function(){t.closeWindow()}},{}]},{height:10}],elementsConfig:{inputAlign:"left",labelPosition:"top"},rules:{password:function(t){return!!e.id||t.length>0},user_id:function(e){return"erpico"!=$$("phone_model").getValue()||e.length}}},i={id:"window-phone",view:"window",position:"center",move:!0,modal:!0,resize:!1,scroll:!0,height:700,width:600,head:{view:"toolbar",paddingY:1,height:40,cols:[{view:"label",label:(e.id?"Изменить ":"Добавить")+"  телефон",align:"left"},{view:"icon",icon:"wxi-close-circle",click:function(){t.closeWindow()}}]},body:o};webix.ui(i).show(),$$("form-phone").setValues(e)},t}(a.b)},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),s=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{type:"clean",rows:[{id:"record_contact_center_layout",rows:[{rows:[{id:"record_contact_center",view:"datatable",resizeColumn:!0,resizeRow:!0,select:!0,hover:"myhover",footer:!0,navigation:!0,tooltip:!0,multiselect:!0,css:"my_style",columns:[{id:"calldate",header:[{text:"Дата",height:25},{content:"serverDateRangeFilter"}],sort:"string",width:220,footer:{text:"Общее количество:",height:30}},{id:"queue",header:[{text:"Очередь"},{content:"selectFilter"}],sort:"string",width:140,footer:{content:"avgColumn"}},{id:"src",header:[{text:"Источник"},{content:"serverFilter"}],sort:"string",width:155,footer:{text:"Общая продолжительность:",colspan:2,height:30}},{id:"dst",header:[{text:"Агент"},{content:"serverFilter"}],sort:"string",width:140},{id:"duration",header:[{text:"Длительность"},{content:"textFilter"}],sort:"string",width:130,footer:{content:"summTimeColumn"}}],disabled:!1,url:"legacy/record_contact_center",ready:function(){webix.extend(this,webix.ProgressBar)}},{view:"resizer"},{height:100,cols:[{id:"myplayer_record_contact_center",view:"datatable",scroll:!1,width:500,columns:[{id:"download",header:"",width:40,template:"<center><a target='_blank' href='#link'>#download#</center>",tooltip:"Скачать"},{id:"card",header:[{text:"Прослушать запись",height:30}],width:320}],data:[{download:"",name:"",card:""}]},{view:"checkbox",labelRight:"Автовоспроизведение",labelWidth:"auto",value:webix.storage.cookie.get("autoplay2")?webix.storage.cookie.get("autoplay2"):0,click:function(){var e=this.getValue();webix.storage.cookie.put("autoplay2",e)}}]}]}]}]}},t.prototype.urlChange=function(){},t}(a.b);t.default=s},function(e,t){webix.Date.add(new Date,-7,"day"),webix.Date.add(new Date,1,"day"),npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip,npsTooltip},function(e,t){},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,o){$$("phone")&&($$("phone").setValue(e),$$("fio").setValue(t),$$("org").setValue(o),webix.ajax().get("bigam_getinfo.php",{cid:e},function(e,t){t=t.json(),$$("fio").setValue(t.fio),$$("org").setValue(t.org)}))}function s(e){for(e||(e=this),e.hide();e&&(!e.config.epbx_line||1!=e.config.epbx_line);)e=e.getParentView();var t=e.getParentView().getChildViews(),o=e.getParentView().index(e),i=e.getParentView().index(e)+1,n=t[o].getChildViews()[0],r=n.config;if(e.getChildViews()[1].hide(),"form"==r.type&&r.epbx_action&&"sendEmail"==r.epbx_action){if(!n.validate())return webix.message({type:"error",text:"Заполните обязательные поля."}),void e.getChildViews()[2].show();var a=n.getValues();a.epbx_rcpt=r.epbx_rcpt,a.epbx_subject=r.epbx_subject;var s=JSON.stringify(a);webix.message({type:"debug",text:"Отправляем письмо... Ожидайте."}),webix.ajax().post("/queues/send_mail.php",s,{error:function(t,o,i){e.getChildViews()[2].show()},success:function(o,n,r){0==n.json().result?t[i].show(!0,!0):(e.getChildViews()[2].show(),webix.message({type:"error",text:"Произошла ошибка при отправке письма."}))}})}else t[i].show(!0,!0)}function l(e){for(e||(e=this);e&&(!e.config.epbx_line||1!=e.config.epbx_line);)e=e.getParentView();var t=e.getParentView().getChildViews();e.hide();var o=e.getParentView().index(e)-1;0!=o&&t[o].getChildViews()[t[o].getChildViews().length-2].show(!0,!0),t[o].getChildViews()[t[o].getChildViews().length-1].show(!0,!0)}function c(e){var t=[],o=0;return e.forEach(function(i){o++,"object"!==(void 0===i?"undefined":f(i))&&(i={type:"template",css:"green-block",template:i,height:50}),t.push({epbx_line:1,hidden:1!=o,cols:[i,{view:"button",value:"Назад",hidden:1==o,click:function(){l(this)},width:100},{view:"button",value:"Дальше",hidden:o==e.length,click:function(){s(this)},width:100}]})}),t}function u(e,t){this&&this.data&&this.data.id&&0==e&&(e=this.data.id);var o=$$("mainView"),i="script_"+e;if($$(i))return $$(i).show({type:"flip",subtype:"horizontal"}),void o.showView(i);var n=$$("mainBody");n.disable(),webix.ajax().get("/legacy/scripts",{id:_,sid:e,nps_id:parseInt(b("nps"))||0},function(t,r,a){var s=r.json(),l=s.elements;window.actionsInfo=l,window.actionsId=e;var p;if(1==parseInt(s.autobuttons)){for(var h=[],f=0;f<s.substages.length;f++){var w={view:"button",label:s.substages[f].name,epbx_action:"next",epbx_action_block:s.substages[f].id,click:d,level:n.getChildViews().length,script_id:e};s.substages[f].used&&(p=w,u(w.epbx_action_block,w)),h.push(w)}l.push({cols:h})}else for(var b in l)l[b].used&&(p=l[b],u(l[b].epbx_action_block,l[b]));var _={animate:{type:"flip",subtype:"horizontal"},hidden:!0,rows:1==parseInt(s.show_prevnext)?c(l):l};_.id=i,n.addView(_,n.getChildViews().length-1),$$(i).show({type:"flip",subtype:"horizontal"}),o.showView(i),g=i,n.enable(),$$("$multiselect1")&&$$("$multiselect1").attachEvent("onChange",function(e,t){var o=$$("$multiselect1").getValue();-1!=o.indexOf(",Затрудняюсь ответить")&&(o=o.replace(",Затрудняюсь ответить",""),$$("$multiselect1").setValue(o)),-1!=o.indexOf("Затрудняюсь ответить,")&&(o=o.replace("Затрудняюсь ответить,",""),$$("$multiselect1").setValue(o))}),p&&p.id&&$$(p.id)&&webix.html.addCss($$(p.id).getNode().childNodes[0].childNodes[0],"toggleOn")})}function d(){for(var e=$$(this).config,t=$$(this).getParentView().getChildViews(),o=0;o<t.length;o++){var i=t[o].config.id;"button"==$$(i).config.view&&webix.html.removeCss($$(i).getNode().childNodes[0].childNodes[0],"toggleOn")}webix.html.addCss($$(e.id).getNode().childNodes[0].childNodes[0],"toggleOn");for(var n=$$(this).getParentView(),r=n.getParentView(),a=$$("mainBody"),s=0,o=0;o<a.getChildViews().length;o++)s&&$$(a.getChildViews()[o].config.id).hide({type:"flip",subtype:"horizontal"}),a.getChildViews()[o].config.id!=r.config.id&&a.getChildViews()[o].config.id!=n.config.id||(s=o);e.epbx_action_script;switch(e.epbx_action){case"next":if(94==e.epbx_action_block)window.close();else if(93==e.epbx_action_block)var l={nps_id:parseInt(b("nps")),answer:$$("$textarea1").getValue(),question_id:parseInt(e.script_id)||window.actionsId,answer_type:1};var c={nps_id:parseInt(b("nps")),answer:parseInt(e.epbx_action_block),question_id:parseInt(e.script_id)||window.actionsId,answer_type:2};if(window.actionsInfo&&!l)for(var d in window.actionsInfo)if(window.actionsInfo[d]&&("radio"==window.actionsInfo[d].view||"multiselect"==window.actionsInfo[d].view||"textarea"==window.actionsInfo[d].view)&&$$(window.actionsInfo[d].id)&&""!=$$(window.actionsInfo[d].id).getValue())var l={nps_id:parseInt(b("nps")),answer:$$(window.actionsInfo[d].id).getValue(),question_id:parseInt(window.actionsId),answer_type:1};l&&console.log("secondData",l),console.log("data",c),c?webix.ajax().post("/legacy/scripts/set_answer",{data:c},function(t){t=JSON.parse(t),t.result?(window.actionsInfo=[],l?webix.ajax().post("/legacy/scripts/set_answer",{data:l},function(t){t=JSON.parse(t),t.result?(91==l.question_id&&window.close(),u(e.epbx_action_block,e)):(webix.message({type:"error",text:t.msg}),console.log("err",t.data))}):u(e.epbx_action_block,e)):(webix.message({type:"error",text:t.msg}),console.log("err",t.data))}):u(e.epbx_action_block,e);break;case"jump":document.location.href="/#!/main/script?id="+e.epbx_action_script;break;default:alert("Unknow action: "+e.epbx_action)}}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;10!=parseInt(b("id"))?webix.ui({view:"scrollview",scroll:"y",id:"mainView",body:{id:"mainBody",rows:[{cols:[{rows:[{type:"header",template:"Сценарий разговора"},{rows:c(["«Должность» «Имя оператора» <strong>Здравствуйте! Чем могу помочь?</strong>","<strong>Скажите пожалуйста, как я могу к Вам обращаться?</strong>","«Имя клиента»<strong>, очень приятно!  Из какого города Вы звоните?</strong>"])}]},{rows:[{type:"header",template:"Информация о клиенте"},{view:"form",id:"info_form",elements:[{cols:[{view:"text",label:"Телефон:",name:"phone",id:"phone",labelWidth:110,readonly:!0,labelAlign:"right"},{view:"text",label:"Организация",name:"org",id:"org",labelWidth:110,labelAlign:"right"}]},{view:"text",label:"ФИО клиента",name:"fio",id:"fio",labelWidth:110,labelAlign:"right"},{view:"text",label:"Город",name:"city",labelWidth:110,labelAlign:"right"}]}]}]},{}]},ready:function(){}}).show():webix.ui({view:"scrollview",scroll:"y",id:"mainView",body:{id:"mainBody",rows:[{}]},ready:function(){}}).show(),u(e)}Object.defineProperty(t,"__esModule",{value:!0});var h=o(0),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=function(e){function t(){return i(this,t),n(this,e.apply(this,arguments))}return r(t,e),t.prototype.config=function(){return{rows:[{view:"form",id:"qwer",elements:[]}]}},t}(h.b);t.default=w;var g=0;window.epbxAction=d;var b=function(e){var t,o,i=decodeURIComponent(window.location.hash.substring(15)),n=i.split("&");for(o=0;o<n.length;o++)if(t=n[o].split("="),t[0]===e)return void 0===t[1]||t[1]},_=parseInt(b("id"));console.log(parseInt(b("id"))),$$("menuBar").hide(),webix.ajax().get("/legacy/scripts/getstageid",{id:_},function(e,t){t=t.json(),webix.ready(function(){p(parseInt(parseInt(t.result))),a()})})},function(e,t){webix.protoUI({name:"ckeditor",$init:function(){this.$view.className+=" webix_selectable"},defaults:{borderless:!0,toolbar:[["Bold","Italic","-","NumberedList","BulletedList","-","Link","Unlink"],["FontSize","TextColor","BGColor"]]},_init_ckeditor_once:function(){var e=this.config.textAreaID="t"+webix.uid();this.$view.innerHTML="<textarea id='"+e+"'>"+this.config.value+"</textarea>",window.CKEDITOR_BASEPATH=webix.codebase+"ckeditor/";var t={toolbar:this.config.toolbar,width:this.$width-2,height:this.$height-44};webix.extend(t,this.config.editor||{}),webix.require("ckeditor/ckeditor.js",function(){this._3rd_editor=window.CKEDITOR.replace(this.config.textAreaID,t)},this)},_set_inner_size:function(e,t){this._3rd_editor&&this._3rd_editor.container&&this.$width&&this._3rd_editor.resize(e,t)},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&(this._init_ckeditor_once(),this._set_inner_size(e,t))},setValue:function(e){this.config.value=e,this._3rd_editor?this._3rd_editor.setData(e):webix.delay(function(){this.setValue(e)},this,[],100)},getValue:function(){return this._3rd_editor?this._3rd_editor.getData():this.config.value},focus:function(){this._focus_await=!0,this._3rd_editor&&this._3rd_editor.focus()},getEditor:function(){return this._3rd_editor.getData()}},webix.ui.view)},function(e,t){webix.protoUI({name:"icon",$skin:function(){this.defaults.height=webix.skin.$active.inputHeight},defaults:{template:function(e){var t="<button style='height:100%;width:100%;line-height:"+e.aheight+"px' class='webix_icon_button'>";return t+="<span class='webix_icon fa-"+e.icon+"'></span>",e.value&&(t+="<span class='webix_icon_count'>"+e.value+"</span>"),t+="</button>"},width:33},_set_inner_size:function(){}},webix.ui.button)},function(e,t){webix.type(webix.ui.tree,{name:"menuTree",height:40,icon:function(){return""},folder:function(e){return e.icon?"<span class='webix_icon icon fa-"+e.icon+"'></span>":""}}),webix.type(webix.ui.tree,{name:"menuTree2",height:40,icon:function(e){for(var t="",o=1;o<=e.$level;o++)if(o==e.$level&&e.$count){var i=e.open?"down":"right";t+="<span class=' webix_icon fa-angle-"+i+"'></span>"}return t},folder:function(e){return e.icon?"<span class='webix_icon icon fa-"+e.icon+"'></span>":""}})},function(e,t){webix.protoUI({name:"dhx-scheduler",defaults:{tabs:["day","week","month"]},getScheduler:function(){return this._scheduler},$init:function(){this.$ready.push(function(){var e=this.config.tabs,t=["<div class='dhx_cal_container' style='width:100%; height:100%;'><div class='dhx_cal_navline'><div class='dhx_cal_prev_button'>&nbsp;</div><div class='dhx_cal_next_button'>&nbsp;</div><div class='dhx_cal_today_button'></div><div class='dhx_cal_date'></div>"];if(e)for(var o=0;o<e.length;o++)t.push("<div class='dhx_cal_tab"+(0===o?" dhx_cal_tab_first":"")+(o==e.length-1?" dhx_cal_tab_last":"")+"' name='"+e[o]+"_tab' ></div>");t.push("</div><div class='dhx_cal_header'></div><div class='dhx_cal_data'></div></div>"),this.$view.innerHTML=t.join(""),webix.delay(webix.bind(this._render_once,this))})},_render_once:function(){var e=this._scheduler=window.Scheduler?window.Scheduler.getSchedulerInstance():window.scheduler;this.config.init&&this.config.init.call(this),e.init(this.$view.firstChild,this.config.date||new Date,this.config.mode||"week"),this.config.ready&&this.config.ready.call(this)}},webix.ui.view)},function(e,t){webix.i18n.locales["en-US"]={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,dateFormat:"%m/%d/%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%m/%d/%Y %h:%i %A",am:["am","AM"],pm:["pm","PM"],price:"${obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2},fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hours:"Hours",minutes:"Minutes",done:"Done",clear:"Clear",today:"Today"},dataExport:{page:"Page",of:"of"},PDFviewer:{of:"of",automaticZoom:"Automatic Zoom",actualSize:"Actual Size",pageFit:"Page Fit",pageWidth:"Page Width",pageHeight:"Page Height"},aria:{calendar:"Calendar",increaseValue:"Increase value",decreaseValue:"Decrease value",navMonth:["Previous month","Next month"],navYear:["Previous year","Next year"],navDecade:["Previous decade","Next decade"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Hours: %h %A",minuteFormat:"Minutes: %i",removeItem:"Remove item",pages:["First page","Previous page","Next page","Last page"],page:"Page",headermenu:"Header menu",openGroup:"Open column group",closeGroup:"Close column group",closeTab:"Close tab",showTabs:"Show more tabs",resetTreeMap:"Reset tree map",navTreeMap:"Level up",nextTab:"Next tab",prevTab:"Previous tab",multitextSection:"Add section",multitextextraSection:"Remove section",showChart:"Show chart",hideChart:"Hide chart",resizeChart:"Resize chart"},richtext:{underline:"Underline",bold:"Bold",italic:"Italic"},combo:{select:"Select",selectAll:"Select all",unselectAll:"Unselect all"},message:{ok:"OK",cancel:"Cancel"}}},function(e,t){webix.i18n.locales["ru-RU"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d.%m.%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} руб.",priceSettings:null,calendar:{monthFull:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShort:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFull:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],hours:"Часы",minutes:"Минуты",done:"Гoтовo",clear:"Очистить",today:"Сегодня"},dataExport:{page:"Страница",of:"из"},PDFviewer:{of:"из",automaticZoom:"Автоматический зум",actualSize:"Настоящий размер",pageFit:"Размер страницы",pageWidth:"Ширина страницы",pageHeight:"Высота страницы"},aria:{calendar:"Календарь",increaseValue:"Увеличить значение",decreaseValue:"Уменьшить значение",navMonth:["Предыдущий месяц","Следующий месяц"],navYear:["Предыдущий год","Следующий год"],navDecade:["Предыдущие десять лет","Следующие десять лет"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Часы: %H",minuteFormat:"Минуты: %i",removeItem:"Удалить элемент",pages:["Первая страница","Предыдущая страница","Следующая страница","Последняя страница"],page:"Страница",headermenu:"Меню шапки таблицы",openGroup:"Развернуть группу столбцов",closeGroup:"Свернуть группу столбцов",closeTab:"Закрыть вкладку",showTabs:"Показать больше вкладок",resetTreeMap:"Вернуться к первоначальному представлению",navTreeMap:"Перейти на уровень выше",nextTab:"Следующая вкладка",prevTab:"Предыдущая вкладка",multitextSection:"Добавить элемент",multitextextraSection:"Удалить элемент",showChart:"Показать чарт",hideChart:"Спрятать чарт",resizeChart:"Изменить размер чарта"},richtext:{underline:"Подчеркивание",bold:"Жирный",italic:"Курсив"},combo:{select:"Выбрать",selectAll:"Выбрать все",unselectAll:"Сброс выбора"},message:{ok:"OK",cancel:"Отмена"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(99),n=(o.n(i),o(100)),r=(o.n(n),o(101)),a=(o.n(r),o(0)),s=o(83),l=o(120),c=o(32),u=o(75);webix.codebase="/webix",webix.ready(function(){!webix.env.touch&&webix.ui.scrollSize&&webix.CustomScroll&&webix.CustomScroll.init();var e=new a.a({id:"erpicopbx",name:"ErpicoPBX",version:"3.0",start:"/main/cti"}),t=new l.a;webix.guiutils=t,webix.AppConfig=new c.default,webix.Manager=new u.default;var o=new s.a;webix.auth=o,webix.i18n.setLocale("ru-RU"),webix.Date.startOnMonday=!0,webix.ui.datafilter.customFilterSelect=webix.extend({inputtype:"combo"},webix.ui.datafilter.serverRichSelectFilter),e.attachEvent("app:error:resolve",function(e,t){var o=this;window.console.error(t),webix.delay(function(){o.show("/main/cti")})}),o.check(function(){e.render().then(function(){var e=document.location.hash.split("/")[document.location.hash.split("/").length-1];e.indexOf("?")&&(e=e.split("?"),e=e[0]),e.length?$$("sidebar")&&($$("sidebar").getItem(e)?($$("sidebar").select(e),$$("sidebar").getSelectedItem().$parent&&$$("sidebar").open($$("sidebar").getSelectedItem().$parent)):(webix.guiutils.hideAllToolbars(),$$("sidebar").select("cti"))):(webix.guiutils.hideAllToolbars(),$$("sidebar")&&$$("sidebar").select("cti"))}),$$("person_template")&&$$("person_template").refresh()})})},function(e,t){},function(e,t){var o;webix.ui.datafilter.avgColumn=webix.extend({refresh:function(e,t,i){o=0,e.mapCells(null,i.columnId,null,1,function(e){return o++,e}),t.firstChild.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.minColumn=webix.extend({refresh:function(e,t,o){var i=0;e.mapCells(null,o.columnId,null,1,function(e){return e*=1,isNaN(e)||(i+=e),e}),t.firstChild.innerHTML=i.toFixed(2)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.avaregeColumn=webix.extend({refresh:function(e,t,o){var i=0,n=0;e.mapCells(null,o.columnId,null,1,function(e){return e*=1,isNaN(e)||(i+=e,n++),e}),t.firstChild.innerHTML=(i/n).toFixed(2)}},webix.ui.datafilter.summColumn),webix.ui.datafilter.summTimeColumn=webix.extend({refresh:function(e,t,o){var i=0,n=0,r=0,a=0,s=0,l=0,c=0,u=new Array,d=new Array,p=new Array;for(e.mapCells(null,o.columnId,null,1,function(e){return e&&(u=e.split(" "),2==u.length?(d=u[0].split(translate("d")),i+=parseInt(d[0],10),p=u[1].split(":"),n+=parseInt(p[0],10),a+=parseInt(p[1],10),l+=parseInt(p[2],10)):(p=u[0].split(":"),3==p.length?(n+=parseInt(p[0],10),a+=parseInt(p[1],10),l+=parseInt(p[2],10)):(a+=parseInt(p[0],10),l+=parseInt(p[1],10)))),e});l>=60;)l-=60,c++;for(a+=c;a>=60;)a-=60,s++;for(n+=s;n>=24;)n-=24,r++;i+=r,l<10&&(l="0"+l),a<10&&(a="0"+a);var h="";i>0&&(h=h+i+translate("d")+" "),n>0?h=h+n+":":i>0&&(h+="0:"),a>0?h=h+a+":":h+="00:",h+=l>0?l:"00",t.firstChild.innerHTML=h}},webix.ui.datafilter.summColumn),webix.ui.datafilter.avaregeTimeColumn=webix.extend({refresh:function(e,t,o){var i=0,n=0,r=0,a=0,s=0,l=0,c=new Array;e.mapCells(null,o.columnId,null,1,function(e){return e&&(c=e.split(":"),n+=parseInt(c[0],10),a+=parseInt(c[1],10),l++),e});var u=60*n+a;for(a=u/l,a=Math.round(a);a>=60;)a-=60,s++;for(n=s;n>=60;)n-=60,r++;i+=r,a<10&&(a="0"+a),n<10&&(n="0"+n);var d=i+":";n>0?d=d+n+":":d+="00:",d+=a>0?a:"00",t.firstChild.innerHTML=d}},webix.ui.datafilter.summColumn)},function(e,t){webix.protoUI({name:"nic-editor",defaults:{config:{buttonList:["fontSize","bold","italic","underline","strikeThrough","subscript","superscript"]},value:""},$init:function(e){this.$view.innerHTML="<div style='padding:10px'>Loading...</div>",this.$view.className+=" webix_selectable",this._waitEditor=webix.promise.defer(),this.$ready.push(this._init_nic_editor)},_init_nic_editor:function(){if(!1===this.config.cdn)return void this._render_nic_editor();var e=[],t=this.config.cdn?this.config.cdn:"https://cdnjs.cloudflare.com/ajax/libs/NicEdit/0.93";e.push(t+"/nicEdit.js"),webix.require(e).then(webix.bind(this._render_nic_editor,this)).catch(function(e){console.log(e)})},_render_nic_editor:function(){if(!this._editorCss){var e=".nicEdit-panel{height:auto}\n";e+=".nicEdit-panelContain{border-top-width:0px !important;}\n",e+=".webix_selectable>div:nth-child(2){overflow-y:auto;}",webix.html.addStyle(e),this._editorCss=!0}this.config.cdn&&!this.config.config.iconsPath&&(this.config.config.iconsPath=cdn+"/nicEditorIcons.gif");var t=new nicEditor(this.config.config).panelInstance(this.$view.firstChild);this._3rd_editor=t.nicInstances[t.nicInstances.length-1],this._set_inner_size(),this._waitEditor.resolve(this._3rd_editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){if(this._3rd_editor&&this.$width){var e=this.$view.firstChild;e.style.width=this.$width+"px",e=e.nextSibling,e.style.width=this.$width-20+"px",e.style.height=this.$height-46+"px"}},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this._set_inner_size()},setValue:function(e){this.config.value=e,this._3rd_editor&&this._3rd_editor.setContent(e)},getValue:function(){return this._3rd_editor?this._3rd_editor.getContent():this.config.value},focus:function(){this._focus_await=!0,this._3rd_editor&&this._3rd_editor.elm.focus()},getEditor:function(e){return e?this._waitEditor:this._3rd_editor}},webix.ui.view)},function(e,t,o){"use strict";o.d(t,"a",function(){return d});var i=o(76),n=o(103),r=o(104),a=o(78),s=o(77),l=o(106),c=(o.n(l),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),d=function(e){function t(t){var o=e.call(this)||this;return o.webix=t.webix||webix,o.config=o.webix.extend({name:"App",version:"1.0",start:"/home"},t,!0),o._name=o.config.name,o._services={},webix.extend(o,webix.EventSystem),o}return u(t,e),t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.copyConfig=function(e,t,o){if(e.$ui?e={$subview:new n.a(this,"",e)}:(e instanceof i.a||"function"==typeof e&&e.prototype instanceof i.a)&&(e={$subview:e}),e.$subview)return this.addSubView(e,t,o);t=t||(e instanceof Array?[]:{});for(var r in e){var a=e[r];"function"==typeof a&&a.prototype instanceof i.a&&(a={$subview:a}),!a||"object"!==(void 0===a?"undefined":c(a))||a instanceof webix.DataCollection||a instanceof RegExp?t[r]=a:a instanceof Date?t[r]=new Date(a):t[r]=this.copyConfig(a,a instanceof Array?[]:{},o)}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e){if(e){var t=e.target||e.srcElement;if(t&&t.getAttribute){var o=t.getAttribute("trigger");o&&this.trigger(o);var i=t.getAttribute("route");i&&this.show(i)}}},t.prototype.refresh=function(){var e=this._container;this._view._name=webix.uid()+"",this._container=null,e.tagName&&this._view&&(this._view.destructor(),this._view=null),this.render(e,Object(s.a)(this.getRouter().get()),this._parent)},t.prototype.loadView=function(e){var t=this,i=this.config.views,n=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(e):i[e])&&(e=n,n=null),n||(e=e.replace(/\./g,"/"),n=o(107)("./"+e))}catch(t){n=this._loadError(e,t)}return n.then||(n=Promise.resolve(n)),n=n.then(function(e){return e.__esModule?e.default:e}).catch(function(o){return t._loadError(e,o)})},t.prototype.createFromURL=function(e,t){var o=this,i=e[0],n=i.page;return t&&t.getName()===n?Promise.resolve(t):this.loadView(i.page).then(function(e){return o.createView(e,n)})},t.prototype.createView=function(e,t){if("function"==typeof e){if(e.prototype instanceof i.a)return new e(this,t);e=e()}return e instanceof i.a?e:e.$ui?new n.a(this,t,e):new r.a(this,t,e)},t.prototype.show=function(e){return this.$router.get()!==e?this._render(e):Promise.resolve(!0)},t.prototype.canNavigate=function(e,t){var o={url:Object(s.a)(e),redirect:e,confirm:Promise.resolve(!0)};return this.callEvent("app:guard",[e,t||this._view,o])?o.confirm.catch(function(){return o.redirect=null}).then(function(){return o.redirect}):Promise.reject("")},t.prototype.destructor=function(){this._view.destructor()},t.prototype.trigger=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.apply(e,t)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.apply(e,t)},this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var o=0;o<t.length;o++)if(console.error(t[o]),t[o]instanceof Error){var i=t[o].message;0===i.indexOf("Module build failed")?(i=i.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+i+"</pre>"):(i+="<br><br>Check console for more details",webix.message({type:"error",text:i,expire:-1}))}},t.prototype._render=function(e){var t=this;!this.$router&&(webix.attachEvent("onClick",function(e){return t.clickHandler(e)}),e=this._first_start(e));var o="string"==typeof e?e:Object(s.b)(e);return this.canNavigate(o).then(function(e){return null!==e?(t.$router.set(e,{silent:!0}),t._render_stage(e)):null})},t.prototype._render_stage=function(e){var t=this,o="string"==typeof e?Object(s.a)(e):e;return webix.ui.freeze(function(){return t.createFromURL(o,t._view).then(function(e){var i=t._view;return t._view=e,e.render(t._container,o,t._parent).then(function(n){return i&&i!==t._view&&i.destructor(),t._view.getRoot().getParentView()&&(t._container=n),t._root=n,t.callEvent("app:route",[o]),e})}).catch(function(e){t.error("app:error:render",[e])})})},t.prototype._urlChange=function(e){return alert("Not implemented"),Promise.resolve(!0)},t.prototype._first_start=function(e){var t=this,o=function(e){return setTimeout(function(){t._render(e)},1)};if(this.$router=new(this.config.router||a.a)(o,this.config),this._container===document.body&&!1!==this.config.animation){var i=this._container;webix.html.addCss(i,"webixappstart"),setTimeout(function(){webix.html.removeCss(i,"webixappstart"),webix.html.addCss(i,"webixapp")},10)}return e&&1!==e.length||(e=this.$router.get()||this.config.start,this.$router.set(e,{silent:!0})),e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,o){var n=!0!==e.$subview?e.$subview:null,r=e.name||(n?this.webix.uid():"default");t.id=e.id||"s"+this.webix.uid();var a=o[r]={id:t.id,url:n};return a.url instanceof i.a&&(a.view=a.url),t},t}(i.a)},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var i=o(31),n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=function(e){function t(t,o,i){var n=e.call(this,t,o)||this;return n._ui=i,n._windows=[],n}return n(t,e),t.prototype.getRoot=function(){if(this.app.config.jet1xMode){var e=this.getParentView();if(e)return e.getRoot()}return this._root},t.prototype.config=function(){return this._ui.$ui||this._ui},t.prototype.destructor=function(){var t=this._ui.$ondestroy;t&&t();for(var o=0,i=this._windows;o<i.length;o++){i[o].destructor()}e.prototype.destructor.call(this)},t.prototype.show=function(t,o){if(0===t.indexOf("/")||0===t.indexOf("./"))return e.prototype.show.call(this,t,o);e.prototype.show.call(this,"../"+t,o)},t.prototype.init=function(){this.app.config.legacyEarlyInit&&this._realInitHandler()},t.prototype.ready=function(){this.app.config.legacyEarlyInit||this._realInitHandler()},t.prototype._realInitHandler=function(){var e=this._ui.$oninit;if(e){var o=this.getRoot();e(o,o.$scope)}var i=this._ui.$onevent;if(i)for(var n in i)this.on(this.app,n,i[n]);var r=this._ui.$windows;if(r)for(var a=0,s=r;a<s.length;a++){var l=s[a];if(l.$ui){var c=new t(this.app,this.getName(),l);c.render(document.body),this._windows.push(c)}else this.ui(l)}},t.prototype._urlChange=function(t){var o=this;return e.prototype._urlChange.call(this,t).then(function(){var e=o._ui.$onurlchange;if(e){var i=o.getRoot();e(t[0].params,t.slice(1),i.$scope)}})},t}(i.a)},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var i=o(31),n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=function(e){function t(t,o,i){var n=e.call(this,t,o)||this;return n._ui=i,n}return n(t,e),t.prototype.config=function(){return this._ui},t}(i.a)},function(e,t,o){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){var o,n=[],r={},a=e.routie,s=function(e,t){this.name=t,this.path=e,this.keys=[],this.fns=[],this.params={},this.regex=l(this.path,this.keys,!1,!1)};s.prototype.addHandler=function(e){this.fns.push(e)},s.prototype.removeHandler=function(e){for(var t=0,o=this.fns.length;t<o;t++){if(e==this.fns[t])return void this.fns.splice(t,1)}},s.prototype.run=function(e){for(var t=0,o=this.fns.length;t<o;t++)if(!1===this.fns[t].apply(this,e))return!1;return!0},s.prototype.match=function(e,t){var o=this.regex.exec(e);if(!o)return!1;for(var i=1,n=o.length;i<n;++i){var r=this.keys[i-1],a="string"==typeof o[i]?decodeURIComponent(o[i]):o[i];r&&(this.params[r.name]=a),t.push(a)}return!0},s.prototype.toURL=function(e){var t=this.path;for(var o in e)t=t.replace("/:"+o,"/"+e[o]);if(t=t.replace(/\/:.*\?/g,"/").replace(/\?/g,""),-1!=t.indexOf(":"))throw new Error("missing parameters for url: "+t);return t};var l=function(e,t,o,i){return e instanceof RegExp?e:(e instanceof Array&&(e="("+e.join("|")+")"),e=e.concat(i?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,o,i,n,r,a){return t.push({name:n,optional:!!a}),o=o||"",(a?"":o)+"(?:"+(a?o:"")+(i||"")+(r||i&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",o?"":"i"))},c=function(e,t){var o=e.split(" "),i=2==o.length?o[0]:null;e=2==o.length?o[1]:o[0],r[e]||(r[e]=new s(e,i),n.push(r[e])),r[e].addHandler(t)},u=function e(t,o){if("function"==typeof o)c(t,o),e.reload();else if("object"==(void 0===t?"undefined":i(t))){for(var n in t)c(n,t[n]);e.reload()}else void 0===o&&e.navigate(t)};u.lookup=function(e,t){for(var o=0,i=n.length;o<i;o++){var r=n[o];if(r.name==e)return r.toURL(t)}},u.remove=function(e,t){var o=r[e];o&&o.removeHandler(t)},u.removeAll=function(){r={},n=[],o=""},u.navigate=function(e,t){t=t||{};var o=t.silent||!1;o&&w(),setTimeout(function(){window.location.hash=e,o&&setTimeout(function(){f()},1)},1)},u.noConflict=function(){return e.routie=a,u};var d=function(){return window.location.hash.substring(1)},p=function(e,t){var o=[];return t.match(e,o)?!1!==t.run(o)?1:0:-1},h=u.reload=function(){for(var e=d(),t=0,i=n.length;t<i;t++){var r=n[t],a=p(e,r);if(1===a){o=e;break}if(0===a){u.navigate(o,{silent:!0});break}}},f=function(){e.addEventListener?e.addEventListener("hashchange",h,!1):e.attachEvent("onhashchange",h)},w=function(){e.removeEventListener?e.removeEventListener("hashchange",h):e.detachEvent("onhashchange",h)};if(f(),o=d(),t)return u;e.routie=u};e.exports=n(window,!0),e.exports.default=e.exports},function(e,t){var o=webix,i=webix.version.split(".");10*i[0]+1*i[1]<53&&(o.ui.freeze=function(e){var t=e();return t&&t.then?t.then(function(e){return o.ui.$freeze=!1,o.ui.resize(),e}):(o.ui.$freeze=!1,o.ui.resize()),t});var n=o.ui.baselayout.prototype.addView,r=o.ui.baselayout.prototype.removeView,a={addView:function(e,t){if(this.$scope&&this.$scope.webixJet){var o=this.$scope,i={};e=o.app.copyConfig(e,{},i),n.apply(this,[e,t]);for(var r in i)!function(e){o._renderFrame(e,i[e],o.getUrl()).then(function(){o._subs[e]=i[e]})}(r);return e.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var t in e)webix.$$(e[t].id)||delete e[t]}}};o.extend(o.ui.layout.prototype,a,!0),o.extend(o.ui.baselayout.prototype,a,!0),webix.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var t=webix.uid().toString();e.body={id:t},this.$ready.push(function(){this.$app.render(webix.$$(t))})}},webix.ui.proxy)},function(e,t,o){function i(e){return o(n(e))}function n(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var r={"./appconfig":32,"./appconfig.js":32,"./apptoolbar":79,"./apptoolbar.js":79,"./appview":33,"./appview.js":33,"./main":80,"./main.js":80,"./manager":75,"./manager.js":75,"./menu":72,"./menu.js":72,"./menus/list":81,"./menus/list.js":81,"./menus/profile":82,"./menus/profile.js":82,"./models/analysis_outgoing_calls_layout":84,"./models/analysis_outgoing_calls_layout.js":84,"./models/call_recording_tables":85,"./models/call_recording_tables.js":85,"./models/clientwnd":17,"./models/clientwnd.js":17,"./models/contact_cdr_report":86,"./models/contact_cdr_report.js":86,"./models/contact_group_wnd":22,"./models/contact_group_wnd.js":22,"./models/groupwnd":20,"./models/groupwnd.js":20,"./models/menudata":73,"./models/menudata.js":73,"./models/phones_window":87,"./models/phones_window.js":87,"./models/record_contact_center":88,"./models/record_contact_center.js":88,"./models/settings_wnd":18,"./models/settings_wnd.js":18,"./modules/agents_grouped_reports_filter":27,"./modules/agents_grouped_reports_filter.js":27,"./modules/channels_toolbar":25,"./modules/channels_toolbar.js":25,"./modules/checklist_toolbar":10,"./modules/checklist_toolbar.js":10,"./modules/clients_toolbar":13,"./modules/clients_toolbar.js":13,"./modules/compare_calls_toolbar":6,"./modules/compare_calls_toolbar.js":6,"./modules/contact_groups_toolbar":21,"./modules/contact_groups_toolbar.js":21,"./modules/daily_report_toolbar":3,"./modules/daily_report_toolbar.js":3,"./modules/dashboard_toolbar":11,"./modules/dashboard_toolbar.js":11,"./modules/dashboardnps":89,"./modules/dashboardnps.js":89,"./modules/ext_dashboard_calls":41,"./modules/ext_dashboard_calls.js":41,"./modules/ext_dashboard_charts":40,"./modules/ext_dashboard_charts.js":40,"./modules/ext_dashboard_gages":38,"./modules/ext_dashboard_gages.js":38,"./modules/ext_dashboard_managers":39,"./modules/ext_dashboard_managers.js":39,"./modules/ext_incoming_external_toolbar":7,"./modules/ext_incoming_external_toolbar.js":7,"./modules/ext_incoming_internal_toolbar":8,"./modules/ext_incoming_internal_toolbar.js":8,"./modules/ext_outgoing_toolbar":9,"./modules/ext_outgoing_toolbar.js":9,"./modules/extended_calls_toolbar":30,"./modules/extended_calls_toolbar.js":30,"./modules/extended_contact_calls_toolbar":74,"./modules/extended_contact_calls_toolbar.js":74,"./modules/groups_toolbar":19,"./modules/groups_toolbar.js":19,"./modules/hourly_traffic_toolbar":5,"./modules/hourly_traffic_toolbar.js":5,"./modules/interval_reports_filter":2,"./modules/interval_reports_filter.js":2,"./modules/month_traffic_toolbar":4,"./modules/month_traffic_toolbar.js":4,"./modules/npsTooltip":90,"./modules/npsTooltip.js":90,"./modules/phones_groups_toolbar":29,"./modules/phones_groups_toolbar.js":29,"./modules/phones_toolbar":23,"./modules/phones_toolbar.js":23,"./modules/queues_grouped_reports_filter":28,"./modules/queues_grouped_reports_filter.js":28,"./modules/queues_toolbar":24,"./modules/queues_toolbar.js":24,"./modules/reports_toolbar":12,"./modules/reports_toolbar.js":12,"./modules/scripts_toolbar":26,"./modules/scripts_toolbar.js":26,"./modules/users_toolbar":16,"./modules/users_toolbar.js":16,"./outgoingcampaign":1,"./outgoingcampaign/":1,"./outgoingcampaign/form":61,"./outgoingcampaign/form.js":61,"./outgoingcampaign/index":1,"./outgoingcampaign/index.js":1,"./outgoingcampaign/outgoingcampaigns":60,"./outgoingcampaign/outgoingcampaigns.js":60,"./outgoingcampaign/ruleswnd":15,"./outgoingcampaign/ruleswnd.js":15,"./outgoingcampaign/toolbar":14,"./outgoingcampaign/toolbar.js":14,"./script":91,"./script.js":91,"./views/analysis_outgoing_calls":46,"./views/analysis_outgoing_calls.js":46,"./views/cdr_reports":36,"./views/cdr_reports.js":36,"./views/channels":67,"./views/channels.js":67,"./views/checklist":56,"./views/checklist.js":56,"./views/clients":59,"./views/clients.js":59,"./views/compare_calls":52,"./views/compare_calls.js":52,"./views/contact_groups":64,"./views/contact_groups.js":64,"./views/cti":34,"./views/cti.js":34,"./views/daily_report":49,"./views/daily_report.js":49,"./views/dashboard":57,"./views/dashboard.js":57,"./views/ext_dashboard":37,"./views/ext_dashboard.js":37,"./views/ext_incoming_external":53,"./views/ext_incoming_external.js":53,"./views/ext_incoming_internal":54,"./views/ext_incoming_internal.js":54,"./views/ext_outgoing":55,"./views/ext_outgoing.js":55,"./views/extended_calls":70,"./views/extended_calls.js":70,"./views/extended_contact_calls":71,"./views/extended_contact_calls.js":71,"./views/grouped_reports":42,"./views/grouped_reports.js":42,"./views/grouped_reports_by_agents":43,"./views/grouped_reports_by_agents.js":43,"./views/grouped_reports_by_queues":44,"./views/grouped_reports_by_queues.js":44,"./views/groups":63,"./views/groups.js":63,"./views/hourly_load":51,"./views/hourly_load.js":51,"./views/interval_reports":48,"./views/interval_reports.js":48,"./views/lost_calls":45,"./views/lost_calls.js":45,"./views/month_traffic":50,"./views/month_traffic.js":50,"./views/operators_work_report":47,"./views/operators_work_report.js":47,"./views/phone":35,"./views/phone.js":35,"./views/phones":65,"./views/phones.js":65,"./views/phones_groups":69,"./views/phones_groups.js":69,"./views/queues":66,"./views/queues.js":66,"./views/reports":58,"./views/reports.js":58,"./views/scripts":68,"./views/scripts.js":68,"./views/users":62,"./views/users.js":62,"./webix/ckeditor":92,"./webix/ckeditor.js":92,"./webix/icon":93,"./webix/icon.js":93,"./webix/menutree":94,"./webix/menutree.js":94,"./webix/scheduler":95,"./webix/scheduler.js":95};i.keys=function(){return Object.keys(r)},i.resolve=n,e.exports=i,i.id=107},function(e,t,o){"use strict";!function(){function e(e,t){this.name=t.storeName||t.id+":route",this.cb=e}e.prototype.set=function(e,t){var o=this;webix.storage.session.put(this.name,e),t&&t.silent||setTimeout(function(){return o.cb(e)},1)},e.prototype.get=function(){return webix.storage.session.get(this.name)}}()},function(e,t,o){"use strict";!function(){function e(e,t){var o=this;this.cb=e,window.onpopstate=function(){return o.cb(o.get())},this.prefix=t.routerPrefix||""}e.prototype.set=function(e,t){var o=this;this.get()!==e&&window.history.pushState(null,null,this.prefix+e),t&&t.silent||setTimeout(function(){return o.cb(e)},1)},e.prototype.get=function(){var e=window.location.pathname.replace(this.prefix,"");return"/"!==e?e:""}}()},function(e,t,o){"use strict";!function(){function e(e,t){this.path="",this.cb=e}e.prototype.set=function(e,t){var o=this;this.path=e,t&&t.silent||setTimeout(function(){return o.cb(e)},1)},e.prototype.get=function(){return this.path}}()},function(e,t,o){"use strict";function i(e,t,o){t.on(e,"app:guard",function(e,i,n){if(i===t||i.contains(t)){var r=o();n.confirm=!1===r?Promise.reject(r):n.confirm.then(function(){return r})}})}t.a=i},function(e,t,o){"use strict";function i(e,t,i){i=i||{};var n=i.storage,a=n?n.get("lang")||"en":i.lang||"en",s={_:null,polyglot:null,getLang:function(){return a},setLang:function(t,l){var c=(i.path?i.path+"/":"")+t,u=o(114)("./"+c);u.__esModule&&(u=u.default);var d=s.polyglot=new r.a({phrases:u});d.locale(t),s._=webix.bind(d.t,d),a=t,n&&n.put("lang",a),l||e.refresh()}};e.setService("locale",s),s.setLang(a,!0)}t.a=i;var n=o(113),r=o.n(n)},function(e,t,o){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t,o){for(var n in e)i(e,n)&&t.call(o||e,e[n],n,e)}function r(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function a(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}function s(e){var t={};return n(e,function(e,o){n(e,function(e){t[e]=o})}),t}function l(e){var t=s(v);return t[e]||t[g.call(e,/-/,1)[0]]||t.en}function c(e,t){return m[l(e)](t)}function u(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function d(e){var t=e&&e.prefix||"%{",o=e&&e.suffix||"}";if(t===b||o===b)throw new RangeError('"'+b+'" token is reserved for pluralization');return new RegExp(u(t)+"(.*?)"+u(o),"g")}function p(e,t,o,n){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,s=n||y,l="number"==typeof t?{smart_count:t}:t;if(null!=l.smart_count&&a){var u=g.call(a,b);a=r(u[c(o||"en",l.smart_count)]||u[0])}return a=w.call(a,s,function(e,t){return i(l,t)&&null!=l[t]?w.call(l[t],x,$):e})}function h(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var o=t.allowMissing?p:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:o,this.warn=t.warn||a,this.tokenRegex=d(t.interpolation)}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=String.prototype.replace,g=String.prototype.split,b="||||",_=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},m={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:_,chinese:function(){return 0},croatian:_,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:_,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},v={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]},x=/\$/g,$="$$",y=/%\{(.*?)\}/g;h.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},h.prototype.extend=function(e,t){n(e,function(e,o){var i=t?t+"."+o:o;"object"===(void 0===e?"undefined":f(e))?this.extend(e,i):this.phrases[i]=e},this)},h.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:n(e,function(e,o){var i=t?t+"."+o:o;"object"===(void 0===e?"undefined":f(e))?this.unset(e,i):delete this.phrases[i]},this)},h.prototype.clear=function(){this.phrases={}},h.prototype.replace=function(e){this.clear(),this.extend(e)},h.prototype.t=function(e,t){var o,i,n=null==t?{}:t;if("string"==typeof this.phrases[e])o=this.phrases[e];else if("string"==typeof n._)o=n._;else if(this.onMissingKey){var r=this.onMissingKey;i=r(e,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),i=e;return"string"==typeof o&&(i=p(o,n,this.currentLocale,this.tokenRegex)),i},h.prototype.has=function(e){return i(this.phrases,e)},h.transformPhrase=function(e,t,o){return p(e,t,o)},e.exports=h},function(e,t,o){function i(e){return o(n(e))}function n(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var r={"./en":96,"./en.js":96,"./ru":97,"./ru.js":97};i.keys=function(){return Object.keys(r)},i.resolve=n,e.exports=i,i.id=114},function(e,t,o){"use strict";function i(e,t,o){t.urls&&(o=t.urls[o]||o),e.show("./"+o)}function n(e,t,o){var n=t.$$(o.id||o),r=!1;n.attachEvent("onchange",function(){r||i(t,o,this.getValue())}),n.attachEvent("onafterselect",function(){if(!r){var e=null;n.setValue?e=this.getValue():n.getSelectedId&&(e=n.getSelectedId()),i(t,o,e)}}),t.on(e,"app:route",function(e){var o=e[t.getIndex()];if(o){r=!0;var i=o.page;n.setValue&&n.getValue()!==i?n.setValue(i):n.select&&n.exists(i)&&n.getSelectedId()!==i&&n.select(i),r=!1}})}t.a=n},function(e,t,o){"use strict";function i(e,t,o){function i(e){var i=t.$$(o.target);i&&(e||(e="<div class='status_"+h+"'><span class='webix_icon fa-"+_[h]+"'></span> "+b[h]+"</div>"),i.setHTML(e))}function a(){f--,d("good")}function s(e){f--,d("error",e)}function l(e){f++,d("saving"),e&&e.then&&e.then(a,s)}function c(){return h}function u(){0===f&&i(" ")}function d(t,o){f<0&&(f=0),"saving"===t?(h="saving",i()):(w="error"===t,0===f&&(h=w?"error":"good",w?e.error("app:error:server",[o.responseText||o]):g&&setTimeout(u,g),i()))}function p(e){var o=webix.dp(e);o&&(t.on(o,"onAfterDataSend",l),t.on(o,"onAfterSaveError",function(e,t,o){return s(o)}),t.on(o,"onAfterSave",a))}var h="good",f=0,w=!1,g=o.expire;g||!1===g||(g=2e3);var b=o.texts||r,_=o.icons||n;"string"==typeof o&&(o={target:o}),e.setService("status",{getStatus:c,setStatus:d,track:p}),o.remote&&t.on(webix,"onRemoteCall",l),o.ajax&&t.on(webix,"onBeforeAjax",function(e,t,o,i,n,r,a){l(a)}),o.data&&p(o.data)}t.a=i;var n={good:"check",error:"warning",saving:"refresh fa-spin"},r={good:"Ok",error:"Error",saving:"Connecting..."}},function(e,t,o){"use strict";function i(e,t,o){o=o||{};var i=o.storage,n=i?i.get("theme")||"flat-default":o.theme||"flat-default",r={getTheme:function(){return n},setTheme:function(t,o){for(var r=t.split("-"),a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s].getAttribute("title");l&&(l===t||l===r[0]?a[s].disabled=!1:a[s].disabled=!0)}webix.skin.set(r[0]),webix.html.removeCss(document.body,"theme-"+n),webix.html.addCss(document.body,"theme-"+t),n=t,i&&i.put("theme",t),o||e.refresh()}};e.setService("theme",r),r.setTheme(n,!0)}t.a=i},function(e,t,o){"use strict";function i(e,t,o){for(var i=0;i<o.length;i++)e.setParam(o[i],t[i+1]?t[i+1].page:"")}function n(e,t,o){var n=o.route||o;t.on(e,"app:urlchange",function(e,o){t===e&&(i(t,o,n),o.splice(1,n.length))}),t.on(e,"app:paramchange",function(e,o,i,r){if(t===e&&r)for(var a=0;a<n.length;a++)if(n[a]===o)return t.show([a,i]),!1}),i(t,t.getUrl(),n)}t.a=n},function(e,t,o){"use strict";function i(e,t,o){function i(e,t){e===r?(d.logout(),t.redirect=s):e===n||d.getStatus()||(t.redirect=n)}o=o||{};var n=o.login||"/login",r=o.logout||"/logout",a=o.afterLogin||e.config.start,s=o.afterLogout||"/login",l=o.ping||3e5,c=o.model,u=o.user,d={getUser:function(){return u},getStatus:function(e){return e?c.status().catch(function(){return null}).then(function(e){u=e}):null!==u},login:function(t,o){return c.login(t,o).then(function(t){if(u=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[u]),e.show(a)})},logout:function(){return u=null,c.logout().then(function(t){return e.callEvent("app:user:logout",[]),t})}};e.setService("user",d),e.attachEvent("app:guard",function(e,t,o){return void 0===u&&(o.confirm=d.getStatus(!0).then(function(){return i(e,o)})),i(e,o)}),l&&setInterval(function(){return d.getStatus(!0)},l)}t.a=i},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}o.d(t,"a",function(){return n});var n=function(){function e(){i(this,e),this.filter_grouped_reports=1,this.queue_grouped_reports="",this.type_grouped_reports=1}return e.prototype.yesterday=function(e){return e.setDate(e.getDate()-1),e},e.prototype.hideAllToolbars=function(){$$("extended_calls_trafic").hide(),$$("extended_calls_toolbar").hide(),$$("extended_contact_calls_toolbar").hide(),$$("reportDateRange").hide(),$$("cdr_toolbar").hide(),$$("analysis_outgoing_calls_toolbar").hide(),$$("grouped_reports_toolbar").hide(),$$("phoneExcelButton").hide(),$$("lost_calls_toolbar").hide(),$$("agents_grouped_reports_filter").hide(),$$("queues_grouped_reports_filter").hide(),$$("operators_work_report_toolbar").hide(),$$("interval_reports_toolbar").hide(),$$("daily_report_toolbar").hide(),$$("month_traffic_toolbar").hide(),$$("hourly_traffic_toolbar").hide(),$$("compare_calls_toolbar").hide(),$$("ext_incoming_external_toolbar").hide(),$$("ext_incoming_internal_toolbar").hide(),$$("ext_outgoing_toolbar").hide(),$$("checklist_toolbar").hide(),$$("dashboard_toolbar").hide(),$$("reports_toolbar").hide(),$$("outgoingcampaign-toolbar").hide(),$$("users_toolbar").hide(),$$("groups_toolbar").hide(),$$("contact_groups_toolbar").hide(),$$("phones_toolbar").hide(),$$("queues_toolbar").hide(),$$("channels_toolbar").hide(),$$("scripts_toolbar").hide(),$$("clients_toolbar").hide(),$$("phones_groups_toolbar").hide()},e.prototype.loadTable=function(e,t){if(!$$(e))return!1;$$(e)._feed_last.url?$$(e).load($$(e)._feed_last.url):$$(e).load(t),$$(e).filterByAll()},e.prototype.loadUserTable=function(){$$("users")._feed_last.url?$$("users").load($$("users")._feed_last.url):$$("users").load("/users/list"),$$("users").filterByAll()},e.prototype.getDateRange=function(e){var t=$$(e).getValue(),o=t.start,i=o.getMonth()+1,n=o.getFullYear()+"-"+i+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),r=t.end;if(r)var a=r.getMonth()+1,s=r.getFullYear()+"-"+a+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":59";else var s="";return{start:n,end:s}},e.prototype.contact_lost_calls_refresh=function(){webix.extend($$("lost_calls_list"),webix.ProgressBar),webix.extend($$("lost_calls_table"),webix.ProgressBar),$$("lost_calls_table").enable(),$$("lost_calls_list").enable();var e=webix.guiutils.getDateRange("reportDateRange"),t={t1:e.start,t2:e.end},o="filter[t1]="+t.t1+"&filter[t2]="+t.t2;$$("lost_calls_list").showProgress(),$$("lost_calls_table").showProgress(),webix.ajax().get("legacy/lost_calls_total",o,{error:function(e,t,o){$$("lost_calls_list").hideProgress(),$$("lost_calls_table").hideProgress(),webix.message({type:"error",text:"Произошла ошибка при получении данных."})},success:function(e,t,o){var i=t.json();$$("lost_calls_list").clearAll(),i.data.lost_cals&&$$("lost_calls_list").parse(i.data.lost_cals),$$("lost_calls_table").clearAll(),i.data&&$$("lost_calls_table").parse(i.data),$$("lost_calls_list").hideProgress(),$$("lost_calls_table").hideProgress()}})},e.prototype.contact_grouped_reports_refresh=function(){var e=$$("reportDateRange").getValue(),t=e.start,o=t.getMonth()+1,i=t.getFullYear()+"-"+o+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),n=e.end;if(n)var r=n.getMonth()+1,a=n.getFullYear()+"-"+r+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":59";else var a="";var s={t1:i,t2:a},l="?filter[t1]="+s.t1+"&filter[t2]="+s.t2,c="/legacy/grouped_reports_total_chart";$$("grouped_reports1").load(c+"1"+l),$$("grouped_reports2").load(c+"2"+l),$$("grouped_reports3").load(c+"3"+l),$$("grouped_reports4").load(c+"4"+l),$$("grouped_reports5").load(c+"5"+l),$$("grouped_reports6").load(c+"6"+l),$$("grouped_reports7").load(c+"7"+l),this.filter_grouped_reports=1,this.queue_grouped_reports="",this.type_grouped_reports=1,$$("option_grouped_reports").define("badge",0),$$("option_grouped_reports").define("label",translate("Add options")),$$("option_grouped_reports").define("icon","plus"),$$("option_grouped_reports").refresh()},e.prototype.billing_analysis_outgoing_calls_refresh=function(){var e=webix.guiutils.getDateRange("reportDateRange"),t="?filter[t1]="+e.start+"&filter[t2]="+e.end;$$("traffic_for_period").load("/legacy/traffic_for_period"+t),$$("popular_city_for_period").load("/legacy/popular_city_for_period"+t),$$("popular_longdistance_over_period").load("/legacy/popular_longdistance_over_period"+t),$$("popular_cell_for_period").load("/legacy/popular_cell_for_period"+t),$$("most_calling_employees_for_period").load("/legacy/most_calling_employees_for_period"+t)},e.prototype.contact_operators_work_report_refresh=function(){var e=webix.guiutils.getDateRange("reportDateRange"),t="?filter[t1]="+e.start+"&filter[t2]="+e.end;$$("operators_work_table").load("/legacy/operators_work_report"+t),$$("operators_work_report_list").load("legacy/operators_work_report_list"+t)},e.prototype.checklistFillWindow=function(e,t,o){var i;webix.ui((i={id:"checklist_fill_win",view:"window",title:"",head:{view:"button",label:"Закрыть",width:70,click:"$$('checklist_fill_win').close();"}},i.head={view:"toolbar",margin:-4,cols:[{view:"label",label:o?"Результаты заполнения чеклиста":"Заполнение чеклиста"},{view:"icon",icon:"wxi-close-circle",click:"$$('checklist_fill_win').close();"}]},i.resize=!0,i.width=700,i.height=500,i.center=!0,i.position="center",i.modal=!0,i.move=!0,i.body={rows:[{view:"datepicker",label:"Дата",labelWidth:100,labelAlign:"right",editable:!0,timepicker:!1,format:"%D, %d.%m.%Y",value:o?t:new Date,id:"questions_answers_date",stringResult:!1},{view:"richselect",id:"questions_answers_agent",label:"Менеджер",labelWidth:100,labelAlign:"right",options:"/legacy/ext_dashboard_agentslist/"+e+"/short"},{view:"richselect",id:"questions_answers_checklist",label:"Группа",labelWidth:100,labelAlign:"right",options:"/legacy/ext/checklists/groups/",on:{onChange:function(e,t){$$("questions_answers").clearAll();var o=$$("questions_answers_checklist_block");o.getList().clearAll(),o.getList().load("/legacy/ext/checklists/groups/"+e),o.setValue(0),o.show()}}},{view:"richselect",id:"questions_answers_checklist_block",label:"Блок",labelWidth:100,labelAlign:"right",options:[],hidden:!0,on:{onChange:function(o,i){$$("questions_answers").clearAll(),o?($$("questions_answers").load("/legacy/ext/checklist/list/"+o+"/"+e+"/"+t),$$("questions_answers_save").enable()):$$("questions_answers_save").disable()}}},{view:"datatable",id:"questions_answers",autowidth:!0,editable:!0,columns:[{id:"question",header:"Вопрос",width:250},{id:"answer",header:"Ответ",width:80,editor:"select",options:["0","3","5"]},{id:"comment",header:"Комментарий",width:250,editor:"text"}],on:{onItemClick:function(e){this.editColumn(e),this.focusEditor(e)}}},{cols:[{id:"questions_answers_save",view:"button",label:"Сохранить",disable:!0,click:function(){var e=[];$$("questions_answers").editStop();var t=$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(o){o.user_id=t,e.push(o)});var o=JSON.stringify(e),i=webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklists/fill/"+i,o,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при сохранении."})},success:function(e,t,o){webix.message({type:"success",text:"Операция сохранения успешно завершена."}),$$("checklist_fill_win").close()}})}},{view:"button",label:"Закрыть",click:"$$('checklist_fill_win').close();"},{view:"button",id:"delete_change_answers",label:"Удалить запись",click:function(){var e=[];$$("questions_answers").editStop();$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(t){e.push(t)});var t=JSON.stringify(e);webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklist/deleteanswer",t,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при удалении"})},success:function(e,t,o){webix.message({type:"success",text:"Успешно удалено."}),$$("checklist_fill_win").close();var i=$$("ext_checklist_table"),n=i.getSelectedItem();i.remove(n.id);var r=$$("ext_checklist_start").getValue(),a=$$("ext_checklist_finish").getValue();i.load("/legacy/ext/checklist/tree/"+r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+"/"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"/"+n.$parent)}})}},{view:"button",id:"save_change_answers",label:"Сохранить изменения",click:function(){var t=[];$$("questions_answers").editStop();$$("questions_answers_agent").getValue();$$("questions_answers").data.each&&$$("questions_answers").data.each(function(o){o.user_id=e,t.push(o)});var o=JSON.stringify(t),i=webix.Date.dateToStr("%Y-%m-%d")($$("questions_answers_date").getValue());webix.ajax().post("/legacy/ext/checklists/change/"+i,o,{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при изменении."})},success:function(e,t,o){webix.message({type:"success",text:"Успешно изменено."}),$$("checklist_fill_win").close();var n=$$("ext_checklist_table"),r=n.getSelectedItem();i!=r.date&&n.remove(r.id),1==r.open&&n.remove(r.id);var a=$$("ext_checklist_start").getValue(),s=$$("ext_checklist_finish").getValue();n.load("/legacy/ext/checklist/tree/"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"/"+s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+"/"+r.$parent)}})}}]}]},i.on={onShow:function(){0==o&&($$("delete_change_answers").hide(),$$("save_change_answers").hide()),0!=o&&($$("questions_answers").clearAll(),$$("questions_answers").load("/legacy/ext/checklist/list/"+o+"/"+e+"/"+t),$$("questions_answers_save").hide(),$$("questions_answers_agent").hide(),$$("questions_answers_checklist").hide(),$$("questions_answers_checklist_block").hide())}},i)).show()},e.prototype.loadMonthTrafficReports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";$$("month_traffic_table").enable(),$$("month_traffic_chart").enable();var o="";""!=$$("startDate_month_traffic").getValue()&&(o+="?filter[t1]="+$$("startDate_month_traffic").getValue()),""!=$$("finishDate_month_traffic").getValue()&&(o+="&filter[t2]="+$$("finishDate_month_traffic").getValue()),""!=e&&(o+="&filter[src]="+e),""!=t&&(o+="&filter[dst]="+t),$$("month_traffic_table").clearAll(),webix.extend($$("month_traffic_table"),webix.ProgressBar),$$("month_traffic_table").showProgress(),$$("month_traffic_table").load("/legacy/month_traffic"+o),$$("month_traffic_chart").clearAll(),$$("month_traffic_chart").load("/legacy/month_traffic_chart"+o),$$("month_traffic_chart").refresh()},e.prototype.getNpsFilter=function(){if($$("rangePickerFilter")){var e=$$("rangePickerFilter").getValue();if(e.start)var t=webix.Date.dateToStr("%Y-%m-%d %H:%i:%s")(new Date(e.start));if(e.end)var o=webix.Date.dateToStr("%Y-%m-%d %H:%i:%s")(new Date(e.end))}if($$("filialFilter"))var i=$$("filialFilter").getText();if($$("cityFilter"))var n=$$("cityFilter").getText();if($$("channel"))var r=$$("channel").getText();webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/count",{filter:{end:o,start:t,city:n,filial:i,channel:r}},{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,o){var i=t.json();$$("countList").clearAll(),$$("countList").parse(i)}}),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/count",{filter:{end:o,start:t,city:n,filial:i,channel:r},byCities:1},{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,o){var i=t.json();$$("countListByCities").clearAll(),$$("countListByCities").parse(i)}}),webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/promoters",{filter:{end:o,start:t,city:n,filial:i,channel:r}},{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,a,s){webix.ajax().headers({"Content-type":"application/json"}).get("legacy/nps/detractors",{filter:{end:o,start:t,city:n,filial:i,channel:r}},{error:function(e,t,o){webix.message({type:"error",text:"Произошла ошибка при выполнении запроса.<br/>"+e})},success:function(e,t,o){var i=a.json(),n=t.json(),r=[],s=[];if(n&&i){for(var l in n)n[l].sales==i[l].sales&&0==i[l].sales||(r.push(i[l]),s.push(n[l]));$$("detractorsList").clearAll(),$$("detractorsList").parse(s),$$("promotersList").clearAll(),$$("promotersList").parse(r)}}})}})},e.prototype.getPdfChart=function(e){webix.require("https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js").then(function(){domtoimage.toJpeg($$(e).$view,{quality:.95,bgcolor:"#fff"}).then(function(e){pdfjs.load("//cdn.webix.com//extras/pt-sans.regular.ttf",function(t,o){var i=new pdfjs.Document;pdfjs.load(e,function(e,t){var o=new pdfjs.Image(t);i.image(o);var n=i.render(),r=new Blob([n.toString()],{type:"application/pdf"}),a=$$("rangePickerFilter").getValue();if(a.start)var s=webix.Date.dateToStr("%d.%m.%Y")(new Date(a.start));else if(a.end)var s=webix.Date.dateToStr("%d.%m%Y")(new Date(a.end));if(a.end)var l=webix.Date.dateToStr("%d.%m%Y")(new Date(a.end));else var l=s;webix.html.download(r,"NPS_Dashboard_"+s+"-"+l+".pdf")})})})})},e.prototype.getExtDashboardFilterData=function(){$$("gage_sl").setValue(0),$$("gage_lcr").setValue(0),$$("gage_fcr").setValue(0);var e=$$("date_ext_dash").getValue(),t=e.start,o=t.getMonth()+1,i=t.getFullYear()+"-"+o+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),n=e.end;if(n)var r=n.getMonth()+1,a=n.getFullYear()+"-"+r+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":59";else var a="";return{"filter[t1]":i,"filter[t2]":a,"filter[queues]":$$("queues-select").getValue(),"filter[agents]":$$("agents").getValue(),"filter[hours]":$$("hours").getValue()}},e.prototype.getUrlParameter=function(e){var t=decodeURIComponent(window.location.search.substring(1));t||window.location.href.split("?")[1]&&(t=window.location.href.split("?")[1]);var o,i,n=t.split("&");for(i=0;i<n.length;i++)if(o=n[i].split("="),o[0]===e)return void 0===o[1]||o[1]},e}()}]);
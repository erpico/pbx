{"version":3,"file":"chat.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/libs/rtc.js","../sources/libs/phone.js","../sources/views/call/panel.js","../sources/views/chat/common/form.js","../sources/helpers/customcheckbox.js","../sources/helpers/icons.js","../sources/views/chat/common/people.js","../sources/views/chat/common/toolbar.js","../sources/views/chat/common/window.js","../sources/views/chat/info/form.js","../sources/views/chat/info/index.js","../sources/views/chat/info/info.js","../sources/views/chat/info/people.js","../sources/views/chat/members/index.js","../sources/views/chat/new/form.js","../sources/views/chat/new/index.js","../sources/views/list.js","../sources/views/chats.js","../sources/helpers/search.js","../sources/views/sidebar.js","../sources/views/compact/sidemenu.js","../sources/views/messages/toolbar.js","../sources/views/messages/index.js","../sources/helpers/responsive.js","../sources/views/top.js","../sources/views/users.js","../sources/export_views.js","../sources/models/Local.js","../node_modules/remote-client/dist/remote.es6.js","../sources/models/Backend.js","../sources/models/Operations.js","../sources/models/Upload.js","../sources/models/Helpers.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","// https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\n\nfunction reportError(e) {\n\tconsole.error(e);\n}\n\nfunction defer() {\n\tlet resolve;\n\tconst promise = new Promise(res => {\n\t\tresolve = res;\n\t});\n\tpromise.resolve = resolve;\n\treturn promise;\n}\n\nexport default function rtc(sendSignal, rtcConfig, handler, locale) {\n\trtcConfig = rtcConfig || {\n\t\ticeServers: [\n\t\t\t{\n\t\t\t\turls: \"stun:turn.webix.com:5349\",\n\t\t\t},\n\t\t\t{\n\t\t\t\turls: \"turn:turn.webix.com:5349\",\n\t\t\t\tusername: \"demo\",\n\t\t\t\tcredential: \"redro43a\",\n\t\t\t},\n\t\t],\n\t};\n\n\tlet conn = new RTCPeerConnection(rtcConfig);\n\tconst ready = defer();\n\n\tconst trigger = obj => {\n\t\tif (obj) handler(obj);\n\t\telse handler({ action: \"streams\", conn });\n\t};\n\n\t// The local ICE layer calls your icecandidate event handler\n\t// when it needs you to transmit an ICE candidate to the other peer\n\tconn.onicecandidate = ev => {\n\t\t// accept candidate\n\t\tif (ev.candidate) {\n\t\t\tsendSignal(\"new-ice-candidate\", ev.candidate);\n\t\t}\n\t};\n\n\t// handler is called by the local WebRTC layer\n\t// when a track is added to the connection\n\tconn.ontrack = () => {\n\t\ttrigger();\n\t};\n\n\t// is called whenever the WebRTC infrastructure needs\n\t// you to start the session negotiation process anew.\n\tconn.onnegotiationneeded = () => {\n\t\tconn\n\t\t\t.createOffer()\n\t\t\t.then(offer => conn.setLocalDescription(offer))\n\t\t\t.then(() => sendSignal(\"offer\", conn.localDescription))\n\t\t\t.catch(reportError);\n\t};\n\n\tconn.oniceconnectionstatechange = () => {\n\t\tswitch (conn.iceConnectionState) {\n\t\t\tcase \"closed\":\n\t\t\tcase \"failed\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconn.onicegatheringstatechange = () => {\n\t\tswitch (conn.signalingState) {\n\t\t\tcase \"closed\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst handleGetUserMediaError = (e, type) => {\n\t\t//get user media after call end\n\t\tif (!conn) return;\n\n\t\tswitch (e.name) {\n\t\t\tcase \"NotFoundError\":\n\t\t\t\twebix.alert(\n\t\t\t\t\tlocale(\"Could not find your\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tlocale(type == \"audio\" ? \"microphone\" : \"camera\")\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase \"SecurityError\":\n\t\t\tcase \"PermissionDeniedError\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\twebix.alert(\n\t\t\t\t\tlocale(\"Error opening your\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tlocale(type == \"audio\" ? \"microphone\" : \"camera\")\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst start = (mode, emode, reset) => {\n\t\tif (reset) sendSignal(\"reset\", \"\");\n\t};\n\n\tconst restart = () => {\n\t\tconn.restartIce();\n\t};\n\n\tconst onOffer = msg => {\n\t\tvar desc = new RTCSessionDescription(msg);\n\t\tif (conn.getSenders().length === 0) {\n\t\t\tconn\n\t\t\t\t.setRemoteDescription(desc)\n\t\t\t\t.then(() => conn.createAnswer())\n\t\t\t\t.then(answer => conn.setLocalDescription(answer))\n\t\t\t\t.then(() => {\n\t\t\t\t\tready.resolve();\n\t\t\t\t\tsendSignal(\"answer\", conn.localDescription);\n\t\t\t\t})\n\t\t\t\t.catch(reportError);\n\t\t} else {\n\t\t\tconn\n\t\t\t\t.setRemoteDescription(desc)\n\t\t\t\t.then(() => conn.createAnswer())\n\t\t\t\t.then(answer => conn.setLocalDescription(answer))\n\t\t\t\t.then(() => {\n\t\t\t\t\tsendSignal(\"answer\", conn.localDescription);\n\t\t\t\t})\n\t\t\t\t.catch(reportError);\n\t\t}\n\t};\n\n\tconst onAnswer = msg => {\n\t\tvar desc = new RTCSessionDescription(msg);\n\t\treturn conn\n\t\t\t.setRemoteDescription(desc)\n\t\t\t.then(() => {\n\t\t\t\tready.resolve();\n\t\t\t})\n\t\t\t.catch(reportError);\n\t};\n\n\tconst onCandidate = msg => {\n\t\tready\n\t\t\t.then(() => {\n\t\t\t\tvar candidate = new RTCIceCandidate(msg);\n\t\t\t\treturn conn.addIceCandidate(candidate);\n\t\t\t})\n\t\t\t.catch(reportError);\n\t};\n\n\tconst end = final => {\n\t\tif (conn) {\n\t\t\tconn.ontrack = null;\n\t\t\tconn.onremovetrack = null;\n\t\t\tconn.onremovestream = null;\n\t\t\tconn.onicecandidate = null;\n\t\t\tconn.oniceconnectionstatechange = null;\n\t\t\tconn.onsignalingstatechange = null;\n\t\t\tconn.onicegatheringstatechange = null;\n\t\t\tconn.onnegotiationneeded = null;\n\t\t\tconn.close();\n\t\t\tconn = null;\n\t\t}\n\n\t\ttrigger({ action: \"end\", final });\n\t};\n\n\tconst status = () => {\n\t\treturn conn && conn.remoteDescription ? 1 : 0;\n\t};\n\n\tconst enable = (kind, mode) => {\n\t\tconst promise = webix.promise.defer();\n\n\t\tlet tracks = conn\n\t\t\t.getSenders()\n\t\t\t.map(a => a.track || {})\n\t\t\t.reduce((p, c) => p.concat(c), []);\n\n\t\ttracks = tracks.filter(a => a.kind === kind);\n\n\t\tif (mode && !tracks.length) {\n\t\t\ttrigger({ action: \"upgrade\", kind, promise });\n\t\t} else {\n\t\t\ttracks.forEach(a => (a.enabled = mode));\n\t\t\tpromise.resolve();\n\t\t}\n\n\t\treturn promise;\n\t};\n\n\tconst mediaValues = {\n\t\taudio: {\n\t\t\techoCancellation: true,\n\t\t\tnoiseSuppression: true,\n\t\t},\n\t\tvideo: {\n\t\t\tfacingMode: \"user\",\n\t\t},\n\t};\n\n\tconst upgrade = (type, promise) => {\n\t\treturn navigator.mediaDevices\n\t\t\t.getUserMedia({ [type]: mediaValues[type] })\n\t\t\t.then(local => {\n\t\t\t\tlocal.getTracks().forEach(track => conn.addTrack(track, local));\n\t\t\t\ttrigger();\n\t\t\t\tpromise.resolve();\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\tpromise.reject();\n\t\t\t\thandleGetUserMediaError(e, type);\n\t\t\t});\n\t};\n\n\treturn {\n\t\tstart,\n\t\tend,\n\t\trestart,\n\t\tstatus,\n\t\tenable,\n\t\tonOffer,\n\t\tonAnswer,\n\t\tupgrade,\n\t\tonCandidate,\n\t};\n}\n","import rtc from \"./rtc\";\n\nfunction setStream(nodes, type, value) {\n\tconst track = value.track;\n\n\tif (!track) return;\n\n\tconst kind = track.kind;\n\tconst tag = nodes[type][kind];\n\n\tconst stream = new MediaStream();\n\tstream.addTrack(track);\n\n\ttag.srcObject = stream;\n}\n\nexport default function phone(\n\tsendSignal,\n\trtcConfig,\n\tnodes,\n\trole,\n\tmode,\n\tlocale\n) {\n\tmode = webix.extend(mode || {}, {\n\t\taudio: true,\n\t\tvideo: false,\n\t});\n\n\tconst emode = {\n\t\taudio: true,\n\t\tvideo: false,\n\t};\n\n\tlet baseConn;\n\n\tconst handler = ({ action, conn, final, kind, promise }) => {\n\t\tif (action === \"upgrade\") {\n\t\t\tmode[kind] = true;\n\t\t\tbaseConn.upgrade(kind, promise);\n\t\t} else if (action === \"end\") {\n\t\t\tif (nodes.remote.audio.srcObject)\n\t\t\t\tnodes.remote.audio.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.local.audio.srcObject)\n\t\t\t\tnodes.local.audio.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.remote.video.srcObject)\n\t\t\t\tnodes.remote.video.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.local.video.srcObject)\n\t\t\t\tnodes.local.video.srcObject.getTracks().forEach(track => track.stop());\n\n\t\t\tnodes.local.audio.removeAttribute(\"src\");\n\t\t\tnodes.local.audio.removeAttribute(\"srcObject\");\n\t\t\tnodes.remote.audio.removeAttribute(\"src\");\n\t\t\tnodes.remote.audio.removeAttribute(\"srcObject\");\n\t\t\tnodes.local.video.removeAttribute(\"src\");\n\t\t\tnodes.local.video.removeAttribute(\"srcObject\");\n\t\t\tnodes.remote.video.removeAttribute(\"src\");\n\t\t\tnodes.remote.video.removeAttribute(\"srcObject\");\n\n\t\t\tif (final) nodes.end();\n\t\t} else if (action === \"streams\") {\n\t\t\tconn.getSenders().forEach(a => setStream(nodes, \"local\", a));\n\t\t\tconn.getReceivers().forEach(a => setStream(nodes, \"remote\", a));\n\t\t}\n\t};\n\n\tconst events = (type, msg) => {\n\t\tswitch (type) {\n\t\t\tcase \"reset\":\n\t\t\t\tbaseConn.end();\n\t\t\t\tbaseConn = init();\n\t\t\t\tbreak;\n\t\t\tcase \"offer\":\n\t\t\t\tbaseConn.onOffer(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"answer\":\n\t\t\t\tbaseConn.onAnswer(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"new-ice-candidate\":\n\t\t\t\tbaseConn.onCandidate(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"await-offer\":\n\t\t\t\tsendSignal(\"active\", { ...emode });\n\t\t\t\tbaseConn.restart();\n\t\t\t\tbreak;\n\t\t\tcase \"active\":\n\t\t\t\tfor (var key in msg) {\n\t\t\t\t\tconst trigger = nodes.active[\"remote\"]\n\t\t\t\t\t\t? nodes.active[\"remote\"][key]\n\t\t\t\t\t\t: null;\n\t\t\t\t\tif (trigger) trigger(msg[key]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst init = () => {\n\t\tsendSignal(\"active\", { ...emode });\n\t\treturn rtc(sendSignal, rtcConfig, handler, locale);\n\t};\n\tbaseConn = init();\n\n\tconst end = () => {\n\t\tif (baseConn) baseConn.end();\n\t};\n\tconst enable = (key, value) => {\n\t\tconst promise = baseConn.enable(key, value);\n\n\t\tpromise\n\t\t\t.then(() => {\n\t\t\t\temode[key] = value;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\temode[key] = mode[key] = false;\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsendSignal(\"active\", { ...emode });\n\t\t\t});\n\n\t\treturn promise;\n\t};\n\n\tswitch (role) {\n\t\tcase 1:\n\t\t\tbaseConn.start(mode, emode);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tsendSignal(\"await-offer\", \"\");\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tbaseConn.start(mode, emode, true);\n\t\t\tbreak;\n\t}\n\n\treturn { events, enable, end };\n}\n","import { JetView } from \"webix-jet\";\nimport { createState } from \"jet-restate\";\n\nimport phone from \"../../libs/phone\";\n\nexport default class CallPanel extends JetView {\n\tconfig() {\n\t\tthis.time = 0;\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.Back = this.app.getService(\"backend\");\n\t\tthis.callStatuses = this.Back.callStatuses;\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.LocalState = createState({\n\t\t\taudio: true,\n\t\t\tvideo: false,\n\t\t\tremoteVideo: false,\n\t\t\tremoteAudio: false,\n\t\t});\n\t\tthis.Initiator = this.State.callUsers[0] === this.app.config.user;\n\n\t\tif (this.State.callStatus === this.callStatuses[\"active\"]) {\n\t\t\t// loading page while call already active\n\t\t\t// most probably due to page reloading\n\t\t\t// we need to force user to interact with page, or players will not start\n\t\t\tthis.AfterRefresh = true;\n\t\t}\n\n\t\tconst users = this.app.getService(\"local\")._users;\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\twidth: this.getParam(\"compact\", true) ? 0 : 380,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_call\",\n\t\t\t\t\tlocalId: \"fullscreen\",\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\tcells: [this.GetAudioConfig(users), this.GetVideoConfig()],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\tcss: \"webix_chat_video webix_chat_audio\",\n\t\t\t\t\t\t\tminHeight: 96,\n\t\t\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\t\t\ttemplate: `\n\t\t\t\t\t\t\t\t<div style=\"position: relative; width: 100%; height: 100%;\">\n\t\t\t\t\t\t\t\t\t<div class=\"webix_chat_video_remote\">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"webix_chat_video_local\">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t${this.Helpers.avatar(\n\t\t\t\t\t\t\t\t\t\tusers.getItem(this.app.config.user),\n\t\t\t\t\t\t\t\t\t\t\"webix_chat_video_local_avatar\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tlocalId: \"connection\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.GetActionsConfig(),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst video = this.$$(\"connection\").$view;\n\t\tthis.localVideo = video.querySelector(\".webix_chat_video_local\");\n\t\tthis.localAvatar = video.querySelector(\".webix_chat_video_local_avatar\");\n\t\tthis.remoteVideo = video.querySelector(\".webix_chat_video_remote\");\n\n\t\tthis.on(this.Back.pubsub(), \"signal\", ({ msg, type }) => {\n\t\t\t// do nothing, until user confirms that they want to join the call\n\t\t\tif (this.AfterRefresh) return;\n\n\t\t\tif (msg) msg = JSON.parse(msg);\n\t\t\tif (this.Phone) this.Phone.events(type, msg);\n\t\t});\n\n\t\tthis.on(this.app, \"updateCallTime\", time => this.UpdateCallTime(time));\n\n\t\tthis.on(this.State.$changes, \"callStatus\", status =>\n\t\t\tthis.HandleCallStatusChange(status)\n\t\t);\n\n\t\tthis.on(this.LocalState.$changes, \"remoteVideo\", () => this.ShowVideo());\n\t}\n\n\tGetAudioConfig(users) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tlocalId: \"audio\",\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_audio_time\",\n\t\t\t\t\tlocalId: \"audio-timer\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\treturn `${_(\"Active call\")} (${this.Helpers.normalizeTime(\n\t\t\t\t\t\t\tthis.time\n\t\t\t\t\t\t)})`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\theight: 270,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\tconst user = users.getItem(\n\t\t\t\t\t\t\tthis.State.callUsers[this.Initiator ? 1 : 0]\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst avatar = this.Helpers.avatar(\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\"webix_chat_call_avatar webix_chat_avatar\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tavatar + \"<p class='webix_chat_call_name'>\" + user.name + \"</p>\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"outgoing\",\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\theight: 30,\n\t\t\t\t\ttemplate: _(\"Ringing\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"income\",\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\theight: 30,\n\t\t\t\t\ttemplate: _(\"Is calling you\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"income\",\n\t\t\t\t\theight: 42,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Accept\"),\n\t\t\t\t\t\t\tcss: \"webix_chat_accept\",\n\t\t\t\t\t\t\tclick: () => this.AcceptCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Reject\"),\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\tclick: () => this.RejectCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"refresh\",\n\t\t\t\t\theight: 42,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Join call\"),\n\t\t\t\t\t\t\tcss: \"webix_chat_accept\",\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.AfterRefresh = false;\n\t\t\t\t\t\t\t\tthis.Start(true);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"End call\"),\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\tclick: () => this.EndCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tGetVideoConfig() {\n\t\treturn {\n\t\t\tlocalId: \"video\",\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_video_time\",\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlocalId: \"video-timer\",\n\t\t\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\t\t\treturn this.Helpers.normalizeTime(this.time);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\t\tlocalId: \"fullscreen-icon\",\n\t\t\t\t\t\t\ticon: \"chi-fullscreen\",\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.SetFullscreen(!this.fullscreen);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 6 },\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tGetActionsConfig() {\n\t\treturn {\n\t\t\theight: 80,\n\t\t\tcss: \"webix_chat_call_actions\",\n\t\t\tlocalId: \"call-actions\",\n\t\t\trows: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\theight: 44,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\toffIcon: \"chi-video-off\",\n\t\t\t\t\t\t\tonIcon: \"chi-video\",\n\t\t\t\t\t\t\tlocalId: \"video-toggle\",\n\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tclick: () => this.EnableVideo(true),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 32 },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\toffIcon: \"chi-audio-off\",\n\t\t\t\t\t\t\tonIcon: \"chi-audio\",\n\t\t\t\t\t\t\tlocalId: \"audio-toggle\",\n\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tvalue: true,\n\t\t\t\t\t\t\tclick: () => this.EnableAudio(true),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 32 },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\ticon: \"chi-hangup\",\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tclick: () => this.EndCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\t}\n\n\tControlVisibility(type, batch, actions) {\n\t\tconst view = this.$$(type);\n\t\tview.show();\n\t\tif (batch) view.showBatch(batch);\n\n\t\tthis.$$(\"call-actions\")[actions ? \"show\" : \"hide\"]();\n\t}\n\n\tSetFullscreen(fullscreen) {\n\t\twebix.fullscreen.exit();\n\n\t\tconst icon = this.$$(\"fullscreen-icon\");\n\t\ticon.config.icon = \"chi-fullscreen\" + (fullscreen ? \"-off\" : \"\");\n\t\ticon.refresh();\n\n\t\tthis.fullscreen = fullscreen\n\t\t\t? webix.fullscreen.set(this.$$(\"fullscreen\"), {\n\t\t\t\t\thead: false,\n\t\t\t\t\tcss: \"webix_chat_video_fullscreen\",\n\t\t\t  })\n\t\t\t: null;\n\t}\n\n\tStart(isAfterRefresh) {\n\t\tif (this.AfterRefresh) {\n\t\t\tthis.ControlVisibility(\"audio\", \"refresh\", false);\n\t\t} else {\n\t\t\tthis.ControlVisibility(\"audio\", \"active\", true);\n\t\t\tthis.InitPhone(this.Initiator, isAfterRefresh);\n\n\t\t\tif (this.LocalState.audio) this.EnableAudio();\n\n\t\t\tif (this.LocalState.video) this.EnableVideo();\n\t\t}\n\t}\n\n\tInitPhone(isInitiator, isAfterRefresh) {\n\t\tconst alist = this.$$(\"connection\").$view.querySelectorAll(\"audio\");\n\t\tconst vlist = this.$$(\"connection\").$view.querySelectorAll(\"video\");\n\t\tthis.Phone = phone(\n\t\t\tthis.SendSignal.bind(this),\n\t\t\tthis.app.config.rtcConfig || null,\n\t\t\t{\n\t\t\t\tlocal: { audio: alist[1], video: vlist[1] },\n\t\t\t\tremote: { audio: alist[0], video: vlist[0] },\n\t\t\t\tactive: {\n\t\t\t\t\tremote: {\n\t\t\t\t\t\tvideo: v => (this.LocalState.remoteVideo = v),\n\t\t\t\t\t\taudio: v => (this.LocalState.remoteAudio = v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tend: () => this.EndCall(),\n\t\t\t},\n\t\t\tisInitiator ? (isAfterRefresh ? 3 : 1) : isAfterRefresh ? 2 : 4,\n\t\t\t{ video: this.LocalState.video, audio: this.LocalState.audio },\n\t\t\tthis.app.getService(\"locale\")._\n\t\t);\n\t}\n\n\tEndCall() {\n\t\tthis.SetFullscreen(false);\n\t\tthis.getParam(\"state\", true).callStatus = this.callStatuses[\"drop\"];\n\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.end();\n\t\t\tthis.Phone = null;\n\t\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"end\"]);\n\t\t} else {\n\t\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"ignore\"]);\n\t\t}\n\t}\n\n\tAcceptCall() {\n\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"accept\"]);\n\t}\n\n\tRejectCall() {\n\t\tthis.getParam(\"state\", true).callStatus = this.callStatuses[\"drop\"];\n\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"reject\"]);\n\t}\n\n\tSendSignal(type, payload) {\n\t\t// rtc handler can trigger callback when view already destroyed\n\t\tif (this.app) {\n\t\t\tif (typeof payload !== \"string\") payload = JSON.stringify(payload);\n\t\t\treturn this.Back.signalCall(type, payload);\n\t\t}\n\t}\n\n\tEnableAudio(toggle) {\n\t\tconst v = toggle\n\t\t\t? (this.LocalState.audio = !this.LocalState.audio)\n\t\t\t: this.LocalState.audio;\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.enable(\"audio\", v).catch(() => {\n\t\t\t\tthis.LocalState.audio = false;\n\t\t\t\tthis.$$(\"audio-toggle\").setValue(false);\n\t\t\t});\n\t\t}\n\t}\n\n\tEnableVideo(toggle) {\n\t\tconst v = toggle\n\t\t\t? (this.LocalState.video = !this.LocalState.video)\n\t\t\t: this.LocalState.video;\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.enable(\"video\", v)\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.LocalState.video = false;\n\t\t\t\t\tthis.$$(\"video-toggle\").setValue(false);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.ShowVideo();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tCheckVideoVisibility() {\n\t\tconst remote = this.LocalState.remoteVideo;\n\t\tconst local = this.LocalState.video;\n\n\t\tlet visibility = [\"none\", \"none\", \"none\"];\n\t\tif (remote) {\n\t\t\tif (local) visibility = [\"none\", \"block\", \"block\"];\n\t\t\telse visibility = [\"block\", \"none\", \"block\"];\n\t\t} else if (local) visibility = [\"none\", \"block\", \"none\"];\n\n\t\t[this.localAvatar, this.localVideo, this.remoteVideo].forEach((node, i) => {\n\t\t\tnode.style.display = visibility[i];\n\t\t});\n\t}\n\n\tUpdateCallTime(time) {\n\t\tthis.time = time;\n\n\t\tif (this.fullscreen)\n\t\t\tthis.fullscreen.queryView({ localId: \"video-timer\" }).refresh();\n\t\telse if (this.$$(\"audio-timer\").isVisible())\n\t\t\tthis.$$(\"audio-timer\").refresh();\n\t\telse if (this.$$(\"video-timer\").isVisible())\n\t\t\tthis.$$(\"video-timer\").refresh();\n\t}\n\n\tHandleCallStatusChange(status) {\n\t\tif (status == this.callStatuses[\"init\"]) {\n\t\t\tthis.ControlVisibility(\n\t\t\t\t\"audio\",\n\t\t\t\tthis.Initiator ? \"outgoing\" : \"income\",\n\t\t\t\tthis.Initiator\n\t\t\t);\n\t\t} else if (status == this.callStatuses[\"active\"]) {\n\t\t\tthis.Start();\n\t\t} else if (\n\t\t\tstatus == this.callStatuses[\"reject\"] ||\n\t\t\tstatus == this.callStatuses[\"end\"] ||\n\t\t\tstatus == this.callStatuses[\"ignore\"] ||\n\t\t\tstatus == this.callStatuses[\"lost\"]\n\t\t) {\n\t\t\tif (this.Phone) {\n\t\t\t\tthis.SetFullscreen(false);\n\t\t\t\tthis.Phone.end();\n\t\t\t\tthis.Phone = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tShowVideo() {\n\t\tif (\n\t\t\tthis.State.callStatus == this.callStatuses[\"active\"] &&\n\t\t\t!this.AfterRefresh\n\t\t) {\n\t\t\tconst remote = this.LocalState.remoteVideo;\n\t\t\tconst audio = !this.LocalState.video && !remote;\n\n\t\t\tif (audio || !remote) {\n\t\t\t\tthis.SetFullscreen(false);\n\t\t\t\tthis.ControlVisibility(\"audio\", \"active\", true);\n\t\t\t} else if (!this.fullscreen) this.ControlVisibility(\"video\", \"\", true);\n\n\t\t\tthis.CheckVideoVisibility();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tconst avatarInput = {\n\t\t\tview: \"forminput\",\n\t\t\tname: \"avatar\",\n\t\t\tbody: {\n\t\t\t\tlocalId: \"avatar\",\n\t\t\t\tcss: \"webix_chat_form_avatar\",\n\t\t\t\twidth: 130,\n\t\t\t\theight: 130,\n\t\t\t\tborderless: true,\n\t\t\t\ttemplate: data => {\n\t\t\t\t\treturn helpers.formAvatar(data, _(\"Change avatar\"));\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_chat_avatar: () => {\n\t\t\t\t\t\tlet upload = this.app.getService(\"upload\");\n\t\t\t\t\t\tupload.config({\n\t\t\t\t\t\t\tupload: \"avatar/\" + webix.uid(),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tupload.fileDialog();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst nameInput = {\n\t\t\tname: \"name\",\n\t\t\tlocalId: \"name\",\n\t\t\tinputAlign: \"center\",\n\t\t\tview: \"text\",\n\t\t\twidth: 300,\n\t\t\tplaceholder: _(\"Chat name\"),\n\t\t\ton: {\n\t\t\t\tonChange: v => {\n\t\t\t\t\tthis.NameChangedHandler(v);\n\t\t\t\t},\n\t\t\t\tonTimedKeyPress: () => {\n\t\t\t\t\tthis.NameChangedHandler(this.$$(\"name\").getValue());\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst form = {\n\t\t\tpadding: 20,\n\t\t\tmargin: 20,\n\t\t\telementsConfig: {\n\t\t\t\tlabelWidth: 130,\n\t\t\t\tlabelAlign: \"right\",\n\t\t\t},\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tcss: \"webix_chat_newchat_form\",\n\t\t\telements: [\n\t\t\t\t{ align: \"center\", body: avatarInput },\n\t\t\t\t{ align: \"center\", body: nameInput },\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\t// uploader events\n\t\tconst upload = this.app.getService(\"upload\").getUploader();\n\t\tthis.on(upload, \"onAfterFileAdd\", data => {\n\t\t\tthis.UpdateAvatar(data);\n\t\t});\n\t\tthis.on(upload, \"onUploadComplete\", data => {\n\t\t\tthis.UpdateAvatar(data);\n\t\t});\n\n\t\tconst { name, avatar } = this.getParam(\"state\", true);\n\t\tthis.$$(\"form\").setValues({ name, avatar: { avatar } });\n\t}\n\n\tready() {\n\t\twebix.delay(() => {\n\t\t\tthis.$$(\"name\").focus();\n\t\t});\n\t}\n\n\tUpdateAvatar(data) {\n\t\tif (data.status === \"client\" && data.file) {\n\t\t\t// client-side preview\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tthis.SetLocalAvatar(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(data.file);\n\t\t} else if (data.status === \"server\") {\n\t\t\t// refresh picture after uploading, update data in form\n\t\t\tconst avatar = data.value;\n\t\t\tthis.$$(\"form\").setValues({ avatar }, true);\n\t\t\tthis.AvatarChangedHandler(avatar);\n\t\t\tthis.SetLocalAvatar(avatar);\n\t\t}\n\t}\n\n\tSetLocalAvatar(avatar) {\n\t\tthis.$$(\"avatar\").setValues({ avatar });\n\t}\n\n\tSetInitValues() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tconst { name, avatar } = state.values.form;\n\t\tif (name || avatar) {\n\t\t\tthis.$$(\"form\").setValues({ name, avatar: { avatar } });\n\t\t}\n\t}\n\n\tNameChangedHandler() {}\n\n\tAvatarChangedHandler() {}\n}\n","import { checkedIcon, notCheckedIcon } from \"./icons\";\n\nwebix.ui.datafilter.umMasterCheckox = webix.extend(\n\t{\n\t\trefresh: function(master, node, config) {\n\t\t\tnode.onclick = function() {\n\t\t\t\tconfig.checked = !config.checked;\n\t\t\t\tlet elem = node.querySelector(\".webix_icon\");\n\t\t\t\telem.className =\n\t\t\t\t\t\"webix_icon wxi-checkbox-\" + (config.checked ? \"marked\" : \"blank\");\n\t\t\t\tmaster.data.each(obj => (obj[config.columnId] = config.checked));\n\t\t\t\tmaster.refresh();\n\t\t\t\tmaster.callEvent(\"onCustomSave\", []);\n\t\t\t};\n\t\t},\n\t\trender: function(master, config) {\n\t\t\treturn config.checked ? checkedIcon : notCheckedIcon;\n\t\t},\n\t},\n\twebix.ui.datafilter.masterCheckbox\n);\n","export const checkedIcon =\n\t\"<span class='webix_icon wxi-checkbox-marked'></span>\";\nexport const notCheckedIcon =\n\t\"<span class='webix_icon wxi-checkbox-blank'></span>\";\n","import { JetView } from \"webix-jet\";\nimport \"../../../helpers/customcheckbox\";\n\nexport default class PeopleView extends JetView {\n\tconfig() {\n\t\tconst selectedList = {\n\t\t\tbatch: \"selected\",\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"selected\",\n\t\t\tautoheight: true,\n\t\t\tscroll: \"x\",\n\t\t\ttemplate: \"\",\n\t\t\tborderless: true,\n\t\t};\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"table\",\n\t\t\tcss: \"webix_chat_people_table\",\n\t\t\trowHeight: 60,\n\t\t\theaderRowHeight: Math.max(webix.skin.$active.barHeight - 2, 44),\n\t\t\tcolumns: this.GetColumns(),\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tby: \"name\",\n\t\t\t\t\tdir: \"asc\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tcheckboxRefresh: true,\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t\tonCustomSave: () => this.UpdatePeopleList(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tvisibleBatch: \"default\",\n\t\t\tmargin: 5,\n\t\t\trows: [selectedList, table],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").users();\n\t\tconst table = this.$$(\"table\");\n\t\tthis.Users = [].concat(this.getParam(\"state\", true).users);\n\n\t\t// to work with data copy\n\t\tthis.UsersStore = new webix.DataCollection({\n\t\t\tdata: [],\n\t\t});\n\t\tthis.UsersStore.data.attachEvent(\"onSyncApply\", () => {\n\t\t\ttable.clearAll();\n\t\t\ttable.parse(\n\t\t\t\tthis.UsersStore.data\n\t\t\t\t\t.serialize()\n\t\t\t\t\t.map(({ id, name, avatar, status }) => {\n\t\t\t\t\t\treturn { id, name, avatar, status };\n\t\t\t\t\t})\n\t\t\t\t\t.filter(a => a.id !== this.app.config.user)\n\t\t\t);\n\t\t\ttable.sort((a, b) => this.SortUsers(a, b));\n\t\t\tthis.LoadPeopleList();\n\t\t});\n\n\t\tthis.UsersStore.sync(users);\n\t}\n\tdestroy() {\n\t\tthis.UsersStore.destructor();\n\t\tthis.UsersStore = null;\n\t}\n\n\tGetColumns() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"selected\",\n\t\t\t\theader: {\n\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\tcolspan: 2,\n\t\t\t\t\tprepare: a => a.toLowerCase(),\n\t\t\t\t\tcompare: this.GetCompare(),\n\t\t\t\t},\n\t\t\t\twidth: 45,\n\t\t\t\tcssFormat: (_, obj) => {\n\t\t\t\t\tif (obj.selected) {\n\t\t\t\t\t\tlet isGroupUser = this.Users.indexOf(obj.id) >= 0;\n\t\t\t\t\t\treturn \"webix_chat_row_\" + (isGroupUser ? \"group_user\" : \"select\");\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t},\n\t\t\t\ttemplate: obj => {\n\t\t\t\t\treturn obj.selected ? helpers.checkedIcon : helpers.notCheckedIcon;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"name\",\n\t\t\t\theader: \"\",\n\t\t\t\ttemplate: user =>\n\t\t\t\t\thelpers.listAvatar(user, \"webix_chat_people_avatar\") + user.name,\n\t\t\t\tfillspace: 2,\n\t\t\t\tcssFormat: (_, obj) => {\n\t\t\t\t\tif (obj.selected) {\n\t\t\t\t\t\tlet isGroupUser = this.Users.indexOf(obj.id) >= 0;\n\t\t\t\t\t\treturn \"webix_chat_row_\" + (isGroupUser ? \"group_user\" : \"select\");\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\tGetCompare() {\n\t\treturn (value, searchValue, user) => {\n\t\t\treturn user.name.toLowerCase().indexOf(searchValue) > -1;\n\t\t};\n\t}\n\n\tGetPeopleList(selected) {\n\t\tselected.sort((a, b) => this.SortUsers(a, b));\n\t\treturn this.app\n\t\t\t.getService(\"helpers\")\n\t\t\t.peopleList(selected, false, this.Users);\n\t}\n\n\tSortUsers(a, b) {\n\t\tconst ai = this.Users.indexOf(a.id);\n\t\tconst bi = this.Users.indexOf(b.id);\n\n\t\t// previously added first\n\t\tif (ai >= 0 && bi < 0) return 1;\n\t\tif (bi >= 0 && ai < 0) return -1;\n\t\treturn a.name > b.name ? 1 : a.name < b.name ? -1 : 0;\n\t}\n\n\tToggle(id) {\n\t\tconst table = this.$$(\"table\");\n\t\tconst item = table.getItem(id);\n\t\ttable.updateItem(id, { selected: !item.selected });\n\t\tthis.UpdatePeopleList();\n\t}\n\n\tUpdatePeopleList() {\n\t\tlet selected = this.GetSelected();\n\t\tthis.SetBatch(selected.length ? \"selected\" : \"default\");\n\t\tlet html = this.GetPeopleList(selected);\n\t\tthis.$$(\"selected\").setHTML(html);\n\t\tlet state = this.getParam(\"state\", true);\n\t\tstate.users = this.GetSelectedIds();\n\t}\n\n\tLoadPeopleList() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tlet ids = state.users.filter(a => a !== this.app.config.user);\n\n\t\tif (ids && ids.length) {\n\t\t\tlet users = [];\n\t\t\tids.forEach(id => {\n\t\t\t\tlet item = this.$$(\"table\").getItem(id);\n\t\t\t\tusers.push(item);\n\t\t\t\titem.selected = true;\n\t\t\t});\n\t\t\tthis.SetBatch(\"selected\");\n\t\t\tlet html = this.GetPeopleList(users);\n\t\t\tthis.$$(\"selected\").setHTML(html);\n\t\t}\n\t}\n\n\tGetSelected() {\n\t\tlet selected = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row.selected) selected.push(row);\n\t\t});\n\t\treturn selected;\n\t}\n\n\tGetSelectedIds() {\n\t\tlet selected = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row.selected) selected.push(row.id);\n\t\t});\n\t\treturn selected;\n\t}\n\n\tSetBatch(batch) {\n\t\tif (batch) this.getRoot().showBatch(batch);\n\t\telse this.getRoot().showBatch(\"default\");\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class Toolbar extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\theight: Math.max(webix.skin.$active.toolbarHeight, 46),\n\t\t\tborderless: true,\n\t\t\tcols: [],\n\t\t};\n\t}\n\n\tinit() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tthis.on(state.$changes, \"toolbar\", () => {\n\t\t\tconst cols = state.toolbar.cols.map(a => this.ButtonFactory(a, state));\n\t\t\tthis.webix.ui(cols, this.getRoot());\n\t\t});\n\t}\n\n\tButtonFactory(id, state) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tswitch (id) {\n\t\t\tcase \"close\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = 0;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"back\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"chi-back\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = state.cursor - 1;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"start\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"chi-back\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"wizardStart\", []);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"label\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\tcss: \"webix_chat_wizard_title\",\n\t\t\t\t\tlabelAlign: \"center\",\n\t\t\t\t\tlabel:\n\t\t\t\t\t\ttypeof state.toolbar.label === \"function\"\n\t\t\t\t\t\t\t? state.toolbar.label()\n\t\t\t\t\t\t\t: state.toolbar.label,\n\t\t\t\t};\n\n\t\t\tcase \"edit\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tbatch: \"m1\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = state.cursor + 1;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"save\":\n\t\t\t\treturn {\n\t\t\t\t\tbatch: \"m2\",\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlabel: _(\"Save\"),\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"wizardSave\", []);\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { createState } from \"jet-restate\";\nimport Toolbar from \"./toolbar\";\n\nexport default class BaseWindow extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\tmove: true,\n\t\t\tfullscreen: this.Compact,\n\t\t\tposition: \"center\",\n\t\t\twidth: 450,\n\t\t\theight: 600,\n\t\t\tborderless: true,\n\t\t\thead: Toolbar,\n\t\t\tbody: {\n\t\t\t\t$subview: true,\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tconst id = this.getParam(\"id\") || 0;\n\t\tconst chat = id\n\t\t\t? this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.chats()\n\t\t\t\t\t.getItem(id)\n\t\t\t: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tname: \"\",\n\t\t\t\t\tusers: [],\n\t\t\t\t\tavatar: \"\",\n\t\t\t  };\n\n\t\tlet state = createState({\n\t\t\tcursor: 1,\n\t\t\ttoolbar: { label: \"\", cols: [] },\n\t\t\tchat: chat.id,\n\t\t\tname: chat.name,\n\t\t\tavatar: chat.avatar,\n\t\t\tusers: [].concat(chat.users),\n\t\t\tgroup: !chat.direct_id,\n\t\t});\n\t\tthis.setParam(\"state\", state);\n\n\t\tconst stages = this.stages();\n\t\tthis.on(state.$changes, \"cursor\", v => {\n\t\t\t// use delay to avoid hotkey handler call\n\t\t\t// for the new view that is shown after cursor change\n\t\t\twebix.delay(() => {\n\t\t\t\tif (!stages[v]) this.Close();\n\t\t\t\telse {\n\t\t\t\t\tthis.show(stages[v][0]);\n\t\t\t\t\tstate.toolbar = stages[v][1];\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.on(this.app, \"wizardSave\", () => {\n\t\t\tif (this.Save) {\n\t\t\t\tthis.Save();\n\t\t\t\tthis.Close();\n\t\t\t}\n\t\t});\n\t}\n\n\tClose() {\n\t\tthis.show(\"_hidden\", { target: \"top\" });\n\t}\n}\n","import FormBaseView from \"../common/form\";\n\nexport default class FormView extends FormBaseView {\n\tinit() {\n\t\tthis.on(this.app, \"wizardSave\", () => this.Save());\n\n\t\treturn super.init();\n\t}\n\n\tSave() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst ops = this.app.getService(\"operations\");\n\t\tconst form = this.$$(\"form\").getValues();\n\n\t\tops.updateChat(state.chat, form.name, form.avatar.avatar);\n\t\t// [NOT SURE] code doesn't wait server side confirmation\n\t\tstate.$batch({\n\t\t\tname: form.name,\n\t\t\tavatar: form.avatar.avatar,\n\t\t\tcursor: 1,\n\t\t});\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.info.info\",\n\t\t\t\t{\n\t\t\t\t\tlabel: () => this.getParam(\"state\").name,\n\t\t\t\t\tcols: [\"close\", \"label\", \"edit\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.info.form\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Edit chat\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"back\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.info.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"start\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.on(this.app, \"leaveChatClick\", () => {\n\t\t\tthis.LeaveChat();\n\t\t});\n\t}\n\n\tLeaveChat() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Leave chat\"),\n\t\t\t\tok: _(\"Leave\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to leave this chat?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst ops = this.app.getService(\"operations\");\n\t\t\t\tops.leaveChat(this.getParam(\"state\").chat);\n\t\t\t\tthis.Close();\n\t\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ChatInfo extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tthis.ShowAll = false;\n\t\tthis.MemberListMaxCount = 3;\n\t\tthis.CanAddUsers = state.group;\n\n\t\tconst chatAvatar = {\n\t\t\tlocalId: \"avatar\",\n\t\t\tcss: \"webix_chat_form_avatar\",\n\t\t\twidth: 130,\n\t\t\theight: 130,\n\t\t\tborderless: true,\n\t\t\ttemplate: data => {\n\t\t\t\treturn helpers.formAvatar(data, _(\"Avatar\"));\n\t\t\t},\n\t\t\tdata: { avatar: state.avatar },\n\t\t};\n\n\t\tconst membersList = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"members\",\n\t\t\tcss: \"webix_chat_list\",\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\ttype: {\n\t\t\t\theight: 60,\n\t\t\t\ttemplate: user => this.ListTemplate(user),\n\t\t\t\ttext: a => a.replace(/<[^>]*>/g, \"\"),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_chat_list_item_delete: (e, id) =>\n\t\t\t\t\tthis.DeleteMemberClickHandler(id),\n\t\t\t},\n\t\t};\n\n\t\tconst addMembersButton = {\n\t\t\tview: \"button\",\n\t\t\ttype: \"icon\",\n\t\t\twidth: 150,\n\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\ticon: \"wxi-plus\",\n\t\t\tlabel: \"Add members\",\n\t\t\tclick: () => (state.cursor = 3),\n\t\t};\n\n\t\tconst leaveChatButton = {\n\t\t\tview: \"button\",\n\t\t\tcss: \"webix_chat_delete_button\",\n\t\t\tlabel: _(\"Leave chat\"),\n\t\t\twidth: 130,\n\n\t\t\tclick: () => this.LeaveChat(),\n\t\t};\n\n\t\tconst form = [\n\t\t\t{\n\t\t\t\ttype: \"form\",\n\t\t\t\tcols: [{}, chatAvatar, {}],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"form\",\n\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\t\tlabel: _(\"Members\") + \" (\" + state.users.length + \")\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\taddMembersButton,\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tmembersList,\n\t\t\t\t\t{\n\t\t\t\t\t\tlocalId: \"showAllButton\",\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tautoheight: true,\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\ttemplate: `<span class=\"webix_chat_show_all_btn\">${_(\n\t\t\t\t\t\t\t\"Show all members\"\n\t\t\t\t\t\t)}</span>`,\n\t\t\t\t\t\tcss: \"webix_chat_show_all_tmpl\",\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_chat_show_all_btn: () => this.ShowAllMembers(state.users),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinputWidth: 150,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tif (state.group)\n\t\t\tform.push({\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\tcols: [leaveChatButton, {}],\n\t\t\t});\n\n\t\treturn {\n\t\t\tview: \"form\",\n\t\t\ttype: \"clean\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\telements: form,\n\t\t};\n\t}\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tif (this.$$(\"members\")) this.InitMembersList(state.users);\n\t\tthis.on(state.$changes, \"users\", v => this.Filter(v));\n\t}\n\n\tInitMembersList(users) {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst members = this.$$(\"members\");\n\t\tmembers.data.attachEvent(\"onSyncApply\", () => {\n\t\t\tmembers.data.sort((a, b) => this.Sort(a, b), \"asc\");\n\t\t\tthis.Filter(users);\n\t\t});\n\t\tmembers.sync(local.users());\n\t}\n\n\tListTemplate(user) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tlet youText =\n\t\t\tuser.id == this.app.config.user\n\t\t\t\t? \" (<span class='webix_chat_list_you_text'>\" + _(\"You\") + \"</span>)\"\n\t\t\t\t: \"\";\n\t\treturn (\n\t\t\tthis.app.getService(\"helpers\").listAvatar(user) +\n\t\t\tuser.name +\n\t\t\tyouText +\n\t\t\tthis.DeleteButtonTemplate(user)\n\t\t);\n\t}\n\n\tDeleteButtonTemplate(user) {\n\t\tlet html = \"\";\n\t\tif (user.id != this.app.config.user && this.CanAddUsers) {\n\t\t\thtml =\n\t\t\t\t\"<button type='button' class='webix_icon_button webix_chat_list_item_delete'>\" +\n\t\t\t\t\"<span class='webix_icon wxi-close'></span>\" +\n\t\t\t\t\"</button>\";\n\t\t}\n\t\treturn html;\n\t}\n\n\tSort(a, b) {\n\t\tif (b.id == this.app.config.user) return 1;\n\t\tif (a.id == this.app.config.user) return -1;\n\t\treturn a.name > b.name ? 1 : -1;\n\t}\n\n\tShowAllMembers(users) {\n\t\tthis.ShowAll = true;\n\t\tthis.Filter(users);\n\t\tthis.$$(\"showAllButton\").hide();\n\t}\n\n\tFilter(users) {\n\t\tthis.MemberListCount = 0;\n\t\tthis.$$(\"members\").data.filter(user => {\n\t\t\tconst isDirect = user.direct_id == user.id;\n\t\t\tconst groupMember = users && users.indexOf(user.id) > -1;\n\t\t\tlet result = isDirect || groupMember;\n\t\t\tif (result && !this.ShowAll) {\n\t\t\t\tthis.MemberListCount++;\n\t\t\t}\n\t\t\treturn result && this.MemberListCount <= this.MemberListMaxCount;\n\t\t});\n\t\tif (this.MemberListCount > this.MemberListMaxCount)\n\t\t\tthis.$$(\"showAllButton\").show();\n\t}\n\n\tDeleteMemberClickHandler(id) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ops = this.app.getService(\"operations\");\n\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete member\"),\n\t\t\t\tok: _(\"Delete\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to delete this member?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst state = this.getParam(\"state\", true);\n\t\t\t\tstate.users = state.users.filter(a => a != id);\n\t\t\t\tops.setUsers(state.chat, state.users);\n\t\t\t});\n\t}\n\n\tLeaveChat() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Leave chat\"),\n\t\t\t\tok: _(\"Leave\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to leave this chat?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst ops = this.app.getService(\"operations\");\n\t\t\t\tconst state = this.getParam(\"state\", true);\n\t\t\t\tops.leaveChat(state.chat);\n\t\t\t\t//force wizard closing\n\t\t\t\tstate.cursor = 0;\n\t\t\t});\n\t}\n}\n","import PeopleBaseView from \"../common/people\";\n\nexport default class PeopleView extends PeopleBaseView {\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tthis._users = [].concat(state.users);\n\n\t\tthis.on(this.app, \"wizardStart\", () => this.Back());\n\t\tthis.on(this.app, \"wizardSave\", () => this.Save());\n\n\t\treturn super.init();\n\t}\n\tSave() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst ops = this.app.getService(\"operations\");\n\n\t\tops.setUsers(state.chat, state.users);\n\t\t// [NOT SURE] code doesn't wait server side confirmation\n\t\tstate.cursor = 1;\n\t}\n\tBack() {\n\t\tthis.getParam(\"state\", true).$batch({ cursor: 1, users: this._users });\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.common.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"close\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\n\tSave() {\n\t\t// view will be destroyed till the the op callback\n\t\tconst app = this.app;\n\t\tconst state = this.getParam(\"state\");\n\t\tif (state.users.length) {\n\t\t\tapp.getService(\"operations\").setUsers(state.chat, state.users);\n\t\t}\n\t}\n}\n","import FormBaseView from \"../common/form\";\n\nexport default class FormView extends FormBaseView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst form = super.config(true);\n\n\t\tconst nextButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"next\",\n\t\t\ttype: \"icon\",\n\t\t\thotkey: \"enter\",\n\t\t\ticon: \"chi-next\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: `<span class=\"webix_chat_next_text\">${_(\"People\")}</span>`,\n\t\t\twidth: 160,\n\t\t\tdisabled: true,\n\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\talign: \"center\",\n\t\t\tclick: () => {\n\t\t\t\tthis.ShowNextPage();\n\t\t\t},\n\t\t};\n\n\t\tform.elements.push({ align: \"right\", body: nextButton });\n\t\treturn form;\n\t}\n\n\tShowNextPage() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tconst form = this.$$(\"form\").getValues();\n\n\t\tstate.name = form.name;\n\t\t// forminput returns avatar: { avatar: key }\n\t\tstate.avatar = form.avatar.avatar;\n\t\tstate.cursor = state.cursor + 1;\n\t}\n\n\tNameChangedHandler(value) {\n\t\tconst next = this.$$(\"next\");\n\t\tif (value) next.enable();\n\t\telse next.disable();\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.new.form\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title1\">${_(\n\t\t\t\t\t\t\"New chat\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"close\", \"label\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.common.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"back\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\n\tSave() {\n\t\t// view will be destroyed till the the op callback\n\t\tconst app = this.app;\n\t\tconst { name, avatar, users } = this.getParam(\"state\");\n\t\tif (users && users.length)\n\t\t\tapp\n\t\t\t\t.getService(\"operations\")\n\t\t\t\t.addGroupChat(name, avatar, users)\n\t\t\t\t.then(cid => app.callEvent(\"showChat\", [\"chat\", cid]));\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ListView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"list\",\n\t\t\tselect: true,\n\t\t\tcss: \"webix_chat_list\",\n\t\t\ttype: {\n\t\t\t\theight: 60,\n\t\t\t\ttemplate: (data, common) => {\n\t\t\t\t\treturn this.ListTemplate(data, common);\n\t\t\t\t},\n\t\t\t\ttext: a => a.replace(/<[^>]*>/g, \"\"),\n\t\t\t},\n\t\t};\n\t}\n\n\tInitSelf(data, filter) {\n\t\tconst list = this.$$(\"list\");\n\t\tlist.data.attachEvent(\"onSyncApply\", () => {\n\t\t\tthis.ApplySearchValue();\n\t\t\tthis.SyncHandler();\n\t\t});\n\t\tlist.sync(data, filter || null);\n\t\tlist.attachEvent(\"onAfterSelect\", id => {\n\t\t\tthis.SelectHandler(id);\n\t\t});\n\n\t\tthis.on(this.app.getState().$changes, \"search\", v => {\n\t\t\tthis.Find(v);\n\t\t});\n\t}\n\n\tSyncHandler() {}\n\n\tSelectHandler() {}\n\n\tListTemplate(item) {\n\t\treturn item.name;\n\t}\n\n\tEscapeRegExp(text) {\n\t\treturn text.replace(/[[\\]{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n\t}\n\n\tApplySearchValue() {\n\t\tconst searchValue = this.app.getState().search;\n\t\tif (searchValue) this.Find(searchValue);\n\t}\n\n\t/* filters table by input text and highlights occurrences*/\n\tFind(text) {\n\t\tlet list = this.$$(\"list\");\n\t\tthis.EscapedSearchText = this.EscapeRegExp(text || \"\");\n\n\t\tif (text) {\n\t\t\ttext = text.toLowerCase();\n\t\t\tlist.filter(data => this.SearchCompare(text, data));\n\t\t} else list.filter();\n\t}\n\n\tSearchCompare(value, item) {\n\t\treturn item.name.toLowerCase().indexOf(value) > -1;\n\t}\n\n\tSelect(id) {\n\t\tconst list = this.$$(\"list\");\n\t\tif (id != list.getSelectedId() && list.getItem(id)) list.select(id);\n\t}\n}\n","import ListView from \"./list\";\n\nconst MessageCallEnd = 900;\nconst MessageCallRejected = 901;\nconst MessageCallMissed = 902;\n\nexport default class chatsView extends ListView {\n\tconfig() {\n\t\tconst limited = this.app.config.mode === \"limited\";\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = super.config();\n\t\tconst bottomForm = {\n\t\t\tpadding: 9,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\tcss: \"webix_chat_add_button\",\n\t\t\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tlabel: _(\"New chat\"),\n\t\t\t\t\tclick: () => this.app.callEvent(\"newChat\", []),\n\t\t\t\t\thidden: limited,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [ui, bottomForm],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getParam(\"state\", true);\n\t\tconst chats = this.app.getService(\"local\").chats();\n\t\tthis.InitSelf(chats);\n\n\t\t// wait data loading, so list will contain something to select\n\t\tchats.waitData.then(() => {\n\t\t\t// allow to change selected chat through API\n\t\t\tthis.on(state.$changes, \"chatId\", id => {\n\t\t\t\tif (id) this.ShowChat(id);\n\t\t\t\telse this.$$(\"list\").unselectAll();\n\t\t\t});\n\t\t});\n\t}\n\n\tShowChat(id) {\n\t\tthis.app.callEvent(\"showChat\", [\"chat\", id * 1]);\n\t}\n\n\tListTemplate(chat, common) {\n\t\tconst locale = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tlet html = \"\";\n\t\thtml += helpers.listAvatar(chat);\n\t\thtml += \"<div class='webix_chat_listitem_block'>\";\n\t\thtml += `<div class='webix_chat_listitem_name'>${helpers.addTextMark(\n\t\t\tchat.name,\n\t\t\tthis.EscapedSearchText\n\t\t)}</div>`;\n\t\tif (chat.date)\n\t\t\thtml += `<span class='webix_chat_listitem_date'>${helpers.dateChatFormat(\n\t\t\t\tchat.date\n\t\t\t)}</span>`;\n\t\tif (chat.unread_count) {\n\t\t\tlet css = \"webix_chat_listitem_number\";\n\t\t\tif (chat.unread_count > 9) css += \" webix_chat_listitem_number_wide\";\n\t\t\thtml += `<span class='${css}'>${chat.unread_count}</span>`;\n\t\t}\n\t\tif (chat.message_type) {\n\t\t\thtml += \"<div class='webix_chat_listitem_message'>\";\n\t\t\tswitch (chat.message_type) {\n\t\t\t\tcase MessageCallEnd:\n\t\t\t\t\thtml += locale(\"Ended call\") + \" (\" + chat.message + \")\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageCallRejected:\n\t\t\t\t\thtml += locale(\"Rejected call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageCallMissed:\n\t\t\t\t\thtml += locale(\"Missed call\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\thtml += \"</div>\";\n\t\t} else if (chat.message) {\n\t\t\thtml += \"<div class='webix_chat_listitem_message'>\";\n\t\t\thtml += common.text(chat.message);\n\t\t\thtml += \"</div>\";\n\t\t}\n\n\t\treturn html + \"</div>\";\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"chat-search\",\n\t\t$cssName: \"search\",\n\t\ton_click: {\n\t\t\twebix_input_icon: function(e) {\n\t\t\t\tconst css = e.target.className;\n\t\t\t\tif (css.indexOf(this.config.closeIcon) > -1) {\n\t\t\t\t\tthis.getInputNode().focus();\n\t\t\t\t\tthis.setValue(\"\");\n\t\t\t\t\tthis.callEvent(\"onCloseIconClick\", [e]);\n\t\t\t\t\tthis.hideCloseIcon();\n\t\t\t\t} else {\n\t\t\t\t\tthis.getInputNode().focus();\n\t\t\t\t\tthis.callEvent(\"onSearchIconClick\", [e]);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tsetIcon(icon) {\n\t\t\tconst nodes = this.$view.getElementsByClassName(\"webix_input_icon\");\n\t\t\tif (nodes.length) nodes[0].className = \"webix_input_icon \" + icon;\n\t\t},\n\t\tshowCloseIcon() {\n\t\t\tthis.setIcon(this.config.closeIcon);\n\t\t},\n\t\thideCloseIcon() {\n\t\t\tthis.setIcon(this.config.icon);\n\t\t},\n\t\tdefaults: {\n\t\t\tcloseIcon: \"wxi-close\",\n\t\t},\n\t},\n\twebix.ui.search\n);\n","import { JetView } from \"webix-jet\";\nimport \"../helpers/search\";\n\nexport default class SideBar extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst tabbar = {\n\t\t\tview: \"tabbar\",\n\t\t\tcss: \"webix_chat_tabbar\",\n\t\t\theight: 52,\n\t\t\tbottomOffset: 0,\n\t\t\t//type: \"icon\",\n\t\t\toptions: [\n\t\t\t\t{ value: _(\"Chats\"), id: \"chats\" },\n\t\t\t\t{ value: _(\"Users\"), id: \"users\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: v => this.ShowPanel(v),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\ttabbar,\n\t\t\t{\n\t\t\t\tpadding: 9,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"chat-search\",\n\t\t\t\t\t\tlocalId: \"search\",\n\t\t\t\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"left\",\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcss: \"webix_chat_sidebar\",\n\t\t\twidth: 320,\n\t\t\ttype: \"clean\",\n\t\t\trows,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.ShowPanel(\"chats\");\n\n\t\tthis.$$(\"search\").attachEvent(\"onTimedKeyPress\", () => {\n\t\t\tthis.State.search = this.$$(\"search\").getValue();\n\t\t});\n\t\tthis.$$(\"search\").attachEvent(\"onChange\", () => {\n\t\t\tthis.State.search = this.$$(\"search\").getValue();\n\t\t});\n\t\tthis.on(this.State.$changes, \"search\", v => {\n\t\t\tif (v) this.$$(\"search\").showCloseIcon();\n\t\t\telse {\n\t\t\t\tthis.$$(\"search\").setValue(\"\");\n\t\t\t\tthis.$$(\"search\").hideCloseIcon();\n\t\t\t}\n\t\t});\n\t}\n\n\tShowPanel(v) {\n\t\tthis.State.search = \"\";\n\t\tthis.show(\"./\" + v, { target: \"left\" });\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nimport SideBar from \"../sidebar\";\n\nexport default class SideMenu extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"sidemenu\",\n\t\t\twidth: 320,\n\t\t\tposition: \"left\",\n\t\t\tstate: state => {\n\t\t\t\tstate.left = this.Parent.left;\n\t\t\t\t(state.top = this.Parent.top), (state.height = this.Parent.height);\n\t\t\t},\n\t\t\tbody: SideBar,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.on(this.app, \"top:navigation\", () => {\n\t\t\tthis.getRoot().hide();\n\t\t});\n\t}\n\tShow(box) {\n\t\tif (this.getRoot().isVisible()) return;\n\n\t\tthis.Parent = box;\n\t\tthis.webix.delay(() => this.getRoot().show());\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class Toolbar extends JetView {\n\tconfig() {\n\t\tconst config = this.app.config;\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst mode = config.mode;\n\t\tthis.Limited = mode === \"single\" || mode === \"limited\";\n\n\t\tconst width = Math.max(webix.skin.$active.inputHeight, 38);\n\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\tlocalId: \"toolbar\",\n\t\t\tvisibleBatch: \"active\",\n\t\t\theight: 50,\n\t\t\tcss: \"webix_chat_toolbar\",\n\t\t\tpadding: {\n\t\t\t\tright: 5,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"webix_icon chi-menu\",\n\t\t\t\t\tclick: () => this.app.callEvent(\"showSidebar\", []),\n\t\t\t\t\thidden: !this.Compact || mode === \"single\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tlocalId: \"chatTitle\",\n\t\t\t\t\tcss: \"webix_chat_toolbar_tmpl\",\n\t\t\t\t\tname: \"chatTitle\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\ttemplate: data => this.TitleTemplate(data),\n\t\t\t\t\tonClick: {\n\t\t\t\t\t\twebix_chat_title: () => {\n\t\t\t\t\t\t\tthis.ChatInfoHandler();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"chi-video\",\n\t\t\t\t\ttooltip: _(\"Start call\"),\n\t\t\t\t\tlocalId: \"call\",\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.StartCallHandler();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"chi-account-plus\",\n\t\t\t\t\ttooltip: _(\"Add members\"),\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.NewMembersHandler();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"wxi-dots\",\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: (id, ev) => {\n\t\t\t\t\t\tthis.ToggleMenu(ev);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tthis.State = state;\n\n\t\tconst chats = this.app.getService(\"local\").chats();\n\t\tchats.data.attachEvent(\"onStoreUpdated\", id => {\n\t\t\tif (!id || id == state.chatId) {\n\t\t\t\tthis.Refresh();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(state.$changes, \"*\", () => {\n\t\t\tthis.Refresh();\n\t\t});\n\n\t\tthis.InitMenu();\n\t}\n\n\tRefresh() {\n\t\tconst state = this.State;\n\t\tif (!this.getRoot()) return false;\n\t\tconst local = this.app.getService(\"local\");\n\t\tlet obj;\n\n\t\tif (state.chatId) {\n\t\t\tconst chats = local.chats();\n\t\t\tobj = chats.getItem(state.chatId);\n\t\t} else {\n\t\t\tconst users = local.users();\n\t\t\tobj = users.getItem(state.userId);\n\t\t}\n\n\t\tobj = obj || {};\n\n\t\tthis.$$(\"chatTitle\").setValues(obj);\n\n\t\tif (obj.direct_id && this.app.config.calls) this.$$(\"call\").show();\n\t\telse this.$$(\"call\").hide();\n\n\t\tconst t = this.$$(\"toolbar\");\n\t\tif (state.chatId && !this.Limited) t.showBatch(\"active\");\n\t\telse t.showBatch(\"inactive\");\n\t}\n\n\tTitleTemplate(data) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\t\tlet result = \"\";\n\t\tif (data.name) {\n\t\t\tresult += helpers.listAvatar(data, \"webix_chat_toolbar_avatar\");\n\t\t\tif (data.users) {\n\t\t\t\tlet members = data.users.length + \" \" + _(\"members\");\n\t\t\t\tresult += \"<div class='webix_chat_title'>\";\n\t\t\t\tif (data.direct_id)\n\t\t\t\t\tresult += `<span class=\"webix_chat_messages_chat_name\">${data.name}</span>`;\n\t\t\t\telse\n\t\t\t\t\tresult +=\n\t\t\t\t\t\t`<div class=\"webix_chat_messages_groupchat_name\">${data.name}</div>` +\n\t\t\t\t\t\t`<div class=\"webix_chat_messages_groupchat_members\">${members}</div>`;\n\t\t\t\tresult += \"</div>\";\n\t\t\t} else\n\t\t\t\tresult += `<span class=\"webix_chat_messages_user_name\">${data.name}</span>`;\n\t\t}\n\t\treturn result;\n\t}\n\n\tToggleMenu(ev) {\n\t\tif (this.ToolbarMenu.isVisible()) this.ToolbarMenu.hide();\n\t\telse this.ToolbarMenu.show(ev.target, { pos: \"left\", y: 30, x: 10 });\n\t}\n\n\tInitMenu() {\n\t\tthis.ToolbarMenu = this.ui({\n\t\t\tview: \"contextmenu\",\n\t\t\tautowidth: true,\n\t\t\tpoint: false,\n\t\t\tdata: this.GetMenuData(),\n\t\t\ton: {\n\t\t\t\tonItemClick: id => {\n\t\t\t\t\tif (this.ToolbarMenu.callEvent(\"onBeforeMenuAction\", [id])) {\n\t\t\t\t\t\tif (id == \"info\") this.ChatInfoHandler();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\treturn this.ToolbarMenu;\n\t}\n\tGetMenuData() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [{ id: \"info\", value: _(\"Chat info\") }];\n\t}\n\n\tChatInfoHandler() {\n\t\tif (this.State.chatId && !this.Limited)\n\t\t\tthis.app.callEvent(\"chatInfo\", [this.State.chatId]);\n\t}\n\tNewMembersHandler() {\n\t\tthis.app.callEvent(\"newMembers\", [this.State.chatId]);\n\t}\n\tStartCallHandler() {\n\t\tthis.app.callEvent(\"startCall\", [\n\t\t\tthis.State.userId || this.State.chatId,\n\t\t\tthis.State.chatId || 0,\n\t\t]);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport Toolbar from \"./toolbar\";\n\nexport default class MessagesView extends JetView {\n\tconfig() {\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tconst ui = {\n\t\t\tview: \"comments\",\n\t\t\tsendAction: \"enter\",\n\t\t\tlocalId: \"comments\",\n\t\t\tcurrentUser: this.app.config.user,\n\t\t\tusers: new webix.DataCollection({\n\t\t\t\tdata: [],\n\t\t\t\tscheme: {\n\t\t\t\t\t$init: user => {\n\t\t\t\t\t\tuser.value = user.name;\n\t\t\t\t\t\tuser.image = user.avatar;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tlistItem: {\n\t\t\t\ttemplateText: obj => this.MessageTemplateText(obj),\n\t\t\t\ttemplateMenu: obj => this.MessageTemplateMenu(obj),\n\t\t\t\ttemplateUser: obj => this.MessageTemplateUser(obj),\n\t\t\t\ttemplateAvatar: obj => this.MessageTemplateAvatar(obj),\n\t\t\t\ttemplateDate: obj => this.MessageTemplateDate(obj),\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\trows: [Toolbar, ui],\n\t\t};\n\t}\n\n\tinit() {\n\t\t// this.Comments will be used in UI template\n\t\tconst comments = (this.Comments = this.$$(\"comments\"));\n\n\t\t// services\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Back = this.app.getService(\"backend\");\n\t\tconst serverEvents = this.Back.pubsub();\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tcomments.getUsers().sync(this.Local.users());\n\t\tcomments.attachEvent(\"onAfterAdd\", cid => {\n\t\t\tconst obj = comments.getItem(cid);\n\n\t\t\tif (!obj.chat_id) {\n\t\t\t\tconst userId = this.State.userId;\n\n\t\t\t\t// show typed value as text, not as HTML tags\n\t\t\t\tconst formatted = obj.text.replace(/</g, \"&lt;\");\n\t\t\t\tif (formatted !== obj.text) {\n\t\t\t\t\tcomments.updateItem(cid, { text: formatted });\n\t\t\t\t}\n\n\t\t\t\tif (this.State.chatId) {\n\t\t\t\t\tthis.AddMessage(this.State.chatId, obj.text, cid);\n\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t} else if (userId) {\n\t\t\t\t\tcomments.disable();\n\t\t\t\t\tthis.Ops.addChat(userId)\n\t\t\t\t\t\t.then(chatId => this.AddMessage(chatId, obj.text, cid))\n\t\t\t\t\t\t.then(() => this.app.callEvent(\"showChat\", [\"user\", userId]));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tcomments.attachEvent(\"onBeforeDelete\", id => {\n\t\t\tif (this.IsUsersMessage(comments.getItem(id))) {\n\t\t\t\tthis.Ops.removeMessage(id);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\tcomments.attachEvent(\"onDataUpdate\", (id, msg) => {\n\t\t\tif (this.IsUsersMessage(msg)) this.Ops.updateMessage(id, msg.text);\n\t\t});\n\n\t\tthis.on(this.app, \"showChat\", () => {\n\t\t\tconst chats = this.Local.chats();\n\t\t\tchats.waitData.then(() => {\n\t\t\t\tif (this.getRoot())\n\t\t\t\t\tthis.FilterUsers(\n\t\t\t\t\t\tcomments.getUsers(),\n\t\t\t\t\t\tchats,\n\t\t\t\t\t\tthis.State.chatId,\n\t\t\t\t\t\tthis.State.userId\n\t\t\t\t\t);\n\t\t\t});\n\t\t});\n\n\t\tthis.on(serverEvents, \"messages\", pack => {\n\t\t\tconst { op, origin, msg } = pack;\n\n\t\t\tif (msg.chat_id != this.State.chatId) return;\n\n\t\t\tswitch (op) {\n\t\t\t\tcase \"add\":\n\t\t\t\t\tmsg.date = new Date(msg.date);\n\t\t\t\t\t// recent message saved\n\t\t\t\t\tif (comments.exists(origin)) {\n\t\t\t\t\t\tcomments.queryView(\"list\").data.changeId(origin, msg.id);\n\t\t\t\t\t\tcomments.updateItem(msg.id, msg);\n\t\t\t\t\t\t// new message added\n\t\t\t\t\t} else if (!comments.exists(msg.id)) {\n\t\t\t\t\t\tcomments.add(msg);\n\t\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"remove\":\n\t\t\t\t\tif (comments.exists(msg.id)) comments.remove(msg.id);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"update\":\n\t\t\t\t\tmsg.date = new Date(msg.date);\n\t\t\t\t\tif (comments.exists(msg.id)) comments.updateItem(msg.id, msg);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"chatId\", () => {\n\t\t\tthis.LoadChat(this.State.chatId, this.State.userId);\n\t\t});\n\t}\n\n\tIsUsersMessage(msg) {\n\t\treturn msg.user_id == this.app.config.user && (!msg.type || msg.type < 900);\n\t}\n\n\tAddMessage(chatId, text, messageId) {\n\t\treturn this.Ops.addMessage(chatId, messageId, text).then(msg => {\n\t\t\tif (this.Comments.exists(messageId))\n\t\t\t\tthis.Comments.queryView(\"list\").data.changeId(messageId, msg.id);\n\t\t});\n\t}\n\n\tScrollToBottom() {\n\t\tconst list = this.$$(\"comments\").queryView(\"list\");\n\t\tlist.showItem(list.getLastId());\n\t}\n\n\tLoadChat(id, userId) {\n\t\tconst comments = this.$$(\"comments\");\n\n\t\t// detach old chat\n\t\tcomments.clearAll();\n\t\tif (id || userId) {\n\t\t\tcomments.enable();\n\t\t\tif (id)\n\t\t\t\tthis.Local.messages(id).then(data => {\n\t\t\t\t\tif (!this.getRoot()) return;\n\t\t\t\t\tcomments.parse(data);\n\t\t\t\t\tthis.Ops.resetCounter(id);\n\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t});\n\t\t\tthis.Focus();\n\t\t} else {\n\t\t\tcomments.disable();\n\t\t}\n\t}\n\n\tFilterUsers(users, chats, chatId, userId) {\n\t\tconst chat = chatId ? chats.getItem(chatId) : null;\n\t\tusers.data.filter(user => {\n\t\t\tif (chatId)\n\t\t\t\treturn (\n\t\t\t\t\tchat &&\n\t\t\t\t\t(chat.users.indexOf(user.id) >= 0 && user.id != this.app.config.user)\n\t\t\t\t);\n\t\t\treturn user.id == userId;\n\t\t});\n\t}\n\n\tFocus() {\n\t\twebix.delay(() => {\n\t\t\tif (this.getRoot()) this.Comments.focus();\n\t\t});\n\t}\n\n\tMessageTemplateText(obj) {\n\t\tlet text = obj.text;\n\t\tlet type = obj.type;\n\t\tif (obj.type) {\n\t\t\tconst outgoing = this.State.userId == obj.user_id;\n\t\t\tconst arrow = \"chi-arrow-\" + (outgoing ? \"bottom-left\" : \"top-right\");\n\t\t\tconst locale = this.app.getService(\"locale\")._;\n\t\t\tlet message;\n\t\t\tswitch (type) {\n\t\t\t\tcase 900:\n\t\t\t\t\tmessage = outgoing\n\t\t\t\t\t\t? locale(\"Incoming call\")\n\t\t\t\t\t\t: locale(\"Outgoing call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 901:\n\t\t\t\t\tmessage = locale(\"Rejected call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 902:\n\t\t\t\t\tmessage = locale(\"Missed call\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttext =\n\t\t\t\t\"<span class = 'webix_chat_call_type \" +\n\t\t\t\tarrow +\n\t\t\t\t\" webix_chat_call_type_\" +\n\t\t\t\tthis.Back.callMessages[type] +\n\t\t\t\t\"'></span>\" +\n\t\t\t\t\"<div class = 'webix_chat_call_message'>\" +\n\t\t\t\tmessage +\n\t\t\t\t\"<p>\" +\n\t\t\t\ttext +\n\t\t\t\t\"</p></div>\";\n\t\t}\n\t\treturn \"<div class = 'webix_comments_message'>\" + text + \"</div>\";\n\t}\n\n\tMessageTemplateAvatar(obj) {\n\t\tlet html = \"<div class='webix_chat_list_avatar'>\";\n\t\tconst users = this.Comments.getUsers();\n\t\tconst user =\n\t\t\tusers && users.exists(obj.user_id) ? users.getItem(obj.user_id) : {};\n\t\tif (user.status) html += this.Helpers.status(user);\n\t\thtml += this.Helpers.avatar(user);\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t}\n\n\tMessageTemplateUser(obj) {\n\t\tconst users = this.Comments.getUsers();\n\t\tlet user =\n\t\t\tusers && users.exists(obj.user_id) ? users.getItem(obj.user_id) : {};\n\n\t\treturn (\n\t\t\t\"<span class = 'webix_comments_name'>\" + (user.name || \"\") + \"</span>\"\n\t\t);\n\t}\n\n\tMessageTemplateMenu(obj) {\n\t\treturn this.Comments.config.readonly || obj.type >= 900\n\t\t\t? \"\"\n\t\t\t: \"<span class='webix_icon wxi-dots webix_comments_menu'></span>\";\n\t}\n\n\tMessageTemplateDate(obj) {\n\t\treturn obj.date\n\t\t\t? \"<span class='webix_comments_date'>\" +\n\t\t\t\t\tthis.Helpers.dateChatFormat(obj.date) +\n\t\t\t\t\t\"</span>\"\n\t\t\t: \"\";\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\nimport \"../helpers/search\";\n\nimport SideBar from \"./sidebar\";\nimport SideMenu from \"./compact/sidemenu\";\nimport \"../helpers/responsive\";\n\nexport default class TopView extends JetView {\n\tconfig() {\n\t\tconst isSingle = this.app.config.mode === \"single\";\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tconst isForced = typeof fCompact !== \"undefined\" || isSingle;\n\n\t\tif (isForced) this.setParam(\"compact\", fCompact || isSingle);\n\t\tthis.Compact = this.getParam(\"compact\");\n\n\t\tlet cols = this.Compact\n\t\t\t? [{ $subview: true, name: \"center\" }]\n\t\t\t: [\n\t\t\t\t\tSideBar,\n\t\t\t\t\t{ $subview: true, name: \"center\" },\n\t\t\t\t\t{ $subview: \"_hidden\", name: \"panel\" },\n\t\t\t  ];\n\n\t\treturn {\n\t\t\tview: isForced ? \"layout\" : \"r-layout\",\n\t\t\tid: \"main\",\n\t\t\trows: [{ cols }, { $subview: true, name: \"top\", popup: true }],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst local = this.app.getService(\"local\");\n\n\t\t// responsive UI\n\t\tconst root = this.getRoot();\n\t\tif (root.sizeTrigger)\n\t\t\troot.sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\tthis.ShowDefaultChat();\n\n\t\tthis.on(this.app, \"showSidebar\", () => this.ShowSidebar());\n\n\t\tthis.on(this.app, \"showChat\", (type, id) => {\n\t\t\tlet userId = null;\n\t\t\tif (type === \"user\") {\n\t\t\t\tuserId = id;\n\t\t\t\t// check if we have such chat already\n\t\t\t\tlet chat = local.chats().find(a => a.direct_id == id, true);\n\t\t\t\tid = chat ? chat.id : null;\n\t\t\t} else {\n\t\t\t\t// check, is it user chat\n\t\t\t\tlet chat = local.chats().getItem(id);\n\t\t\t\tif (chat.direct_id) {\n\t\t\t\t\ttype = \"user\";\n\t\t\t\t\tuserId = chat.direct_id;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.ShowChat(type, id, userId);\n\t\t});\n\n\t\tthis.on(this.app, \"leaveChat\", chatId => {\n\t\t\tthis.LeaveChat(chatId);\n\t\t});\n\t\tthis.on(this.app, \"removeChatMember\", chatId => {\n\t\t\tthis.LeaveChat(chatId, true);\n\t\t});\n\n\t\tthis.on(this.app, \"newChat\", () => {\n\t\t\tthis.ShowChatWindow();\n\t\t});\n\t\tthis.on(this.app, \"chatInfo\", id => {\n\t\t\tthis.ShowChatInfo(id);\n\t\t});\n\t\tthis.on(this.app, \"newMembers\", id => {\n\t\t\tthis.ShowNewMembersWindow(id);\n\t\t});\n\t\tthis.on(this.app, \"startCall\", (id, chatId) => {\n\t\t\tthis.StartCall(id, chatId);\n\t\t});\n\n\t\tconst state = this.getParam(\"state\");\n\t\tthis.on(state.$changes, \"callId\", v => {\n\t\t\tif (v) {\n\t\t\t\tif (this.Compact) this.show(\"./call.panel\", { target: \"center\" });\n\t\t\t\telse {\n\t\t\t\t\tthis.show(\"./call.panel\", { target: \"panel\" });\n\t\t\t\t\tthis.show(\"./messages\", { target: \"center\" });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.show(\"./messages\", { target: \"center\" });\n\t\t\t\tif (!this.Compact) this.show(\"_hidden\", { target: \"panel\" });\n\t\t\t}\n\t\t});\n\n\t\tconst back = this.app.getService(\"backend\");\n\t\tconst serverEvents = back.pubsub();\n\t\tconst callStatuses = back.callStatuses;\n\n\t\tthis.on(serverEvents, \"signal\", obj => {\n\t\t\tif (obj.type === \"active\") {\n\t\t\t\tif (!state.timer)\n\t\t\t\t\tback.callInfo().then(info => {\n\t\t\t\t\t\tconst start = new Date(info.start);\n\t\t\t\t\t\t//time on server and client may differ\n\t\t\t\t\t\t//exclude cases where state.time < 0\n\t\t\t\t\t\tconst date = Math.max(new Date(), start);\n\t\t\t\t\t\tstate.time = Math.floor((date - start) / 1000);\n\t\t\t\t\t\tthis.CallTimer();\n\t\t\t\t\t});\n\t\t\t} else if (obj.type === \"connect\") {\n\t\t\t\tconst info = JSON.parse(obj.msg);\n\n\t\t\t\t// already inside another call\n\t\t\t\tif (state.callId && info.id != state.callId && info.status < 900) {\n\t\t\t\t\tback.updateCall(info.id, callStatuses[\"reject\"]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (info.start && !state.timer) this.CallTimer();\n\n\t\t\t\tif (info.status == callStatuses[\"init\"])\n\t\t\t\t\tstate.callChatId = state.chatId;\n\n\t\t\t\tlet callUsers = info.users;\n\t\t\t\tlet callId = info.id;\n\t\t\t\tlet callStatus = info.status;\n\n\t\t\t\tif (\n\t\t\t\t\tinfo.status == callStatuses[\"end\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"reject\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"ignore\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"lost\"]\n\t\t\t\t) {\n\t\t\t\t\tcallUsers = [];\n\t\t\t\t\tcallId = 0;\n\t\t\t\t\tstate.callChatId = null;\n\t\t\t\t\tclearInterval(state.timer);\n\t\t\t\t\tstate.timer = null;\n\t\t\t\t\tstate.time = null;\n\t\t\t\t}\n\t\t\t\tstate.$batch({ callId, callStatus, callUsers });\n\t\t\t}\n\t\t});\n\t}\n\n\tShowDefaultChat() {\n\t\tconst state = this.getParam(\"state\");\n\t\tconst chats = this.app.getService(\"local\").chats();\n\n\t\tchats.waitData.then(() => {\n\t\t\tif (!state.chatId) {\n\t\t\t\tif (!chats.count()) {\n\t\t\t\t\tif (this.Compact) this.ShowSidebar();\n\t\t\t\t} else {\n\t\t\t\t\tstate.chatId = chats.getFirstId();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tShowChat(chatType, chatId, userId) {\n\t\tthis.getParam(\"state\").$batch({ chatId, chatType, userId });\n\t\tthis.show(\"_hidden\", { target: \"top\" });\n\t}\n\n\tShowChatWindow() {\n\t\tthis.show(\"chat.new\", { target: \"top\" });\n\t}\n\tShowChatInfo(id) {\n\t\tthis.show(\"chat.info\", { target: \"top\", params: { id } });\n\t}\n\tShowNewMembersWindow(id) {\n\t\tthis.show(\"chat.members\", { target: \"top\", params: { id } });\n\t}\n\n\tLeaveChat(id, removed) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\");\n\t\tif (id === state.chatId) {\n\t\t\tif (removed) webix.alert(_(\"You have been removed from the group\"));\n\t\t\tstate.$batch({ chatId: 0, chatType: \"\", userId: 0 });\n\t\t}\n\t}\n\n\tSetCompactMode(mode) {\n\t\t// delay is necessary to prevent the refresh call\n\t\t// while this view is still in rendering process\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tShowSidebar() {\n\t\tif (!this.SideMenu || !this.SideMenu.getRoot())\n\t\t\tthis.SideMenu = this.ui(SideMenu);\n\n\t\tconst box = this.$$(\"main\").$view.getBoundingClientRect();\n\t\tthis.SideMenu.Show(box);\n\t}\n\n\tStartCall(id, chatId) {\n\t\tconst state = this.getParam(\"state\");\n\t\t// we can't start new call if previous one is still active\n\t\tif (state.callId) return;\n\n\t\tthis.app.getService(\"backend\").startCall(id, chatId);\n\t}\n\n\tCallTimer() {\n\t\tconst state = this.getParam(\"state\");\n\n\t\tif (!state.time) state.time = 0;\n\n\t\tstate.timer = setInterval(() => {\n\t\t\tthis.app.callEvent(\"updateCallTime\", [++state.time]);\n\t\t}, 1000);\n\t}\n}\n","import ListView from \"./list\";\n\nexport default class UsersView extends ListView {\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").users();\n\t\tthis.InitSelf(users);\n\t}\n\n\tSyncHandler() {\n\t\tthis.$$(\"list\").data.filter(a => a.id != this.app.config.user);\n\t\tthis.$$(\"list\").data.silent(function() {\n\t\t\tthis.sort(\"name\", \"asc\");\n\t\t});\n\t}\n\n\tSelectHandler(id) {\n\t\tthis.app.callEvent(\"showChat\", [\"user\", id * 1]);\n\t}\n\n\tListTemplate(user) {\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\treturn (\n\t\t\thelpers.listAvatar(user) +\n\t\t\thelpers.addTextMark(user.name, this.EscapedSearchText)\n\t\t);\n\t}\n}\n","import m0 from \"views/call/panel\";\nimport m1 from \"views/chat/common/form\";\nimport m2 from \"views/chat/common/people\";\nimport m3 from \"views/chat/common/toolbar\";\nimport m4 from \"views/chat/common/window\";\nimport m5 from \"views/chat/info/form\";\nimport m6 from \"views/chat/info/index.js\";\nimport m7 from \"views/chat/info/info\";\nimport m8 from \"views/chat/info/people\";\nimport m9 from \"views/chat/members/index.js\";\nimport m10 from \"views/chat/new/form\";\nimport m11 from \"views/chat/new/index.js\";\nimport m12 from \"views/chats\";\nimport m13 from \"views/compact/sidemenu\";\nimport m14 from \"views/list\";\nimport m15 from \"views/messages/index.js\";\nimport m16 from \"views/messages/toolbar\";\nimport m17 from \"views/sidebar\";\nimport m18 from \"views/top\";\nimport m19 from \"views/users\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"call/panel\"] = m0;\nviews[\"chat/common/form\"] = m1;\nviews[\"chat/common/people\"] = m2;\nviews[\"chat/common/toolbar\"] = m3;\nviews[\"chat/common/window\"] = m4;\nviews[\"chat/info/form\"] = m5;\nviews[\"chat/info\"] = m6;\nviews[\"chat/info/info\"] = m7;\nviews[\"chat/info/people\"] = m8;\nviews[\"chat/members\"] = m9;\nviews[\"chat/new/form\"] = m10;\nviews[\"chat/new\"] = m11;\nviews[\"chats\"] = m12;\nviews[\"compact/sidemenu\"] = m13;\nviews[\"list\"] = m14;\nviews[\"messages\"] = m15;\nviews[\"messages/toolbar\"] = m16;\nviews[\"sidebar\"] = m17;\nviews[\"top\"] = m18;\nviews[\"users\"] = m19;\n\nexport default views;\n","export default class Local {\n\tconstructor(app) {\n\t\tthis.app = app;\n\n\t\tthis._messages = {};\n\t\tthis._subs = [];\n\t}\n\n\tusers() {\n\t\tif (!this._users) {\n\t\t\tconst back = this.app.getService(\"backend\");\n\t\t\tthis._users = new webix.DataCollection({});\n\t\t\tback.users().then(d => this._users.parse(d));\n\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"users\", u => {\n\t\t\t\t\tconst { op, user_id, data } = u;\n\t\t\t\t\tlet user;\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"online\":\n\t\t\t\t\t\t\tuser = this._users.getItem(user_id);\n\t\t\t\t\t\t\tif (user && user.status != data) {\n\t\t\t\t\t\t\t\tthis._users.updateItem(user_id, { status: data });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn this._users;\n\t}\n\tchats() {\n\t\tconst state = this.app.getState();\n\t\tif (!this._chats) {\n\t\t\tthis._chats = new webix.DataCollection({\n\t\t\t\tscheme: {\n\t\t\t\t\t$change: obj => {\n\t\t\t\t\t\tif (obj.date && typeof obj.date === \"string\")\n\t\t\t\t\t\t\tobj.date = new Date(obj.date);\n\t\t\t\t\t\tif (obj.direct_id) {\n\t\t\t\t\t\t\tconst user = this.users().getItem(obj.direct_id);\n\t\t\t\t\t\t\tif (!obj.name) obj.name = \"PM: \" + user.name;\n\t\t\t\t\t\t\tif (!obj.avatar) {\n\t\t\t\t\t\t\t\tobj.avatar = user.avatar;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$sort: {\n\t\t\t\t\t\tby: \"date\",\n\t\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\t\tas: \"date\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst back = this.app.getService(\"backend\");\n\t\t\tPromise.all([back.chats(), this.users().waitData]).then(d => {\n\t\t\t\tthis._chats.parse(d[0]);\n\t\t\t});\n\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"chats\", c => {\n\t\t\t\t\tconst { op, chat_id, data } = c;\n\t\t\t\t\tlet update;\n\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"add\":\n\t\t\t\t\t\tcase \"update\":\n\t\t\t\t\t\t\t// user removed from the chat\n\t\t\t\t\t\t\tif (data.users.indexOf(this.app.config.user) == -1) {\n\t\t\t\t\t\t\t\tif (this._chats.exists(chat_id)) {\n\t\t\t\t\t\t\t\t\tthis.app.callEvent(\"removeChatMember\", [chat_id]);\n\t\t\t\t\t\t\t\t\tthis._chats.remove(chat_id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// new chat created\n\t\t\t\t\t\t\tif (!this._chats.exists(chat_id)) this._chats.add(data, 0);\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// chat updated\n\t\t\t\t\t\t\t\tupdate = {\n\t\t\t\t\t\t\t\t\tname: data.name,\n\t\t\t\t\t\t\t\t\tavatar: data.avatar,\n\t\t\t\t\t\t\t\t\tusers: data.users,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (!data.direct_id) {\n\t\t\t\t\t\t\t\t\tupdate.direct_id = 0;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._chats.updateItem(chat_id, update);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"message\":\n\t\t\t\t\t\t\tthis._chats.updateItem(chat_id, {\n\t\t\t\t\t\t\t\tmessage: data.message,\n\t\t\t\t\t\t\t\tmessage_type: data.message_type,\n\t\t\t\t\t\t\t\tdate: new Date(data.date),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"messages\", c => {\n\t\t\t\t\tconst { op, msg } = c;\n\t\t\t\t\tlet chat;\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"add\":\n\t\t\t\t\t\t\tchat = this._chats.getItem(msg.chat_id);\n\t\t\t\t\t\t\tif (chat) {\n\t\t\t\t\t\t\t\tif (state.chatId != chat.id) {\n\t\t\t\t\t\t\t\t\tthis._chats.updateItem(chat.id, {\n\t\t\t\t\t\t\t\t\t\tmessage: msg.text,\n\t\t\t\t\t\t\t\t\t\tmessage_type: msg.type,\n\t\t\t\t\t\t\t\t\t\tunread_count: chat.unread_count + 1,\n\t\t\t\t\t\t\t\t\t\tdate: msg.date,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis._chats.updateItem(chat.id, {\n\t\t\t\t\t\t\t\t\t\tmessage: msg.text,\n\t\t\t\t\t\t\t\t\t\tmessage_type: msg.type,\n\t\t\t\t\t\t\t\t\t\tdate: msg.date,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tback.resetCounter(chat.id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (this._chats.getIndexById(chat.id))\n\t\t\t\t\t\t\t\t\tthis._chats.moveTop(chat.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn this._chats;\n\t}\n\tmessages(id) {\n\t\t// ignore cache for now\n\t\t// const cache = this._messages[id];\n\t\t// if (cache)\n\t\t// \treturn cache;\n\n\t\tconst backs = this.app.getService(\"backend\");\n\t\treturn (this._messages[id] = backs.messages(id));\n\t}\n}\n","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import { Client } from \"remote-client\";\n\nexport default class Backend {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tconst remote = new Client({\n\t\t\turl: app.config.url,\n\t\t\ttoken: app.config.token,\n\t\t});\n\n\t\tthis._ready = remote.load().then(back => {\n\t\t\tthis._api = back.api;\n\t\t\tthis._data = back.data;\n\t\t\tthis._pubsub = {\n\t\t\t\tattachEvent: (name, handler) => back.on(name, handler),\n\t\t\t\tdetachEvent: ev => back.detach(ev),\n\t\t\t};\n\n\t\t\tconst id = (app.config.user = this._data.user);\n\t\t\tapp.config.device = this._data.device;\n\t\t\t// mark current user as online\n\t\t\tthis._data.users.forEach(a => {\n\t\t\t\tif (a.id === id) a.status = 2;\n\t\t\t});\n\t\t});\n\n\t\tthis.callStatuses = {\n\t\t\tinit: 1,\n\t\t\taccept: 2,\n\t\t\tactive: 3,\n\t\t\tdrop: 900,\n\t\t\treject: 901,\n\t\t\tend: 902,\n\t\t\tignore: 903,\n\t\t\tlost: 904,\n\t\t};\n\n\t\tthis.callMessages = {\n\t\t\t900: \"start\",\n\t\t\t901: \"reject\",\n\t\t\t902: \"ignore\",\n\t\t};\n\t}\n\n\tready() {\n\t\treturn this._ready;\n\t}\n\n\tusers() {\n\t\treturn Promise.resolve(this._data.users);\n\t}\n\tchats() {\n\t\treturn Promise.resolve(this._data.chats);\n\t}\n\tcallInfo() {\n\t\treturn Promise.resolve(this._data.call);\n\t}\n\taddChat(uid) {\n\t\treturn this._api.chat.AddDirect(uid * 1);\n\t}\n\tmessages(cid) {\n\t\treturn this._api.message.GetAll(cid * 1).then(data => {\n\t\t\tdata.forEach(a => (a.date = new Date(a.date)));\n\t\t\treturn data;\n\t\t});\n\t}\n\taddMessage(cid, text, origin) {\n\t\treturn this._api.message.Add(text, cid * 1, origin.toString()).then(a => {\n\t\t\ta.date = new Date(a.date);\n\t\t\treturn a;\n\t\t});\n\t}\n\n\tremoveMessage(messageId) {\n\t\treturn this._api.message.Remove(messageId * 1);\n\t}\n\n\tupdateMessage(messageId, text) {\n\t\treturn this._api.message.Update(messageId * 1, text);\n\t}\n\n\tresetCounter(cid) {\n\t\tthis._api.message.ResetCounter(cid * 1);\n\t}\n\n\tpubsub() {\n\t\treturn this._pubsub;\n\t}\n\n\taddGroupChat(name, avatar, users) {\n\t\treturn this._api.chat.AddGroup(name, avatar, users);\n\t}\n\n\tupdateChat(id, name, avatar) {\n\t\treturn this._api.chat.Update(id, name, avatar);\n\t}\n\n\tleave(chatId, userId) {\n\t\treturn this._api.chat.Leave(chatId, userId);\n\t}\n\n\tsetUsers(chatId, users) {\n\t\treturn this._api.chat.SetUsers(chatId, users);\n\t}\n\n\tavatarUploadUrl() {\n\t\treturn this.app.config.url + \"/chat/0/avatar\";\n\t}\n\n\tstartCall(withUser, chatID) {\n\t\treturn this._api.call.Start(withUser, chatID);\n\t}\n\n\tupdateCall(id, value) {\n\t\treturn this._api.call.SetStatus(id, value);\n\t}\n\tsignalCall(type, payload) {\n\t\treturn this._api.call.Signal(type, payload);\n\t}\n}\n","export default class Operations {\n\tconstructor(_app) {\n\t\tthis._app = _app;\n\t\tthis._local = this._app.getService(\"local\");\n\t\tthis._back = this._app.getService(\"backend\");\n\t}\n\n\taddChat(userId) {\n\t\treturn this._back.addChat(userId).then(chat => {\n\t\t\tthis._local.chats().add(chat, 0);\n\t\t\treturn chat.id;\n\t\t});\n\t}\n\n\taddMessage(cid, origin, text) {\n\t\tconst chats = this._local.chats();\n\t\tchats.updateItem(cid, {\n\t\t\tmessage: this._getMessageText(text),\n\t\t\tmessage_type: 0,\n\t\t\tdate: new Date(),\n\t\t});\n\t\tif (chats.getIndexById(cid)) chats.moveTop(cid);\n\t\treturn this._back.addMessage(cid, text, origin);\n\t}\n\n\tremoveMessage(id) {\n\t\treturn this._back.removeMessage(id);\n\t}\n\n\tupdateMessage(id, text) {\n\t\treturn this._back.updateMessage(id, text);\n\t}\n\t_getMessageText(text) {\n\t\treturn text.substr(0, Math.min(text.length, 80));\n\t}\n\tresetCounter(cid) {\n\t\tthis._back.resetCounter(cid);\n\n\t\tconst chats = this._local.chats();\n\t\tif (chats.exists(cid)) {\n\t\t\tchats.updateItem(cid, { unread_count: 0 });\n\t\t}\n\t}\n\n\taddGroupChat(name, avatar, users) {\n\t\treturn this._back.addGroupChat(name, avatar, users).then(chat => {\n\t\t\tthis._local.chats().add(chat, 0);\n\t\t\treturn chat.id;\n\t\t});\n\t}\n\n\tupdateChat(chatId, name, avatar) {\n\t\treturn this._back.updateChat(chatId, name, avatar).then(info => {\n\t\t\tthis._local.chats().updateItem(chatId, info);\n\t\t});\n\t}\n\n\tleaveChat(chatId) {\n\t\treturn this._back.leave(chatId, this._app.config.user).then(() => {\n\t\t\tthis._app.callEvent(\"leaveChat\", [chatId]);\n\t\t\tthis._local.chats().remove(chatId);\n\t\t});\n\t}\n\n\tsetUsers(chatId, users) {\n\t\treturn this._back.setUsers(chatId, users).then(info => {\n\t\t\tconst chat = this._local.chats();\n\t\t\tif (info.id == chatId) chat.updateItem(chatId, info);\n\t\t\telse {\n\t\t\t\tchat.add(info, 0);\n\t\t\t\tthis._app.callEvent(\"showChat\", [chat, info.id]);\n\t\t\t}\n\t\t});\n\t}\n}\n","export default class UploadHandler {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.initUploader();\n\t}\n\n\tinitUploader() {\n\t\tthis.uploader = webix.ui({\n\t\t\tview: \"uploader\",\n\t\t\tapiOnly: true,\n\t\t\taccept: \"image/*\",\n\t\t\tautosend: true,\n\t\t\ton: {\n\t\t\t\tonBeforeFileAdd: () => this.configUpload(),\n\t\t\t},\n\t\t});\n\t}\n\n\tconfig(props) {\n\t\twebix.extend(this.uploader.config, props, true);\n\t}\n\n\tgetUploader() {\n\t\treturn this.uploader;\n\t}\n\n\tconfigUpload() {\n\t\tthis.uploader.config.upload = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.avatarUploadUrl();\n\t}\n\n\tfileDialog() {\n\t\tthis.uploader.fileDialog();\n\t}\n}\n","export default class Helpers {\n\tconstructor() {\n\t\t//status\n\t\tthis.statusMap = {\n\t\t\t1: \"none\",\n\t\t\t2: \"active\",\n\t\t\t3: \"busy\",\n\t\t\t4: \"away\",\n\t\t};\n\t\t// icons\n\t\tthis.checkedIcon = \"<span class='webix_icon wxi-checkbox-marked'></span>\";\n\t\tthis.notCheckedIcon = \"<span class='webix_icon wxi-checkbox-blank'></span>\";\n\t\t//date formats\n\t\tthis.dateMask = \"%d.%m.%Y\";\n\t\tthis.weekMask = \"%D\";\n\t\tthis.todayDateMask = \"%H:%i\";\n\t}\n\n\tstatus(user) {\n\t\treturn (\n\t\t\t\"<span class = 'webix_chat_status webix_chat_status_\" +\n\t\t\tthis.statusMap[user.status] +\n\t\t\t\"'></span>\"\n\t\t);\n\t}\n\n\tlistAvatar(user, cssClass) {\n\t\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_chat_list_avatar\";\n\t\tlet html = `<div class='${css}'>`;\n\t\tif (user.status) html += this.status(user);\n\t\thtml += this.avatar(user);\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t}\n\n\tinitials(name) {\n\t\tlet initials = name.match(/\\b\\w/g) || [];\n\t\treturn ((initials.shift() || \"\") + (initials.pop() || \"\")).toUpperCase();\n\t}\n\n\tavatar(user, cssClass) {\n\t\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_chat_avatar\";\n\t\tif (user.avatar) return `<img alt=\"\" class=\"${css}\" src=\"${user.avatar}\"/>`;\n\t\tif (!user.name) return `<div class='${css} webix_icon wxi-user'></div>`;\n\t\treturn `<div class='${css}'>${this.initials(user.name || \"\")}</div>`;\n\t}\n\n\tformAvatar(user, tooltip) {\n\t\tlet css = \"webix_chat_avatar\";\n\t\tif (user.avatar)\n\t\t\treturn `<img alt=\"\" title=\"${tooltip}\" class=\"${css}\" src=\"${user.avatar}\"/>`;\n\t\treturn `<div class='${css}  webix_icon chi-camera' title='${tooltip}'</div>`;\n\t}\n\n\tdateChatFormat(date) {\n\t\tlet mask = this.dateMask;\n\t\tconst today = webix.Date.datePart(new Date(), true);\n\t\tconst day = webix.Date.datePart(date, true);\n\t\tif (webix.Date.equal(day, today)) mask = this.todayDateMask;\n\t\telse if (day > webix.Date.add(today, -7, \"day\")) mask = this.weekMask;\n\t\treturn webix.Date.dateToStr(mask)(date);\n\t}\n\n\tpeopleList(users, deleteIcon, groupUsers) {\n\t\tlet list = \"<ul class='webix_chat_peoplelist'>\";\n\t\tusers.forEach(user => {\n\t\t\tlist +=\n\t\t\t\t`<li class='webix_chat_peoplelist_item' data-id='${user.id}'>` +\n\t\t\t\t\"<div class='webix_chat_peoplelist_avatar'>\" +\n\t\t\t\tthis.avatar(user) +\n\t\t\t\t(groupUsers && groupUsers.indexOf(user.id) >= 0\n\t\t\t\t\t? \"<div class='webix_chat_group_user_marker'><span class='webix_icon wxi-check'></span></div>\"\n\t\t\t\t\t: \"\") +\n\t\t\t\t(deleteIcon\n\t\t\t\t\t? \"<div class='webix_chat_peoplelist_delete_icon'><span class='webix_icon wxi-close'></span></div>\"\n\t\t\t\t\t: \"\") +\n\t\t\t\t\"</div>\" +\n\t\t\t\t`<br/><span class=\"webix_chat_peoplelist_item_name\">${user.name}</span></li>`;\n\t\t});\n\t\tlist += \"</ul>\";\n\t\treturn list;\n\t}\n\n\t/* adds a mark for text occurrence in a value */\n\taddTextMark(value, text) {\n\t\tif (!text) return value;\n\n\t\treturn value.replace(\n\t\t\tnew RegExp(\"(\" + text + \")\", \"ig\"),\n\t\t\t\"<span class='webix_chat_search_mark'>$1</span>\"\n\t\t);\n\t}\n\n\tnormalizeTime(seconds) {\n\t\tseconds = seconds || 0;\n\t\tconst min = Math.floor(seconds / 60);\n\t\tconst sec = seconds - min * 60;\n\t\treturn (min < 10 ? \"0\" + min : min) + \":\" + (sec < 10 ? \"0\" + sec : sec);\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\n// services\nimport Local from \"./models/Local\";\nimport Backend from \"./models/Backend\";\nimport Operations from \"./models/Operations\";\nimport Upload from \"./models/Upload\";\nimport Helpers from \"./models/Helpers\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tchatId: 0,\n\t\t\tchatType: null,\n\t\t\tuserId: null,\n\t\t\tsearch: \"\",\n\n\t\t\tcallStatus: 0,\n\t\t\tcallId: 0,\n\t\t\tcallUsers: [],\n\t\t});\n\t\tconst params = { state };\n\t\tif (config.compat) params.forceCompact = config.compact;\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/top\",\n\t\t\tmode: \"full\",\n\t\t\tcompactWidth: 650,\n\t\t\tparams,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// better error reporting\n\t\tif (this.config.debug) {\n\t\t\twebix.Promise = window.Promise;\n\t\t}\n\n\t\tconst dynamic = obj =>\n\t\t\tthis.config.override ? this.config.override.get(obj) || obj : obj;\n\n\t\tthis.setService(\"local\", new (dynamic(Local))(this));\n\t\tthis.setService(\"backend\", new (dynamic(Backend))(this));\n\t\tthis.setService(\"operations\", new (dynamic(Operations))(this));\n\t\tthis.setService(\"upload\", new (dynamic(Upload))(this));\n\t\tthis.setService(\"helpers\", new (dynamic(Helpers))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\trender(node) {\n\t\tconst back = this.getService(\"backend\");\n\t\tback\n\t\t\t.ready()\n\t\t\t.then(() => back.callInfo())\n\t\t\t.then(info => {\n\t\t\t\tif (info && info.id) {\n\t\t\t\t\tconst state = this.config.params.state;\n\t\t\t\t\tstate.$batch({\n\t\t\t\t\t\tcallId: info.id,\n\t\t\t\t\t\tcallUsers: info.users,\n\t\t\t\t\t\tcallStatus: info.status,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tsuper.render(node);\n\t\t\t});\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\t// for external users\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"chat\",\n\t\tapp: App,\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\t$init() {\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Local, Backend, Operations, Upload, Helpers };\nconst locales = { en };\nexport { views, locales, services };\n","export default {\n\t\"Add members\": \"Add members\",\n\t\"Are you sure to leave this chat?\": \"Are you sure to leave this chat?\",\n\tAvatar: \"Avatar\",\n\t\"Are you sure to delete this member?\": \"Are you sure to delete this member?\",\n\tCancel: \"Cancel\",\n\t\"Change avatar\": \"Change avatar\",\n\t\"Chat info\": \"Chat info\",\n\t\"Chat name\": \"Chat name\",\n\tChats: \"Chats\",\n\t\"Create group\": \"Create group\",\n\tDelete: \"Delete\",\n\t\"Delete member\": \"Delete member\",\n\t\"Edit chat\": \"Edit chat\",\n\tLeave: \"Leave\",\n\t\"Leave chat\": \"Leave chat\",\n\tmember: \"member\",\n\tmembers: \"members\",\n\tMembers: \"Members\",\n\t\"New chat\": \"New chat\",\n\t\"No people to add\": \"No people to add\",\n\tPeople: \"People\",\n\tSave: \"Save\",\n\tSearch: \"Search\",\n\t\"Show all members\": \"Show all members\",\n\tUsers: \"Users\",\n\tYou: \"You\",\n\tRinging: \"Ringing...\",\n\t\"Active call\": \"Active call\",\n\t\"Is calling you\": \"Is calling you...\",\n\tAccept: \"Accept\",\n\tReject: \"Reject\",\n\t\"Start call\": \"Start call\",\n\t\"Join call\": \"Join call\",\n\t\"End call\": \"End call\",\n\t\"Ended call\": \"Ended call\",\n\t\"Incoming call\": \"Incoming call\",\n\t\"Outgoing call\": \"Outgoing call\",\n\t\"Rejected call\": \"Rejected call\",\n\t\"Missed call\": \"Missed call\",\n\t\"Could not find your\": \"Could not find your\",\n\t\"Error opening your\": \"Error opening your\",\n\tmicrophone: \"microphone\",\n\tcamera: \"camera\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","reportError","rtc","sendSignal","rtcConfig","iceServers","urls","username","credential","conn","RTCPeerConnection","action","onicecandidate","ev","candidate","ontrack","onnegotiationneeded","createOffer","offer","setLocalDescription","localDescription","oniceconnectionstatechange","iceConnectionState","onicegatheringstatechange","signalingState","final","onremovetrack","onremovestream","onsignalingstatechange","close","mediaValues","audio","echoCancellation","noiseSuppression","video","facingMode","mode","emode","restart","restartIce","status","remoteDescription","enable","kind","defer","tracks","getSenders","map","track","reduce","p","c","filter","enabled","onOffer","msg","desc","RTCSessionDescription","setRemoteDescription","createAnswer","answer","onAnswer","upgrade","navigator","mediaDevices","getUserMedia","_a","local","getTracks","addTrack","alert","handleGetUserMediaError","onCandidate","RTCIceCandidate","addIceCandidate","setStream","nodes","tag","stream","MediaStream","srcObject","CallPanel","time","Helpers","getService","Back","callStatuses","State","LocalState","remoteVideo","remoteAudio","Initiator","callUsers","user","callStatus","AfterRefresh","users","_users","width","rows","css","animate","borderless","cells","GetAudioConfig","GetVideoConfig","minHeight","gravity","avatar","getItem","GetActionsConfig","$view","localVideo","querySelector","localAvatar","on","pubsub","JSON","Phone","UpdateCallTime","$changes","HandleCallStatusChange","ShowVideo","batch","height","normalizeTime","cols","click","AcceptCall","RejectCall","Start","EndCall","icon","SetFullscreen","fullscreen","offIcon","onIcon","EnableVideo","EnableAudio","actions","showBatch","exit","head","isAfterRefresh","ControlVisibility","InitPhone","isInitiator","alist","querySelectorAll","vlist","role","baseConn","remote","stop","removeAttribute","getReceivers","active","finally","phone","SendSignal","v","updateCall","callId","payload","stringify","signalCall","toggle","setValue","visibility","node","style","display","CheckVideoVisibility","FormView","helpers","padding","margin","elementsConfig","labelWidth","labelAlign","elements","align","formAvatar","onClick","webix_chat_avatar","upload","fileDialog","inputAlign","placeholder","onChange","NameChangedHandler","onTimedKeyPress","getValue","getUploader","UpdateAvatar","setValues","delay","focus","file","reader_1","FileReader","onload","SetLocalAvatar","readAsDataURL","AvatarChangedHandler","values","form","datafilter","umMasterCheckox","master","onclick","checked","className","each","columnId","masterCheckbox","PeopleView","visibleBatch","autoheight","scroll","rowHeight","headerRowHeight","Math","max","skin","$active","barHeight","columns","GetColumns","scheme","$sort","by","dir","checkboxRefresh","onItemClick","Toggle","row","onCustomSave","UpdatePeopleList","table","Users","UsersStore","clearAll","serialize","sort","b","SortUsers","LoadPeopleList","sync","header","content","colspan","prepare","toLowerCase","GetCompare","cssFormat","selected","checkedIcon","notCheckedIcon","listAvatar","fillspace","searchValue","peopleList","ai","bi","item","updateItem","GetSelected","SetBatch","GetPeopleList","setHTML","GetSelectedIds","ids","users_1","Toolbar","toolbarHeight","state","toolbar","ButtonFactory","hotkey","inputHeight","cursor","label","BaseWindow","Compact","modal","move","position","chat","chats","group","direct_id","stages","Close","Save","ops","getValues","updateChat","$batch","FormBaseView","NewChatWin","LeaveChat","title","ok","cancel","leaveChat","ChatInfo","ShowAll","MemberListMaxCount","CanAddUsers","chatAvatar","membersList","ListTemplate","webix_chat_list_item_delete","DeleteMemberClickHandler","addMembersButton","leaveChatButton","webix_chat_show_all_btn","ShowAllMembers","inputWidth","InitMembersList","Filter","members","Sort","youText","DeleteButtonTemplate","hide","MemberListCount","isDirect","groupMember","setUsers","PeopleBaseView","nextButton","disabled","ShowNextPage","disable","addGroupChat","cid","ListView","select","common","ApplySearchValue","SyncHandler","SelectHandler","getState","Find","EscapedSearchText","EscapeRegExp","SearchCompare","getSelectedId","chatsView","limited","InitSelf","waitData","ShowChat","unselectAll","addTextMark","date","dateChatFormat","unread_count","message_type","$cssName","on_click","webix_input_icon","closeIcon","getInputNode","hideCloseIcon","setIcon","getElementsByClassName","showCloseIcon","defaults","SideBar","bottomOffset","ShowPanel","SideMenu","left","Parent","box","Limited","right","TitleTemplate","webix_chat_title","ChatInfoHandler","tooltip","StartCallHandler","NewMembersHandler","ToggleMenu","chatId","Refresh","InitMenu","userId","calls","ToolbarMenu","y","autowidth","GetMenuData","MessagesView","sendAction","currentUser","image","listItem","templateText","MessageTemplateText","templateMenu","MessageTemplateMenu","templateUser","MessageTemplateUser","templateAvatar","MessageTemplateAvatar","templateDate","MessageTemplateDate","comments","Comments","Local","serverEvents","Ops","getUsers","chat_id","userId_1","formatted","AddMessage","ScrollToBottom","addChat","IsUsersMessage","removeMessage","updateMessage","FilterUsers","pack","op","origin","exists","changeId","add","remove","LoadChat","user_id","messageId","addMessage","showItem","getLastId","messages","resetCounter","Focus","outgoing","arrow","callMessages","readonly","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","TopView","isSingle","fCompact","isForced","compactWidth","SetCompactMode","ShowDefaultChat","ShowSidebar","find","ShowChatWindow","ShowChatInfo","ShowNewMembersWindow","StartCall","back","timer","callInfo","info","floor","CallTimer","callChatId","clearInterval","getFirstId","chatType","removed","getBoundingClientRect","Show","startCall","setInterval","UsersView","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","_messages","d","u","_chats","$change","as","back_1","getIndexById","moveTop","backs","s","_url","_token","_mode","_seed","_queue","api","Accept","Content-Type","Remote-Token","credentials","headers","fetch","json","e_1","e_2","s_1","t_1","_wrapper","connect","_socket","onclose","protocol","host","o","r","WebSocket","onmessage","fire","_send","_resubscribe","onError","_uid","args","onCall","send","e_3","t_2","t_3","e_4","onResponse","splice","t_4","t_6","t_5","t_7","Client","_ready","load","_api","_pubsub","detach","device","accept","drop","ignore","lost","900","901","902","Backend","AddDirect","GetAll","Add","Remove","Update","ResetCounter","AddGroup","Leave","SetUsers","withUser","chatID","SetStatus","Signal","_app","_local","_back","Operations","_getMessageText","min","leave","initUploader","UploadHandler","uploader","apiOnly","autosend","onBeforeFileAdd","configUpload","props","avatarUploadUrl","statusMap","1","2","3","4","dateMask","weekMask","todayDateMask","cssClass","initials","match","pop","toUpperCase","today","datePart","day","equal","dateToStr","deleteIcon","groupUsers","seconds","sec","compat","forceCompact","compact","dynamic","Upload","use","App","locales","jetapp","services","Add members","Are you sure to leave this chat?","Avatar","Are you sure to delete this member?","Cancel","Change avatar","Chat info","Chat name","Chats","Create group","Delete","Delete member","Edit chat","Leave chat","member","Members","New chat","No people to add","People","Search","Show all members","You","Ringing","Active call","Is calling you","Reject","Start call","Join call","End call","Ended call","Incoming call","Outgoing call","Rejected call","Missed call","Could not find your","Error opening your","microphone","camera"],"mappings":"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"}